var O=Object.defineProperty;var Z=(u,t,e)=>t in u?O(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var c=(u,t,e)=>(Z(u,typeof t!="symbol"?t+"":t,e),e);import{f as b,V as f,h as D,n as N,r as B,Z as X,H as F,i as k,s as z,p as G}from"./elements.b2968f38.js";import{G as E,A as Q}from"./GridLayer.fc0b255b.js";class T{static newton(t,e=.01,s=1e3,r=.5,i=0,n=1){let a=r;for(let h=0;h<s;h++){const l=t(a);if(Math.abs(l)<e)return b(a,i,n);const g=(t(a+1e-4)-l)/1e-4;a=a-l/g}return null}static bisect(t,e=.01,s=1e3,r=.5,i=0,n=1){let o=i,a=n,h=r,l,g;for(g=0;g<s;g++){if(l=t(h),Math.abs(l)<e)return h;l<0?a=h:o=h,h=(a+o)/2}return h}static findRoot(t,e=.01,s=1e3,r=.5,i=0,n=1){let o=T.newton(t,e,s,r);return o==null&&(o=T.bisect(t,e,s,r,i,n)),o}}class Y{static bisect(t,e=0,s=1,r=.005,i=4,n=10){const o=(A,_,x,y,M,P,d=0)=>{const p=(A+_)/2,L=t(p),m=f.distance(x,L),v=f.distance(L,y),S=m+v;if(d>=i&&Math.abs(S-M)<P||d>=n)return S;const I=P/2,H=d+1;return o(A,p,x,L,m,I,H)+o(p,_,L,y,v,I,H)},a=t(e),h=t(s),l=f.distance(a,h);return o(e,s,a,h,l,r)}static trapezoid(t,e=0,s=1,r=1e3){let i=0,n=t(e);const o=(s-e)/(r-1);for(let a=1;a<r;a++){const h=t(e+a*o),l=f.distance(n,h);i+=l,n=h}return i}}class U{static search(t,e){let s=0,r=t.length-1,i=Math.floor(s+r/2);for(;i>s&&i<r;){const n=t[i],o=t[i+1];if(n<=e&&o>=e)return i;e<n?r=i:s=i,i=Math.floor(s+r/2)}return i}}class w extends D{constructor(e,s){super(e,s);c(this,"arcLengthLookup",[]);this.findTForArcLength=this.findTForArcLength.bind(this),this.findTByRootForArcLength=this.findTByRootForArcLength.bind(this),this.findApproxTForArcLength=this.findApproxTForArcLength.bind(this),this.findTQuickForArcLength=this.findTQuickForArcLength.bind(this),this.generateArcLengthLookup=this.generateArcLengthLookup.bind(this),this.getArcLength=this.getArcLength.bind(this),this.getQuickArcLength=this.getQuickArcLength.bind(this),this.getPointAtArcLength=this.getPointAtArcLength.bind(this),this.getPointAt=this.getPointAt.bind(this)}findTForArcLength(e,s){let r;return s!=null&&s.approxT?r=this.findApproxTForArcLength(e,s==null?void 0:s.normalizedLength):s!=null&&s.quickT?r=this.findTQuickForArcLength(e):r=this.findTByRootForArcLength(e),r}findTByRootForArcLength(e,s=.01,r=100){return e<=0?0:e>=this.length?1:T.findRoot(n=>e-this.getQuickArcLength(0,n),s,r,e/this.length)}findApproxTForArcLength(e,s){return e/(s||this.length)}findTQuickForArcLength(e){this.arcLengthLookup.length===0&&this.generateArcLengthLookup();const s=U.search(this.arcLengthLookup,e),r=this.arcLengthLookup[s],i=this.arcLengthLookup[s+1];return(s+(e-r)/(i-r))/this.arcLengthLookup.length}generateArcLengthLookup(e=1e3){let s=this.getPointAt(0),r=0;for(let i=0;i<e;i++){const n=this.getPointAt(i/(e-1)),o=f.distance(s,n);r+=o,this.arcLengthLookup.push(r),s=n}}getArcLength(e=0,s=1){if(e===0&&s===1)return this.length;const r=.002;return Y.bisect(i=>this.getPointAt(i),e,s,r)}getQuickArcLength(e=0,s=1){let r=0,i=this.length;if(this.arcLengthLookup.length===0&&this.generateArcLengthLookup(),e!==0){const o=Math.floor(e*this.arcLengthLookup.length),a=this.arcLengthLookup[o],h=this.arcLengthLookup[o+1];r=a+e*this.arcLengthLookup.length%this.arcLengthLookup.length*(h-a)}if(s!==1){const o=Math.floor(s*this.arcLengthLookup.length),a=this.arcLengthLookup[o],h=this.arcLengthLookup[o+1];i=a+e*this.arcLengthLookup.length%this.arcLengthLookup.length*(h-a)}return i-r}getPointAtArcLength(e,s){const r=this.findTForArcLength(e,s);return this.getPointAt(r)}getPointAt(e){const s=b(e,0,1);return super.getPointAt(s)}}const V=.75,C=5e3,R=.001,q=1e3,$=1e3,W=5e-4,J=.1,K={approxT:!0};class j{constructor(t,e){c(this,"options");c(this,"path",[]);c(this,"projectedPath",[]);c(this,"projectedTrajectory");c(this,"_offset",0);c(this,"displacement");c(this,"depthReference");c(this,"wellboreId");c(this,"trajectoryOffset");c(this,"interpolators");c(this,"startVector");c(this,"endVector");c(this,"_curtainPathCache");if(t.length<1)throw new Error("Missing coordinates");if(t[0]&&t[0].length!==3)throw new Error("Coordinates should be in 3d");this.setPath(t,e),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.getPosition=this.getPosition.bind(this),this.getProjectedLength=this.getProjectedLength.bind(this),this.getTrajectory=this.getTrajectory.bind(this)}setPath(t,e={}){this.options={...K,...e};const{arcDivisions:s,tension:r,calculateDisplacementFromBottom:i}=this.options;this.path=t,this.projectedPath=j.toDisplacement(t);const[n]=this.projectedPath[this.projectedPath.length-1];this.displacement=n,this.interpolators={curve:e.curveInterpolator||new w(t),trajectory:e.trajectoryInterpolator||new w(t.map(h=>[h[0],h[1]]),{tension:r||V,arcDivisions:s||C}),curtain:e.curtainInterpolator||new w(this.projectedPath,{tension:r||V,arcDivisions:s||C})};const o=this.getTrajectoryVector(),a=o.map(h=>h*-1);i?(this.endVector=a,this.startVector=o):(this.endVector=o,this.startVector=a),this._curtainPathCache=void 0}project(t){const{curtain:e}=this.interpolators,{calculateDisplacementFromBottom:s}=this.options,r=b(s?this.length-(t-this._offset):t-this._offset,0,this.length);return e.getPointAtArcLength(r,this.options)}curtainTangent(t){const{curtain:e}=this.interpolators,s=t-this._offset,r=e.findTForArcLength(s,this.options);return r&&e.getTangentAt(r)}getCurtainPath(t,e,s=!1){if(!this._curtainPathCache){const r=[];let i=Math.PI*2;for(let n=this._offset;n<=this.length+this._offset;n+=J){const o=this.project(n),a=Math.atan2(o[1],o[0]);Math.abs(a-i)>W&&(r.push({point:o,md:n}),i=a)}this._curtainPathCache=r}if(s){const r={point:this.project(t),md:t},i=this._curtainPathCache.filter(o=>o.md>t&&o.md<e),n={point:this.project(e),md:e};return[r,...i,n]}return this._curtainPathCache.filter(r=>r.md>=t&&r.md<=e)}unproject(t){const{normalizedLength:e,calculateDisplacementFromBottom:s}=this.options,r=s?this.displacement-t:t,i=e||this.length;if(r<0)return r;if(r>this.displacement)return i+(r-this.displacement);const n=this.interpolators.curtain.lookupPositions(r,0,1);return n&&n.length?n[0]*i+this._offset:null}getProjectedLength(t){const{curtain:e}=this.interpolators,r=this.project(t)[0]/e.maxX;return Number.isFinite(r)?b(r,0,1):0}getPosition(t){const{trajectory:e}=this.interpolators,s=this.getProjectedLength(t);return e.getPointAt(s)}getTrajectory(t,e=0,s=1){const r=e<0?-e:0,i=s>1?s-1:0,n=this.interpolators.trajectory.getPointAt(0),o=this.interpolators.trajectory.getPointAt(1);let a,h,l=0;const g=Math.max(0,e),A=Math.min(1,s),_=this.interpolators.trajectory.getPointAt(g),x=this.interpolators.trajectory.getPointAt(A);r?(a=[n[0]+this.startVector[0]*r*this.displacement,n[1]+this.startVector[1]*r*this.displacement],l=-f.distance(a,n)):e>0&&(l=f.distance(_,n)),i&&(h=[o[0]+this.endVector[0]*i*this.displacement,o[1]+this.endVector[1]*i*this.displacement]);const y=[],M=s-e,P=Math.floor(r/M*t),d=Math.ceil((A-g)/M*t),p=t-d-P;if(a){y.push(a);for(let m=1;m<P;m++){const v=m/P*r*this.displacement;y.push([a[0]-this.startVector[0]*v,a[1]-this.startVector[1]*v])}}const L=this.interpolators.trajectory.getPoints(d-1,null,g,A);if(y.push(...L),h){for(let m=1;m<p-1;m++){const v=m/p*i*this.displacement;y.push([x[0]+this.endVector[0]*v,x[1]+this.endVector[1]*v])}y.push(h)}return{points:y,offset:l}}getExtendedTrajectory(t,e=q,s=$){if(!isFinite(e)||e<0)throw new Error("Invalid parameter, getExtendedTrajectory() must be called with a valid and positive startExtensionLength parameter");if(!isFinite(s)||s<0)throw new Error("Invalid parameter, getExtendedTrajectory() must be called with a valid and positive endExtensionLength parameter");const r=this.displacement+e+s,i=Math.floor(e/r*t),n=Math.max(Math.ceil(this.displacement/r*t),1),o=t-n-i,a=[],h=new f(this.interpolators.trajectory.getPointAt(0)),l=new f(this.startVector),g=e/i;for(let d=i;d>0;d--){const p=d*g,L=h.add(l.scale(p));a.push(L.toArray())}const A=this.interpolators.trajectory.getPoints(n,null,0,1);a.push(...A);const _=new f(this.interpolators.trajectory.getPointAt(1)),x=new f(this.endVector),y=s/(o-1);for(let d=1;d<o;d++){const p=d*y,L=_.add(x.scale(p));a.push(L.toArray())}const M=-e;return{points:a,offset:M}}getTrajectoryVector(){const{trajectoryAngle:t,calculateDisplacementFromBottom:e}=this.options;if(isFinite(t)){const r=B(t);return new f(Math.cos(r),Math.sin(r)).toArray()}return j.getDirectionVector(this.interpolators.trajectory,e?R:1-R,e?0:1)}static toDisplacement(t,e=0){let s=t[0],r=0;return t.map(n=>{const o=n[0]-s[0],a=n[1]-s[1];return r+=Math.sqrt(o**2+a**2),s=n,[e>0?e-r:r,n[2]||0]})}static getDirectionVector(t,e,s){const r=t.getPointAt(s),i=t.getPointAt(e);return N([r[0]-i[0],r[1]-i[1]])}get length(){return this.interpolators.curve.length}get offset(){return this._offset}set offset(t){this._curtainPathCache=void 0,this._offset=t}}class tt{constructor(t,e,s){c(this,"container");c(this,"layerContainer");c(this,"_zoomPanHandler");c(this,"layers",[]);c(this,"_axis");c(this,"_svgContainer");c(this,"createAxis",t=>{const{container:e}=this;this._svgContainer=z(e).append("div").attr("class","axis").style("position","absolute").style("z-index","10").style("pointer-events","none");const s=this._svgContainer.append("svg").attr("height",`${e.offsetHeight}px`).attr("width",`${e.offsetWidth}px`),r=!0;return new Q(s,r,t.xLabel,t.yLabel,t.unitOfMeasure)});if(this.container=t,this.layerContainer=document.createElement("div"),this.layerContainer.className="layer-container",this.container.appendChild(this.layerContainer),this.adjustToSize(+this.container.getAttribute("width"),+this.container.getAttribute("height")),this._zoomPanHandler=new X(t,r=>this.rescale(r)),e){const{xMin:r,xMax:i,yMin:n,yMax:o,xBounds:a,yBounds:h}=e;r!==void 0&&i!==void 0&&n!==void 0&&o!==void 0&&this._zoomPanHandler.setBounds([r,i],[n,o]),a&&h&&this._zoomPanHandler.setBounds(a,h)}else this._zoomPanHandler.setBounds([0,1],[0,1]);s&&(this._axis=this.createAxis(s)),this.rescale=this.rescale.bind(this)}addLayers(t){return t.forEach(e=>this.addLayer(e)),this}getLayers(){return this.layers}clearAllData(t=!0){return this.layers.forEach(e=>e.clearData(t)),this}addLayer(t,e){return this.layers.push(t),this.initLayer(t,e),this}removeLayer(t){const e=this.layers.find(s=>s.id===t);return e&&(e.onUnmount(),this.layers=this.layers.filter(s=>s.id!==t)),this}removeAllLayers(){const{layers:t}=this;return t.forEach(e=>{this.removeLayer(e.id)}),this}getLayer(t){return this.layers.find(e=>e.id===t||e.getInternalLayerIds().includes(t))}initLayer(t,e){const s={elm:this.layerContainer};t.onMount(s);const r=this.zoomPanHandler.currentStateAsEvent();if(t.onUpdate({...r,...e}),t.onRescale(r),this._svgContainer){const i=this.layers.length>0?this.layers.reduce((n,o)=>n.order>o.order?n:o).order:1;this._svgContainer.style("z-index",`${i+1}`)}return this}showLayer(t){const e=this.getLayer(t);return e?(e.setVisibility(!0,t),e.onRescale(this.zoomPanHandler.currentStateAsEvent()),this):this}hideLayer(t){const e=this.getLayer(t);return e?(e.setVisibility(!1,t),e.onRescale(this.zoomPanHandler.currentStateAsEvent()),this):this}adjustToSize(t,e){const s=Math.max(this._axis?t-F:t,0),r=Math.max(this._axis?e-k:e,0);if(this._axis){const i={width:t,height:e};this._axis.onResize(i)}if(this.layers){const i={width:s,height:r};this.layers.forEach(n=>n.onResize(i))}this._zoomPanHandler&&this._zoomPanHandler.adjustToSize(s,r,!0)}setReferenceSystem(t){this.layers.forEach(e=>e.referenceSystem=t)}showAxis(){return this._axis.show(),this}hideAxis(){return this._axis.hide(),this}showAxisLabels(){return this._axis.showLabels(),this}hideAxisLabels(){return this._axis.hideLabels(),this}setAxisOffset(t,e){return this._axis.offsetX=t,this._axis.offsetY=e,this.layers.filter(r=>r instanceof E).forEach(r=>{r.offsetX=t,r.offsetY=e}),this}setXAxisOffset(t){return this._axis.offsetX=t,this.layers.filter(s=>s instanceof E).forEach(s=>{s.offsetX=t}),this}setYAxisOffset(t){return this._axis.offsetY=t,this.layers.filter(s=>s instanceof E).forEach(s=>{s.offsetY=t}),this}setZoomLevelBoundary(t){return this._zoomPanHandler.setZoomLevelBoundary(t),this}setMaxZoomLevel(t){return this._zoomPanHandler.setMaxZoomLevel(t),this}setMinZoomLevel(t){return this._zoomPanHandler.setMinZoomLevel(t),this}destroy(){return this.removeAllLayers(),this.layerContainer.remove(),this.layerContainer=void 0,this.container=void 0,this.layers=void 0,this._zoomPanHandler=void 0,this._axis=void 0,this._svgContainer=void 0,this}get zoomPanHandler(){return this._zoomPanHandler}get axis(){return this._axis}rescale(t){this._axis&&this._axis.onRescale(t),this.layers&&this.layers.forEach(e=>e.isVisible===!0?e.onRescale(t):{})}}class et{constructor(t,e){c(this,"elm");c(this,"source");c(this,"elements",{});c(this,"listeners",{});c(this,"enabled",!0);const s=z(e);this.elm=s.append("div").attr("id","overlay").style("z-index","11").style("position","absolute"),this.source=this.elm.node();const{elm:r}=this;r.on("resize",i=>{const{width:n,height:o}=i.detail;r.style("width",`${n}px`).style("height",`${o}px`),this.enabled&&Object.keys(this.listeners).forEach(a=>{const h=this.elements[a]||null,l=this.listeners[a];l&&l.onResize&&requestAnimationFrame(()=>l.onResize({target:h,source:this.source,caller:t,width:n,height:o}))})}),r.on("mousemove",i=>{if(!this.enabled)return;const[n,o]=G(i,this.elm.node());Object.keys(this.listeners).forEach(a=>{const h=this.elements[a]||null,l=this.listeners[a];l&&l.onMouseMove&&requestAnimationFrame(()=>l.onMouseMove({x:n,y:o,target:h,source:this.source,caller:t}))})}),r.on("mouseout",()=>{!this.enabled||Object.keys(this.listeners).forEach(i=>{const n=this.elements[i]||null,o=this.listeners[i];o&&o.onMouseExit&&requestAnimationFrame(()=>o.onMouseExit({target:n,source:this.source,caller:t}))})})}create(t,e){const s=this.elm.append("div").style("position","relative").style("pointer-events","none").node();return this.elements[t]=s,e&&(this.listeners[t]=e),s}register(t,e){this.listeners[t]=e}remove(t){const e=this.elements[t];e&&(z(e).remove(),delete this.elements[t]),delete this.listeners[t]}setZIndex(t){this.elm.style("z-index",t)}destroy(){this.source.remove()}}const st=(u,t)=>new et(u,t);class ot{constructor(t){c(this,"_referenceSystem");c(this,"layerManager");c(this,"_overlay");const{container:e,axisOptions:s,scaleOptions:r,referenceSystem:i,layers:n,path:o}=t;this._referenceSystem=i||o&&new j(o),this._overlay=st(this,e),this.layerManager=new tt(this._overlay.elm.node(),r,s),n&&(this.layerManager.addLayers(n),this.setOverlayZIndex(n))}setReferenceSystem(t){return this._referenceSystem=t,this.layerManager.setReferenceSystem(t),this}updatePath(t,e){return this.setReferenceSystem(new j(t,e)),this}clearAllData(t=!0){return this.layerManager.clearAllData(t),this}addLayer(t,e){return this.layerManager.addLayer(t,e),this.setOverlayZIndex(this.layerManager.getLayers()),this}removeLayer(t){return this.layerManager.removeLayer(t),this}removeAllLayers(){return this.layerManager.removeAllLayers(),this}getLayer(t){return this.layerManager.getLayer(t)}showLayer(t){return this.layerManager.showLayer(t),this}hideLayer(t){return this.layerManager.hideLayer(t),this}adjustToSize(t,e){this.layerManager.adjustToSize(t,e);const s={width:Math.max(t-F,0),height:Math.max(e-k,0)};return this.overlay.elm.dispatch("resize",{detail:s,bubbles:!0,cancelable:!0}),this}setViewport(t,e,s,r){return this.zoomPanHandler.setViewport(t,e,s,r),this}setBounds(t,e){return this.zoomPanHandler.setBounds(t,e),this}showAxis(){return this.layerManager.showAxis(),this}hideAxis(){return this.layerManager.hideAxis(),this}showAxisLabels(){return this.layerManager.showAxisLabels(),this}hideAxisLabels(){return this.layerManager.hideAxisLabels(),this}setAxisOffset(t,e){return this.layerManager.setAxisOffset(t,e),this}setXAxisOffset(t){return this.layerManager.setXAxisOffset(t),this}setYAxisOffset(t){return this.layerManager.setYAxisOffset(t),this}setZoomLevelBoundary(t){return this.zoomPanHandler.setZoomLevelBoundary(t),this}setMaxZoomLevel(t){return this.zoomPanHandler.setMaxZoomLevel(t),this}setMinZoomLevel(t){return this.zoomPanHandler.setMinZoomLevel(t),this}destroy(){return this.layerManager.destroy(),this._overlay.destroy(),this._referenceSystem=void 0,this.layerManager=void 0,this._overlay=void 0,this}getHighestZIndex(t){return t.length>0?t.reduce((s,r)=>s.order>r.order?s:r).order:1}setOverlayZIndex(t){const e=this.getHighestZIndex(t);this.overlay.setZIndex(e+2)}get overlay(){return this._overlay}get referenceSystem(){return this._referenceSystem}get zoomPanHandler(){return this.layerManager.zoomPanHandler}get axis(){return this.layerManager.axis}get currentStateAsEvent(){return this.zoomPanHandler.currentStateAsEvent()}}export{ot as C,j as I};
//# sourceMappingURL=MainController.bb1db3a7.js.map
