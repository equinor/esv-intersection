import{g as Oc,c as In,a as ip}from"./_commonjsHelpers-D6-XlEtG.js";function pn(r,t){return r==null||t==null?NaN:r<t?-1:r>t?1:r>=t?0:NaN}function np(r,t){return r==null||t==null?NaN:t<r?-1:t>r?1:t>=r?0:NaN}function Lc(r){let t,e,i;r.length!==2?(t=pn,e=(a,h)=>pn(r(a),h),i=(a,h)=>r(a)-h):(t=r===pn||r===np?r:sp,e=r,i=r);function n(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const c=l+u>>>1;e(a[c],h)<0?l=c+1:u=c}while(l<u)}return l}function s(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const c=l+u>>>1;e(a[c],h)<=0?l=c+1:u=c}while(l<u)}return l}function o(a,h,l=0,u=a.length){const c=n(a,h,l,u-1);return c>l&&i(a[c-1],h)>-i(a[c],h)?c-1:c}return{left:n,center:o,right:s}}function sp(){return 0}function op(r){return r===null?NaN:+r}const ap=Lc(pn),hp=ap.right;Lc(op).center;class qh extends Map{constructor(t,e=cp){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[i,n]of t)this.set(i,n)}get(t){return super.get(Yh(this,t))}has(t){return super.has(Yh(this,t))}set(t,e){return super.set(lp(this,t),e)}delete(t){return super.delete(up(this,t))}}function Yh({_intern:r,_key:t},e){const i=t(e);return r.has(i)?r.get(i):e}function lp({_intern:r,_key:t},e){const i=t(e);return r.has(i)?r.get(i):(r.set(i,e),e)}function up({_intern:r,_key:t},e){const i=t(e);return r.has(i)&&(e=r.get(e),r.delete(i)),e}function cp(r){return r!==null&&typeof r=="object"?r.valueOf():r}const dp=Math.sqrt(50),fp=Math.sqrt(10),pp=Math.sqrt(2);function Rn(r,t,e){const i=(t-r)/Math.max(0,e),n=Math.floor(Math.log10(i)),s=i/Math.pow(10,n),o=s>=dp?10:s>=fp?5:s>=pp?2:1;let a,h,l;return n<0?(l=Math.pow(10,-n)/o,a=Math.round(r*l),h=Math.round(t*l),a/l<r&&++a,h/l>t&&--h,l=-l):(l=Math.pow(10,n)*o,a=Math.round(r/l),h=Math.round(t/l),a*l<r&&++a,h*l>t&&--h),h<a&&.5<=e&&e<2?Rn(r,t,e*2):[a,h,l]}function mp(r,t,e){if(t=+t,r=+r,e=+e,!(e>0))return[];if(r===t)return[r];const i=t<r,[n,s,o]=i?Rn(t,r,e):Rn(r,t,e);if(!(s>=n))return[];const a=s-n+1,h=new Array(a);if(i)if(o<0)for(let l=0;l<a;++l)h[l]=(s-l)/-o;else for(let l=0;l<a;++l)h[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)h[l]=(n+l)/-o;else for(let l=0;l<a;++l)h[l]=(n+l)*o;return h}function ha(r,t,e){return t=+t,r=+r,e=+e,Rn(r,t,e)[2]}function gp(r,t,e){t=+t,r=+r,e=+e;const i=t<r,n=i?ha(t,r,e):ha(r,t,e);return(i?-1:1)*(n<0?1/-n:n)}function la(r,t){let e;if(t===void 0)for(const i of r)i!=null&&(e<i||e===void 0&&i>=i)&&(e=i);else{let i=-1;for(let n of r)(n=t(n,++i,r))!=null&&(e<n||e===void 0&&n>=n)&&(e=n)}return e}function Rs(r,t){let e=0;if(t===void 0)for(let i of r)(i=+i)&&(e+=i);else{let i=-1;for(let n of r)(n=+t(n,++i,r))&&(e+=n)}return e}function Nc(r,t){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(t).domain(r);break}return this}const Kh=Symbol("implicit");function kc(){var r=new qh,t=[],e=[],i=Kh;function n(s){let o=r.get(s);if(o===void 0){if(i!==Kh)return i;r.set(s,o=t.push(s)-1)}return e[o%e.length]}return n.domain=function(s){if(!arguments.length)return t.slice();t=[],r=new qh;for(const o of s)r.has(o)||r.set(o,t.push(o)-1);return n},n.range=function(s){return arguments.length?(e=Array.from(s),n):e.slice()},n.unknown=function(s){return arguments.length?(i=s,n):i},n.copy=function(){return kc(t,e).unknown(i)},Nc.apply(n,arguments),n}function lh(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function Uc(r,t){var e=Object.create(r.prototype);for(var i in t)e[i]=t[i];return e}function Ii(){}var Ai=.7,Mn=1/Ai,Hr="\\s*([+-]?\\d+)\\s*",Ei="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",pe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",yp=/^#([0-9a-f]{3,8})$/,vp=new RegExp(`^rgb\\(${Hr},${Hr},${Hr}\\)$`),_p=new RegExp(`^rgb\\(${pe},${pe},${pe}\\)$`),xp=new RegExp(`^rgba\\(${Hr},${Hr},${Hr},${Ei}\\)$`),bp=new RegExp(`^rgba\\(${pe},${pe},${pe},${Ei}\\)$`),wp=new RegExp(`^hsl\\(${Ei},${pe},${pe}\\)$`),Tp=new RegExp(`^hsla\\(${Ei},${pe},${pe},${Ei}\\)$`),Zh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};lh(Ii,$e,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:Qh,formatHex:Qh,formatHex8:Ap,formatHsl:Ep,formatRgb:Jh,toString:Jh});function Qh(){return this.rgb().formatHex()}function Ap(){return this.rgb().formatHex8()}function Ep(){return Gc(this).formatHsl()}function Jh(){return this.rgb().formatRgb()}function $e(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=yp.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?tl(t):e===3?new Mt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Gi(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Gi(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=vp.exec(r))?new Mt(t[1],t[2],t[3],1):(t=_p.exec(r))?new Mt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=xp.exec(r))?Gi(t[1],t[2],t[3],t[4]):(t=bp.exec(r))?Gi(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=wp.exec(r))?il(t[1],t[2]/100,t[3]/100,1):(t=Tp.exec(r))?il(t[1],t[2]/100,t[3]/100,t[4]):Zh.hasOwnProperty(r)?tl(Zh[r]):r==="transparent"?new Mt(NaN,NaN,NaN,0):null}function tl(r){return new Mt(r>>16&255,r>>8&255,r&255,1)}function Gi(r,t,e,i){return i<=0&&(r=t=e=NaN),new Mt(r,t,e,i)}function Sp(r){return r instanceof Ii||(r=$e(r)),r?(r=r.rgb(),new Mt(r.r,r.g,r.b,r.opacity)):new Mt}function ua(r,t,e,i){return arguments.length===1?Sp(r):new Mt(r,t,e,i??1)}function Mt(r,t,e,i){this.r=+r,this.g=+t,this.b=+e,this.opacity=+i}lh(Mt,ua,Uc(Ii,{brighter(r){return r=r==null?Mn:Math.pow(Mn,r),new Mt(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Ai:Math.pow(Ai,r),new Mt(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new Mt(mr(this.r),mr(this.g),mr(this.b),Fn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:el,formatHex:el,formatHex8:Cp,formatRgb:rl,toString:rl}));function el(){return`#${pr(this.r)}${pr(this.g)}${pr(this.b)}`}function Cp(){return`#${pr(this.r)}${pr(this.g)}${pr(this.b)}${pr((isNaN(this.opacity)?1:this.opacity)*255)}`}function rl(){const r=Fn(this.opacity);return`${r===1?"rgb(":"rgba("}${mr(this.r)}, ${mr(this.g)}, ${mr(this.b)}${r===1?")":`, ${r})`}`}function Fn(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function mr(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function pr(r){return r=mr(r),(r<16?"0":"")+r.toString(16)}function il(r,t,e,i){return i<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new te(r,t,e,i)}function Gc(r){if(r instanceof te)return new te(r.h,r.s,r.l,r.opacity);if(r instanceof Ii||(r=$e(r)),!r)return new te;if(r instanceof te)return r;r=r.rgb();var t=r.r/255,e=r.g/255,i=r.b/255,n=Math.min(t,e,i),s=Math.max(t,e,i),o=NaN,a=s-n,h=(s+n)/2;return a?(t===s?o=(e-i)/a+(e<i)*6:e===s?o=(i-t)/a+2:o=(t-e)/a+4,a/=h<.5?s+n:2-s-n,o*=60):a=h>0&&h<1?0:o,new te(o,a,h,r.opacity)}function Pp(r,t,e,i){return arguments.length===1?Gc(r):new te(r,t,e,i??1)}function te(r,t,e,i){this.h=+r,this.s=+t,this.l=+e,this.opacity=+i}lh(te,Pp,Uc(Ii,{brighter(r){return r=r==null?Mn:Math.pow(Mn,r),new te(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Ai:Math.pow(Ai,r),new te(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*t,n=2*e-i;return new Mt(Ms(r>=240?r-240:r+120,n,i),Ms(r,n,i),Ms(r<120?r+240:r-120,n,i),this.opacity)},clamp(){return new te(nl(this.h),Hi(this.s),Hi(this.l),Fn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=Fn(this.opacity);return`${r===1?"hsl(":"hsla("}${nl(this.h)}, ${Hi(this.s)*100}%, ${Hi(this.l)*100}%${r===1?")":`, ${r})`}`}}));function nl(r){return r=(r||0)%360,r<0?r+360:r}function Hi(r){return Math.max(0,Math.min(1,r||0))}function Ms(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}const uh=r=>()=>r;function Ip(r,t){return function(e){return r+e*t}}function Rp(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function Mp(r){return(r=+r)==1?Hc:function(t,e){return e-t?Rp(t,e,r):uh(isNaN(t)?e:t)}}function Hc(r,t){var e=t-r;return e?Ip(r,e):uh(isNaN(r)?t:r)}const Si=(function r(t){var e=Mp(t);function i(n,s){var o=e((n=ua(n)).r,(s=ua(s)).r),a=e(n.g,s.g),h=e(n.b,s.b),l=Hc(n.opacity,s.opacity);return function(u){return n.r=o(u),n.g=a(u),n.b=h(u),n.opacity=l(u),n+""}}return i.gamma=r,i})(1);function Fp(r,t){t||(t=[]);var e=r?Math.min(t.length,r.length):0,i=t.slice(),n;return function(s){for(n=0;n<e;++n)i[n]=r[n]*(1-s)+t[n]*s;return i}}function Dp(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Bp(r,t){var e=t?t.length:0,i=r?Math.min(e,r.length):0,n=new Array(i),s=new Array(e),o;for(o=0;o<i;++o)n[o]=ch(r[o],t[o]);for(;o<e;++o)s[o]=t[o];return function(a){for(o=0;o<i;++o)s[o]=n[o](a);return s}}function Op(r,t){var e=new Date;return r=+r,t=+t,function(i){return e.setTime(r*(1-i)+t*i),e}}function Jt(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}function Lp(r,t){var e={},i={},n;(r===null||typeof r!="object")&&(r={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in r?e[n]=ch(r[n],t[n]):i[n]=t[n];return function(s){for(n in e)i[n]=e[n](s);return i}}var ca=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Fs=new RegExp(ca.source,"g");function Np(r){return function(){return r}}function kp(r){return function(t){return r(t)+""}}function zc(r,t){var e=ca.lastIndex=Fs.lastIndex=0,i,n,s,o=-1,a=[],h=[];for(r=r+"",t=t+"";(i=ca.exec(r))&&(n=Fs.exec(t));)(s=n.index)>e&&(s=t.slice(e,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,h.push({i:o,x:Jt(i,n)})),e=Fs.lastIndex;return e<t.length&&(s=t.slice(e),a[o]?a[o]+=s:a[++o]=s),a.length<2?h[0]?kp(h[0].x):Np(t):(t=h.length,function(l){for(var u=0,c;u<t;++u)a[(c=h[u]).i]=c.x(l);return a.join("")})}function ch(r,t){var e=typeof t,i;return t==null||e==="boolean"?uh(t):(e==="number"?Jt:e==="string"?(i=$e(t))?(t=i,Si):zc:t instanceof $e?Si:t instanceof Date?Op:Dp(t)?Fp:Array.isArray(t)?Bp:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Lp:Jt)(r,t)}function Up(r,t){return r=+r,t=+t,function(e){return Math.round(r*(1-e)+t*e)}}var sl=180/Math.PI,da={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function $c(r,t,e,i,n,s){var o,a,h;return(o=Math.sqrt(r*r+t*t))&&(r/=o,t/=o),(h=r*e+t*i)&&(e-=r*h,i-=t*h),(a=Math.sqrt(e*e+i*i))&&(e/=a,i/=a,h/=a),r*i<t*e&&(r=-r,t=-t,h=-h,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(t,r)*sl,skewX:Math.atan(h)*sl,scaleX:o,scaleY:a}}var zi;function Gp(r){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return t.isIdentity?da:$c(t.a,t.b,t.c,t.d,t.e,t.f)}function Hp(r){return r==null||(zi||(zi=document.createElementNS("http://www.w3.org/2000/svg","g")),zi.setAttribute("transform",r),!(r=zi.transform.baseVal.consolidate()))?da:(r=r.matrix,$c(r.a,r.b,r.c,r.d,r.e,r.f))}function Vc(r,t,e,i){function n(l){return l.length?l.pop()+" ":""}function s(l,u,c,d,f,p){if(l!==c||u!==d){var m=f.push("translate(",null,t,null,e);p.push({i:m-4,x:Jt(l,c)},{i:m-2,x:Jt(u,d)})}else(c||d)&&f.push("translate("+c+t+d+e)}function o(l,u,c,d){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),d.push({i:c.push(n(c)+"rotate(",null,i)-2,x:Jt(l,u)})):u&&c.push(n(c)+"rotate("+u+i)}function a(l,u,c,d){l!==u?d.push({i:c.push(n(c)+"skewX(",null,i)-2,x:Jt(l,u)}):u&&c.push(n(c)+"skewX("+u+i)}function h(l,u,c,d,f,p){if(l!==c||u!==d){var m=f.push(n(f)+"scale(",null,",",null,")");p.push({i:m-4,x:Jt(l,c)},{i:m-2,x:Jt(u,d)})}else(c!==1||d!==1)&&f.push(n(f)+"scale("+c+","+d+")")}return function(l,u){var c=[],d=[];return l=r(l),u=r(u),s(l.translateX,l.translateY,u.translateX,u.translateY,c,d),o(l.rotate,u.rotate,c,d),a(l.skewX,u.skewX,c,d),h(l.scaleX,l.scaleY,u.scaleX,u.scaleY,c,d),l=u=null,function(f){for(var p=-1,m=d.length,g;++p<m;)c[(g=d[p]).i]=g.x(f);return c.join("")}}}var zp=Vc(Gp,"px, ","px)","deg)"),$p=Vc(Hp,", ",")",")"),Vp=1e-12;function ol(r){return((r=Math.exp(r))+1/r)/2}function Xp(r){return((r=Math.exp(r))-1/r)/2}function Wp(r){return((r=Math.exp(2*r))-1)/(r+1)}const jp=(function r(t,e,i){function n(s,o){var a=s[0],h=s[1],l=s[2],u=o[0],c=o[1],d=o[2],f=u-a,p=c-h,m=f*f+p*p,g,y;if(m<Vp)y=Math.log(d/l)/t,g=function(T){return[a+T*f,h+T*p,l*Math.exp(t*T*y)]};else{var x=Math.sqrt(m),v=(d*d-l*l+i*m)/(2*l*e*x),E=(d*d-l*l-i*m)/(2*d*e*x),w=Math.log(Math.sqrt(v*v+1)-v),I=Math.log(Math.sqrt(E*E+1)-E);y=(I-w)/t,g=function(T){var F=T*y,U=ol(w),G=l/(e*x)*(U*Wp(t*F+w)-Xp(w));return[a+G*f,h+G*p,l*U/ol(t*F+w)]}}return g.duration=y*1e3*t/Math.SQRT2,g}return n.rho=function(s){var o=Math.max(.001,+s),a=o*o,h=a*a;return r(o,a,h)},n})(Math.SQRT2,2,4);function qp(r,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=r(i/(t-1));return e}function Yp(r){return function(){return r}}function Kp(r){return+r}var al=[0,1];function Nr(r){return r}function fa(r,t){return(t-=r=+r)?function(e){return(e-r)/t}:Yp(isNaN(t)?NaN:.5)}function Zp(r,t){var e;return r>t&&(e=r,r=t,t=e),function(i){return Math.max(r,Math.min(t,i))}}function Qp(r,t,e){var i=r[0],n=r[1],s=t[0],o=t[1];return n<i?(i=fa(n,i),s=e(o,s)):(i=fa(i,n),s=e(s,o)),function(a){return s(i(a))}}function Jp(r,t,e){var i=Math.min(r.length,t.length)-1,n=new Array(i),s=new Array(i),o=-1;for(r[i]<r[0]&&(r=r.slice().reverse(),t=t.slice().reverse());++o<i;)n[o]=fa(r[o],r[o+1]),s[o]=e(t[o],t[o+1]);return function(a){var h=hp(r,a,1,i)-1;return s[h](n[h](a))}}function t0(r,t){return t.domain(r.domain()).range(r.range()).interpolate(r.interpolate()).clamp(r.clamp()).unknown(r.unknown())}function e0(){var r=al,t=al,e=ch,i,n,s,o=Nr,a,h,l;function u(){var d=Math.min(r.length,t.length);return o!==Nr&&(o=Zp(r[0],r[d-1])),a=d>2?Jp:Qp,h=l=null,c}function c(d){return d==null||isNaN(d=+d)?s:(h||(h=a(r.map(i),t,e)))(i(o(d)))}return c.invert=function(d){return o(n((l||(l=a(t,r.map(i),Jt)))(d)))},c.domain=function(d){return arguments.length?(r=Array.from(d,Kp),u()):r.slice()},c.range=function(d){return arguments.length?(t=Array.from(d),u()):t.slice()},c.rangeRound=function(d){return t=Array.from(d),e=Up,u()},c.clamp=function(d){return arguments.length?(o=d?!0:Nr,u()):o!==Nr},c.interpolate=function(d){return arguments.length?(e=d,u()):e},c.unknown=function(d){return arguments.length?(s=d,c):s},function(d,f){return i=d,n=f,u()}}function r0(){return e0()(Nr,Nr)}function i0(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function Dn(r,t){if((e=(r=t?r.toExponential(t-1):r.toExponential()).indexOf("e"))<0)return null;var e,i=r.slice(0,e);return[i.length>1?i[0]+i.slice(2):i,+r.slice(e+1)]}function Wr(r){return r=Dn(Math.abs(r)),r?r[1]:NaN}function n0(r,t){return function(e,i){for(var n=e.length,s=[],o=0,a=r[0],h=0;n>0&&a>0&&(h+a+1>i&&(a=Math.max(1,i-h)),s.push(e.substring(n-=a,n+a)),!((h+=a+1)>i));)a=r[o=(o+1)%r.length];return s.reverse().join(t)}}function s0(r){return function(t){return t.replace(/[0-9]/g,function(e){return r[+e]})}}var o0=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Bn(r){if(!(t=o0.exec(r)))throw new Error("invalid format: "+r);var t;return new dh({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Bn.prototype=dh.prototype;function dh(r){this.fill=r.fill===void 0?" ":r.fill+"",this.align=r.align===void 0?">":r.align+"",this.sign=r.sign===void 0?"-":r.sign+"",this.symbol=r.symbol===void 0?"":r.symbol+"",this.zero=!!r.zero,this.width=r.width===void 0?void 0:+r.width,this.comma=!!r.comma,this.precision=r.precision===void 0?void 0:+r.precision,this.trim=!!r.trim,this.type=r.type===void 0?"":r.type+""}dh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function a0(r){t:for(var t=r.length,e=1,i=-1,n;e<t;++e)switch(r[e]){case".":i=n=e;break;case"0":i===0&&(i=e),n=e;break;default:if(!+r[e])break t;i>0&&(i=0);break}return i>0?r.slice(0,i)+r.slice(n+1):r}var Xc;function h0(r,t){var e=Dn(r,t);if(!e)return r+"";var i=e[0],n=e[1],s=n-(Xc=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Dn(r,Math.max(0,t+s-1))[0]}function hl(r,t){var e=Dn(r,t);if(!e)return r+"";var i=e[0],n=e[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}const ll={"%":(r,t)=>(r*100).toFixed(t),b:r=>Math.round(r).toString(2),c:r=>r+"",d:i0,e:(r,t)=>r.toExponential(t),f:(r,t)=>r.toFixed(t),g:(r,t)=>r.toPrecision(t),o:r=>Math.round(r).toString(8),p:(r,t)=>hl(r*100,t),r:hl,s:h0,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16)};function ul(r){return r}var cl=Array.prototype.map,dl=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function l0(r){var t=r.grouping===void 0||r.thousands===void 0?ul:n0(cl.call(r.grouping,Number),r.thousands+""),e=r.currency===void 0?"":r.currency[0]+"",i=r.currency===void 0?"":r.currency[1]+"",n=r.decimal===void 0?".":r.decimal+"",s=r.numerals===void 0?ul:s0(cl.call(r.numerals,String)),o=r.percent===void 0?"%":r.percent+"",a=r.minus===void 0?"−":r.minus+"",h=r.nan===void 0?"NaN":r.nan+"";function l(c){c=Bn(c);var d=c.fill,f=c.align,p=c.sign,m=c.symbol,g=c.zero,y=c.width,x=c.comma,v=c.precision,E=c.trim,w=c.type;w==="n"?(x=!0,w="g"):ll[w]||(v===void 0&&(v=12),E=!0,w="g"),(g||d==="0"&&f==="=")&&(g=!0,d="0",f="=");var I=m==="$"?e:m==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",T=m==="$"?i:/[%p]/.test(w)?o:"",F=ll[w],U=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function G(z){var M=I,B=T,S,N,_;if(w==="c")B=F(z)+B,z="";else{z=+z;var A=z<0||1/z<0;if(z=isNaN(z)?h:F(Math.abs(z),v),E&&(z=a0(z)),A&&+z==0&&p!=="+"&&(A=!1),M=(A?p==="("?p:a:p==="-"||p==="("?"":p)+M,B=(w==="s"?dl[8+Xc/3]:"")+B+(A&&p==="("?")":""),U){for(S=-1,N=z.length;++S<N;)if(_=z.charCodeAt(S),48>_||_>57){B=(_===46?n+z.slice(S+1):z.slice(S))+B,z=z.slice(0,S);break}}}x&&!g&&(z=t(z,1/0));var b=M.length+z.length+B.length,R=b<y?new Array(y-b+1).join(d):"";switch(x&&g&&(z=t(R+z,R.length?y-B.length:1/0),R=""),f){case"<":z=M+z+B+R;break;case"=":z=M+R+z+B;break;case"^":z=R.slice(0,b=R.length>>1)+M+z+B+R.slice(b);break;default:z=R+M+z+B;break}return s(z)}return G.toString=function(){return c+""},G}function u(c,d){var f=l((c=Bn(c),c.type="f",c)),p=Math.max(-8,Math.min(8,Math.floor(Wr(d)/3)))*3,m=Math.pow(10,-p),g=dl[8+p/3];return function(y){return f(m*y)+g}}return{format:l,formatPrefix:u}}var $i,Wc,jc;u0({thousands:",",grouping:[3],currency:["$",""]});function u0(r){return $i=l0(r),Wc=$i.format,jc=$i.formatPrefix,$i}function c0(r){return Math.max(0,-Wr(Math.abs(r)))}function d0(r,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Wr(t)/3)))*3-Wr(Math.abs(r)))}function f0(r,t){return r=Math.abs(r),t=Math.abs(t)-r,Math.max(0,Wr(t)-Wr(r))+1}function p0(r,t,e,i){var n=gp(r,t,e),s;switch(i=Bn(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(r),Math.abs(t));return i.precision==null&&!isNaN(s=d0(n,o))&&(i.precision=s),jc(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=f0(n,Math.max(Math.abs(r),Math.abs(t))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=c0(n))&&(i.precision=s-(i.type==="%")*2);break}}return Wc(i)}function m0(r){var t=r.domain;return r.ticks=function(e){var i=t();return mp(i[0],i[i.length-1],e??10)},r.tickFormat=function(e,i){var n=t();return p0(n[0],n[n.length-1],e??10,i)},r.nice=function(e){e==null&&(e=10);var i=t(),n=0,s=i.length-1,o=i[n],a=i[s],h,l,u=10;for(a<o&&(l=o,o=a,a=l,l=n,n=s,s=l);u-- >0;){if(l=ha(o,a,e),l===h)return i[n]=o,i[s]=a,t(i);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;h=l}return r},r}function On(){var r=r0();return r.copy=function(){return t0(r,On())},Nc.apply(r,arguments),m0(r)}const g0=Math.PI/180;function y0(r,t=0,e=1){return r<t?t:r>e?e:r}function AT(r){return r*g0}function ET(r){const t=new Array(r),e=1/(r-1);t[0]=0;for(let i=1;i<r-1;i++)t[i]=i*e;return t[r-1]=1,t}function ri(r,t,e){e===void 0&&(e=r);for(var i=0;i<r.length;i++)e[i]=r[i]+t[i];return e}function ii(r,t,e){e===void 0&&(e=r);for(var i=0;i<r.length;i++)e[i]=r[i]-t[i];return e}function sr(r,t,e){e===void 0&&(e=r);for(var i=0;i<r.length;i++)e[i]=r[i]*t;return e}function v0(r){for(var t=0,e=0;e<r.length;e++)t+=Math.pow(r[e],2);return t}function ci(r){var t=v0(r);return t===0?t:Math.sqrt(t)}function fl(r,t){t===void 0&&(t=r);var e=ci(r);return e===0?_0(0,t):sr(r,1/e,t)}function _0(r,t){for(var e=0;e<t.length;e++)t[e]=r;return t}function x0(r,t){for(var e=0,i=0;i<r.length;i++)e+=Math.pow(t[i]-r[i],2);return e===0?e:Math.sqrt(e)}function b0(r,t){for(var e=0,i=0;i<r.length;i++)e+=r[i]*t[i];return e}function w0(r,t,e,i){i===void 0&&(i=r);for(var n=y0(e,0,1),s=1-n,o=0;o<r.length;o++)i[o]=r[o]*s+t[o]*n;return i}function T0(r,t,e){e===void 0&&(e=r);for(var i=0;i<r.length;i++)e[i]=t(r[i],i);return e}function pl(r,t){t===void 0&&(t=0),t===void 0&&(t=0);for(var e=0;e<r.length;e++)if(Math.abs(r[e])>t)return!1;return!0}var Ds=180/Math.PI,A0=Math.PI/180;function Bs(r,t,e){var i=Math.cos(t),n=Math.sin(t),s=r[0];return e[0]=i*s-n*r[1],e[1]=n*s+i*r[1],e}function ml(r){return Math.atan2(r[1],r[0])}function ni(r,t){var e=Math.atan2(t[1],t[0])-Math.atan2(r[1],r[0]);return e>Math.PI?e-=2*Math.PI:e<=-Math.PI&&(e+=2*Math.PI),e}var qc=(function(){function r(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.isMutating=!1,this.length=2,typeof t=="number"?typeof e[0]=="number"?(this[0]=t,this[1]=e[0]):(this[0]=t,this[1]=t):"x"in t&&"y"in t?(this[0]=t.x,this[1]=t.y):(this[0]=t[0],this[1]=t[1])}return Object.defineProperty(r.prototype,"x",{get:function(){return this[0]},set:function(t){this[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this[1]},set:function(t){this[1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"magnitude",{get:function(){return ci(this)},set:function(t){var e=ci(this);sr(this,t/e,this)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mutable",{get:function(){return this.isMutating=!0,this},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"immutable",{get:function(){return this.isMutating=!1,this},enumerable:!1,configurable:!0}),r.prototype.set=function(t,e){return typeof t=="number"?typeof e=="number"?(this[0]=t,this[1]=e):(this[0]=t,this[1]=t):(this[0]=t[0],this[1]=t[1]),this},r.prototype.add=function(t,e){return e===void 0&&(e=0),typeof t=="number"?this.isMutating?ri(this,[t,e]):ri(this.clone(),[t,e]):this.isMutating?ri(this,t):ri(this.clone(),t)},r.add=function(t,e){var i=new r(t);return ri(i,e)},r.prototype.sub=function(t,e){return e===void 0&&(e=0),typeof t=="number"?this.isMutating?ii(this,[t,e]):ii(this.clone(),[t,e]):this.isMutating?ii(this,t):ii(this.clone(),t)},r.sub=function(t,e){var i=new r(t);return ii(i,e)},r.prototype.subFrom=function(t,e){return e===void 0&&(e=0),typeof t=="number"?this.isMutating?(this[0]=t-this[0],this[1]=e-this[1],this):new r(t-this[0],e-this[1]):this.isMutating?(this[0]=t[0]-this[0],this[1]=t[1]-this[1],this):new r(t[0]-this[0],t[1]-this[1])},r.divide=function(t,e){var i=new r(t);return sr(i,1/e)},r.multiply=function(t,e){var i=new r(t);return sr(i,e)},r.prototype.scale=function(t){return sr(this,t,this.isMutating?this:r.zero)},r.prototype.rescale=function(t){var e=ci(this);return e<=0?this.isMutating?this:r.zero:sr(this,t/e,this.isMutating?this:r.zero)},r.prototype.clampMagnitude=function(t){var e=ci(this);return e>t?sr(this,t/e,this.isMutating?this:r.zero):this.isMutating?this:this.clone()},r.prototype.rotate=function(t){return Bs(this,t,this.isMutating?this:r.zero)},r.prototype.rotateDeg=function(t){return Bs(this,t*A0,this.isMutating?this:r.zero)},r.prototype.rotate90=function(){return t=this,e=this.isMutating?this:r.zero,i=t[0],e[0]=-t[1],e[1]=i,e;var t,e,i},r.prototype.rotate180=function(){return t=this,(e=this.isMutating?this:r.zero)[0]=-t[0],e[1]=-t[1],e;var t,e},r.prototype.rotate270=function(){return t=this,e=this.isMutating?this:r.zero,i=t[0],e[0]=t[1],e[1]=-i,e;var t,e,i},r.prototype.normalize=function(){return fl(this)},r.prototype.normalized=function(){return fl(this,r.zero)},r.distance=function(t,e){return x0(t,e)},r.dot=function(t,e){return b0(t,e)},r.cross=function(t,e){return(function(i,n){return i[0]*n[1]-i[1]*n[0]})(t,e)},r.angleRight=function(t){return ml(t)},r.angleRightDeg=function(t){return ml(t)*Ds},r.angle=function(t,e){return Math.abs(ni(t,e))},r.angleDeg=function(t,e){return Math.abs(ni(t,e))*Ds},r.signedAngle=function(t,e){return ni(t,e)},r.signedAngleDeg=function(t,e){return ni(t,e)*Ds},r.lerp=function(t,e,i){var n=new r(t);return w0(n,e,i)},r.lerpRot=function(t,e,i){return(function(n,s,o,a){return a===void 0&&(a=n),Bs(n,o*ni(n,s),a)})(t,e,i,r.zero)},r.prototype.clone=function(){return new r(this[0],this[1])},r.equals=function(t,e,i){return i===void 0&&(i=0),!(Math.abs(t[0]-e[0])>i)&&!(Math.abs(t[1]-e[1])>i)},r.prototype.equals=function(t,e){return e===void 0&&(e=0),r.equals(this,t,e)},r.isZeroVector=function(t,e){return e===void 0&&(e=0),pl(t,e)},r.prototype.isZeroVector=function(t){return t===void 0&&(t=0),pl(this,t)},r.prototype.toArray=function(){return[this[0],this[1]]},r.prototype.modify=function(t){return T0(this,t)},r.prototype[Symbol.iterator]=function(){var t=this,e=0;return{next:function(){switch(e++){case 0:return{value:t[0],done:!1};case 1:return{value:t[1],done:!1};default:return{value:-1,done:!0}}}}},Object.defineProperty(r,"zero",{get:function(){return new r(0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(r,"one",{get:function(){return new r(1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(r,"positiveInfinity",{get:function(){return new r(1/0,1/0)},enumerable:!1,configurable:!0}),Object.defineProperty(r,"negativeInfinity",{get:function(){return new r(-1/0,-1/0)},enumerable:!1,configurable:!0}),Object.defineProperty(r,"up",{get:function(){return new r(0,1)},enumerable:!1,configurable:!0}),Object.defineProperty(r,"right",{get:function(){return new r(1,0)},enumerable:!1,configurable:!0}),Object.defineProperty(r,"down",{get:function(){return new r(0,-1)},enumerable:!1,configurable:!0}),Object.defineProperty(r,"left",{get:function(){return new r(-1,0)},enumerable:!1,configurable:!0}),r})();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var pa=function(r,t){return pa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},pa(r,t)};function Yc(r,t){function e(){this.constructor=r}pa(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Ln=function(){return Ln=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++)for(var n in t=arguments[e])Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r},Ln.apply(this,arguments)};function gl(r,t){for(var e=new Array(r.length),i=0;i<r.length;i++)e[i]=2*r[i]-t[i];return e}function ma(r,t,e){var i,n,s,o,a=t.length-1;if(e)i=t[r-1<0?a:r-1],n=t[r%t.length],s=t[(r+1)%t.length],o=t[(r+2)%t.length];else{if(r===a)throw Error("There is no spline segment at this index for a closed curve!");n=t[r],s=t[r+1],i=r>0?t[r-1]:gl(n,s),o=r<a-1?t[r+2]:gl(s,n)}return[i,n,s,o]}function E0(r,t,e){e===void 0&&(e=!1);var i=e?t.length:t.length-1;if(r===1)return{index:i-1,weight:1};var n=i*r,s=Math.floor(n);return{index:s,weight:n-s}}function S0(r,t){for(var e=0;e<r.length;e++)r[e]=t;return r}function C0(r,t){for(var e=0;e<r.length;e++)r[e]=t(r[e],e);return r}function P0(r,t,e){e===void 0&&(e=0);for(var i=0;i<r.length;i++)e=t(e,r[i],i);return e}function mn(r,t){t=t||new Array(r.length);for(var e=0;e<r.length;e++)t[e]=r[e];return t}function Rt(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r<t?t:r>e?e:r}function ga(r,t){var e=t[0];if(r>=t[t.length-1])return t.length-1;if(r<=e)return 0;for(var i=0,n=t.length-1;i<=n;){var s=Math.floor((i+n)/2),o=t[s];if(o<r)i=s+1;else{if(!(o>r))return s;n=s-1}}return Math.max(0,n)}var $t=Math.pow(2,-42);function yl(r){var t=Math.pow(Math.abs(r),.3333333333333333);return r<0?-t:t}function Kc(r,t,e){if(Math.abs(r)<$t)return Math.abs(t)<$t?[]:[-e/t];var i=t*t-4*r*e;return Math.abs(i)<$t?[-t/(2*r)]:i>0?[(-t+Math.sqrt(i))/(2*r),(-t-Math.sqrt(i))/(2*r)]:[]}function I0(r,t,e,i){if(Math.abs(r)<$t)return Kc(t,e,i);var n,s=(3*r*e-t*t)/(3*r*r),o=(2*t*t*t-9*r*t*e+27*r*r*i)/(27*r*r*r);if(Math.abs(s)<$t)n=[yl(-o)];else if(Math.abs(o)<$t)n=[0].concat(s<0?[Math.sqrt(-s),-Math.sqrt(-s)]:[]);else{var a=o*o/4+s*s*s/27;if(Math.abs(a)<$t)n=[-1.5*o/s,3*o/s];else if(a>0)n=[(h=yl(-o/2-Math.sqrt(a)))-s/(3*h)];else{var h=2*Math.sqrt(-s/3),l=Math.acos(3*o/s/h)/3,u=2*Math.PI/3;n=[h*Math.cos(l),h*Math.cos(l-u),h*Math.cos(l-2*u)]}}for(var c=0;c<n.length;c++)n[c]-=t/(3*r);return n}function Vi(r,t){if(r.length!==t.length)throw Error("Vectors must be of equal length!");for(var e=0,i=0;i<r.length;i++)e+=r[i]*t[i];return e}function qt(r,t,e){if(!(r.length>3)){e=e||new Array(3);var i=r[0],n=r[1],s=r[2]||0,o=t[0],a=t[1],h=t[2]||0;return e[0]=n*h-s*a,e[1]=s*o-i*h,e[2]=i*a-n*o,e}}function Zc(r,t){for(var e=0,i=0;i<r.length;i++)e+=(r[i]-t[i])*(r[i]-t[i]);return e}function dr(r){for(var t=0,e=0;e<r.length;e++)t+=r[e]*r[e];return Math.sqrt(t)}function Nn(r,t){var e=Zc(r,t);return e===0?0:Math.sqrt(e)}function Be(r,t){var e=t?mn(r,t):r,i=P0(e,(function(s,o){return s+Math.pow(o,2)})),n=Math.sqrt(i);return n===0?S0(e,0):C0(e,(function(s){return s/n}))}function vl(r,t,e,i){t===void 0&&(t=[0,1,0]),e===void 0&&(e=0);var n=Math.cos(e),s=Math.sin(e),o=1-n,a=r[0],h=r[1],l=r[2],u=t[0],c=t[1],d=t[2],f=o*u,p=o*c;return(i=i||r)[0]=(f*u+n)*a+(f*c-s*d)*h+(f*d+s*c)*l,i[1]=(f*c+s*d)*a+(p*c+n)*h+(p*d-s*u)*l,i[2]=(f*d-s*c)*a+(p*d+s*u)*h+(o*d*d+n)*l,i}function R0(r,t,e,i,n){if(n===void 0&&(n=0),n===0)return[0,1,2,3];var s=function(h,l){return Math.pow(Zc(h,l),.5*n)},o=s(t,r),a=s(e,t)+o;return[0,o,a,s(i,e)+a]}function M0(r,t,e,i,n){for(var s=Number.isFinite(n.tension)?n.tension:.5,o=Number.isFinite(n.alpha)?n.alpha:null,a=o>0?R0(r,t,e,i,o):null,h=new Array(r.length),l=0;l<r.length;l++){var u=0,c=0,d=r[l],f=t[l],p=e[l],m=i[l];if(a){var g=a[0],y=a[1],x=a[2],v=a[3];y-x!=0&&(g-y!=0&&g-x!=0&&(u=(1-s)*(x-y)*((d-f)/(g-y)-(d-p)/(g-x)+(f-p)/(y-x))),y-v!=0&&x-v!=0&&(c=(1-s)*(x-y)*((f-p)/(y-x)-(f-m)/(y-v)+(p-m)/(x-v))))}else u=(1-s)*(p-d)*.5,c=(1-s)*(m-f)*.5;var E=2*f-2*p+u+c,w=-3*f+3*p-2*u-c,I=u,T=f;h[l]=[E,w,I,T]}return h}function kr(r,t){var e=r*r,i=r*e;return t[0]*i+t[1]*e+t[2]*r+t[3]}function Ur(r,t){var e=r*r;return 3*t[0]*e+2*t[1]*r+t[2]}function Os(r,t){return 6*t[0]*r+2*t[1]}function F0(r,t){var e=t[0],i=t[1],n=t[2],s=t[3]-r;return e===0&&i===0&&n===0&&s===0?[0]:I0(e,i,n,s).filter((function(o){return o>-$t&&o<=1+$t})).map((function(o){return Rt(o,0,1)}))}function ya(r,t,e,i){i===void 0&&(i=null),i=i||new Array(e.length);for(var n=0;n<e.length;n++)i[n]=r(t,e[n]);return i}var Qc=(function(){function r(t){t===void 0&&(t=null),this._alpha=0,this._tension=.5,this._closed=!1,this._onInvalidateCache=null,this._onInvalidateCache=t,this._cache={arcLengths:null,coefficients:null}}return r.prototype._invalidateCache=function(){this.points&&(this._cache={arcLengths:null,coefficients:null},this._onInvalidateCache&&this._onInvalidateCache())},Object.defineProperty(r.prototype,"alpha",{get:function(){return this._alpha},set:function(t){Number.isFinite(t)&&t!==this._alpha&&(this._invalidateCache(),this._alpha=t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tension",{get:function(){return this._tension},set:function(t){Number.isFinite(t)&&t!==this._tension&&(this._invalidateCache(),this._tension=t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"points",{get:function(){return this._points},set:function(t){if(!t||t.length<2)throw Error("At least 2 control points are required!");this._points=t,this._invalidateCache()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this._closed},set:function(t){t=!!t,this._closed!==t&&(this._invalidateCache(),this._closed=t)},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this._invalidateCache()},r.prototype.evaluateForT=function(t,e,i){var n=E0(e,this.points,this.closed),s=n.index;return ya(t,n.weight,this.getCoefficients(s),i)},r.prototype.getCoefficients=function(t){if(this.points){if(this._cache.coefficients||(this._cache.coefficients=new Map),!this._cache.coefficients.has(t)){var e=ma(t,this.points,this.closed),i=M0(e[0],e[1],e[2],e[3],{tension:this.tension,alpha:this.alpha});this._cache.coefficients.set(t,i)}return this._cache.coefficients.get(t)}},r})(),D0=(function(r){function t(e,i){e===void 0&&(e=300),i===void 0&&(i=null);var n=r.call(this,i)||this;return n._subDivisions=e,n}return Yc(t,r),Object.defineProperty(t.prototype,"arcLengths",{get:function(){return this._cache.arcLengths||(this._cache.arcLengths=this.computeArcLengths()),this._cache.arcLengths},enumerable:!1,configurable:!0}),t.prototype._invalidateCache=function(){r.prototype._invalidateCache.call(this),this._cache.arcLengths=null},t.prototype.computeArcLengths=function(){var e,i=[],n=this.evaluateForT(kr,0),s=0;i.push(0);for(var o=1;o<=this._subDivisions;o++)s+=Nn(e=this.evaluateForT(kr,o/this._subDivisions),n),i.push(s),n=e;return i},t.prototype.lengthAt=function(e){var i=this.arcLengths;return e*i[i.length-1]},t.prototype.getT=function(e){var i=this.arcLengths,n=i.length,s=e*i[n-1],o=ga(s,i);if(i[o]===s)return o/(n-1);var a=i[o];return(o+(s-a)/(i[o+1]-a))/(n-1)},t.prototype.getU=function(e){if(e===0)return 0;if(e===1)return 1;var i=this.arcLengths,n=i.length-1,s=i[n],o=e*n,a=Math.floor(o),h=i[a];if(o===a)return h/s;var l=a/n;return(h+Nn(this.evaluateForT(kr,l),this.evaluateForT(kr,e)))/s},t})(Qc),Jc=[[[-.906179845938664,.23692688505618908],[-.5384693101056831,.47862867049936647],[0,.5688888888888889],[.5384693101056831,.47862867049936647],[.906179845938664,.23692688505618908]],[[-.932469514203152,.17132449237917036],[-.6612093864662645,.3607615730481386],[-.2386191860831969,.46791393457269104],[.2386191860831969,.46791393457269104],[.6612093864662645,.3607615730481386],[.932469514203152,.17132449237917036]],[[-.9491079123427585,.1294849661688697],[-.7415311855993945,.27970539148927664],[-.4058451513773972,.3818300505051189],[0,.4179591836734694],[.4058451513773972,.3818300505051189],[.7415311855993945,.27970539148927664],[.9491079123427585,.1294849661688697]],[[-.9602898564975363,.10122853629037626],[-.7966664774136267,.22238103445337448],[-.525532409916329,.31370664587788727],[-.1834346424956498,.362683783378362],[.1834346424956498,.362683783378362],[.525532409916329,.31370664587788727],[.7966664774136267,.22238103445337448],[.9602898564975363,.10122853629037626]],[[-.9681602395076261,.08127438836157441],[-.8360311073266358,.1806481606948574],[-.6133714327005904,.26061069640293544],[-.3242534234038089,.31234707704000286],[0,.3302393550012598],[.3242534234038089,.31234707704000286],[.6133714327005904,.26061069640293544],[.8360311073266358,.1806481606948574],[.9681602395076261,.08127438836157441]],[[-.9739065285171717,.06667134430868814],[-.8650633666889845,.1494513491505806],[-.6794095682990244,.21908636251598204],[-.4333953941292472,.26926671930999635],[-.14887433898163122,.29552422471475287],[.14887433898163122,.29552422471475287],[.4333953941292472,.26926671930999635],[.6794095682990244,.21908636251598204],[.8650633666889845,.1494513491505806],[.9739065285171717,.06667134430868814]],[[-.978228658146056,.0556685671161736],[-.887062599768095,.125580369464904],[-.730152005574049,.186290210927734],[-.519096129206811,.23319376459199],[-.269543155952344,.262804544510246],[0,.2729250867779],[.269543155952344,.262804544510246],[.519096129206811,.23319376459199],[.730152005574049,.186290210927734],[.887062599768095,.125580369464904],[.978228658146056,.0556685671161736]],[[-.981560634246719,.0471753363865118],[-.904117256370474,.106939325995318],[-.769902674194304,.160078328543346],[-.587317954286617,.203167426723065],[-.36783149899818,.233492536538354],[-.125233408511468,.249147045813402],[.125233408511468,.249147045813402],[.36783149899818,.233492536538354],[.587317954286617,.203167426723065],[.769902674194304,.160078328543346],[.904117256370474,.106939325995318],[.981560634246719,.0471753363865118]],[[-.984183054718588,.0404840047653158],[-.917598399222977,.0921214998377284],[-.801578090733309,.138873510219787],[-.64234933944034,.178145980761945],[-.448492751036446,.207816047536888],[-.230458315955134,.226283180262897],[0,.232551553230873],[.230458315955134,.226283180262897],[.448492751036446,.207816047536888],[.64234933944034,.178145980761945],[.801578090733309,.138873510219787],[.917598399222977,.0921214998377284],[.984183054718588,.0404840047653158]],[[-.986283808696812,.0351194603317518],[-.928434883663573,.0801580871597602],[-.827201315069764,.121518570687903],[-.687292904811685,.157203167158193],[-.515248636358154,.185538397477937],[-.319112368927889,.205198463721295],[-.108054948707343,.215263853463157],[.108054948707343,.215263853463157],[.319112368927889,.205198463721295],[.515248636358154,.185538397477937],[.687292904811685,.157203167158193],[.827201315069764,.121518570687903],[.928434883663573,.0801580871597602],[.986283808696812,.0351194603317518]],[[-.987992518020485,.0307532419961172],[-.937273392400705,.0703660474881081],[-.848206583410427,.107159220467171],[-.72441773136017,.139570677926154],[-.570972172608538,.166269205816993],[-.394151347077563,.186161000015562],[-.201194093997434,.198431485327111],[0,.202578241925561],[.201194093997434,.198431485327111],[.394151347077563,.186161000015562],[.570972172608538,.166269205816993],[.72441773136017,.139570677926154],[.848206583410427,.107159220467171],[.937273392400705,.0703660474881081],[.987992518020485,.0307532419961172]],[[-.989400934991649,.027152459411754],[-.944575023073232,.0622535239386478],[-.865631202387831,.0951585116824927],[-.755404408355003,.124628971255533],[-.617876244402643,.149595988816576],[-.458016777657227,.169156519395002],[-.281603550779258,.182603415044923],[-.0950125098376374,.189450610455068],[.0950125098376374,.189450610455068],[.281603550779258,.182603415044923],[.458016777657227,.169156519395002],[.617876244402643,.149595988816576],[.755404408355003,.124628971255533],[.865631202387831,.0951585116824927],[.944575023073232,.0622535239386478],[.989400934991649,.027152459411754]],[[-.990575475314417,.0241483028685479],[-.950675521768767,.0554595293739872],[-.880239153726985,.0850361483171791],[-.781514003896801,.111883847193403],[-.65767115921669,.135136368468525],[-.512690537086476,.15404576107681],[-.351231763453876,.16800410215645],[-.178484181495847,.176562705366992],[0,.179446470356206],[.178484181495847,.176562705366992],[.351231763453876,.16800410215645],[.512690537086476,.15404576107681],[.65767115921669,.135136368468525],[.781514003896801,.111883847193403],[.880239153726985,.0850361483171791],[.950675521768767,.0554595293739872],[.990575475314417,.0241483028685479]],[[-.99156516842093,.0216160135264833],[-.955823949571397,.0497145488949698],[-.892602466497555,.076425730254889],[-.803704958972523,.100942044106287],[-.691687043060353,.122555206711478],[-.559770831073947,.14064291467065],[-.411751161462842,.154684675126265],[-.251886225691505,.164276483745832],[-.0847750130417353,.169142382963143],[.0847750130417353,.169142382963143],[.251886225691505,.164276483745832],[.411751161462842,.154684675126265],[.559770831073947,.14064291467065],[.691687043060353,.122555206711478],[.803704958972523,.100942044106287],[.892602466497555,.076425730254889],[.955823949571397,.0497145488949697],[.99156516842093,.0216160135264833]],[[-.992406843843584,.0194617882297264],[-.96020815213483,.0448142267656996],[-.903155903614817,.0690445427376412],[-.822714656537142,.0914900216224499],[-.720966177335229,.111566645547333],[-.600545304661681,.128753962539336],[-.46457074137596,.142606702173606],[-.316564099963629,.152766042065859],[-.160358645640225,.158968843393954],[0,.161054449848783],[.160358645640225,.158968843393954],[.316564099963629,.152766042065859],[.46457074137596,.142606702173606],[.600545304661681,.128753962539336],[.720966177335229,.111566645547333],[.822714656537142,.0914900216224499],[.903155903614817,.0690445427376412],[.96020815213483,.0448142267656996],[.992406843843584,.0194617882297264]],[[-.993128599185094,.0176140071391521],[-.963971927277913,.0406014298003869],[-.912234428251325,.062672048334109],[-.839116971822218,.0832767415767047],[-.74633190646015,.10193011981724],[-.636053680726515,.118194531961518],[-.510867001950827,.131688638449176],[-.373706088715419,.142096109318382],[-.227785851141645,.149172986472603],[-.0765265211334973,.152753387130725],[.0765265211334973,.152753387130725],[.227785851141645,.149172986472603],[.373706088715419,.142096109318382],[.510867001950827,.131688638449176],[.636053680726515,.118194531961518],[.74633190646015,.10193011981724],[.839116971822218,.0832767415767047],[.912234428251325,.062672048334109],[.963971927277913,.0406014298003869],[.993128599185094,.0176140071391521]],[[-.993752170620389,.0160172282577743],[-.967226838566306,.0369537897708524],[-.9200993341504,.0571344254268572],[-.853363364583317,.0761001136283793],[-.768439963475677,.0934444234560338],[-.667138804197412,.108797299167148],[-.551618835887219,.121831416053728],[-.424342120207438,.132268938633337],[-.288021316802401,.139887394791073],[-.145561854160895,.14452440398997],[0,.14608113364969],[.145561854160895,.14452440398997],[.288021316802401,.139887394791073],[.424342120207438,.132268938633337],[.551618835887219,.121831416053728],[.667138804197412,.108797299167148],[.768439963475677,.0934444234560338],[.853363364583317,.0761001136283793],[.9200993341504,.0571344254268572],[.967226838566306,.0369537897708524],[.993752170620389,.0160172282577743]],[[-.994294585482399,.0146279952982722],[-.970060497835428,.0337749015848141],[-.926956772187174,.0522933351526832],[-.8658125777203,.0697964684245204],[-.787816805979208,.0859416062170677],[-.694487263186682,.10041414444288],[-.587640403506911,.112932296080539],[-.469355837986757,.123252376810512],[-.341935820892084,.131173504787062],[-.207860426688221,.136541498346015],[-.0697392733197222,.139251872855631],[.0697392733197222,.139251872855631],[.207860426688221,.136541498346015],[.341935820892084,.131173504787062],[.469355837986757,.123252376810512],[.587640403506911,.112932296080539],[.694487263186682,.10041414444288],[.787816805979208,.0859416062170677],[.8658125777203,.0697964684245204],[.926956772187174,.0522933351526832],[.970060497835428,.0337749015848141],[.994294585482399,.0146279952982722]],[[-.994769334997552,.0134118594871417],[-.972542471218115,.0309880058569794],[-.932971086826016,.0480376717310846],[-.876752358270441,.0642324214085258],[-.804888401618839,.0792814117767189],[-.71866136313195,.0929157660600351],[-.619609875763646,.104892091464541],[-.509501477846007,.114996640222411],[-.39030103803029,.123049084306729],[-.264135680970344,.128905722188082],[-.133256824298466,.132462039404696],[0,.133654572186106],[.133256824298466,.132462039404696],[.264135680970344,.128905722188082],[.39030103803029,.123049084306729],[.509501477846007,.114996640222411],[.619609875763646,.104892091464541],[.71866136313195,.0929157660600351],[.804888401618839,.0792814117767189],[.876752358270441,.0642324214085258],[.932971086826016,.0480376717310846],[.972542471218115,.0309880058569794],[.994769334997552,.0134118594871417]],[[-.995187219997021,.0123412297999872],[-.974728555971309,.0285313886289336],[-.938274552002732,.0442774388174198],[-.886415527004401,.0592985849154367],[-.820001985973902,.0733464814110803],[-.740124191578554,.0861901615319532],[-.648093651936975,.0976186521041138],[-.545421471388839,.107444270115965],[-.433793507626045,.115505668053725],[-.315042679696163,.121670472927803],[-.191118867473616,.125837456346828],[-.0640568928626056,.127938195346752],[.0640568928626056,.127938195346752],[.191118867473616,.125837456346828],[.315042679696163,.121670472927803],[.433793507626045,.115505668053725],[.545421471388839,.107444270115965],[.648093651936975,.0976186521041138],[.740124191578554,.0861901615319532],[.820001985973902,.0733464814110803],[.886415527004401,.0592985849154367],[.938274552002732,.0442774388174198],[.974728555971309,.0285313886289336],[.995187219997021,.0123412297999872]],[[-.995556969790498,.0113937985010262],[-.976663921459517,.0263549866150321],[-.942974571228974,.0409391567013063],[-.894991997878275,.0549046959758351],[-.833442628760834,.0680383338123569],[-.759259263037357,.080140700335001],[-.673566368473468,.0910282619829636],[-.577662930241222,.10053594906705],[-.473002731445714,.108519624474263],[-.361172305809387,.114858259145711],[-.243866883720988,.119455763535784],[-.12286469261071,.12224244299031],[0,.123176053726715],[.12286469261071,.12224244299031],[.243866883720988,.119455763535784],[.361172305809387,.114858259145711],[.473002731445714,.108519624474263],[.577662930241222,.10053594906705],[.673566368473468,.0910282619829636],[.759259263037357,.080140700335001],[.833442628760834,.0680383338123569],[.894991997878275,.0549046959758351],[.942974571228974,.0409391567013063],[.976663921459517,.0263549866150321],[.995556969790498,.0113937985010262]],[[-.995885701145616,.010551372617343],[-.97838544595647,.0244178510926319],[-.947159066661714,.0379623832943627],[-.902637861984307,.0509758252971478],[-.845445942788498,.0632740463295748],[-.776385948820678,.0746841497656597],[-.696427260419957,.0850458943134852],[-.606692293017618,.0942138003559141],[-.508440714824505,.102059161094425],[-.403051755123486,.108471840528576],[-.292004839485956,.113361816546319],[-.17685882035689,.116660443485296],[-.0592300934293132,.118321415279262],[.0592300934293132,.118321415279262],[.17685882035689,.116660443485296],[.292004839485956,.113361816546319],[.403051755123486,.108471840528576],[.508440714824505,.102059161094425],[.606692293017618,.0942138003559141],[.696427260419957,.0850458943134852],[.776385948820678,.0746841497656597],[.845445942788498,.0632740463295748],[.902637861984307,.0509758252971478],[.947159066661714,.0379623832943627],[.97838544595647,.0244178510926319],[.995885701145616,.010551372617343]],[[-.996179262888988,.00979899605129436],[-.979923475961501,.0226862315961806],[-.950900557814705,.0352970537574197],[-.909482320677491,.047449412520615],[-.856207908018294,.0589835368598335],[-.791771639070508,.0697488237662455],[-.717013473739423,.0796048677730577],[-.632907971946495,.0884231585437569],[-.540551564579456,.0960887273700285],[-.441148251750026,.102501637817745],[-.335993903638508,.107578285788533],[-.226459365439536,.111252488356845],[-.113972585609529,.113476346108965],[0,.114220867378956],[.113972585609529,.113476346108965],[.226459365439536,.111252488356845],[.335993903638508,.107578285788533],[.441148251750026,.102501637817745],[.540551564579456,.0960887273700285],[.632907971946495,.0884231585437569],[.717013473739423,.0796048677730577],[.791771639070508,.0697488237662455],[.856207908018294,.0589835368598336],[.909482320677491,.047449412520615],[.950900557814705,.0352970537574197],[.979923475961501,.0226862315961806],[.996179262888988,.00979899605129436]],[[-.996442497573954,.00912428259309452],[-.981303165370872,.0211321125927712],[-.954259280628938,.0329014277823043],[-.915633026392132,.0442729347590042],[-.865892522574395,.0551073456757167],[-.805641370917179,.0652729239669995],[-.735610878013631,.0746462142345687],[-.656651094038864,.0831134172289012],[-.569720471811401,.0905717443930328],[-.475874224955118,.0969306579979299],[-.376251516089078,.10211296757806],[-.272061627635178,.106055765922846],[-.16456928213338,.108711192258294],[-.0550792898840342,.110047013016475],[.0550792898840342,.110047013016475],[.16456928213338,.108711192258294],[.272061627635178,.106055765922846],[.376251516089078,.10211296757806],[.475874224955118,.0969306579979299],[.569720471811401,.0905717443930328],[.656651094038864,.0831134172289012],[.735610878013631,.0746462142345687],[.805641370917179,.0652729239669995],[.865892522574395,.0551073456757167],[.915633026392132,.0442729347590042],[.954259280628938,.0329014277823043],[.981303165370872,.0211321125927712],[.996442497573954,.00912428259309452]],[[-.996679442260596,.00851690387874641],[-.982545505261413,.0197320850561227],[-.957285595778087,.0307404922020936],[-.921180232953058,.0414020625186828],[-.874637804920102,.0515948269024979],[-.818185487615252,.0612030906570791],[-.752462851734477,.0701179332550512],[-.678214537602686,.0782383271357637],[-.596281797138227,.0854722573661725],[-.507592955124227,.0917377571392587],[-.413152888174008,.0969638340944086],[-.314031637867639,.101091273759914],[-.211352286166001,.104073310077729],[-.106278230132679,.10587615509732],[0,.106479381718314],[.106278230132679,.10587615509732],[.211352286166001,.104073310077729],[.314031637867639,.101091273759914],[.413152888174008,.0969638340944086],[.507592955124227,.0917377571392587],[.596281797138227,.0854722573661725],[.678214537602686,.0782383271357637],[.752462851734477,.0701179332550512],[.818185487615252,.0612030906570791],[.874637804920102,.0515948269024979],[.921180232953058,.0414020625186828],[.957285595778087,.0307404922020936],[.982545505261413,.0197320850561227],[.996679442260596,.00851690387874641]],[[-.996893484074649,.0079681924961666],[-.983668123279747,.0184664683110909],[-.960021864968307,.0287847078833233],[-.926200047429274,.038799192569627],[-.882560535792052,.048402672830594],[-.829565762382768,.057493156217619],[-.767777432104826,.0659742298821805],[-.697850494793315,.0737559747377052],[-.620526182989242,.0807558952294202],[-.536624148142019,.0868997872010829],[-.447033769538089,.0921225222377861],[-.352704725530878,.0963687371746442],[-.254636926167889,.0995934205867952],[-.153869913608583,.101762389748405],[-.0514718425553176,.102852652893558],[.0514718425553176,.102852652893558],[.153869913608583,.101762389748405],[.254636926167889,.0995934205867952],[.352704725530878,.0963687371746442],[.447033769538089,.0921225222377861],[.536624148142019,.0868997872010829],[.620526182989242,.0807558952294202],[.697850494793315,.0737559747377052],[.767777432104826,.0659742298821805],[.829565762382768,.057493156217619],[.882560535792052,.048402672830594],[.926200047429274,.038799192569627],[.960021864968307,.0287847078833233],[.983668123279747,.0184664683110909],[.996893484074649,.0079681924961666]]],_l=Jc.length+5,B0=(function(r){function t(e,i,n){e===void 0&&(e=24),i===void 0&&(i=21);var s=r.call(this,n)||this;return s._nSamples=21,s._gauss=(function(o){if(o<5||o>_l)throw Error("Order for Gaussian Quadrature must be in the range of ".concat(5," and ").concat(_l,"."));return Jc[o-5]})(e),s._nSamples=i,s}return Yc(t,r),t.prototype._invalidateCache=function(){r.prototype._invalidateCache.call(this),this._cache.arcLengths=null,this._cache.samples=null},Object.defineProperty(t.prototype,"arcLengths",{get:function(){return this._cache.arcLengths||(this._cache.arcLengths=this.computeArcLengths()),this._cache.arcLengths},enumerable:!1,configurable:!0}),t.prototype.getSamples=function(e){if(this.points){if(this._cache.samples||(this._cache.samples=new Map),!this._cache.samples.has(e)){for(var i=this._nSamples,n=[],s=[],o=this.getCoefficients(e),a=0;a<i;++a){var h=a/(i-1);n.push(this.computeArcLength(e,0,h));var l=dr(ya(Ur,h,o)),u=l===0?0:1/l;this.tension>.95&&(u=Rt(u,-1,1)),s.push(u)}var c=i-1,d=[],f=[],p=n[0],m=s[0],g=1/c;for(a=0;a<c;++a){var y=p,x=(p=n[a+1])-y,v=m,E=s[a+1];m=E;var w=g/x,I=(v+E-2*w)/(x*x),T=(3*w-2*v-E)/x;d.push(I),f.push(T)}this._cache.samples.set(e,[n,s,f,d])}return this._cache.samples.get(e)}},t.prototype.computeArcLength=function(e,i,n){if(i===void 0&&(i=0),n===void 0&&(n=1),i===n)return 0;for(var s=this.getCoefficients(e),o=.5*(n-i),a=0,h=0;h<this._gauss.length;h++){var l=this._gauss[h],u=l[0];a+=l[1]*dr(ya(Ur,o*u+o+i,s))}return o*a},t.prototype.computeArcLengths=function(){if(this.points){var e=[];e.push(0);for(var i=this.closed?this.points.length:this.points.length-1,n=0,s=0;s<i;s++)n+=this.computeArcLength(s),e.push(n);return e}},t.prototype.inverse=function(e,i){var n=1/(this._nSamples-1),s=this.getSamples(e),o=s[0],a=s[1],h=s[2],l=s[3];if(i>=o[o.length-1])return 1;if(i<=0)return 0;var u=Math.max(0,ga(i,o)),c=u*n;if(o[u]===i)return c;var d=a[u],f=l[u],p=h[u],m=i-o[u];return((f*m+p)*m+d)*m+c},t.prototype.lengthAt=function(e){return e*this.arcLengths[this.arcLengths.length-1]},t.prototype.getT=function(e){var i=this.arcLengths,n=i.length,s=e*i[n-1],o=ga(s,i),a=o/(n-1);if(i[o]===s)return a;var h=s-i[o];return(o+this.inverse(o,h))/(n-1)},t.prototype.getU=function(e){if(e===0)return 0;if(e===1)return 1;var i=this.arcLengths,n=i.length-1,s=i[n],o=e*n,a=Math.floor(o),h=i[a];if(o===a)return h/s;var l=o-a;return(h+this.computeArcLength(a,0,l))/s},t})(Qc),ST=(function(){function r(t,e){e===void 0&&(e={});var i=this;this._cache=new Map;var n=(e=Ln({tension:.5,alpha:0,closed:!1},e)).arcDivisions?new D0(e.arcDivisions,(function(){return i._invalidateCache()})):new B0(e.numericalApproximationOrder,e.numericalInverseSamples,(function(){return i._invalidateCache()}));n.alpha=e.alpha,n.tension=e.tension,n.closed=e.closed,n.points=t,this._lmargin=e.lmargin||1-n.tension,this._curveMapper=n}return r.prototype.getTimeFromPosition=function(t,e){return e===void 0&&(e=!1),this._curveMapper.getT(e?Rt(t,0,1):t)},r.prototype.getPositionFromTime=function(t,e){return e===void 0&&(e=!1),this._curveMapper.getU(e?Rt(t,0,1):t)},r.prototype.getPositionFromLength=function(t,e){e===void 0&&(e=!1);var i=e?Rt(t,0,this.length):t;return this._curveMapper.getU(i/this.length)},r.prototype.getLengthAt=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!1),this._curveMapper.lengthAt(e?Rt(t,0,1):t)},r.prototype.getTimeAtKnot=function(t){if(t<0||t>this.points.length-1)throw Error("Invalid index!");return t===0?0:this.closed||t!==this.points.length-1?t/(this.closed?this.points.length:this.points.length-1):1},r.prototype.getPositionAtKnot=function(t){return this.getPositionFromTime(this.getTimeAtKnot(t))},r.prototype.getPointAtTime=function(t,e){return(t=Rt(t,0,1))===0?mn(this.points[0],e):t===1?mn(this.closed?this.points[0]:this.points[this.points.length-1],e):this._curveMapper.evaluateForT(kr,t,e)},r.prototype.getPointAt=function(t,e){return this.getPointAtTime(this.getTimeFromPosition(t),e)},r.prototype.getTangentAt=function(t,e){var i=Rt(this.getTimeFromPosition(t),0,1);return this.getTangentAtTime(i,e)},r.prototype.getTangentAtTime=function(t,e){return Be(this._curveMapper.evaluateForT(Ur,t,e))},r.prototype.getNormalAt=function(t,e){var i=Rt(this.getTimeFromPosition(t),0,1);return this.getNormalAtTime(i,e)},r.prototype.getNormalAtTime=function(t,e){var i=Be(this._curveMapper.evaluateForT(Ur,t));if(!(i.length<2||i.length>3)){var n=e||new Array(i.length);if(i.length===2)return n[0]=-i[1],n[1]=i[0],n;var s=Be(this._curveMapper.evaluateForT(Os,t));return Be(qt(qt(i,s),i),n)}},r.prototype.getFrenetFrames=function(t,e,i){if(e===void 0&&(e=0),i===void 0&&(i=1),!(e<0||i>1||i<e)){for(var n=new Array(t+1),s=new Array(t+1),o=0;o<=t;o++){var a=e===0&&i===1?o/t:e+o/t*(i-e);n[o]=this.getTangentAt(a)}if(this.dim===2){for(o=0;o<n.length;o++)s[o]=[-n[o][1],n[o][0]];return{tangents:n,normals:s}}if(this.dim===3){var h=new Array(t+1),l=void 0,u=Number.MAX_VALUE,c=Math.abs(n[0][0]),d=Math.abs(n[0][1]);c<=u&&(u=c,l=[1,0,0]),d<=u&&(u=d,l=[0,1,0]),Math.abs(n[0][2])<=u&&(l=[0,0,1]);var f=Be(qt(n[0],l));for(s[0]=qt(n[0],f),h[0]=qt(n[0],s[0]),o=1;o<=t;o++){if(f=qt(n[o-1],n[o]),s[o]=mn(s[o-1]),dr(f)>$t){Be(f);var p=Math.acos(Rt(Vi(n[o-1],n[o]),-1,1));vl(s[o-1],f,p,s[o])}h[o]=qt(n[o],s[o])}if(this.closed===!0)for(p=Math.acos(Rt(Vi(s[0],s[t]),-1,1))/t,Vi(n[0],qt(s[0],s[t]))>0&&(p=-p),o=1;o<=t;o++)vl(s[o],n[o],p*o,s[o]),h[o]=qt(n[o],s[o]);return{tangents:n,normals:s,binormals:h}}}},r.prototype.getCurvatureAt=function(t){var e=Rt(this.getTimeFromPosition(t),0,1);return this.getCurvatureAtTime(e)},r.prototype.getCurvatureAtTime=function(t){var e=this._curveMapper.evaluateForT(Ur,t),i=this._curveMapper.evaluateForT(Os,t),n=Be(e,[]),s=0,o=void 0;if(e.length===2){if((c=Math.pow(e[0]*e[0]+e[1]*e[1],1.5))!==0){var a=(e[0]*i[1]-e[1]*i[0])/c;o=a<0?[n[1],-n[0]]:[-n[1],n[0]],s=Math.abs(a)}}else if(e.length===3){var h=dr(e),l=qt(e,i);o=Be(qt(l,e)),h!==0&&(s=dr(l)/Math.pow(h,3))}else{h=dr(e);var u=dr(i),c=Math.pow(h,3),d=Vi(e,i);c!==0&&(s=Math.sqrt(Math.pow(h,2)*Math.pow(u,2)-Math.pow(d,2))/c)}return{curvature:s,radius:s!==0?1/s:0,tangent:n,direction:o}},r.prototype.getDerivativeAt=function(t,e){var i=Rt(this.getTimeFromPosition(t),0,1);return this._curveMapper.evaluateForT(Ur,i,e)},r.prototype.getSecondDerivativeAt=function(t,e){var i=Rt(this.getTimeFromPosition(t),0,1);return this._curveMapper.evaluateForT(Os,i,e)},r.prototype.getBoundingBox=function(t,e){if(t===void 0&&(t=0),e===void 0&&(e=1),t===0&&e===1&&this._cache.has("bbox"))return this._cache.get("bbox");for(var i=[],n=[],s=this.getTimeFromPosition(t),o=this.getTimeFromPosition(e),a=this.getPointAtTime(s),h=this.getPointAtTime(o),l=this.closed?this.points.length:this.points.length-1,u=Math.floor(l*s),c=Math.ceil(l*o),d=0;d<a.length;d++)i[d]=Math.min(a[d],h[d]),n[d]=Math.max(a[d],h[d]);for(var f=function(y){var x=ma(y-1,p.points,p.closed)[2];if(y<c)for(var v=0;v<x.length;v++)x[v]<i[v]&&(i[v]=x[v]),x[v]>n[v]&&(n[v]=x[v]);if(p.tension<1){var E=l*s-(y-1),w=l*o-(y-1),I=function(U){return U>-$t&&U<=1+$t&&(y-1!==u||U>E)&&(y!==c||U<w)},T=p._curveMapper.getCoefficients(y-1),F=function(U){var G=T[U];Kc(3*G[0],2*G[1],G[2]).filter(I).forEach((function(z){var M=kr(z,T[U]);M<i[U]&&(i[U]=M),M>n[U]&&(n[U]=M)}))};for(v=0;v<T.length;v++)F(v)}},p=this,m=u+1;m<=c;m++)f(m);var g={min:i,max:n};return t===0&&e===1&&this._cache.set("bbox",g),g},r.prototype.getPoints=function(t,e,i,n){if(t===void 0&&(t=100),i===void 0&&(i=0),n===void 0&&(n=1),!t||t<=0)throw Error("Invalid arguments passed to getPoints(). You must specify at least 1 sample/segment.");if(!(i<0||n>1||n<i)){for(var s=[],o=0;o<=t;o++){var a=i===0&&n===1?o/t:i+o/t*(n-i);s.push(this.getPointAt(a,e&&new e))}return s}},r.prototype.getNearestPosition=function(t,e,i){var n=this;if(e===void 0&&(e=1e-5),e<=0||!Number.isFinite(e))throw Error("Invalid threshold. Must be a number greater than zero!");i=i||10*this.points.length-1;var s=new Array(t.length),o=1/0,a=0,h=this.createLookupTable((function(d){return n.getPointAt(d)}),i,{cacheKey:"lut_nearest_".concat(i)});Array.from(h.keys()).forEach((function(d){var f=h.get(d),p=Nn(t,f);if(p<o)return o=p,a=d,!0}));for(var l=this.getTimeFromPosition(a),u=function(d){if(d>=0&&d<=1){n.getPointAtTime(d,s);var f=Nn(t,s);if(f<o)return o=f,l=d,!0}},c=.005;c>e;)u(l-c)||u(l+c)||(c/=2);return{u:a=this._curveMapper.getU(l),distance:o,point:s}},r.prototype.getIntersects=function(t,e,i,n){var s=this;e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=this._lmargin);var o=this.getIntersectsAsTime(t,e,i,n).map((function(a){return s.getPointAtTime(a)}));return Math.abs(i)===1?o.length===1?o[0]:null:o},r.prototype.getIntersectsAsPositions=function(t,e,i,n){var s=this;return e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=this._lmargin),this.getIntersectsAsTime(t,e,i,n).map((function(o){return s.getPositionFromTime(o)}))},r.prototype.getIntersectsAsTime=function(t,e,i,n){e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=this._lmargin);for(var s=e,o=new Set,a=this.closed?this.points.length:this.points.length-1,h=0;h<a&&(i===0||o.size<Math.abs(i));h+=1){var l=i<0?a-(h+1):h,u=ma(l,this.points,this.closed),c=u[1],d=u[2],f=this._curveMapper.getCoefficients(l),p=void 0,m=void 0;if(c[s]<d[s]?(p=c[s],m=d[s]):(p=d[s],m=c[s]),t-n<=m&&t+n>=p){var g=F0(t,f[s]);i<0?g.sort((function(v,E){return E-v})):i>=0&&g.sort((function(v,E){return v-E}));for(var y=0;y<g.length;y++){var x=(g[y]+l)/a;if(o.add(x),i!==0&&o.size===Math.abs(i))break}}}return Array.from(o)},r.prototype.createLookupTable=function(t,e,i){if(!e||e<=1)throw Error("Invalid arguments passed to createLookupTable(). You must specify at least 2 samples.");var n=Ln({from:0,to:1,cacheForceUpdate:!1},i),s=n.from,o=n.to,a=n.cacheKey,h=n.cacheForceUpdate;if(!(s<0||o>1||o<s)){var l=null;if(a&&!h&&this._cache.has(a))a&&this._cache.has(a)&&(l=this._cache.get(a));else{l=new Map;for(var u=0;u<e;u++){var c=s===0&&o===1?u/(e-1):s+u/(e-1)*(o-s),d=t(c);l.set(c,d)}a&&this._cache.set(a,l)}return l}},r.prototype.forEach=function(t,e,i,n){var s=this;i===void 0&&(i=0),n===void 0&&(n=1);var o=[];if(Number.isFinite(e)){var a=e;if(a<=1)throw Error("Invalid arguments passed to forEach(). You must specify at least 2 samples.");for(var h=0;h<a;h++){var l=i===0&&n===1?h/(a-1):i+h/(a-1)*(n-i);o.push(l)}}else Array.isArray(e)&&(o=e);var u=null;o.forEach((function(c,d){if(!Number.isFinite(c)||c<0||c>1)throw Error("Invalid position (u) for sample in forEach!");var f=s.getTimeFromPosition(c),p=t({u:c,t:f,i:d,prev:u});u={u:c,t:f,i:d,value:p}}))},r.prototype.map=function(t,e,i,n){var s=this;i===void 0&&(i=0),n===void 0&&(n=1);var o=[];if(Number.isFinite(e)){var a=e;if(a<=1)throw Error("Invalid arguments passed to map(). You must specify at least 2 samples.");for(var h=0;h<a;h++){var l=i===0&&n===1?h/(a-1):i+h/(a-1)*(n-i);o.push(l)}}else Array.isArray(e)&&(o=e);var u=null;return o.map((function(c,d){if(!Number.isFinite(c)||c<0||c>1)throw Error("Invalid position (u) for sample in map()!");var f=s.getTimeFromPosition(c),p=t({u:c,t:f,i:d,prev:u});return u={u:c,t:f,i:d,value:p},p}))},r.prototype.reduce=function(t,e,i,n,s){var o=this;n===void 0&&(n=0),s===void 0&&(s=1);var a=[];if(Number.isFinite(i)){var h=i;if(h<=1)throw Error("Invalid arguments passed to map(). You must specify at least 2 samples.");for(var l=0;l<h;l++){var u=n===0&&s===1?l/(h-1):n+l/(h-1)*(s-n);a.push(u)}}else Array.isArray(i)&&(a=i);return a.reduce((function(c,d,f){if(!Number.isFinite(d)||d<0||d>1)throw Error("Invalid position (u) for sample in map()!");var p=o.getTimeFromPosition(d);return t({acc:c,u:d,t:p,i:f})}),e)},r.prototype._invalidateCache=function(){return this._cache=new Map,this},r.prototype.reset=function(){this._curveMapper.reset()},Object.defineProperty(r.prototype,"points",{get:function(){return this._curveMapper.points},set:function(t){this._curveMapper.points=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tension",{get:function(){return this._curveMapper.tension},set:function(t){this._curveMapper.tension=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alpha",{get:function(){return this._curveMapper.alpha},set:function(t){this._curveMapper.alpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this._curveMapper.closed},set:function(t){this._curveMapper.closed=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this._curveMapper.lengthAt(1)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minX",{get:function(){return this.getBoundingBox().min[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxX",{get:function(){return this.getBoundingBox().max[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minY",{get:function(){return this.getBoundingBox().min[1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxY",{get:function(){return this.getBoundingBox().max[1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minZ",{get:function(){return this.getBoundingBox().min[2]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxZ",{get:function(){return this.getBoundingBox().max[2]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"dim",{get:function(){var t;return((t=this.points[0])===null||t===void 0?void 0:t.length)||void 0},enumerable:!1,configurable:!0}),r})(),va="http://www.w3.org/1999/xhtml";const xl={svg:"http://www.w3.org/2000/svg",xhtml:va,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ns(r){var t=r+="",e=t.indexOf(":");return e>=0&&(t=r.slice(0,e))!=="xmlns"&&(r=r.slice(e+1)),xl.hasOwnProperty(t)?{space:xl[t],local:r}:r}function O0(r){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===va&&t.documentElement.namespaceURI===va?t.createElement(r):t.createElementNS(e,r)}}function L0(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function td(r){var t=ns(r);return(t.local?L0:O0)(t)}function N0(){}function fh(r){return r==null?N0:function(){return this.querySelector(r)}}function k0(r){typeof r!="function"&&(r=fh(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=new Array(o),h,l,u=0;u<o;++u)(h=s[u])&&(l=r.call(h,h.__data__,u,s))&&("__data__"in h&&(l.__data__=h.__data__),a[u]=l);return new Ut(i,this._parents)}function U0(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function G0(){return[]}function ed(r){return r==null?G0:function(){return this.querySelectorAll(r)}}function H0(r){return function(){return U0(r.apply(this,arguments))}}function z0(r){typeof r=="function"?r=H0(r):r=ed(r);for(var t=this._groups,e=t.length,i=[],n=[],s=0;s<e;++s)for(var o=t[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&(i.push(r.call(h,h.__data__,l,o)),n.push(h));return new Ut(i,n)}function rd(r){return function(){return this.matches(r)}}function id(r){return function(t){return t.matches(r)}}var $0=Array.prototype.find;function V0(r){return function(){return $0.call(this.children,r)}}function X0(){return this.firstElementChild}function W0(r){return this.select(r==null?X0:V0(typeof r=="function"?r:id(r)))}var j0=Array.prototype.filter;function q0(){return Array.from(this.children)}function Y0(r){return function(){return j0.call(this.children,r)}}function K0(r){return this.selectAll(r==null?q0:Y0(typeof r=="function"?r:id(r)))}function Z0(r){typeof r!="function"&&(r=rd(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=[],h,l=0;l<o;++l)(h=s[l])&&r.call(h,h.__data__,l,s)&&a.push(h);return new Ut(i,this._parents)}function nd(r){return new Array(r.length)}function Q0(){return new Ut(this._enter||this._groups.map(nd),this._parents)}function kn(r,t){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=t}kn.prototype={constructor:kn,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,t){return this._parent.insertBefore(r,t)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function J0(r){return function(){return r}}function tm(r,t,e,i,n,s){for(var o=0,a,h=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):e[o]=new kn(r,s[o]);for(;o<h;++o)(a=t[o])&&(n[o]=a)}function em(r,t,e,i,n,s,o){var a,h,l=new Map,u=t.length,c=s.length,d=new Array(u),f;for(a=0;a<u;++a)(h=t[a])&&(d[a]=f=o.call(h,h.__data__,a,t)+"",l.has(f)?n[a]=h:l.set(f,h));for(a=0;a<c;++a)f=o.call(r,s[a],a,s)+"",(h=l.get(f))?(i[a]=h,h.__data__=s[a],l.delete(f)):e[a]=new kn(r,s[a]);for(a=0;a<u;++a)(h=t[a])&&l.get(d[a])===h&&(n[a]=h)}function rm(r){return r.__data__}function im(r,t){if(!arguments.length)return Array.from(this,rm);var e=t?em:tm,i=this._parents,n=this._groups;typeof r!="function"&&(r=J0(r));for(var s=n.length,o=new Array(s),a=new Array(s),h=new Array(s),l=0;l<s;++l){var u=i[l],c=n[l],d=c.length,f=nm(r.call(u,u&&u.__data__,l,i)),p=f.length,m=a[l]=new Array(p),g=o[l]=new Array(p),y=h[l]=new Array(d);e(u,c,m,g,y,f,t);for(var x=0,v=0,E,w;x<p;++x)if(E=m[x]){for(x>=v&&(v=x+1);!(w=g[v])&&++v<p;);E._next=w||null}}return o=new Ut(o,i),o._enter=a,o._exit=h,o}function nm(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function sm(){return new Ut(this._exit||this._groups.map(nd),this._parents)}function om(r,t,e){var i=this.enter(),n=this,s=this.exit();return typeof r=="function"?(i=r(i),i&&(i=i.selection())):i=i.append(r+""),t!=null&&(n=t(n),n&&(n=n.selection())),e==null?s.remove():e(s),i&&n?i.merge(n).order():n}function am(r){for(var t=r.selection?r.selection():r,e=this._groups,i=t._groups,n=e.length,s=i.length,o=Math.min(n,s),a=new Array(n),h=0;h<o;++h)for(var l=e[h],u=i[h],c=l.length,d=a[h]=new Array(c),f,p=0;p<c;++p)(f=l[p]||u[p])&&(d[p]=f);for(;h<n;++h)a[h]=e[h];return new Ut(a,this._parents)}function hm(){for(var r=this._groups,t=-1,e=r.length;++t<e;)for(var i=r[t],n=i.length-1,s=i[n],o;--n>=0;)(o=i[n])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function lm(r){r||(r=um);function t(c,d){return c&&d?r(c.__data__,d.__data__):!c-!d}for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s){for(var o=e[s],a=o.length,h=n[s]=new Array(a),l,u=0;u<a;++u)(l=o[u])&&(h[u]=l);h.sort(t)}return new Ut(n,this._parents).order()}function um(r,t){return r<t?-1:r>t?1:r>=t?0:NaN}function cm(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function dm(){return Array.from(this)}function fm(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var i=r[t],n=0,s=i.length;n<s;++n){var o=i[n];if(o)return o}return null}function pm(){let r=0;for(const t of this)++r;return r}function mm(){return!this.node()}function gm(r){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],s=0,o=n.length,a;s<o;++s)(a=n[s])&&r.call(a,a.__data__,s,n);return this}function ym(r){return function(){this.removeAttribute(r)}}function vm(r){return function(){this.removeAttributeNS(r.space,r.local)}}function _m(r,t){return function(){this.setAttribute(r,t)}}function xm(r,t){return function(){this.setAttributeNS(r.space,r.local,t)}}function bm(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(r):this.setAttribute(r,e)}}function wm(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,e)}}function Tm(r,t){var e=ns(r);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((t==null?e.local?vm:ym:typeof t=="function"?e.local?wm:bm:e.local?xm:_m)(e,t))}function sd(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function Am(r){return function(){this.style.removeProperty(r)}}function Em(r,t,e){return function(){this.style.setProperty(r,t,e)}}function Sm(r,t,e){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(r):this.style.setProperty(r,i,e)}}function Cm(r,t,e){return arguments.length>1?this.each((t==null?Am:typeof t=="function"?Sm:Em)(r,t,e??"")):jr(this.node(),r)}function jr(r,t){return r.style.getPropertyValue(t)||sd(r).getComputedStyle(r,null).getPropertyValue(t)}function Pm(r){return function(){delete this[r]}}function Im(r,t){return function(){this[r]=t}}function Rm(r,t){return function(){var e=t.apply(this,arguments);e==null?delete this[r]:this[r]=e}}function Mm(r,t){return arguments.length>1?this.each((t==null?Pm:typeof t=="function"?Rm:Im)(r,t)):this.node()[r]}function od(r){return r.trim().split(/^|\s+/)}function ph(r){return r.classList||new ad(r)}function ad(r){this._node=r,this._names=od(r.getAttribute("class")||"")}ad.prototype={add:function(r){var t=this._names.indexOf(r);t<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var t=this._names.indexOf(r);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function hd(r,t){for(var e=ph(r),i=-1,n=t.length;++i<n;)e.add(t[i])}function ld(r,t){for(var e=ph(r),i=-1,n=t.length;++i<n;)e.remove(t[i])}function Fm(r){return function(){hd(this,r)}}function Dm(r){return function(){ld(this,r)}}function Bm(r,t){return function(){(t.apply(this,arguments)?hd:ld)(this,r)}}function Om(r,t){var e=od(r+"");if(arguments.length<2){for(var i=ph(this.node()),n=-1,s=e.length;++n<s;)if(!i.contains(e[n]))return!1;return!0}return this.each((typeof t=="function"?Bm:t?Fm:Dm)(e,t))}function Lm(){this.textContent=""}function Nm(r){return function(){this.textContent=r}}function km(r){return function(){var t=r.apply(this,arguments);this.textContent=t??""}}function Um(r){return arguments.length?this.each(r==null?Lm:(typeof r=="function"?km:Nm)(r)):this.node().textContent}function Gm(){this.innerHTML=""}function Hm(r){return function(){this.innerHTML=r}}function zm(r){return function(){var t=r.apply(this,arguments);this.innerHTML=t??""}}function $m(r){return arguments.length?this.each(r==null?Gm:(typeof r=="function"?zm:Hm)(r)):this.node().innerHTML}function Vm(){this.nextSibling&&this.parentNode.appendChild(this)}function Xm(){return this.each(Vm)}function Wm(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function jm(){return this.each(Wm)}function qm(r){var t=typeof r=="function"?r:td(r);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Ym(){return null}function Km(r,t){var e=typeof r=="function"?r:td(r),i=t==null?Ym:typeof t=="function"?t:fh(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)})}function Zm(){var r=this.parentNode;r&&r.removeChild(this)}function Qm(){return this.each(Zm)}function Jm(){var r=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function tg(){var r=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function eg(r){return this.select(r?tg:Jm)}function rg(r){return arguments.length?this.property("__data__",r):this.node().__data__}function ig(r){return function(t){r.call(this,t,this.__data__)}}function ng(r){return r.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}})}function sg(r){return function(){var t=this.__on;if(t){for(var e=0,i=-1,n=t.length,s;e<n;++e)s=t[e],(!r.type||s.type===r.type)&&s.name===r.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function og(r,t,e){return function(){var i=this.__on,n,s=ig(t);if(i){for(var o=0,a=i.length;o<a;++o)if((n=i[o]).type===r.type&&n.name===r.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=e),n.value=t;return}}this.addEventListener(r.type,s,e),n={type:r.type,name:r.name,value:t,listener:s,options:e},i?i.push(n):this.__on=[n]}}function ag(r,t,e){var i=ng(r+""),n,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var h=0,l=a.length,u;h<l;++h)for(n=0,u=a[h];n<s;++n)if((o=i[n]).type===u.type&&o.name===u.name)return u.value}return}for(a=t?og:sg,n=0;n<s;++n)this.each(a(i[n],t,e));return this}function ud(r,t,e){var i=sd(r),n=i.CustomEvent;typeof n=="function"?n=new n(t,e):(n=i.document.createEvent("Event"),e?(n.initEvent(t,e.bubbles,e.cancelable),n.detail=e.detail):n.initEvent(t,!1,!1)),r.dispatchEvent(n)}function hg(r,t){return function(){return ud(this,r,t)}}function lg(r,t){return function(){return ud(this,r,t.apply(this,arguments))}}function ug(r,t){return this.each((typeof t=="function"?lg:hg)(r,t))}function*cg(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var i=r[t],n=0,s=i.length,o;n<s;++n)(o=i[n])&&(yield o)}var cd=[null];function Ut(r,t){this._groups=r,this._parents=t}function Ri(){return new Ut([[document.documentElement]],cd)}function dg(){return this}Ut.prototype=Ri.prototype={constructor:Ut,select:k0,selectAll:z0,selectChild:W0,selectChildren:K0,filter:Z0,data:im,enter:Q0,exit:sm,join:om,merge:am,selection:dg,order:hm,sort:lm,call:cm,nodes:dm,node:fm,size:pm,empty:mm,each:gm,attr:Tm,style:Cm,property:Mm,classed:Om,text:Um,html:$m,raise:Xm,lower:jm,append:qm,insert:Km,remove:Qm,clone:eg,datum:rg,on:ag,dispatch:ug,[Symbol.iterator]:cg};function Ue(r){return typeof r=="string"?new Ut([[document.querySelector(r)]],[document.documentElement]):new Ut([[r]],cd)}function fg(r){let t;for(;t=r.sourceEvent;)r=t;return r}function er(r,t){if(r=fg(r),t===void 0&&(t=r.currentTarget),t){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=r.clientX,i.y=r.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var n=t.getBoundingClientRect();return[r.clientX-n.left-t.clientLeft,r.clientY-n.top-t.clientTop]}}return[r.pageX,r.pageY]}var pg={value:()=>{}};function mh(){for(var r=0,t=arguments.length,e={},i;r<t;++r){if(!(i=arguments[r]+"")||i in e||/[\s.]/.test(i))throw new Error("illegal type: "+i);e[i]=[]}return new gn(e)}function gn(r){this._=r}function mg(r,t){return r.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");if(n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:i}})}gn.prototype=mh.prototype={constructor:gn,on:function(r,t){var e=this._,i=mg(r+"",e),n,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((n=(r=i[s]).type)&&(n=gg(e[n],r.name)))return n;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(n=(r=i[s]).type)e[n]=bl(e[n],r.name,t);else if(t==null)for(n in e)e[n]=bl(e[n],r.name,null);return this},copy:function(){var r={},t=this._;for(var e in t)r[e]=t[e].slice();return new gn(r)},call:function(r,t){if((n=arguments.length-2)>0)for(var e=new Array(n),i=0,n,s;i<n;++i)e[i]=arguments[i+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(s=this._[r],i=0,n=s.length;i<n;++i)s[i].value.apply(t,e)},apply:function(r,t,e){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var i=this._[r],n=0,s=i.length;n<s;++n)i[n].value.apply(t,e)}};function gg(r,t){for(var e=0,i=r.length,n;e<i;++e)if((n=r[e]).name===t)return n.value}function bl(r,t,e){for(var i=0,n=r.length;i<n;++i)if(r[i].name===t){r[i]=pg,r=r.slice(0,i).concat(r.slice(i+1));break}return e!=null&&r.push({name:t,value:e}),r}const _a={capture:!0,passive:!1};function xa(r){r.preventDefault(),r.stopImmediatePropagation()}function yg(r){var t=r.document.documentElement,e=Ue(r).on("dragstart.drag",xa,_a);"onselectstart"in t?e.on("selectstart.drag",xa,_a):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function vg(r,t){var e=r.document.documentElement,i=Ue(r).on("dragstart.drag",null);t&&(i.on("click.drag",xa,_a),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}var qr=0,di=0,si=0,dd=1e3,Un,fi,Gn=0,vr=0,ss=0,Ci=typeof performance=="object"&&performance.now?performance:Date,fd=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function gh(){return vr||(fd(_g),vr=Ci.now()+ss)}function _g(){vr=0}function Hn(){this._call=this._time=this._next=null}Hn.prototype=pd.prototype={constructor:Hn,restart:function(r,t,e){if(typeof r!="function")throw new TypeError("callback is not a function");e=(e==null?gh():+e)+(t==null?0:+t),!this._next&&fi!==this&&(fi?fi._next=this:Un=this,fi=this),this._call=r,this._time=e,ba()},stop:function(){this._call&&(this._call=null,this._time=1/0,ba())}};function pd(r,t,e){var i=new Hn;return i.restart(r,t,e),i}function xg(){gh(),++qr;for(var r=Un,t;r;)(t=vr-r._time)>=0&&r._call.call(void 0,t),r=r._next;--qr}function wl(){vr=(Gn=Ci.now())+ss,qr=di=0;try{xg()}finally{qr=0,wg(),vr=0}}function bg(){var r=Ci.now(),t=r-Gn;t>dd&&(ss-=t,Gn=r)}function wg(){for(var r,t=Un,e,i=1/0;t;)t._call?(i>t._time&&(i=t._time),r=t,t=t._next):(e=t._next,t._next=null,t=r?r._next=e:Un=e);fi=r,ba(i)}function ba(r){if(!qr){di&&(di=clearTimeout(di));var t=r-vr;t>24?(r<1/0&&(di=setTimeout(wl,r-Ci.now()-ss)),si&&(si=clearInterval(si))):(si||(Gn=Ci.now(),si=setInterval(bg,dd)),qr=1,fd(wl))}}function Tl(r,t,e){var i=new Hn;return t=t==null?0:+t,i.restart(n=>{i.stop(),r(n+t)},t,e),i}var Tg=mh("start","end","cancel","interrupt"),Ag=[],md=0,Al=1,wa=2,yn=3,El=4,Ta=5,vn=6;function os(r,t,e,i,n,s){var o=r.__transition;if(!o)r.__transition={};else if(e in o)return;Eg(r,e,{name:t,index:i,group:n,on:Tg,tween:Ag,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:md})}function yh(r,t){var e=ne(r,t);if(e.state>md)throw new Error("too late; already scheduled");return e}function _e(r,t){var e=ne(r,t);if(e.state>yn)throw new Error("too late; already running");return e}function ne(r,t){var e=r.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function Eg(r,t,e){var i=r.__transition,n;i[t]=e,e.timer=pd(s,0,e.time);function s(l){e.state=Al,e.timer.restart(o,e.delay,e.time),e.delay<=l&&o(l-e.delay)}function o(l){var u,c,d,f;if(e.state!==Al)return h();for(u in i)if(f=i[u],f.name===e.name){if(f.state===yn)return Tl(o);f.state===El?(f.state=vn,f.timer.stop(),f.on.call("interrupt",r,r.__data__,f.index,f.group),delete i[u]):+u<t&&(f.state=vn,f.timer.stop(),f.on.call("cancel",r,r.__data__,f.index,f.group),delete i[u])}if(Tl(function(){e.state===yn&&(e.state=El,e.timer.restart(a,e.delay,e.time),a(l))}),e.state=wa,e.on.call("start",r,r.__data__,e.index,e.group),e.state===wa){for(e.state=yn,n=new Array(d=e.tween.length),u=0,c=-1;u<d;++u)(f=e.tween[u].value.call(r,r.__data__,e.index,e.group))&&(n[++c]=f);n.length=c+1}}function a(l){for(var u=l<e.duration?e.ease.call(null,l/e.duration):(e.timer.restart(h),e.state=Ta,1),c=-1,d=n.length;++c<d;)n[c].call(r,u);e.state===Ta&&(e.on.call("end",r,r.__data__,e.index,e.group),h())}function h(){e.state=vn,e.timer.stop(),delete i[t];for(var l in i)return;delete r.__transition}}function _n(r,t){var e=r.__transition,i,n,s=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((i=e[o]).name!==t){s=!1;continue}n=i.state>wa&&i.state<Ta,i.state=vn,i.timer.stop(),i.on.call(n?"interrupt":"cancel",r,r.__data__,i.index,i.group),delete e[o]}s&&delete r.__transition}}function Sg(r){return this.each(function(){_n(this,r)})}function Cg(r,t){var e,i;return function(){var n=_e(this,r),s=n.tween;if(s!==e){i=e=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}n.tween=i}}function Pg(r,t,e){var i,n;if(typeof e!="function")throw new Error;return function(){var s=_e(this,r),o=s.tween;if(o!==i){n=(i=o).slice();for(var a={name:t,value:e},h=0,l=n.length;h<l;++h)if(n[h].name===t){n[h]=a;break}h===l&&n.push(a)}s.tween=n}}function Ig(r,t){var e=this._id;if(r+="",arguments.length<2){for(var i=ne(this.node(),e).tween,n=0,s=i.length,o;n<s;++n)if((o=i[n]).name===r)return o.value;return null}return this.each((t==null?Cg:Pg)(e,r,t))}function vh(r,t,e){var i=r._id;return r.each(function(){var n=_e(this,i);(n.value||(n.value={}))[t]=e.apply(this,arguments)}),function(n){return ne(n,i).value[t]}}function gd(r,t){var e;return(typeof t=="number"?Jt:t instanceof $e?Si:(e=$e(t))?(t=e,Si):zc)(r,t)}function Rg(r){return function(){this.removeAttribute(r)}}function Mg(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Fg(r,t,e){var i,n=e+"",s;return function(){var o=this.getAttribute(r);return o===n?null:o===i?s:s=t(i=o,e)}}function Dg(r,t,e){var i,n=e+"",s;return function(){var o=this.getAttributeNS(r.space,r.local);return o===n?null:o===i?s:s=t(i=o,e)}}function Bg(r,t,e){var i,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttribute(r):(o=this.getAttribute(r),h=a+"",o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a)))}}function Og(r,t,e){var i,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttributeNS(r.space,r.local):(o=this.getAttributeNS(r.space,r.local),h=a+"",o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a)))}}function Lg(r,t){var e=ns(r),i=e==="transform"?$p:gd;return this.attrTween(r,typeof t=="function"?(e.local?Og:Bg)(e,i,vh(this,"attr."+r,t)):t==null?(e.local?Mg:Rg)(e):(e.local?Dg:Fg)(e,i,t))}function Ng(r,t){return function(e){this.setAttribute(r,t.call(this,e))}}function kg(r,t){return function(e){this.setAttributeNS(r.space,r.local,t.call(this,e))}}function Ug(r,t){var e,i;function n(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&kg(r,s)),e}return n._value=t,n}function Gg(r,t){var e,i;function n(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&Ng(r,s)),e}return n._value=t,n}function Hg(r,t){var e="attr."+r;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var i=ns(r);return this.tween(e,(i.local?Ug:Gg)(i,t))}function zg(r,t){return function(){yh(this,r).delay=+t.apply(this,arguments)}}function $g(r,t){return t=+t,function(){yh(this,r).delay=t}}function Vg(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?zg:$g)(t,r)):ne(this.node(),t).delay}function Xg(r,t){return function(){_e(this,r).duration=+t.apply(this,arguments)}}function Wg(r,t){return t=+t,function(){_e(this,r).duration=t}}function jg(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?Xg:Wg)(t,r)):ne(this.node(),t).duration}function qg(r,t){if(typeof t!="function")throw new Error;return function(){_e(this,r).ease=t}}function Yg(r){var t=this._id;return arguments.length?this.each(qg(t,r)):ne(this.node(),t).ease}function Kg(r,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;_e(this,r).ease=e}}function Zg(r){if(typeof r!="function")throw new Error;return this.each(Kg(this._id,r))}function Qg(r){typeof r!="function"&&(r=rd(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=[],h,l=0;l<o;++l)(h=s[l])&&r.call(h,h.__data__,l,s)&&a.push(h);return new Re(i,this._parents,this._name,this._id)}function Jg(r){if(r._id!==this._id)throw new Error;for(var t=this._groups,e=r._groups,i=t.length,n=e.length,s=Math.min(i,n),o=new Array(i),a=0;a<s;++a)for(var h=t[a],l=e[a],u=h.length,c=o[a]=new Array(u),d,f=0;f<u;++f)(d=h[f]||l[f])&&(c[f]=d);for(;a<i;++a)o[a]=t[a];return new Re(o,this._parents,this._name,this._id)}function ty(r){return(r+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function ey(r,t,e){var i,n,s=ty(t)?yh:_e;return function(){var o=s(this,r),a=o.on;a!==i&&(n=(i=a).copy()).on(t,e),o.on=n}}function ry(r,t){var e=this._id;return arguments.length<2?ne(this.node(),e).on.on(r):this.each(ey(e,r,t))}function iy(r){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==r)return;t&&t.removeChild(this)}}function ny(){return this.on("end.remove",iy(this._id))}function sy(r){var t=this._name,e=this._id;typeof r!="function"&&(r=fh(r));for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o)for(var a=i[o],h=a.length,l=s[o]=new Array(h),u,c,d=0;d<h;++d)(u=a[d])&&(c=r.call(u,u.__data__,d,a))&&("__data__"in u&&(c.__data__=u.__data__),l[d]=c,os(l[d],t,e,d,l,ne(u,e)));return new Re(s,this._parents,t,e)}function oy(r){var t=this._name,e=this._id;typeof r!="function"&&(r=ed(r));for(var i=this._groups,n=i.length,s=[],o=[],a=0;a<n;++a)for(var h=i[a],l=h.length,u,c=0;c<l;++c)if(u=h[c]){for(var d=r.call(u,u.__data__,c,h),f,p=ne(u,e),m=0,g=d.length;m<g;++m)(f=d[m])&&os(f,t,e,m,d,p);s.push(d),o.push(u)}return new Re(s,o,t,e)}var ay=Ri.prototype.constructor;function hy(){return new ay(this._groups,this._parents)}function ly(r,t){var e,i,n;return function(){var s=jr(this,r),o=(this.style.removeProperty(r),jr(this,r));return s===o?null:s===e&&o===i?n:n=t(e=s,i=o)}}function yd(r){return function(){this.style.removeProperty(r)}}function uy(r,t,e){var i,n=e+"",s;return function(){var o=jr(this,r);return o===n?null:o===i?s:s=t(i=o,e)}}function cy(r,t,e){var i,n,s;return function(){var o=jr(this,r),a=e(this),h=a+"";return a==null&&(h=a=(this.style.removeProperty(r),jr(this,r))),o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a))}}function dy(r,t){var e,i,n,s="style."+t,o="end."+s,a;return function(){var h=_e(this,r),l=h.on,u=h.value[s]==null?a||(a=yd(t)):void 0;(l!==e||n!==u)&&(i=(e=l).copy()).on(o,n=u),h.on=i}}function fy(r,t,e){var i=(r+="")=="transform"?zp:gd;return t==null?this.styleTween(r,ly(r,i)).on("end.style."+r,yd(r)):typeof t=="function"?this.styleTween(r,cy(r,i,vh(this,"style."+r,t))).each(dy(this._id,r)):this.styleTween(r,uy(r,i,t),e).on("end.style."+r,null)}function py(r,t,e){return function(i){this.style.setProperty(r,t.call(this,i),e)}}function my(r,t,e){var i,n;function s(){var o=t.apply(this,arguments);return o!==n&&(i=(n=o)&&py(r,o,e)),i}return s._value=t,s}function gy(r,t,e){var i="style."+(r+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,my(r,t,e??""))}function yy(r){return function(){this.textContent=r}}function vy(r){return function(){var t=r(this);this.textContent=t??""}}function _y(r){return this.tween("text",typeof r=="function"?vy(vh(this,"text",r)):yy(r==null?"":r+""))}function xy(r){return function(t){this.textContent=r.call(this,t)}}function by(r){var t,e;function i(){var n=r.apply(this,arguments);return n!==e&&(t=(e=n)&&xy(n)),t}return i._value=r,i}function wy(r){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(r==null)return this.tween(t,null);if(typeof r!="function")throw new Error;return this.tween(t,by(r))}function Ty(){for(var r=this._name,t=this._id,e=vd(),i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,h,l=0;l<a;++l)if(h=o[l]){var u=ne(h,t);os(h,r,e,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Re(i,this._parents,r,e)}function Ay(){var r,t,e=this,i=e._id,n=e.size();return new Promise(function(s,o){var a={value:o},h={value:function(){--n===0&&s()}};e.each(function(){var l=_e(this,i),u=l.on;u!==r&&(t=(r=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(h)),l.on=t}),n===0&&s()})}var Ey=0;function Re(r,t,e,i){this._groups=r,this._parents=t,this._name=e,this._id=i}function vd(){return++Ey}var be=Ri.prototype;Re.prototype={constructor:Re,select:sy,selectAll:oy,selectChild:be.selectChild,selectChildren:be.selectChildren,filter:Qg,merge:Jg,selection:hy,transition:Ty,call:be.call,nodes:be.nodes,node:be.node,size:be.size,empty:be.empty,each:be.each,on:ry,attr:Lg,attrTween:Hg,style:fy,styleTween:gy,text:_y,textTween:wy,remove:ny,tween:Ig,delay:Vg,duration:jg,ease:Yg,easeVarying:Zg,end:Ay,[Symbol.iterator]:be[Symbol.iterator]};function Sy(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var Cy={time:null,delay:0,duration:250,ease:Sy};function Py(r,t){for(var e;!(e=r.__transition)||!(e=e[t]);)if(!(r=r.parentNode))throw new Error(`transition ${t} not found`);return e}function Iy(r){var t,e;r instanceof Re?(t=r._id,r=r._name):(t=vd(),(e=Cy).time=gh(),r=r==null?null:r+"");for(var i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&os(h,r,t,l,o,e||Py(h,t));return new Re(i,this._parents,r,t)}Ri.prototype.interrupt=Sg;Ri.prototype.transition=Iy;const Xi=r=>()=>r;function Ry(r,{sourceEvent:t,target:e,transform:i,dispatch:n}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:n}})}function Se(r,t,e){this.k=r,this.x=t,this.y=e}Se.prototype={constructor:Se,scale:function(r){return r===1?this:new Se(this.k*r,this.x,this.y)},translate:function(r,t){return r===0&t===0?this:new Se(this.k,this.x+this.k*r,this.y+this.k*t)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var _h=new Se(1,0,0);Se.prototype;function Ls(r){r.stopImmediatePropagation()}function oi(r){r.preventDefault(),r.stopImmediatePropagation()}function My(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function Fy(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function Sl(){return this.__zoom||_h}function Dy(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function By(){return navigator.maxTouchPoints||"ontouchstart"in this}function Oy(r,t,e){var i=r.invertX(t[0][0])-e[0][0],n=r.invertX(t[1][0])-e[1][0],s=r.invertY(t[0][1])-e[0][1],o=r.invertY(t[1][1])-e[1][1];return r.translate(n>i?(i+n)/2:Math.min(0,i)||Math.max(0,n),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Ly(){var r=My,t=Fy,e=Oy,i=Dy,n=By,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,h=jp,l=mh("start","zoom","end"),u,c,d,f=500,p=150,m=0,g=10;function y(S){S.property("__zoom",Sl).on("wheel.zoom",F,{passive:!1}).on("mousedown.zoom",U).on("dblclick.zoom",G).filter(n).on("touchstart.zoom",z).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",B).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(S,N,_,A){var b=S.selection?S.selection():S;b.property("__zoom",Sl),S!==b?w(S,N,_,A):b.interrupt().each(function(){I(this,arguments).event(A).start().zoom(null,typeof N=="function"?N.apply(this,arguments):N).end()})},y.scaleBy=function(S,N,_,A){y.scaleTo(S,function(){var b=this.__zoom.k,R=typeof N=="function"?N.apply(this,arguments):N;return b*R},_,A)},y.scaleTo=function(S,N,_,A){y.transform(S,function(){var b=t.apply(this,arguments),R=this.__zoom,C=_==null?E(b):typeof _=="function"?_.apply(this,arguments):_,P=R.invert(C),D=typeof N=="function"?N.apply(this,arguments):N;return e(v(x(R,D),C,P),b,o)},_,A)},y.translateBy=function(S,N,_,A){y.transform(S,function(){return e(this.__zoom.translate(typeof N=="function"?N.apply(this,arguments):N,typeof _=="function"?_.apply(this,arguments):_),t.apply(this,arguments),o)},null,A)},y.translateTo=function(S,N,_,A,b){y.transform(S,function(){var R=t.apply(this,arguments),C=this.__zoom,P=A==null?E(R):typeof A=="function"?A.apply(this,arguments):A;return e(_h.translate(P[0],P[1]).scale(C.k).translate(typeof N=="function"?-N.apply(this,arguments):-N,typeof _=="function"?-_.apply(this,arguments):-_),R,o)},A,b)};function x(S,N){return N=Math.max(s[0],Math.min(s[1],N)),N===S.k?S:new Se(N,S.x,S.y)}function v(S,N,_){var A=N[0]-_[0]*S.k,b=N[1]-_[1]*S.k;return A===S.x&&b===S.y?S:new Se(S.k,A,b)}function E(S){return[(+S[0][0]+ +S[1][0])/2,(+S[0][1]+ +S[1][1])/2]}function w(S,N,_,A){S.on("start.zoom",function(){I(this,arguments).event(A).start()}).on("interrupt.zoom end.zoom",function(){I(this,arguments).event(A).end()}).tween("zoom",function(){var b=this,R=arguments,C=I(b,R).event(A),P=t.apply(b,R),D=_==null?E(P):typeof _=="function"?_.apply(b,R):_,O=Math.max(P[1][0]-P[0][0],P[1][1]-P[0][1]),H=b.__zoom,$=typeof N=="function"?N.apply(b,R):N,Y=h(H.invert(D).concat(O/H.k),$.invert(D).concat(O/$.k));return function(W){if(W===1)W=$;else{var K=Y(W),et=O/K[2];W=new Se(et,D[0]-K[0]*et,D[1]-K[1]*et)}C.zoom(null,W)}})}function I(S,N,_){return!_&&S.__zooming||new T(S,N)}function T(S,N){this.that=S,this.args=N,this.active=0,this.sourceEvent=null,this.extent=t.apply(S,N),this.taps=0}T.prototype={event:function(S){return S&&(this.sourceEvent=S),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(S,N){return this.mouse&&S!=="mouse"&&(this.mouse[1]=N.invert(this.mouse[0])),this.touch0&&S!=="touch"&&(this.touch0[1]=N.invert(this.touch0[0])),this.touch1&&S!=="touch"&&(this.touch1[1]=N.invert(this.touch1[0])),this.that.__zoom=N,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(S){var N=Ue(this.that).datum();l.call(S,this.that,new Ry(S,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:l}),N)}};function F(S,...N){if(!r.apply(this,arguments))return;var _=I(this,N).event(S),A=this.__zoom,b=Math.max(s[0],Math.min(s[1],A.k*Math.pow(2,i.apply(this,arguments)))),R=er(S);if(_.wheel)(_.mouse[0][0]!==R[0]||_.mouse[0][1]!==R[1])&&(_.mouse[1]=A.invert(_.mouse[0]=R)),clearTimeout(_.wheel);else{if(A.k===b)return;_.mouse=[R,A.invert(R)],_n(this),_.start()}oi(S),_.wheel=setTimeout(C,p),_.zoom("mouse",e(v(x(A,b),_.mouse[0],_.mouse[1]),_.extent,o));function C(){_.wheel=null,_.end()}}function U(S,...N){if(d||!r.apply(this,arguments))return;var _=S.currentTarget,A=I(this,N,!0).event(S),b=Ue(S.view).on("mousemove.zoom",D,!0).on("mouseup.zoom",O,!0),R=er(S,_),C=S.clientX,P=S.clientY;yg(S.view),Ls(S),A.mouse=[R,this.__zoom.invert(R)],_n(this),A.start();function D(H){if(oi(H),!A.moved){var $=H.clientX-C,Y=H.clientY-P;A.moved=$*$+Y*Y>m}A.event(H).zoom("mouse",e(v(A.that.__zoom,A.mouse[0]=er(H,_),A.mouse[1]),A.extent,o))}function O(H){b.on("mousemove.zoom mouseup.zoom",null),vg(H.view,A.moved),oi(H),A.event(H).end()}}function G(S,...N){if(r.apply(this,arguments)){var _=this.__zoom,A=er(S.changedTouches?S.changedTouches[0]:S,this),b=_.invert(A),R=_.k*(S.shiftKey?.5:2),C=e(v(x(_,R),A,b),t.apply(this,N),o);oi(S),a>0?Ue(this).transition().duration(a).call(w,C,A,S):Ue(this).call(y.transform,C,A,S)}}function z(S,...N){if(r.apply(this,arguments)){var _=S.touches,A=_.length,b=I(this,N,S.changedTouches.length===A).event(S),R,C,P,D;for(Ls(S),C=0;C<A;++C)P=_[C],D=er(P,this),D=[D,this.__zoom.invert(D),P.identifier],b.touch0?!b.touch1&&b.touch0[2]!==D[2]&&(b.touch1=D,b.taps=0):(b.touch0=D,R=!0,b.taps=1+!!u);u&&(u=clearTimeout(u)),R&&(b.taps<2&&(c=D[0],u=setTimeout(function(){u=null},f)),_n(this),b.start())}}function M(S,...N){if(this.__zooming){var _=I(this,N).event(S),A=S.changedTouches,b=A.length,R,C,P,D;for(oi(S),R=0;R<b;++R)C=A[R],P=er(C,this),_.touch0&&_.touch0[2]===C.identifier?_.touch0[0]=P:_.touch1&&_.touch1[2]===C.identifier&&(_.touch1[0]=P);if(C=_.that.__zoom,_.touch1){var O=_.touch0[0],H=_.touch0[1],$=_.touch1[0],Y=_.touch1[1],W=(W=$[0]-O[0])*W+(W=$[1]-O[1])*W,K=(K=Y[0]-H[0])*K+(K=Y[1]-H[1])*K;C=x(C,Math.sqrt(W/K)),P=[(O[0]+$[0])/2,(O[1]+$[1])/2],D=[(H[0]+Y[0])/2,(H[1]+Y[1])/2]}else if(_.touch0)P=_.touch0[0],D=_.touch0[1];else return;_.zoom("touch",e(v(C,P,D),_.extent,o))}}function B(S,...N){if(this.__zooming){var _=I(this,N).event(S),A=S.changedTouches,b=A.length,R,C;for(Ls(S),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),R=0;R<b;++R)C=A[R],_.touch0&&_.touch0[2]===C.identifier?delete _.touch0:_.touch1&&_.touch1[2]===C.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(C=er(C,this),Math.hypot(c[0]-C[0],c[1]-C[1])<g)){var P=Ue(this).on("dblclick.zoom");P&&P.apply(this,arguments)}}}return y.wheelDelta=function(S){return arguments.length?(i=typeof S=="function"?S:Xi(+S),y):i},y.filter=function(S){return arguments.length?(r=typeof S=="function"?S:Xi(!!S),y):r},y.touchable=function(S){return arguments.length?(n=typeof S=="function"?S:Xi(!!S),y):n},y.extent=function(S){return arguments.length?(t=typeof S=="function"?S:Xi([[+S[0][0],+S[0][1]],[+S[1][0],+S[1][1]]]),y):t},y.scaleExtent=function(S){return arguments.length?(s[0]=+S[0],s[1]=+S[1],y):[s[0],s[1]]},y.translateExtent=function(S){return arguments.length?(o[0][0]=+S[0][0],o[1][0]=+S[1][0],o[0][1]=+S[0][1],o[1][1]=+S[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(S){return arguments.length?(e=S,y):e},y.duration=function(S){return arguments.length?(a=+S,y):a},y.interpolate=function(S){return arguments.length?(h=S,y):h},y.on=function(){var S=l.on.apply(l,arguments);return S===l?y:S},y.clickDistance=function(S){return arguments.length?(m=(S=+S)*S,y):Math.sqrt(m)},y.tapDistance=function(S){return arguments.length?(g=+S,y):g},y}const Ny=.1,ky=256;class CT{constructor(t,e,i={maxZoomLevel:ky,minZoomLevel:Ny}){this.xBounds=[0,1],this.yBounds=[0,1],this.translateBoundsX=[0,1],this.translateBoundsY=[0,1],this._zFactor=1,this._enableTranslateExtent=!1,this.container=Ue(t),this.options=i,this.onRescale=e,this.onZoom=this.onZoom.bind(this),this.calculateTransform=this.calculateTransform.bind(this),this.applyTransform=this.applyTransform.bind(this),this.recalculateZoomTransform=this.recalculateZoomTransform.bind(this),this.rescale=this.rescale.bind(this),this.adjustToSize=this.adjustToSize.bind(this),this.setViewport=this.setViewport.bind(this),this.currentStateAsEvent=this.currentStateAsEvent.bind(this),this.updateTranslateExtent=this.updateTranslateExtent.bind(this),this.scaleX=On().domain(this.xBounds).range([0,1]),this.scaleY=On().domain(this.yBounds).range([0,1]),this.init()}get width(){return this.scaleX.range()[1]??0}get height(){return this.scaleY.range()[1]??0}get xSpan(){const{xBounds:t}=this;return Math.abs(t[1]-t[0])}get ySpan(){const{yBounds:t}=this;return Math.abs(t[1]-t[0])}get viewportRatio(){return this.width/(this.height||1)}get xRatio(){const t=this.scaleX.domain();return Math.abs(this.width/(t[1]-t[0]))}get yRatio(){const t=this.scaleY.domain();return Math.abs(this.height/(t[1]-t[0]))}get zFactor(){return this._zFactor}set zFactor(t){this._zFactor=t,this.recalculateZoomTransform()}get isXInverted(){return this.xBounds[1]<this.xBounds[0]}get isYInverted(){return this.yBounds[1]<this.yBounds[0]}get enableTranslateExtent(){return this._enableTranslateExtent}set enableTranslateExtent(t){this._enableTranslateExtent=t,this.updateTranslateExtent()}updateTranslateExtent(){const{width:t,xSpan:e,zFactor:i,enableTranslateExtent:n,translateBoundsX:s,translateBoundsY:o}=this;let a=-1/0,h=-1/0,l=1/0,u=1/0;if(n){const c=t/e;a=s[0]*c,l=s[1]*c,h=o[0]*c*i,u=o[1]*c*i}this.zoom.translateExtent([[a,h],[l,u]])}currentStateAsEvent(){const{scaleX:t,scaleY:e,xBounds:i,yBounds:n,zFactor:s,viewportRatio:o,currentTransform:a,xRatio:h,yRatio:l,width:u,height:c}=this;return{xScale:t.copy(),yScale:e.copy(),xBounds:i,yBounds:n,zFactor:s,viewportRatio:o,xRatio:h,yRatio:l,width:u,height:c,transform:Object.assign({},a)}}rescale(){const{currentStateAsEvent:t}=this;this.onRescale(t())}init(){this.zoom=Ly().scaleExtent([this.options.minZoomLevel,this.options.maxZoomLevel]).on("zoom",this.onZoom),this.container.call(this.zoom)}onZoom(t){const{transform:e}=t;e&&(this.applyTransform(e),this.rescale())}applyTransform(t){const{width:e,scaleX:i,scaleY:n,xSpan:s,xBounds:o,yBounds:a,zFactor:h}=this,{viewportRatio:l,isXInverted:u,isYInverted:c}=this,d=e*t.k,f=s/d,p=s/t.k,m=p/h/l,g=f*t.x,y=f/h*t.y,x=o[0]-(u?-g:g),v=a[0]-(c?-y:y);i.domain([x,x+(u?-p:p)]),n.domain([v,v+(c?-m:m)]),this.currentTransform=t}setViewport(t,e,i,n){const{zoom:s,container:o,calculateTransform:a,scaleX:h,scaleY:l,isXInverted:u}=this;if(t==null||i==null||isNaN(t)||isNaN(i)){const m=h.domain(),g=m[1]-m[0];(t==null||isNaN(t))&&(t=m[0]+g/2||0),(i==null||isNaN(i))&&(i=Math.abs(g)||1)}if(e==null||isNaN(e)){const m=l.domain();e=m[0]+(m[1]-m[0])/2||0}const c=u?-i:i,d=t-c/2,f=d+c,p=a(d,f,e);n!=null&&Number.isFinite(n)&&n>0?s.transform(o.transition().duration(n),p):s.transform(o,p)}setBounds(t,e){this.xBounds=t,this.yBounds=e,this.recalculateZoomTransform()}setTranslateBounds(t,e){this.translateBoundsX=t,this.translateBoundsY=e,this.updateTranslateExtent()}adjustToSize(t,e,i=!1){const{width:n,height:s,scaleX:o,scaleY:a,recalculateZoomTransform:h}=this;let l=0,u=0;if(typeof t=="number"&&typeof e=="number")u=e,l=t;else{const f=this.container.node();if(f){const{width:p,height:m}=f.getBoundingClientRect();l=p,u=m}}const c=Math.max(1,l),d=Math.max(1,u);!i&&n===c&&s===d||(o.range([0,c]),a.range([0,d]),h(),this.onRescale(this.currentStateAsEvent()))}calculateTransform(t,e,i){const{scaleX:n,xSpan:s,xBounds:o,yBounds:a,zFactor:h,viewportRatio:l,isXInverted:u,isYInverted:c}=this,[d,f]=n.range(),p=Math.abs(e-t),m=s/p,g=p/(f-d),y=i-(c?-p:p)/h/l/2,x=(o[0]-t)/(u?-g:g),v=(a[0]-y)/((c?-g:g)/h);return _h.translate(x,v).scale(m)}recalculateZoomTransform(){const{scaleX:t,scaleY:e,container:i,calculateTransform:n,updateTranslateExtent:s}=this,[o,a]=t.domain(),[h,l]=e.domain(),u=h+(l-h)/2,c=n(o,a,u);s(),this.zoom.transform(i,c)}setZoomLevelBoundary(t){return this.zoom.scaleExtent(t),this}setMaxZoomLevel(t){const e=this.zoom.scaleExtent();return this.zoom.scaleExtent([e[0],t]),this}setMinZoomLevel(t){const e=this.zoom.scaleExtent();return this.zoom.scaleExtent([t,e[1]]),this}}const Uy={order:1,layerOpacity:1,interactive:!1};class _d{constructor(t,e){this._interactive=!1,this._id=t||`layer-${Math.floor(Math.random()*1e3)}`;const i=e||Uy;this._order=i.order||1,this._options={...i},this.loading=!1,this._element=void 0,this._opacity=i.layerOpacity||1,this._visible=!0,this._interactive=i.interactive||!1,e&&e.data&&this.setData(e.data),this._referenceSystem=e==null?void 0:e.referenceSystem,this.onMount=this.onMount.bind(this),this.onUnmount=this.onUnmount.bind(this),this.onUpdate=this.onUpdate.bind(this),this.onRescale=this.onRescale.bind(this),this.onResize=this.onResize.bind(this),this.onOrderChanged=this.onOrderChanged.bind(this),this.onOpacityChanged=this.onOpacityChanged.bind(this),this.setVisibility=this.setVisibility.bind(this)}get id(){return this._id}get element(){return this._element}get options(){return this._options}set options(t){this._options=t}set isLoading(t){this.loading=t}get isLoading(){return this.loading}set opacity(t){this._opacity=t,this.onOpacityChanged(t)}get opacity(){return this._opacity}set order(t){this._order=t,this.onOrderChanged(t)}get order(){return this._order}set interactive(t){this._interactive=t,this.onInteractivityChanged(t)}get interactive(){return this._interactive}get referenceSystem(){return this._referenceSystem}set referenceSystem(t){this._referenceSystem=t}get data(){return this.getData()}set data(t){this.setData(t)}get isVisible(){return this._visible}getData(){return this._data}setData(t){this._data=t,this.element&&t!=null&&this.onUpdate({data:t})}clearData(t=!0){this._data=void 0,t&&(this.referenceSystem=void 0),this.onUpdate({})}setVisibility(t,e){this._visible=t}onMount(t){this._element=t.elm,this._options.onMount&&this._options.onMount(t,this)}onUnmount(t){this._options.onUnmount&&t!=null&&this._options.onUnmount(t,this)}onResize(t){this._options.onResize&&this._options.onResize(t,this)}onUpdate(t){t.data&&(this._data=t.data),this._options.onUpdate&&this._options.onUpdate(t,this)}onRescale(t){this.optionsRescale(t)}optionsRescale(t){this._options.onRescale&&this._options.onRescale(t,this)}getInternalLayerIds(){return[]}}const xd=200,bd=300,PT=40,IT=30,Gy=100,Hy=.6,zy=.3,$y=8,Vy=16,Ve=64,RT=1;class MT extends _d{onOpacityChanged(t){this.canvas&&this.updateStyle()}onOrderChanged(t){this.canvas&&this.updateStyle()}onInteractivityChanged(t){this.canvas&&this.updateStyle()}setVisibility(t){super.setVisibility(t),this.canvas&&this.updateStyle(t)}updateStyle(t){var s;const i=t||this.isVisible?"visible":"hidden",n=this.interactive?"auto":"none";(s=this.canvas)==null||s.setAttribute("style",`position:absolute;pointer-events:${n};z-index:${this.order};opacity:${this.opacity};visibility:${i}`)}onMount(t){super.onMount(t);const{elm:e}=t,i=t.width||parseInt((e==null?void 0:e.getAttribute("width"))??"",10)||xd,n=t.height||parseInt((e==null?void 0:e.getAttribute("height"))??"",10)||bd;this.elm=e;let s;this.canvas||(s=document.createElement("canvas"),this.canvas=s,t.elm.appendChild(s)),this.canvas.setAttribute("id",`${this.id}`),this.canvas.setAttribute("width",`${i}px`),this.canvas.setAttribute("height",`${n}px`),this.canvas.setAttribute("class","canvas-layer"),this.updateStyle(),this.ctx=this.canvas.getContext("2d")??void 0}onUnmount(){var t;super.onUnmount(),(t=this.canvas)==null||t.remove(),this.canvas=void 0}onResize(t){const{ctx:e}=this,{width:i,height:n}=t;e==null||e.canvas.setAttribute("width",`${i}px`),e==null||e.canvas.setAttribute("height",`${n}px`)}onUpdate(t){super.onUpdate(t)}resetTransform(){var t;(t=this.ctx)==null||t.resetTransform()}setTransform(t){var n,s;this.resetTransform();const e=t.xBounds[0]>t.xBounds[1],i=t.yBounds[0]>t.yBounds[1];(n=this.ctx)==null||n.translate(t.xScale(0),t.yScale(0)),(s=this.ctx)==null||s.scale(t.xRatio*(e?-1:1),t.yRatio*(i?-1:1))}clearCanvas(){const{ctx:t,canvas:e}=this;t==null||t.save(),t==null||t.resetTransform(),t==null||t.clearRect(0,0,(e==null?void 0:e.width)??0,(e==null?void 0:e.height)??0),t==null||t.restore()}}var br=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(br||{}),xh=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(xh||{}),Aa=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(Aa||{}),at=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(at||{}),de=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(de||{}),V=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(V||{}),zr=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(zr||{}),ot=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(ot||{}),Z=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(Z||{}),fe=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(fe||{}),kt=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(kt||{}),ye=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(ye||{}),Ft=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(Ft||{}),ce=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(ce||{}),bh=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(bh||{}),Vt=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(Vt||{}),At=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(At||{}),Tt=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(Tt||{}),me=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(me||{});const Xy={createCanvas:(r,t)=>{const e=document.createElement("canvas");return e.width=r,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")},Q={ADAPTER:Xy,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Ns=/iPhone/i,Cl=/iPod/i,Pl=/iPad/i,Il=/\biOS-universal(?:.+)Mac\b/i,ks=/\bAndroid(?:.+)Mobile\b/i,Rl=/Android/i,Pr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Wi=/Silk/i,we=/Windows Phone/i,Ml=/\bWindows(?:.+)ARM\b/i,Fl=/BlackBerry/i,Dl=/BB10/i,Bl=/Opera Mini/i,Ol=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ll=/Mobile(?:.+)Firefox\b/i,Nl=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function Wy(r){return function(t){return t.test(r)}}function kl(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var n=Wy(e),s={apple:{phone:n(Ns)&&!n(we),ipod:n(Cl),tablet:!n(Ns)&&(n(Pl)||Nl(t))&&!n(we),universal:n(Il),device:(n(Ns)||n(Cl)||n(Pl)||n(Il)||Nl(t))&&!n(we)},amazon:{phone:n(Pr),tablet:!n(Pr)&&n(Wi),device:n(Pr)||n(Wi)},android:{phone:!n(we)&&n(Pr)||!n(we)&&n(ks),tablet:!n(we)&&!n(Pr)&&!n(ks)&&(n(Wi)||n(Rl)),device:!n(we)&&(n(Pr)||n(Wi)||n(ks)||n(Rl))||n(/\bokhttp\b/i)},windows:{phone:n(we),tablet:n(Ml),device:n(we)||n(Ml)},other:{blackberry:n(Fl),blackberry10:n(Dl),opera:n(Bl),firefox:n(Ll),chrome:n(Ol),device:n(Fl)||n(Dl)||n(Bl)||n(Ll)||n(Ol)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const jy=kl.default??kl,Ce=jy(globalThis.navigator);Q.RETINA_PREFIX=/@([0-9\.]+)x/;Q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Us={exports:{}},Ul;function qy(){return Ul||(Ul=1,(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function s(h,l,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new n(u,c||h,d),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new i:delete h._events[l]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,c;if(this._eventsCount===0)return l;for(c in u=this._events)t.call(u,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=e?e+l:l,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,p=new Array(f);d<f;d++)p[d]=c[d].fn;return p},a.prototype.listenerCount=function(l){var u=e?e+l:l,c=this._events[u];return c?c.fn?1:c.length:0},a.prototype.emit=function(l,u,c,d,f,p){var m=e?e+l:l;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,x,v;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,c),!0;case 4:return g.fn.call(g.context,u,c,d),!0;case 5:return g.fn.call(g.context,u,c,d,f),!0;case 6:return g.fn.call(g.context,u,c,d,f,p),!0}for(v=1,x=new Array(y-1);v<y;v++)x[v-1]=arguments[v];g.fn.apply(g.context,x)}else{var E=g.length,w;for(v=0;v<E;v++)switch(g[v].once&&this.removeListener(l,g[v].fn,void 0,!0),y){case 1:g[v].fn.call(g[v].context);break;case 2:g[v].fn.call(g[v].context,u);break;case 3:g[v].fn.call(g[v].context,u,c);break;case 4:g[v].fn.call(g[v].context,u,c,d);break;default:if(!x)for(w=1,x=new Array(y-1);w<y;w++)x[w-1]=arguments[w];g[v].fn.apply(g[v].context,x)}}return!0},a.prototype.on=function(l,u,c){return s(this,l,u,c,!1)},a.prototype.once=function(l,u,c){return s(this,l,u,c,!0)},a.prototype.removeListener=function(l,u,c,d){var f=e?e+l:l;if(!this._events[f])return this;if(!u)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!d||p.once)&&(!c||p.context===c)&&o(this,f);else{for(var m=0,g=[],y=p.length;m<y;m++)(p[m].fn!==u||d&&!p[m].once||c&&p[m].context!==c)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&o(this,u)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,r.exports=a})(Us)),Us.exports}var Yy=qy();const Mi=Oc(Yy);var ji={exports:{}},Gl;function Ky(){if(Gl)return ji.exports;Gl=1,ji.exports=r,ji.exports.default=r;function r(_,A,b){b=b||2;var R=A&&A.length,C=R?A[0]*b:_.length,P=t(_,0,C,b,!0),D=[];if(!P||P.next===P.prev)return D;var O,H,$,Y,W,K,et;if(R&&(P=h(_,A,P,b)),_.length>80*b){O=$=_[0],H=Y=_[1];for(var X=b;X<C;X+=b)W=_[X],K=_[X+1],W<O&&(O=W),K<H&&(H=K),W>$&&($=W),K>Y&&(Y=K);et=Math.max($-O,Y-H),et=et!==0?32767/et:0}return i(P,D,b,O,H,et,0),D}function t(_,A,b,R,C){var P,D;if(C===N(_,A,b,R)>0)for(P=A;P<b;P+=R)D=M(P,_[P],_[P+1],D);else for(P=b-R;P>=A;P-=R)D=M(P,_[P],_[P+1],D);return D&&E(D,D.next)&&(B(D),D=D.next),D}function e(_,A){if(!_)return _;A||(A=_);var b=_,R;do if(R=!1,!b.steiner&&(E(b,b.next)||v(b.prev,b,b.next)===0)){if(B(b),b=A=b.prev,b===b.next)break;R=!0}else b=b.next;while(R||b!==A);return A}function i(_,A,b,R,C,P,D){if(_){!D&&P&&f(_,R,C,P);for(var O=_,H,$;_.prev!==_.next;){if(H=_.prev,$=_.next,P?s(_,R,C,P):n(_)){A.push(H.i/b|0),A.push(_.i/b|0),A.push($.i/b|0),B(_),_=$.next,O=$.next;continue}if(_=$,_===O){D?D===1?(_=o(e(_),A,b),i(_,A,b,R,C,P,2)):D===2&&a(_,A,b,R,C,P):i(e(_),A,b,R,C,P,1);break}}}}function n(_){var A=_.prev,b=_,R=_.next;if(v(A,b,R)>=0)return!1;for(var C=A.x,P=b.x,D=R.x,O=A.y,H=b.y,$=R.y,Y=C<P?C<D?C:D:P<D?P:D,W=O<H?O<$?O:$:H<$?H:$,K=C>P?C>D?C:D:P>D?P:D,et=O>H?O>$?O:$:H>$?H:$,X=R.next;X!==A;){if(X.x>=Y&&X.x<=K&&X.y>=W&&X.y<=et&&y(C,O,P,H,D,$,X.x,X.y)&&v(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function s(_,A,b,R){var C=_.prev,P=_,D=_.next;if(v(C,P,D)>=0)return!1;for(var O=C.x,H=P.x,$=D.x,Y=C.y,W=P.y,K=D.y,et=O<H?O<$?O:$:H<$?H:$,X=Y<W?Y<K?Y:K:W<K?W:K,rt=O>H?O>$?O:$:H>$?H:$,nt=Y>W?Y>K?Y:K:W>K?W:K,lt=m(et,X,A,b,R),dt=m(rt,nt,A,b,R),J=_.prevZ,st=_.nextZ;J&&J.z>=lt&&st&&st.z<=dt;){if(J.x>=et&&J.x<=rt&&J.y>=X&&J.y<=nt&&J!==C&&J!==D&&y(O,Y,H,W,$,K,J.x,J.y)&&v(J.prev,J,J.next)>=0||(J=J.prevZ,st.x>=et&&st.x<=rt&&st.y>=X&&st.y<=nt&&st!==C&&st!==D&&y(O,Y,H,W,$,K,st.x,st.y)&&v(st.prev,st,st.next)>=0))return!1;st=st.nextZ}for(;J&&J.z>=lt;){if(J.x>=et&&J.x<=rt&&J.y>=X&&J.y<=nt&&J!==C&&J!==D&&y(O,Y,H,W,$,K,J.x,J.y)&&v(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;st&&st.z<=dt;){if(st.x>=et&&st.x<=rt&&st.y>=X&&st.y<=nt&&st!==C&&st!==D&&y(O,Y,H,W,$,K,st.x,st.y)&&v(st.prev,st,st.next)>=0)return!1;st=st.nextZ}return!0}function o(_,A,b){var R=_;do{var C=R.prev,P=R.next.next;!E(C,P)&&w(C,R,R.next,P)&&U(C,P)&&U(P,C)&&(A.push(C.i/b|0),A.push(R.i/b|0),A.push(P.i/b|0),B(R),B(R.next),R=_=P),R=R.next}while(R!==_);return e(R)}function a(_,A,b,R,C,P){var D=_;do{for(var O=D.next.next;O!==D.prev;){if(D.i!==O.i&&x(D,O)){var H=z(D,O);D=e(D,D.next),H=e(H,H.next),i(D,A,b,R,C,P,0),i(H,A,b,R,C,P,0);return}O=O.next}D=D.next}while(D!==_)}function h(_,A,b,R){var C=[],P,D,O,H,$;for(P=0,D=A.length;P<D;P++)O=A[P]*R,H=P<D-1?A[P+1]*R:_.length,$=t(_,O,H,R,!1),$===$.next&&($.steiner=!0),C.push(g($));for(C.sort(l),P=0;P<C.length;P++)b=u(C[P],b);return b}function l(_,A){return _.x-A.x}function u(_,A){var b=c(_,A);if(!b)return A;var R=z(b,_);return e(R,R.next),e(b,b.next)}function c(_,A){var b=A,R=_.x,C=_.y,P=-1/0,D;do{if(C<=b.y&&C>=b.next.y&&b.next.y!==b.y){var O=b.x+(C-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(O<=R&&O>P&&(P=O,D=b.x<b.next.x?b:b.next,O===R))return D}b=b.next}while(b!==A);if(!D)return null;var H=D,$=D.x,Y=D.y,W=1/0,K;b=D;do R>=b.x&&b.x>=$&&R!==b.x&&y(C<Y?R:P,C,$,Y,C<Y?P:R,C,b.x,b.y)&&(K=Math.abs(C-b.y)/(R-b.x),U(b,_)&&(K<W||K===W&&(b.x>D.x||b.x===D.x&&d(D,b)))&&(D=b,W=K)),b=b.next;while(b!==H);return D}function d(_,A){return v(_.prev,_,A.prev)<0&&v(A.next,_,_.next)<0}function f(_,A,b,R){var C=_;do C.z===0&&(C.z=m(C.x,C.y,A,b,R)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==_);C.prevZ.nextZ=null,C.prevZ=null,p(C)}function p(_){var A,b,R,C,P,D,O,H,$=1;do{for(b=_,_=null,P=null,D=0;b;){for(D++,R=b,O=0,A=0;A<$&&(O++,R=R.nextZ,!!R);A++);for(H=$;O>0||H>0&&R;)O!==0&&(H===0||!R||b.z<=R.z)?(C=b,b=b.nextZ,O--):(C=R,R=R.nextZ,H--),P?P.nextZ=C:_=C,C.prevZ=P,P=C;b=R}P.nextZ=null,$*=2}while(D>1);return _}function m(_,A,b,R,C){return _=(_-b)*C|0,A=(A-R)*C|0,_=(_|_<<8)&16711935,_=(_|_<<4)&252645135,_=(_|_<<2)&858993459,_=(_|_<<1)&1431655765,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,_|A<<1}function g(_){var A=_,b=_;do(A.x<b.x||A.x===b.x&&A.y<b.y)&&(b=A),A=A.next;while(A!==_);return b}function y(_,A,b,R,C,P,D,O){return(C-D)*(A-O)>=(_-D)*(P-O)&&(_-D)*(R-O)>=(b-D)*(A-O)&&(b-D)*(P-O)>=(C-D)*(R-O)}function x(_,A){return _.next.i!==A.i&&_.prev.i!==A.i&&!F(_,A)&&(U(_,A)&&U(A,_)&&G(_,A)&&(v(_.prev,_,A.prev)||v(_,A.prev,A))||E(_,A)&&v(_.prev,_,_.next)>0&&v(A.prev,A,A.next)>0)}function v(_,A,b){return(A.y-_.y)*(b.x-A.x)-(A.x-_.x)*(b.y-A.y)}function E(_,A){return _.x===A.x&&_.y===A.y}function w(_,A,b,R){var C=T(v(_,A,b)),P=T(v(_,A,R)),D=T(v(b,R,_)),O=T(v(b,R,A));return!!(C!==P&&D!==O||C===0&&I(_,b,A)||P===0&&I(_,R,A)||D===0&&I(b,_,R)||O===0&&I(b,A,R))}function I(_,A,b){return A.x<=Math.max(_.x,b.x)&&A.x>=Math.min(_.x,b.x)&&A.y<=Math.max(_.y,b.y)&&A.y>=Math.min(_.y,b.y)}function T(_){return _>0?1:_<0?-1:0}function F(_,A){var b=_;do{if(b.i!==_.i&&b.next.i!==_.i&&b.i!==A.i&&b.next.i!==A.i&&w(b,b.next,_,A))return!0;b=b.next}while(b!==_);return!1}function U(_,A){return v(_.prev,_,_.next)<0?v(_,A,_.next)>=0&&v(_,_.prev,A)>=0:v(_,A,_.prev)<0||v(_,_.next,A)<0}function G(_,A){var b=_,R=!1,C=(_.x+A.x)/2,P=(_.y+A.y)/2;do b.y>P!=b.next.y>P&&b.next.y!==b.y&&C<(b.next.x-b.x)*(P-b.y)/(b.next.y-b.y)+b.x&&(R=!R),b=b.next;while(b!==_);return R}function z(_,A){var b=new S(_.i,_.x,_.y),R=new S(A.i,A.x,A.y),C=_.next,P=A.prev;return _.next=A,A.prev=_,b.next=C,C.prev=b,R.next=b,b.prev=R,P.next=R,R.prev=P,R}function M(_,A,b,R){var C=new S(_,A,b);return R?(C.next=R.next,C.prev=R,R.next.prev=C,R.next=C):(C.prev=C,C.next=C),C}function B(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function S(_,A,b){this.i=_,this.x=A,this.y=b,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}r.deviation=function(_,A,b,R){var C=A&&A.length,P=C?A[0]*b:_.length,D=Math.abs(N(_,0,P,b));if(C)for(var O=0,H=A.length;O<H;O++){var $=A[O]*b,Y=O<H-1?A[O+1]*b:_.length;D-=Math.abs(N(_,$,Y,b))}var W=0;for(O=0;O<R.length;O+=3){var K=R[O]*b,et=R[O+1]*b,X=R[O+2]*b;W+=Math.abs((_[K]-_[X])*(_[et+1]-_[K+1])-(_[K]-_[et])*(_[X+1]-_[K+1]))}return D===0&&W===0?0:Math.abs((W-D)/D)};function N(_,A,b,R){for(var C=0,P=A,D=b-R;P<b;P+=R)C+=(_[D]-_[P])*(_[P+1]+_[D+1]),D=P;return C}return r.flatten=function(_){for(var A=_[0][0].length,b={vertices:[],holes:[],dimensions:A},R=0,C=0;C<_.length;C++){for(var P=0;P<_[C].length;P++)for(var D=0;D<A;D++)b.vertices.push(_[C][P][D]);C>0&&(R+=_[C-1].length,b.holes.push(R))}return b},ji.exports}var Zy=Ky();const Qy=Oc(Zy);var rr={},pi={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var Jy=pi.exports,Hl;function t1(){return Hl||(Hl=1,(function(r,t){(function(e){var i=t&&!t.nodeType&&t,n=r&&!r.nodeType&&r,s=typeof In=="object"&&In;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,h=36,l=1,u=26,c=38,d=700,f=72,p=128,m="-",g=/^xn--/,y=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=h-l,w=Math.floor,I=String.fromCharCode,T;function F(C){throw new RangeError(v[C])}function U(C,P){for(var D=C.length,O=[];D--;)O[D]=P(C[D]);return O}function G(C,P){var D=C.split("@"),O="";D.length>1&&(O=D[0]+"@",C=D[1]),C=C.replace(x,".");var H=C.split("."),$=U(H,P).join(".");return O+$}function z(C){for(var P=[],D=0,O=C.length,H,$;D<O;)H=C.charCodeAt(D++),H>=55296&&H<=56319&&D<O?($=C.charCodeAt(D++),($&64512)==56320?P.push(((H&1023)<<10)+($&1023)+65536):(P.push(H),D--)):P.push(H);return P}function M(C){return U(C,function(P){var D="";return P>65535&&(P-=65536,D+=I(P>>>10&1023|55296),P=56320|P&1023),D+=I(P),D}).join("")}function B(C){return C-48<10?C-22:C-65<26?C-65:C-97<26?C-97:h}function S(C,P){return C+22+75*(C<26)-((P!=0)<<5)}function N(C,P,D){var O=0;for(C=D?w(C/d):C>>1,C+=w(C/P);C>E*u>>1;O+=h)C=w(C/E);return w(O+(E+1)*C/(C+c))}function _(C){var P=[],D=C.length,O,H=0,$=p,Y=f,W,K,et,X,rt,nt,lt,dt,J;for(W=C.lastIndexOf(m),W<0&&(W=0),K=0;K<W;++K)C.charCodeAt(K)>=128&&F("not-basic"),P.push(C.charCodeAt(K));for(et=W>0?W+1:0;et<D;){for(X=H,rt=1,nt=h;et>=D&&F("invalid-input"),lt=B(C.charCodeAt(et++)),(lt>=h||lt>w((a-H)/rt))&&F("overflow"),H+=lt*rt,dt=nt<=Y?l:nt>=Y+u?u:nt-Y,!(lt<dt);nt+=h)J=h-dt,rt>w(a/J)&&F("overflow"),rt*=J;O=P.length+1,Y=N(H-X,O,X==0),w(H/O)>a-$&&F("overflow"),$+=w(H/O),H%=O,P.splice(H++,0,$)}return M(P)}function A(C){var P,D,O,H,$,Y,W,K,et,X,rt,nt=[],lt,dt,J,st;for(C=z(C),lt=C.length,P=p,D=0,$=f,Y=0;Y<lt;++Y)rt=C[Y],rt<128&&nt.push(I(rt));for(O=H=nt.length,H&&nt.push(m);O<lt;){for(W=a,Y=0;Y<lt;++Y)rt=C[Y],rt>=P&&rt<W&&(W=rt);for(dt=O+1,W-P>w((a-D)/dt)&&F("overflow"),D+=(W-P)*dt,P=W,Y=0;Y<lt;++Y)if(rt=C[Y],rt<P&&++D>a&&F("overflow"),rt==P){for(K=D,et=h;X=et<=$?l:et>=$+u?u:et-$,!(K<X);et+=h)st=K-X,J=h-X,nt.push(I(S(X+st%J,0))),K=w(st/J);nt.push(I(S(K,0))),$=N(D,dt,O==H),D=0,++O}++D,++P}return nt.join("")}function b(C){return G(C,function(P){return g.test(P)?_(P.slice(4).toLowerCase()):P})}function R(C){return G(C,function(P){return y.test(P)?"xn--"+A(P):P})}if(o={version:"1.4.1",ucs2:{decode:z,encode:M},decode:_,encode:A,toASCII:R,toUnicode:b},i&&n)if(r.exports==i)n.exports=o;else for(T in o)o.hasOwnProperty(T)&&(i[T]=o[T]);else e.punycode=o})(Jy)})(pi,pi.exports)),pi.exports}var Gs,zl;function wd(){return zl||(zl=1,Gs=Object),Gs}var Hs,$l;function e1(){return $l||($l=1,Hs=Error),Hs}var zs,Vl;function r1(){return Vl||(Vl=1,zs=EvalError),zs}var $s,Xl;function i1(){return Xl||(Xl=1,$s=RangeError),$s}var Vs,Wl;function n1(){return Wl||(Wl=1,Vs=ReferenceError),Vs}var Xs,jl;function Td(){return jl||(jl=1,Xs=SyntaxError),Xs}var Ws,ql;function Fi(){return ql||(ql=1,Ws=TypeError),Ws}var js,Yl;function s1(){return Yl||(Yl=1,js=URIError),js}var qs,Kl;function o1(){return Kl||(Kl=1,qs=Math.abs),qs}var Ys,Zl;function a1(){return Zl||(Zl=1,Ys=Math.floor),Ys}var Ks,Ql;function h1(){return Ql||(Ql=1,Ks=Math.max),Ks}var Zs,Jl;function l1(){return Jl||(Jl=1,Zs=Math.min),Zs}var Qs,tu;function u1(){return tu||(tu=1,Qs=Math.pow),Qs}var Js,eu;function c1(){return eu||(eu=1,Js=Math.round),Js}var to,ru;function d1(){return ru||(ru=1,to=Number.isNaN||function(t){return t!==t}),to}var eo,iu;function f1(){if(iu)return eo;iu=1;var r=d1();return eo=function(e){return r(e)||e===0?e:e<0?-1:1},eo}var ro,nu;function p1(){return nu||(nu=1,ro=Object.getOwnPropertyDescriptor),ro}var io,su;function as(){if(su)return io;su=1;var r=p1();if(r)try{r([],"length")}catch{r=null}return io=r,io}var no,ou;function hs(){if(ou)return no;ou=1;var r=Object.defineProperty||!1;if(r)try{r({},"a",{value:1})}catch{r=!1}return no=r,no}var so,au;function m1(){return au||(au=1,so=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,e);if(a.value!==n||a.enumerable!==!0)return!1}return!0}),so}var oo,hu;function g1(){if(hu)return oo;hu=1;var r=typeof Symbol<"u"&&Symbol,t=m1();return oo=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},oo}var ao,lu;function Ad(){return lu||(lu=1,ao=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),ao}var ho,uu;function Ed(){if(uu)return ho;uu=1;var r=wd();return ho=r.getPrototypeOf||null,ho}var lo,cu;function y1(){if(cu)return lo;cu=1;var r="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,i="[object Function]",n=function(h,l){for(var u=[],c=0;c<h.length;c+=1)u[c]=h[c];for(var d=0;d<l.length;d+=1)u[d+h.length]=l[d];return u},s=function(h,l){for(var u=[],c=l,d=0;c<h.length;c+=1,d+=1)u[d]=h[c];return u},o=function(a,h){for(var l="",u=0;u<a.length;u+=1)l+=a[u],u+1<a.length&&(l+=h);return l};return lo=function(h){var l=this;if(typeof l!="function"||t.apply(l)!==i)throw new TypeError(r+l);for(var u=s(arguments,1),c,d=function(){if(this instanceof c){var y=l.apply(this,n(u,arguments));return Object(y)===y?y:this}return l.apply(h,n(u,arguments))},f=e(0,l.length-u.length),p=[],m=0;m<f;m++)p[m]="$"+m;if(c=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(d),l.prototype){var g=function(){};g.prototype=l.prototype,c.prototype=new g,g.prototype=null}return c},lo}var uo,du;function Di(){if(du)return uo;du=1;var r=y1();return uo=Function.prototype.bind||r,uo}var co,fu;function wh(){return fu||(fu=1,co=Function.prototype.call),co}var fo,pu;function Th(){return pu||(pu=1,fo=Function.prototype.apply),fo}var po,mu;function v1(){return mu||(mu=1,po=typeof Reflect<"u"&&Reflect&&Reflect.apply),po}var mo,gu;function Sd(){if(gu)return mo;gu=1;var r=Di(),t=Th(),e=wh(),i=v1();return mo=i||r.call(e,t),mo}var go,yu;function Cd(){if(yu)return go;yu=1;var r=Di(),t=Fi(),e=wh(),i=Sd();return go=function(s){if(s.length<1||typeof s[0]!="function")throw new t("a function is required");return i(r,e,s)},go}var yo,vu;function _1(){if(vu)return yo;vu=1;var r=Cd(),t=as(),e;try{e=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var i=!!e&&t&&t(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return yo=i&&typeof i.get=="function"?r([i.get]):typeof s=="function"?function(a){return s(a==null?a:n(a))}:!1,yo}var vo,_u;function x1(){if(_u)return vo;_u=1;var r=Ad(),t=Ed(),e=_1();return vo=r?function(n){return r(n)}:t?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return t(n)}:e?function(n){return e(n)}:null,vo}var _o,xu;function b1(){if(xu)return _o;xu=1;var r=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Di();return _o=e.call(r,t),_o}var xo,bu;function Ah(){if(bu)return xo;bu=1;var r,t=wd(),e=e1(),i=r1(),n=i1(),s=n1(),o=Td(),a=Fi(),h=s1(),l=o1(),u=a1(),c=h1(),d=l1(),f=u1(),p=c1(),m=f1(),g=Function,y=function(et){try{return g('"use strict"; return ('+et+").constructor;")()}catch{}},x=as(),v=hs(),E=function(){throw new a},w=x?(function(){try{return arguments.callee,E}catch{try{return x(arguments,"callee").get}catch{return E}}})():E,I=g1()(),T=x1(),F=Ed(),U=Ad(),G=Th(),z=wh(),M={},B=typeof Uint8Array>"u"||!T?r:T(Uint8Array),S={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?r:ArrayBuffer,"%ArrayIteratorPrototype%":I&&T?T([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":M,"%AsyncGenerator%":M,"%AsyncGeneratorFunction%":M,"%AsyncIteratorPrototype%":M,"%Atomics%":typeof Atomics>"u"?r:Atomics,"%BigInt%":typeof BigInt>"u"?r:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?r:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":i,"%Float16Array%":typeof Float16Array>"u"?r:Float16Array,"%Float32Array%":typeof Float32Array>"u"?r:Float32Array,"%Float64Array%":typeof Float64Array>"u"?r:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?r:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":M,"%Int8Array%":typeof Int8Array>"u"?r:Int8Array,"%Int16Array%":typeof Int16Array>"u"?r:Int16Array,"%Int32Array%":typeof Int32Array>"u"?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":I&&T?T(T([][Symbol.iterator]())):r,"%JSON%":typeof JSON=="object"?JSON:r,"%Map%":typeof Map>"u"?r:Map,"%MapIteratorPrototype%":typeof Map>"u"||!I||!T?r:T(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":x,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?r:Promise,"%Proxy%":typeof Proxy>"u"?r:Proxy,"%RangeError%":n,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?r:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?r:Set,"%SetIteratorPrototype%":typeof Set>"u"||!I||!T?r:T(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":I&&T?T(""[Symbol.iterator]()):r,"%Symbol%":I?Symbol:r,"%SyntaxError%":o,"%ThrowTypeError%":w,"%TypedArray%":B,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?r:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?r:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?r:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?r:Uint32Array,"%URIError%":h,"%WeakMap%":typeof WeakMap>"u"?r:WeakMap,"%WeakRef%":typeof WeakRef>"u"?r:WeakRef,"%WeakSet%":typeof WeakSet>"u"?r:WeakSet,"%Function.prototype.call%":z,"%Function.prototype.apply%":G,"%Object.defineProperty%":v,"%Object.getPrototypeOf%":F,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":c,"%Math.min%":d,"%Math.pow%":f,"%Math.round%":p,"%Math.sign%":m,"%Reflect.getPrototypeOf%":U};if(T)try{null.error}catch(et){var N=T(T(et));S["%Error.prototype%"]=N}var _=function et(X){var rt;if(X==="%AsyncFunction%")rt=y("async function () {}");else if(X==="%GeneratorFunction%")rt=y("function* () {}");else if(X==="%AsyncGeneratorFunction%")rt=y("async function* () {}");else if(X==="%AsyncGenerator%"){var nt=et("%AsyncGeneratorFunction%");nt&&(rt=nt.prototype)}else if(X==="%AsyncIteratorPrototype%"){var lt=et("%AsyncGenerator%");lt&&T&&(rt=T(lt.prototype))}return S[X]=rt,rt},A={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=Di(),R=b1(),C=b.call(z,Array.prototype.concat),P=b.call(G,Array.prototype.splice),D=b.call(z,String.prototype.replace),O=b.call(z,String.prototype.slice),H=b.call(z,RegExp.prototype.exec),$=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Y=/\\(\\)?/g,W=function(X){var rt=O(X,0,1),nt=O(X,-1);if(rt==="%"&&nt!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(nt==="%"&&rt!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var lt=[];return D(X,$,function(dt,J,st,It){lt[lt.length]=st?D(It,Y,"$1"):J||dt}),lt},K=function(X,rt){var nt=X,lt;if(R(A,nt)&&(lt=A[nt],nt="%"+lt[0]+"%"),R(S,nt)){var dt=S[nt];if(dt===M&&(dt=_(nt)),typeof dt>"u"&&!rt)throw new a("intrinsic "+X+" exists, but is not available. Please file an issue!");return{alias:lt,name:nt,value:dt}}throw new o("intrinsic "+X+" does not exist!")};return xo=function(X,rt){if(typeof X!="string"||X.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof rt!="boolean")throw new a('"allowMissing" argument must be a boolean');if(H(/^%?[^%]*%?$/,X)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var nt=W(X),lt=nt.length>0?nt[0]:"",dt=K("%"+lt+"%",rt),J=dt.name,st=dt.value,It=!1,Ht=dt.alias;Ht&&(lt=Ht[0],P(nt,C([0,1],Ht)));for(var Tr=1,Qe=!0;Tr<nt.length;Tr+=1){var Wt=nt[Tr],Ar=O(Wt,0,1),Er=O(Wt,-1);if((Ar==='"'||Ar==="'"||Ar==="`"||Er==='"'||Er==="'"||Er==="`")&&Ar!==Er)throw new o("property names with quotes must have matching quotes");if((Wt==="constructor"||!Qe)&&(It=!0),lt+="."+Wt,J="%"+lt+"%",R(S,J))st=S[J];else if(st!=null){if(!(Wt in st)){if(!rt)throw new a("base intrinsic for "+X+" exists, but the property is not available.");return}if(x&&Tr+1>=nt.length){var Je=x(st,Wt);Qe=!!Je,Qe&&"get"in Je&&!("originalValue"in Je.get)?st=Je.get:st=st[Wt]}else Qe=R(st,Wt),st=st[Wt];Qe&&!It&&(S[J]=st)}}return st},xo}var bo={exports:{}},wo,wu;function w1(){if(wu)return wo;wu=1;var r=hs(),t=Td(),e=Fi(),i=as();return wo=function(s,o,a){if(!s||typeof s!="object"&&typeof s!="function")throw new e("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new e("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new e("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new e("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new e("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new e("`loose`, if provided, must be a boolean");var h=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,u=arguments.length>5?arguments[5]:null,c=arguments.length>6?arguments[6]:!1,d=!!i&&i(s,o);if(r)r(s,o,{configurable:u===null&&d?d.configurable:!u,enumerable:h===null&&d?d.enumerable:!h,value:a,writable:l===null&&d?d.writable:!l});else if(c||!h&&!l&&!u)s[o]=a;else throw new t("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},wo}var To,Tu;function T1(){if(Tu)return To;Tu=1;var r=hs(),t=function(){return!!r};return t.hasArrayLengthDefineBug=function(){if(!r)return null;try{return r([],"length",{value:1}).length!==1}catch{return!0}},To=t,To}var Ao,Au;function A1(){if(Au)return Ao;Au=1;var r=Ah(),t=w1(),e=T1()(),i=as(),n=Fi(),s=r("%Math.floor%");return Ao=function(a,h){if(typeof a!="function")throw new n("`fn` is not a function");if(typeof h!="number"||h<0||h>4294967295||s(h)!==h)throw new n("`length` must be a positive 32-bit integer");var l=arguments.length>2&&!!arguments[2],u=!0,c=!0;if("length"in a&&i){var d=i(a,"length");d&&!d.configurable&&(u=!1),d&&!d.writable&&(c=!1)}return(u||c||!l)&&(e?t(a,"length",h,!0,!0):t(a,"length",h)),a},Ao}var Eo,Eu;function E1(){if(Eu)return Eo;Eu=1;var r=Di(),t=Th(),e=Sd();return Eo=function(){return e(r,t,arguments)},Eo}var Su;function S1(){return Su||(Su=1,(function(r){var t=A1(),e=hs(),i=Cd(),n=E1();r.exports=function(o){var a=i(arguments),h=o.length-(arguments.length-1);return t(a,1+(h>0?h:0),!0)},e?e(r.exports,"apply",{value:n}):r.exports.apply=n})(bo)),bo.exports}var So,Cu;function C1(){if(Cu)return So;Cu=1;var r=Ah(),t=S1(),e=t(r("String.prototype.indexOf"));return So=function(n,s){var o=r(n,!!s);return typeof o=="function"&&e(n,".prototype.")>-1?t(o):o},So}const P1={},I1=Object.freeze(Object.defineProperty({__proto__:null,default:P1},Symbol.toStringTag,{value:"Module"})),R1=ip(I1);var Co,Pu;function M1(){if(Pu)return Co;Pu=1;var r=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=r&&t&&typeof t.get=="function"?t.get:null,i=r&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=n&&s&&typeof s.get=="function"?s.get:null,a=n&&Set.prototype.forEach,h=typeof WeakMap=="function"&&WeakMap.prototype,l=h?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,c=u?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,f=d?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,x=String.prototype.slice,v=String.prototype.replace,E=String.prototype.toUpperCase,w=String.prototype.toLowerCase,I=RegExp.prototype.test,T=Array.prototype.concat,F=Array.prototype.join,U=Array.prototype.slice,G=Math.floor,z=typeof BigInt=="function"?BigInt.prototype.valueOf:null,M=Object.getOwnPropertySymbols,B=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,S=typeof Symbol=="function"&&typeof Symbol.iterator=="object",N=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===S||!0)?Symbol.toStringTag:null,_=Object.prototype.propertyIsEnumerable,A=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(L){return L.__proto__}:null);function b(L,k){if(L===1/0||L===-1/0||L!==L||L&&L>-1e3&&L<1e3||I.call(/e/,k))return k;var mt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof L=="number"){var gt=L<0?-G(-L):G(L);if(gt!==L){var bt=String(gt),ft=x.call(k,bt.length+1);return v.call(bt,mt,"$&_")+"."+v.call(v.call(ft,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(k,mt,"$&_")}var R=R1,C=R.custom,P=rt(C)?C:null;Co=function L(k,mt,gt,bt){var ft=mt||{};if(dt(ft,"quoteStyle")&&ft.quoteStyle!=="single"&&ft.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(dt(ft,"maxStringLength")&&(typeof ft.maxStringLength=="number"?ft.maxStringLength<0&&ft.maxStringLength!==1/0:ft.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Fe=dt(ft,"customInspect")?ft.customInspect:!0;if(typeof Fe!="boolean"&&Fe!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(dt(ft,"indent")&&ft.indent!==null&&ft.indent!=="	"&&!(parseInt(ft.indent,10)===ft.indent&&ft.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(dt(ft,"numericSeparator")&&typeof ft.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var tr=ft.numericSeparator;if(typeof k>"u")return"undefined";if(k===null)return"null";if(typeof k=="boolean")return k?"true":"false";if(typeof k=="string")return Je(k,ft);if(typeof k=="number"){if(k===0)return 1/0/k>0?"0":"-0";var Dt=String(k);return tr?b(k,Dt):Dt}if(typeof k=="bigint"){var De=String(k)+"n";return tr?b(k,De):De}var Ts=typeof ft.depth>"u"?5:ft.depth;if(typeof gt>"u"&&(gt=0),gt>=Ts&&Ts>0&&typeof k=="object")return H(k)?"[Array]":"[Object]";var Sr=tp(ft,gt);if(typeof bt>"u")bt=[];else if(It(bt,k)>=0)return"[Circular]";function jt(Cr,Ui,rp){if(Ui&&(bt=U.call(bt),bt.push(Ui)),rp){var jh={depth:ft.depth};return dt(ft,"quoteStyle")&&(jh.quoteStyle=ft.quoteStyle),L(Cr,jh,gt+1,bt)}return L(Cr,ft,gt+1,bt)}if(typeof k=="function"&&!Y(k)){var Gh=st(k),Hh=Ni(k,jt);return"[Function"+(Gh?": "+Gh:" (anonymous)")+"]"+(Hh.length>0?" { "+F.call(Hh,", ")+" }":"")}if(rt(k)){var zh=S?v.call(String(k),/^(Symbol\(.*\))_[^)]*$/,"$1"):B.call(k);return typeof k=="object"&&!S?ti(zh):zh}if(Er(k)){for(var ei="<"+w.call(String(k.nodeName)),As=k.attributes||[],ki=0;ki<As.length;ki++)ei+=" "+As[ki].name+"="+D(O(As[ki].value),"double",ft);return ei+=">",k.childNodes&&k.childNodes.length&&(ei+="..."),ei+="</"+w.call(String(k.nodeName))+">",ei}if(H(k)){if(k.length===0)return"[]";var Es=Ni(k,jt);return Sr&&!Jf(Es)?"["+ws(Es,Sr)+"]":"[ "+F.call(Es,", ")+" ]"}if(W(k)){var Ss=Ni(k,jt);return!("cause"in Error.prototype)&&"cause"in k&&!_.call(k,"cause")?"{ ["+String(k)+"] "+F.call(T.call("[cause]: "+jt(k.cause),Ss),", ")+" }":Ss.length===0?"["+String(k)+"]":"{ ["+String(k)+"] "+F.call(Ss,", ")+" }"}if(typeof k=="object"&&Fe){if(P&&typeof k[P]=="function"&&R)return R(k,{depth:Ts-gt});if(Fe!=="symbol"&&typeof k.inspect=="function")return k.inspect()}if(Ht(k)){var $h=[];return i&&i.call(k,function(Cr,Ui){$h.push(jt(Ui,k,!0)+" => "+jt(Cr,k))}),Uh("Map",e.call(k),$h,Sr)}if(Wt(k)){var Vh=[];return a&&a.call(k,function(Cr){Vh.push(jt(Cr,k))}),Uh("Set",o.call(k),Vh,Sr)}if(Tr(k))return bs("WeakMap");if(Ar(k))return bs("WeakSet");if(Qe(k))return bs("WeakRef");if(et(k))return ti(jt(Number(k)));if(nt(k))return ti(jt(z.call(k)));if(X(k))return ti(p.call(k));if(K(k))return ti(jt(String(k)));if(typeof window<"u"&&k===window)return"{ [object Window] }";if(typeof globalThis<"u"&&k===globalThis||typeof In<"u"&&k===In)return"{ [object globalThis] }";if(!$(k)&&!Y(k)){var Cs=Ni(k,jt),Xh=A?A(k)===Object.prototype:k instanceof Object||k.constructor===Object,Ps=k instanceof Object?"":"null prototype",Wh=!Xh&&N&&Object(k)===k&&N in k?x.call(J(k),8,-1):Ps?"Object":"",ep=Xh||typeof k.constructor!="function"?"":k.constructor.name?k.constructor.name+" ":"",Is=ep+(Wh||Ps?"["+F.call(T.call([],Wh||[],Ps||[]),": ")+"] ":"");return Cs.length===0?Is+"{}":Sr?Is+"{"+ws(Cs,Sr)+"}":Is+"{ "+F.call(Cs,", ")+" }"}return String(k)};function D(L,k,mt){var gt=(mt.quoteStyle||k)==="double"?'"':"'";return gt+L+gt}function O(L){return v.call(String(L),/"/g,"&quot;")}function H(L){return J(L)==="[object Array]"&&(!N||!(typeof L=="object"&&N in L))}function $(L){return J(L)==="[object Date]"&&(!N||!(typeof L=="object"&&N in L))}function Y(L){return J(L)==="[object RegExp]"&&(!N||!(typeof L=="object"&&N in L))}function W(L){return J(L)==="[object Error]"&&(!N||!(typeof L=="object"&&N in L))}function K(L){return J(L)==="[object String]"&&(!N||!(typeof L=="object"&&N in L))}function et(L){return J(L)==="[object Number]"&&(!N||!(typeof L=="object"&&N in L))}function X(L){return J(L)==="[object Boolean]"&&(!N||!(typeof L=="object"&&N in L))}function rt(L){if(S)return L&&typeof L=="object"&&L instanceof Symbol;if(typeof L=="symbol")return!0;if(!L||typeof L!="object"||!B)return!1;try{return B.call(L),!0}catch{}return!1}function nt(L){if(!L||typeof L!="object"||!z)return!1;try{return z.call(L),!0}catch{}return!1}var lt=Object.prototype.hasOwnProperty||function(L){return L in this};function dt(L,k){return lt.call(L,k)}function J(L){return m.call(L)}function st(L){if(L.name)return L.name;var k=y.call(g.call(L),/^function\s*([\w$]+)/);return k?k[1]:null}function It(L,k){if(L.indexOf)return L.indexOf(k);for(var mt=0,gt=L.length;mt<gt;mt++)if(L[mt]===k)return mt;return-1}function Ht(L){if(!e||!L||typeof L!="object")return!1;try{e.call(L);try{o.call(L)}catch{return!0}return L instanceof Map}catch{}return!1}function Tr(L){if(!l||!L||typeof L!="object")return!1;try{l.call(L,l);try{c.call(L,c)}catch{return!0}return L instanceof WeakMap}catch{}return!1}function Qe(L){if(!f||!L||typeof L!="object")return!1;try{return f.call(L),!0}catch{}return!1}function Wt(L){if(!o||!L||typeof L!="object")return!1;try{o.call(L);try{e.call(L)}catch{return!0}return L instanceof Set}catch{}return!1}function Ar(L){if(!c||!L||typeof L!="object")return!1;try{c.call(L,c);try{l.call(L,l)}catch{return!0}return L instanceof WeakSet}catch{}return!1}function Er(L){return!L||typeof L!="object"?!1:typeof HTMLElement<"u"&&L instanceof HTMLElement?!0:typeof L.nodeName=="string"&&typeof L.getAttribute=="function"}function Je(L,k){if(L.length>k.maxStringLength){var mt=L.length-k.maxStringLength,gt="... "+mt+" more character"+(mt>1?"s":"");return Je(x.call(L,0,k.maxStringLength),k)+gt}var bt=v.call(v.call(L,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Qf);return D(bt,"single",k)}function Qf(L){var k=L.charCodeAt(0),mt={8:"b",9:"t",10:"n",12:"f",13:"r"}[k];return mt?"\\"+mt:"\\x"+(k<16?"0":"")+E.call(k.toString(16))}function ti(L){return"Object("+L+")"}function bs(L){return L+" { ? }"}function Uh(L,k,mt,gt){var bt=gt?ws(mt,gt):F.call(mt,", ");return L+" ("+k+") {"+bt+"}"}function Jf(L){for(var k=0;k<L.length;k++)if(It(L[k],`
`)>=0)return!1;return!0}function tp(L,k){var mt;if(L.indent==="	")mt="	";else if(typeof L.indent=="number"&&L.indent>0)mt=F.call(Array(L.indent+1)," ");else return null;return{base:mt,prev:F.call(Array(k+1),mt)}}function ws(L,k){if(L.length===0)return"";var mt=`
`+k.prev+k.base;return mt+F.call(L,","+mt)+`
`+k.prev}function Ni(L,k){var mt=H(L),gt=[];if(mt){gt.length=L.length;for(var bt=0;bt<L.length;bt++)gt[bt]=dt(L,bt)?k(L[bt],L):""}var ft=typeof M=="function"?M(L):[],Fe;if(S){Fe={};for(var tr=0;tr<ft.length;tr++)Fe["$"+ft[tr]]=ft[tr]}for(var Dt in L)dt(L,Dt)&&(mt&&String(Number(Dt))===Dt&&Dt<L.length||S&&Fe["$"+Dt]instanceof Symbol||(I.call(/[^\w$]/,Dt)?gt.push(k(Dt,L)+": "+k(L[Dt],L)):gt.push(Dt+": "+k(L[Dt],L))));if(typeof M=="function")for(var De=0;De<ft.length;De++)_.call(L,ft[De])&&gt.push("["+k(ft[De])+"]: "+k(L[ft[De]],L));return gt}return Co}var Po,Iu;function F1(){if(Iu)return Po;Iu=1;var r=Ah(),t=C1(),e=M1(),i=Fi(),n=r("%WeakMap%",!0),s=r("%Map%",!0),o=t("WeakMap.prototype.get",!0),a=t("WeakMap.prototype.set",!0),h=t("WeakMap.prototype.has",!0),l=t("Map.prototype.get",!0),u=t("Map.prototype.set",!0),c=t("Map.prototype.has",!0),d=function(g,y){for(var x=g,v;(v=x.next)!==null;x=v)if(v.key===y)return x.next=v.next,v.next=g.next,g.next=v,v},f=function(g,y){var x=d(g,y);return x&&x.value},p=function(g,y,x){var v=d(g,y);v?v.value=x:g.next={key:y,next:g.next,value:x}},m=function(g,y){return!!d(g,y)};return Po=function(){var y,x,v,E={assert:function(w){if(!E.has(w))throw new i("Side channel does not contain "+e(w))},get:function(w){if(n&&w&&(typeof w=="object"||typeof w=="function")){if(y)return o(y,w)}else if(s){if(x)return l(x,w)}else if(v)return f(v,w)},has:function(w){if(n&&w&&(typeof w=="object"||typeof w=="function")){if(y)return h(y,w)}else if(s){if(x)return c(x,w)}else if(v)return m(v,w);return!1},set:function(w,I){n&&w&&(typeof w=="object"||typeof w=="function")?(y||(y=new n),a(y,w,I)):s?(x||(x=new s),u(x,w,I)):(v||(v={key:{},next:null}),p(v,w,I))}};return E},Po}var Io,Ru;function Eh(){if(Ru)return Io;Ru=1;var r=String.prototype.replace,t=/%20/g,e={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Io={default:e.RFC3986,formatters:{RFC1738:function(i){return r.call(i,t,"+")},RFC3986:function(i){return String(i)}},RFC1738:e.RFC1738,RFC3986:e.RFC3986},Io}var Ro,Mu;function Pd(){if(Mu)return Ro;Mu=1;var r=Eh(),t=Object.prototype.hasOwnProperty,e=Array.isArray,i=(function(){for(var g=[],y=0;y<256;++y)g.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return g})(),n=function(y){for(;y.length>1;){var x=y.pop(),v=x.obj[x.prop];if(e(v)){for(var E=[],w=0;w<v.length;++w)typeof v[w]<"u"&&E.push(v[w]);x.obj[x.prop]=E}}},s=function(y,x){for(var v=x&&x.plainObjects?Object.create(null):{},E=0;E<y.length;++E)typeof y[E]<"u"&&(v[E]=y[E]);return v},o=function g(y,x,v){if(!x)return y;if(typeof x!="object"){if(e(y))y.push(x);else if(y&&typeof y=="object")(v&&(v.plainObjects||v.allowPrototypes)||!t.call(Object.prototype,x))&&(y[x]=!0);else return[y,x];return y}if(!y||typeof y!="object")return[y].concat(x);var E=y;return e(y)&&!e(x)&&(E=s(y,v)),e(y)&&e(x)?(x.forEach(function(w,I){if(t.call(y,I)){var T=y[I];T&&typeof T=="object"&&w&&typeof w=="object"?y[I]=g(T,w,v):y.push(w)}else y[I]=w}),y):Object.keys(x).reduce(function(w,I){var T=x[I];return t.call(w,I)?w[I]=g(w[I],T,v):w[I]=T,w},E)},a=function(y,x){return Object.keys(x).reduce(function(v,E){return v[E]=x[E],v},y)},h=function(g,y,x){var v=g.replace(/\+/g," ");if(x==="iso-8859-1")return v.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(v)}catch{return v}},l=1024,u=function(y,x,v,E,w){if(y.length===0)return y;var I=y;if(typeof y=="symbol"?I=Symbol.prototype.toString.call(y):typeof y!="string"&&(I=String(y)),v==="iso-8859-1")return escape(I).replace(/%u[0-9a-f]{4}/gi,function(B){return"%26%23"+parseInt(B.slice(2),16)+"%3B"});for(var T="",F=0;F<I.length;F+=l){for(var U=I.length>=l?I.slice(F,F+l):I,G=[],z=0;z<U.length;++z){var M=U.charCodeAt(z);if(M===45||M===46||M===95||M===126||M>=48&&M<=57||M>=65&&M<=90||M>=97&&M<=122||w===r.RFC1738&&(M===40||M===41)){G[G.length]=U.charAt(z);continue}if(M<128){G[G.length]=i[M];continue}if(M<2048){G[G.length]=i[192|M>>6]+i[128|M&63];continue}if(M<55296||M>=57344){G[G.length]=i[224|M>>12]+i[128|M>>6&63]+i[128|M&63];continue}z+=1,M=65536+((M&1023)<<10|U.charCodeAt(z)&1023),G[G.length]=i[240|M>>18]+i[128|M>>12&63]+i[128|M>>6&63]+i[128|M&63]}T+=G.join("")}return T},c=function(y){for(var x=[{obj:{o:y},prop:"o"}],v=[],E=0;E<x.length;++E)for(var w=x[E],I=w.obj[w.prop],T=Object.keys(I),F=0;F<T.length;++F){var U=T[F],G=I[U];typeof G=="object"&&G!==null&&v.indexOf(G)===-1&&(x.push({obj:I,prop:U}),v.push(G))}return n(x),y},d=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},f=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},p=function(y,x){return[].concat(y,x)},m=function(y,x){if(e(y)){for(var v=[],E=0;E<y.length;E+=1)v.push(x(y[E]));return v}return x(y)};return Ro={arrayToObject:s,assign:a,combine:p,compact:c,decode:h,encode:u,isBuffer:f,isRegExp:d,maybeMap:m,merge:o},Ro}var Mo,Fu;function D1(){if(Fu)return Mo;Fu=1;var r=F1(),t=Pd(),e=Eh(),i=Object.prototype.hasOwnProperty,n={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,y){return g+"["+y+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(m,g){o.apply(m,s(g)?g:[g])},h=Date.prototype.toISOString,l=e.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,format:l,formatter:e.formatters[l],indices:!1,serializeDate:function(g){return h.call(g)},skipNulls:!1,strictNullHandling:!1},c=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},d={},f=function m(g,y,x,v,E,w,I,T,F,U,G,z,M,B,S,N,_,A){for(var b=g,R=A,C=0,P=!1;(R=R.get(d))!==void 0&&!P;){var D=R.get(g);if(C+=1,typeof D<"u"){if(D===C)throw new RangeError("Cyclic object value");P=!0}typeof R.get(d)>"u"&&(C=0)}if(typeof U=="function"?b=U(y,b):b instanceof Date?b=M(b):x==="comma"&&s(b)&&(b=t.maybeMap(b,function(J){return J instanceof Date?M(J):J})),b===null){if(w)return F&&!N?F(y,u.encoder,_,"key",B):y;b=""}if(c(b)||t.isBuffer(b)){if(F){var O=N?y:F(y,u.encoder,_,"key",B);return[S(O)+"="+S(F(b,u.encoder,_,"value",B))]}return[S(y)+"="+S(String(b))]}var H=[];if(typeof b>"u")return H;var $;if(x==="comma"&&s(b))N&&F&&(b=t.maybeMap(b,F)),$=[{value:b.length>0?b.join(",")||null:void 0}];else if(s(U))$=U;else{var Y=Object.keys(b);$=G?Y.sort(G):Y}var W=T?y.replace(/\./g,"%2E"):y,K=v&&s(b)&&b.length===1?W+"[]":W;if(E&&s(b)&&b.length===0)return K+"[]";for(var et=0;et<$.length;++et){var X=$[et],rt=typeof X=="object"&&typeof X.value<"u"?X.value:b[X];if(!(I&&rt===null)){var nt=z&&T?X.replace(/\./g,"%2E"):X,lt=s(b)?typeof x=="function"?x(K,nt):K:K+(z?"."+nt:"["+nt+"]");A.set(g,C);var dt=r();dt.set(d,A),a(H,m(rt,lt,x,v,E,w,I,T,x==="comma"&&N&&s(b)?null:F,U,G,z,M,B,S,N,_,dt))}}return H},p=function(g){if(!g)return u;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=g.charset||u.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var x=e.default;if(typeof g.format<"u"){if(!i.call(e.formatters,g.format))throw new TypeError("Unknown format option provided.");x=g.format}var v=e.formatters[x],E=u.filter;(typeof g.filter=="function"||s(g.filter))&&(E=g.filter);var w;if(g.arrayFormat in n?w=g.arrayFormat:"indices"in g?w=g.indices?"indices":"repeat":w=u.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var I=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:u.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:u.addQueryPrefix,allowDots:I,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:w,charset:y,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:u.charsetSentinel,commaRoundTrip:g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?u.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:u.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:u.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:u.encodeValuesOnly,filter:E,format:x,formatter:v,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:u.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:u.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:u.strictNullHandling}};return Mo=function(m,g){var y=m,x=p(g),v,E;typeof x.filter=="function"?(E=x.filter,y=E("",y)):s(x.filter)&&(E=x.filter,v=E);var w=[];if(typeof y!="object"||y===null)return"";var I=n[x.arrayFormat],T=I==="comma"&&x.commaRoundTrip;v||(v=Object.keys(y)),x.sort&&v.sort(x.sort);for(var F=r(),U=0;U<v.length;++U){var G=v[U];x.skipNulls&&y[G]===null||a(w,f(y[G],G,I,T,x.allowEmptyArrays,x.strictNullHandling,x.skipNulls,x.encodeDotInKeys,x.encode?x.encoder:null,x.filter,x.sort,x.allowDots,x.serializeDate,x.format,x.formatter,x.encodeValuesOnly,x.charset,F))}var z=w.join(x.delimiter),M=x.addQueryPrefix===!0?"?":"";return x.charsetSentinel&&(x.charset==="iso-8859-1"?M+="utf8=%26%2310003%3B&":M+="utf8=%E2%9C%93&"),z.length>0?M+z:""},Mo}var Fo,Du;function B1(){if(Du)return Fo;Du=1;var r=Pd(),t=Object.prototype.hasOwnProperty,e=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:r.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},n=function(d){return d.replace(/&#(\d+);/g,function(f,p){return String.fromCharCode(parseInt(p,10))})},s=function(d,f){return d&&typeof d=="string"&&f.comma&&d.indexOf(",")>-1?d.split(","):d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",h=function(f,p){var m={__proto__:null},g=p.ignoreQueryPrefix?f.replace(/^\?/,""):f;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=p.parameterLimit===1/0?void 0:p.parameterLimit,x=g.split(p.delimiter,y),v=-1,E,w=p.charset;if(p.charsetSentinel)for(E=0;E<x.length;++E)x[E].indexOf("utf8=")===0&&(x[E]===a?w="utf-8":x[E]===o&&(w="iso-8859-1"),v=E,E=x.length);for(E=0;E<x.length;++E)if(E!==v){var I=x[E],T=I.indexOf("]="),F=T===-1?I.indexOf("="):T+1,U,G;F===-1?(U=p.decoder(I,i.decoder,w,"key"),G=p.strictNullHandling?null:""):(U=p.decoder(I.slice(0,F),i.decoder,w,"key"),G=r.maybeMap(s(I.slice(F+1),p),function(M){return p.decoder(M,i.decoder,w,"value")})),G&&p.interpretNumericEntities&&w==="iso-8859-1"&&(G=n(G)),I.indexOf("[]=")>-1&&(G=e(G)?[G]:G);var z=t.call(m,U);z&&p.duplicates==="combine"?m[U]=r.combine(m[U],G):(!z||p.duplicates==="last")&&(m[U]=G)}return m},l=function(d,f,p,m){for(var g=m?f:s(f,p),y=d.length-1;y>=0;--y){var x,v=d[y];if(v==="[]"&&p.parseArrays)x=p.allowEmptyArrays&&(g===""||p.strictNullHandling&&g===null)?[]:[].concat(g);else{x=p.plainObjects?Object.create(null):{};var E=v.charAt(0)==="["&&v.charAt(v.length-1)==="]"?v.slice(1,-1):v,w=p.decodeDotInKeys?E.replace(/%2E/g,"."):E,I=parseInt(w,10);!p.parseArrays&&w===""?x={0:g}:!isNaN(I)&&v!==w&&String(I)===w&&I>=0&&p.parseArrays&&I<=p.arrayLimit?(x=[],x[I]=g):w!=="__proto__"&&(x[w]=g)}g=x}return g},u=function(f,p,m,g){if(f){var y=m.allowDots?f.replace(/\.([^.[]+)/g,"[$1]"):f,x=/(\[[^[\]]*])/,v=/(\[[^[\]]*])/g,E=m.depth>0&&x.exec(y),w=E?y.slice(0,E.index):y,I=[];if(w){if(!m.plainObjects&&t.call(Object.prototype,w)&&!m.allowPrototypes)return;I.push(w)}for(var T=0;m.depth>0&&(E=v.exec(y))!==null&&T<m.depth;){if(T+=1,!m.plainObjects&&t.call(Object.prototype,E[1].slice(1,-1))&&!m.allowPrototypes)return;I.push(E[1])}if(E){if(m.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+m.depth+" and strictDepth is true");I.push("["+y.slice(E.index)+"]")}return l(I,p,m,g)}},c=function(f){if(!f)return i;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.decodeDotInKeys<"u"&&typeof f.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(f.decoder!==null&&typeof f.decoder<"u"&&typeof f.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var p=typeof f.charset>"u"?i.charset:f.charset,m=typeof f.duplicates>"u"?i.duplicates:f.duplicates;if(m!=="combine"&&m!=="first"&&m!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof f.allowDots>"u"?f.decodeDotInKeys===!0?!0:i.allowDots:!!f.allowDots;return{allowDots:g,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:typeof f.allowPrototypes=="boolean"?f.allowPrototypes:i.allowPrototypes,allowSparse:typeof f.allowSparse=="boolean"?f.allowSparse:i.allowSparse,arrayLimit:typeof f.arrayLimit=="number"?f.arrayLimit:i.arrayLimit,charset:p,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:i.charsetSentinel,comma:typeof f.comma=="boolean"?f.comma:i.comma,decodeDotInKeys:typeof f.decodeDotInKeys=="boolean"?f.decodeDotInKeys:i.decodeDotInKeys,decoder:typeof f.decoder=="function"?f.decoder:i.decoder,delimiter:typeof f.delimiter=="string"||r.isRegExp(f.delimiter)?f.delimiter:i.delimiter,depth:typeof f.depth=="number"||f.depth===!1?+f.depth:i.depth,duplicates:m,ignoreQueryPrefix:f.ignoreQueryPrefix===!0,interpretNumericEntities:typeof f.interpretNumericEntities=="boolean"?f.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:typeof f.parameterLimit=="number"?f.parameterLimit:i.parameterLimit,parseArrays:f.parseArrays!==!1,plainObjects:typeof f.plainObjects=="boolean"?f.plainObjects:i.plainObjects,strictDepth:typeof f.strictDepth=="boolean"?!!f.strictDepth:i.strictDepth,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:i.strictNullHandling}};return Fo=function(d,f){var p=c(f);if(d===""||d===null||typeof d>"u")return p.plainObjects?Object.create(null):{};for(var m=typeof d=="string"?h(d,p):d,g=p.plainObjects?Object.create(null):{},y=Object.keys(m),x=0;x<y.length;++x){var v=y[x],E=u(v,m[v],p,typeof d=="string");g=r.merge(g,E,p)}return p.allowSparse===!0?g:r.compact(g)},Fo}var Do,Bu;function O1(){if(Bu)return Do;Bu=1;var r=D1(),t=B1(),e=Eh();return Do={formats:e,parse:t,stringify:r},Do}var Ou;function L1(){if(Ou)return rr;Ou=1;var r=t1();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var e=/^([a-z0-9.+-]+:)/i,i=/:[0-9]*$/,n=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),h=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,c=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=O1();function y(w,I,T){if(w&&typeof w=="object"&&w instanceof t)return w;var F=new t;return F.parse(w,I,T),F}t.prototype.parse=function(w,I,T){if(typeof w!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof w);var F=w.indexOf("?"),U=F!==-1&&F<w.indexOf("#")?"?":"#",G=w.split(U),z=/\\/g;G[0]=G[0].replace(z,"/"),w=G.join(U);var M=w;if(M=M.trim(),!T&&w.split("#").length===1){var B=n.exec(M);if(B)return this.path=M,this.href=M,this.pathname=B[1],B[2]?(this.search=B[2],I?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):I&&(this.search="",this.query={}),this}var S=e.exec(M);if(S){S=S[0];var N=S.toLowerCase();this.protocol=N,M=M.substr(S.length)}if(T||S||M.match(/^\/\/[^@/]+@[^@/]+/)){var _=M.substr(0,2)==="//";_&&!(S&&p[S])&&(M=M.substr(2),this.slashes=!0)}if(!p[S]&&(_||S&&!m[S])){for(var A=-1,b=0;b<l.length;b++){var R=M.indexOf(l[b]);R!==-1&&(A===-1||R<A)&&(A=R)}var C,P;A===-1?P=M.lastIndexOf("@"):P=M.lastIndexOf("@",A),P!==-1&&(C=M.slice(0,P),M=M.slice(P+1),this.auth=decodeURIComponent(C)),A=-1;for(var b=0;b<h.length;b++){var R=M.indexOf(h[b]);R!==-1&&(A===-1||R<A)&&(A=R)}A===-1&&(A=M.length),this.host=M.slice(0,A),M=M.slice(A),this.parseHost(),this.hostname=this.hostname||"";var D=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!D)for(var O=this.hostname.split(/\./),b=0,H=O.length;b<H;b++){var $=O[b];if($&&!$.match(c)){for(var Y="",W=0,K=$.length;W<K;W++)$.charCodeAt(W)>127?Y+="x":Y+=$[W];if(!Y.match(c)){var et=O.slice(0,b),X=O.slice(b+1),rt=$.match(d);rt&&(et.push(rt[1]),X.unshift(rt[2])),X.length&&(M="/"+X.join(".")+M),this.hostname=et.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),D||(this.hostname=r.toASCII(this.hostname));var nt=this.port?":"+this.port:"",lt=this.hostname||"";this.host=lt+nt,this.href+=this.host,D&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),M[0]!=="/"&&(M="/"+M))}if(!f[N])for(var b=0,H=a.length;b<H;b++){var dt=a[b];if(M.indexOf(dt)!==-1){var J=encodeURIComponent(dt);J===dt&&(J=escape(dt)),M=M.split(dt).join(J)}}var st=M.indexOf("#");st!==-1&&(this.hash=M.substr(st),M=M.slice(0,st));var It=M.indexOf("?");if(It!==-1?(this.search=M.substr(It),this.query=M.substr(It+1),I&&(this.query=g.parse(this.query)),M=M.slice(0,It)):I&&(this.search="",this.query={}),M&&(this.pathname=M),m[N]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var nt=this.pathname||"",Ht=this.search||"";this.path=nt+Ht}return this.href=this.format(),this};function x(w){return typeof w=="string"&&(w=y(w)),w instanceof t?w.format():t.prototype.format.call(w)}t.prototype.format=function(){var w=this.auth||"";w&&(w=encodeURIComponent(w),w=w.replace(/%3A/i,":"),w+="@");var I=this.protocol||"",T=this.pathname||"",F=this.hash||"",U=!1,G="";this.host?U=w+this.host:this.hostname&&(U=w+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(U+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(G=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var z=this.search||G&&"?"+G||"";return I&&I.substr(-1)!==":"&&(I+=":"),this.slashes||(!I||m[I])&&U!==!1?(U="//"+(U||""),T&&T.charAt(0)!=="/"&&(T="/"+T)):U||(U=""),F&&F.charAt(0)!=="#"&&(F="#"+F),z&&z.charAt(0)!=="?"&&(z="?"+z),T=T.replace(/[?#]/g,function(M){return encodeURIComponent(M)}),z=z.replace("#","%23"),I+U+T+z+F};function v(w,I){return y(w,!1,!0).resolve(I)}t.prototype.resolve=function(w){return this.resolveObject(y(w,!1,!0)).format()};function E(w,I){return w?y(w,!1,!0).resolveObject(I):I}return t.prototype.resolveObject=function(w){if(typeof w=="string"){var I=new t;I.parse(w,!1,!0),w=I}for(var T=new t,F=Object.keys(this),U=0;U<F.length;U++){var G=F[U];T[G]=this[G]}if(T.hash=w.hash,w.href==="")return T.href=T.format(),T;if(w.slashes&&!w.protocol){for(var z=Object.keys(w),M=0;M<z.length;M++){var B=z[M];B!=="protocol"&&(T[B]=w[B])}return m[T.protocol]&&T.hostname&&!T.pathname&&(T.pathname="/",T.path=T.pathname),T.href=T.format(),T}if(w.protocol&&w.protocol!==T.protocol){if(!m[w.protocol]){for(var S=Object.keys(w),N=0;N<S.length;N++){var _=S[N];T[_]=w[_]}return T.href=T.format(),T}if(T.protocol=w.protocol,!w.host&&!p[w.protocol]){for(var H=(w.pathname||"").split("/");H.length&&!(w.host=H.shift()););w.host||(w.host=""),w.hostname||(w.hostname=""),H[0]!==""&&H.unshift(""),H.length<2&&H.unshift(""),T.pathname=H.join("/")}else T.pathname=w.pathname;if(T.search=w.search,T.query=w.query,T.host=w.host||"",T.auth=w.auth,T.hostname=w.hostname||w.host,T.port=w.port,T.pathname||T.search){var A=T.pathname||"",b=T.search||"";T.path=A+b}return T.slashes=T.slashes||w.slashes,T.href=T.format(),T}var R=T.pathname&&T.pathname.charAt(0)==="/",C=w.host||w.pathname&&w.pathname.charAt(0)==="/",P=C||R||T.host&&w.pathname,D=P,O=T.pathname&&T.pathname.split("/")||[],H=w.pathname&&w.pathname.split("/")||[],$=T.protocol&&!m[T.protocol];if($&&(T.hostname="",T.port=null,T.host&&(O[0]===""?O[0]=T.host:O.unshift(T.host)),T.host="",w.protocol&&(w.hostname=null,w.port=null,w.host&&(H[0]===""?H[0]=w.host:H.unshift(w.host)),w.host=null),P=P&&(H[0]===""||O[0]==="")),C)T.host=w.host||w.host===""?w.host:T.host,T.hostname=w.hostname||w.hostname===""?w.hostname:T.hostname,T.search=w.search,T.query=w.query,O=H;else if(H.length)O||(O=[]),O.pop(),O=O.concat(H),T.search=w.search,T.query=w.query;else if(w.search!=null){if($){T.host=O.shift(),T.hostname=T.host;var Y=T.host&&T.host.indexOf("@")>0?T.host.split("@"):!1;Y&&(T.auth=Y.shift(),T.hostname=Y.shift(),T.host=T.hostname)}return T.search=w.search,T.query=w.query,(T.pathname!==null||T.search!==null)&&(T.path=(T.pathname?T.pathname:"")+(T.search?T.search:"")),T.href=T.format(),T}if(!O.length)return T.pathname=null,T.search?T.path="/"+T.search:T.path=null,T.href=T.format(),T;for(var W=O.slice(-1)[0],K=(T.host||w.host||O.length>1)&&(W==="."||W==="..")||W==="",et=0,X=O.length;X>=0;X--)W=O[X],W==="."?O.splice(X,1):W===".."?(O.splice(X,1),et++):et&&(O.splice(X,1),et--);if(!P&&!D)for(;et--;et)O.unshift("..");P&&O[0]!==""&&(!O[0]||O[0].charAt(0)!=="/")&&O.unshift(""),K&&O.join("/").substr(-1)!=="/"&&O.push("");var rt=O[0]===""||O[0]&&O[0].charAt(0)==="/";if($){T.hostname=rt?"":O.length?O.shift():"",T.host=T.hostname;var Y=T.host&&T.host.indexOf("@")>0?T.host.split("@"):!1;Y&&(T.auth=Y.shift(),T.hostname=Y.shift(),T.host=T.hostname)}return P=P||T.host&&O.length,P&&!rt&&O.unshift(""),O.length>0?T.pathname=O.join("/"):(T.pathname=null,T.path=null),(T.pathname!==null||T.search!==null)&&(T.path=(T.pathname?T.pathname:"")+(T.search?T.search:"")),T.auth=w.auth||T.auth,T.slashes=T.slashes||w.slashes,T.href=T.format(),T},t.prototype.parseHost=function(){var w=this.host,I=i.exec(w);I&&(I=I[0],I!==":"&&(this.port=I.substr(1)),w=w.substr(0,w.length-I.length)),w&&(this.hostname=w)},rr.parse=y,rr.resolve=v,rr.resolveObject=E,rr.format=x,rr.Url=t,rr}L1();const Lu={};function pt(r,t,e=3){if(Lu[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`),console.warn(i))),Lu[t]=!0}function Yt(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function ai(r){return r.split("?")[0].split("#")[0]}function N1(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function k1(r,t,e){return r.replace(new RegExp(N1(t),"g"),e)}function U1(r,t){let e="",i=0,n=-1,s=0,o=-1;for(let a=0;a<=r.length;++a){if(a<r.length)o=r.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),n=a,s=0;continue}}else if(e.length===2||e.length===1){e="",i=0,n=a,s=0;continue}}}else e.length>0?e+=`/${r.slice(n+1,a)}`:e=r.slice(n+1,a),i=a-n-1;n=a,s=0}else o===46&&s!==-1?++s:s=-1}return e}const Pt={toPosix(r){return k1(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){Yt(r),r=this.toPosix(r);const t=/^file:\/\/\//.exec(r);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(r);return e?e[0]:""},toAbsolute(r,t,e){if(Yt(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;const i=ai(this.toPosix(t??Q.ADAPTER.getBaseUrl())),n=ai(this.toPosix(e??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?Pt.join(n,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(Yt(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let t="";const e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));const i=r.endsWith("/");return r=U1(r),r.length>0&&i&&(r+="/"),e?`/${r}`:t+r},isAbsolute(r){return Yt(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let t;for(let e=0;e<r.length;++e){const i=r[e];if(Yt(i),i.length>0)if(t===void 0)t=i;else{const n=r[e-1]??"";this.extname(n)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(r){if(Yt(r),r.length===0)return".";r=this.toPosix(r);let t=r.charCodeAt(0);const e=t===47;let i=-1,n=!0;const s=this.getProtocol(r),o=r;r=r.slice(s.length);for(let a=r.length-1;a>=1;--a)if(t=r.charCodeAt(a),t===47){if(!n){i=a;break}}else n=!1;return i===-1?e?"/":this.isUrl(o)?s+r:s:e&&i===1?"//":s+r.slice(0,i)},rootname(r){Yt(r),r=this.toPosix(r);let t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){const e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/")}return t},basename(r,t){Yt(r),t&&Yt(t),r=ai(this.toPosix(r));let e=0,i=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";let o=t.length-1,a=-1;for(s=r.length-1;s>=0;--s){const h=r.charCodeAt(s);if(h===47){if(!n){e=s+1;break}}else a===-1&&(n=!1,a=s+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(i=s):(o=-1,i=a))}return e===i?i=a:i===-1&&(i=r.length),r.slice(e,i)}for(s=r.length-1;s>=0;--s)if(r.charCodeAt(s)===47){if(!n){e=s+1;break}}else i===-1&&(n=!1,i=s+1);return i===-1?"":r.slice(e,i)},extname(r){Yt(r),r=ai(this.toPosix(r));let t=-1,e=0,i=-1,n=!0,s=0;for(let o=r.length-1;o>=0;--o){const a=r.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}i===-1&&(n=!1,i=o+1),a===46?t===-1?t=o:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===e+1?"":r.slice(t,i)},parse(r){Yt(r);const t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=ai(this.toPosix(r));let e=r.charCodeAt(0);const i=this.isAbsolute(r);let n;t.root=this.rootname(r),i||this.hasProtocol(r)?n=1:n=0;let s=-1,o=0,a=-1,h=!0,l=r.length-1,u=0;for(;l>=n;--l){if(e=r.charCodeAt(l),e===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),e===46?s===-1?s=l:u!==1&&(u=1):s!==-1&&(u=-1)}return s===-1||a===-1||u===0||u===1&&s===a-1&&s===o+1?a!==-1&&(o===0&&i?t.base=t.name=r.slice(1,a):t.base=t.name=r.slice(o,a)):(o===0&&i?(t.name=r.slice(1,s),t.base=r.slice(1,a)):(t.name=r.slice(o,s),t.base=r.slice(o,a)),t.ext=r.slice(s,a)),t.dir=this.dirname(r),t},sep:"/",delimiter:":"};let Bo;async function G1(){return Bo??(Bo=(async()=>{var s;const r=document.createElement("canvas").getContext("webgl");if(!r)return Ft.UNPACK;const t=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!t)return Ft.UNPACK;const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);const i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);const n=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,n),r.deleteFramebuffer(i),r.deleteTexture(e),(s=r.getExtension("WEBGL_lose_context"))==null||s.loseContext(),n[0]<=n[3]?Ft.PMA:Ft.UNPACK})()),Bo}let Oo;function H1(){return typeof Oo>"u"&&(Oo=(function(){var t;const r={stencil:!0,failIfMajorPerformanceCaveat:Q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Q.ADAPTER.getWebGLRenderingContext())return!1;const e=Q.ADAPTER.createCanvas();let i=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);const n=!!((t=i==null?void 0:i.getContextAttributes())!=null&&t.stencil);if(i){const s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,n}catch{return!1}})()),Oo}var z1={grad:.9,turn:360,rad:360/(2*Math.PI)},Te=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Et=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0},Xt=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t},Id=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},Nu=function(r){return{r:Xt(r.r,0,255),g:Xt(r.g,0,255),b:Xt(r.b,0,255),a:Xt(r.a)}},Lo=function(r){return{r:Et(r.r),g:Et(r.g),b:Et(r.b),a:Et(r.a,3)}},$1=/^#([0-9a-f]{3,8})$/i,qi=function(r){var t=r.toString(16);return t.length<2?"0"+t:t},Rd=function(r){var t=r.r,e=r.g,i=r.b,n=r.a,s=Math.max(t,e,i),o=s-Math.min(t,e,i),a=o?s===t?(e-i)/o:s===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:n}},Md=function(r){var t=r.h,e=r.s,i=r.v,n=r.a;t=t/360*6,e/=100,i/=100;var s=Math.floor(t),o=i*(1-e),a=i*(1-(t-s)*e),h=i*(1-(1-t+s)*e),l=s%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:n}},ku=function(r){return{h:Id(r.h),s:Xt(r.s,0,100),l:Xt(r.l,0,100),a:Xt(r.a)}},Uu=function(r){return{h:Et(r.h),s:Et(r.s),l:Et(r.l),a:Et(r.a,3)}},Gu=function(r){return Md((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},wi=function(r){return{h:(t=Rd(r)).h,s:(n=(200-(e=t.s))*(i=t.v)/100)>0&&n<200?e*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,i,n},V1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,X1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,W1=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,j1=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ea={string:[[function(r){var t=$1.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Et(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Et(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var t=W1.exec(r)||j1.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:Nu({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(r){var t=V1.exec(r)||X1.exec(r);if(!t)return null;var e,i,n=ku({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(z1[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Gu(n)},"hsl"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,n=r.a,s=n===void 0?1:n;return Te(t)&&Te(e)&&Te(i)?Nu({r:Number(t),g:Number(e),b:Number(i),a:Number(s)}):null},"rgb"],[function(r){var t=r.h,e=r.s,i=r.l,n=r.a,s=n===void 0?1:n;if(!Te(t)||!Te(e)||!Te(i))return null;var o=ku({h:Number(t),s:Number(e),l:Number(i),a:Number(s)});return Gu(o)},"hsl"],[function(r){var t=r.h,e=r.s,i=r.v,n=r.a,s=n===void 0?1:n;if(!Te(t)||!Te(e)||!Te(i))return null;var o=(function(a){return{h:Id(a.h),s:Xt(a.s,0,100),v:Xt(a.v,0,100),a:Xt(a.a)}})({h:Number(t),s:Number(e),v:Number(i),a:Number(s)});return Md(o)},"hsv"]]},Hu=function(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]]}return[null,void 0]},q1=function(r){return typeof r=="string"?Hu(r.trim(),Ea.string):typeof r=="object"&&r!==null?Hu(r,Ea.object):[null,void 0]},No=function(r,t){var e=wi(r);return{h:e.h,s:Xt(e.s+100*t,0,100),l:e.l,a:e.a}},ko=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},zu=function(r,t){var e=wi(r);return{h:e.h,s:e.s,l:Xt(e.l+100*t,0,100),a:e.a}},Sa=(function(){function r(t){this.parsed=q1(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Et(ko(this.rgba),2)},r.prototype.isDark=function(){return ko(this.rgba)<.5},r.prototype.isLight=function(){return ko(this.rgba)>=.5},r.prototype.toHex=function(){return t=Lo(this.rgba),e=t.r,i=t.g,n=t.b,o=(s=t.a)<1?qi(Et(255*s)):"","#"+qi(e)+qi(i)+qi(n)+o;var t,e,i,n,s,o},r.prototype.toRgb=function(){return Lo(this.rgba)},r.prototype.toRgbString=function(){return t=Lo(this.rgba),e=t.r,i=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+i+", "+n+", "+s+")":"rgb("+e+", "+i+", "+n+")";var t,e,i,n,s},r.prototype.toHsl=function(){return Uu(wi(this.rgba))},r.prototype.toHslString=function(){return t=Uu(wi(this.rgba)),e=t.h,i=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+i+"%, "+n+"%, "+s+")":"hsl("+e+", "+i+"%, "+n+"%)";var t,e,i,n,s},r.prototype.toHsv=function(){return t=Rd(this.rgba),{h:Et(t.h),s:Et(t.s),v:Et(t.v),a:Et(t.a,3)};var t},r.prototype.invert=function(){return oe({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},r.prototype.saturate=function(t){return t===void 0&&(t=.1),oe(No(this.rgba,t))},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),oe(No(this.rgba,-t))},r.prototype.grayscale=function(){return oe(No(this.rgba,-1))},r.prototype.lighten=function(t){return t===void 0&&(t=.1),oe(zu(this.rgba,t))},r.prototype.darken=function(t){return t===void 0&&(t=.1),oe(zu(this.rgba,-t))},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},r.prototype.alpha=function(t){return typeof t=="number"?oe({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Et(this.rgba.a,3);var e},r.prototype.hue=function(t){var e=wi(this.rgba);return typeof t=="number"?oe({h:t,s:e.s,l:e.l,a:e.a}):Et(e.h)},r.prototype.isEqual=function(t){return this.toHex()===oe(t).toHex()},r})(),oe=function(r){return r instanceof Sa?r:new Sa(r)},$u=[],Y1=function(r){r.forEach(function(t){$u.indexOf(t)<0&&(t(Sa,Ea),$u.push(t))})};function K1(r,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in e)i[e[n]]=n;var s={};r.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=i[this.toHex()];if(l)return l;if(o!=null&&o.closest){var u=this.toRgb(),c=1/0,d="black";if(!s.length)for(var f in e)s[f]=new r(e[f]).toRgb();for(var p in e){var m=(a=u,h=s[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<c&&(c=m,d=p)}return d}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new r(h).toRgb():null},"name"])}Y1([K1]);const Mr=class xn{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof xn)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,s)=>n===e[s]);if(t!==null&&e!==null){const n=Object.keys(t),s=Object.keys(e);return n.length!==s.length?!1:n.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,i,n]=this._components;return{r:t,g:e,b:i,a:n}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,n]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(n*255),t}toRgbArray(t){t=t??[];const[e,i,n]=this._components;return t[0]=e,t[1]=i,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,n,s]=xn.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=n,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,n=this._int>>8&255,s=this._int&255;return e&&(i=i*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(t*255<<24)+(i<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,n,s]=this._components;return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t}normalize(t){let e,i,n,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,n=(o&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,n,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,n,s=255]=t,e/=255,i/=255,n/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=xn.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=oe(t);o.isValid()&&({r:e,g:i,b:n,a:s}=o.rgba,e/=255,i/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=n,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((n,s)=>{t[s]=Math.min(Math.max(n,e),i)}),t)}};Mr.shared=new Mr,Mr.temp=new Mr,Mr.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let _t=Mr;function Z1(r){return pt("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),_t.shared.setValue(r).toHex()}function Q1(r){return pt("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),_t.shared.setValue(r).toNumber()}function J1(){const r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[at.NORMAL_NPM]=at.NORMAL,r[at.ADD_NPM]=at.ADD,r[at.SCREEN_NPM]=at.SCREEN,t[at.NORMAL]=at.NORMAL_NPM,t[at.ADD]=at.ADD_NPM,t[at.SCREEN]=at.SCREEN_NPM;const e=[];return e.push(t),e.push(r),e}const Fd=J1();function Dd(r,t){return Fd[t?1:0][r]}function tv(r,t=null){const e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,n=0;i<e;i+=6,n+=4)t[i+0]=n+0,t[i+1]=n+1,t[i+2]=n+2,t[i+3]=n+0,t[i+4]=n+2,t[i+5]=n+3;return t}function Bd(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function zn(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Vu(r){return!(r&r-1)&&!!r}function Xu(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function $r(r,t,e){const i=r.length;let n;if(t>=i||e===0)return;e=t+e>i?i-t:e;const s=i-e;for(n=t;n<s;++n)r[n]=r[n+e];r.length=s}function He(r){return r===0?0:r<0?-1:1}let ev=0;function _r(){return++ev}const Ca=class{constructor(r,t,e,i){this.left=r,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Ca.EMPTY=new Ca(0,0,0,0);let Wu=Ca;const ju={},ae=Object.create(null),Oe=Object.create(null);class rv{constructor(t,e,i){this._canvas=Q.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||Q.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function qu(r,t,e){for(let i=0,n=4*e*t;i<t;++i,n+=4)if(r[n+3]!==0)return!1;return!0}function Yu(r,t,e,i,n){const s=4*t;for(let o=i,a=i*s+4*e;o<=n;++o,a+=s)if(r[a+3]!==0)return!1;return!0}function iv(r){const{width:t,height:e}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const n=i.getImageData(0,0,t,e).data;let s=0,o=0,a=t-1,h=e-1;for(;o<e&&qu(n,t,o);)++o;if(o===e)return Wu.EMPTY;for(;qu(n,t,h);)--h;for(;Yu(n,t,s,o,h);)++s;for(;Yu(n,t,a,o,h);)--a;return++a,++h,new Wu(s,o,a,h)}function nv(r){const t=iv(r),{width:e,height:i}=t;let n=null;if(!t.isEmpty()){const s=r.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:n}}function sv(r,t=globalThis.location){if(r.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Me(r,t=1){var i;const e=(i=Q.RETINA_PREFIX)==null?void 0:i.exec(r);return e?parseFloat(e[1]):t}var q=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(q||{});const Pa=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},Ku=(r,t)=>Pa(r).priority??t,tt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(Pa).forEach(t=>{t.type.forEach(e=>{var i,n;return(n=(i=this._removeHandlers)[e])==null?void 0:n.call(i,t)})}),this},add(...r){return r.map(Pa).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,n=this._queue;i[e]?i[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(r,t,e){const i=this._addHandlers,n=this._removeHandlers;if(i[r]||n[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=t,n[r]=e;const s=this._queue;return s[r]&&(s[r].forEach(o=>t(o)),delete s[r]),this},handleByMap(r,t){return this.handle(r,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(r,t,e=-1){return this.handle(r,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((n,s)=>Ku(s,e)-Ku(n,e)))},i=>{const n=t.indexOf(i.ref);n!==-1&&t.splice(n,1)})}};class Ia{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const ov=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function av(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function hv(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=ov.replace(/%forloop%/gi,av(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}const Uo=0,Go=1,Ho=2,zo=3,$o=4,Vo=5;class xe{constructor(){this.data=0,this.blendMode=at.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Uo)}set blend(t){!!(this.data&1<<Uo)!==t&&(this.data^=1<<Uo)}get offsets(){return!!(this.data&1<<Go)}set offsets(t){!!(this.data&1<<Go)!==t&&(this.data^=1<<Go)}get culling(){return!!(this.data&1<<Ho)}set culling(t){!!(this.data&1<<Ho)!==t&&(this.data^=1<<Ho)}get depthTest(){return!!(this.data&1<<zo)}set depthTest(t){!!(this.data&1<<zo)!==t&&(this.data^=1<<zo)}get depthMask(){return!!(this.data&1<<Vo)}set depthMask(t){!!(this.data&1<<Vo)!==t&&(this.data^=1<<Vo)}get clockwiseFrontFace(){return!!(this.data&1<<$o)}set clockwiseFrontFace(t){!!(this.data&1<<$o)!==t&&(this.data^=1<<$o)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==at.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new xe;return t.depthTest=!1,t.blend=!0,t}}xe.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Ra=[];function Od(r,t){if(!r)return null;let e="";if(typeof r=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=Ra.length-1;i>=0;--i){const n=Ra[i];if(n.test&&n.test(r,e))return new n(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class re{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,n,s,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](t,e,i,n,s,o,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(re.prototype,{dispatch:{value:re.prototype.emit},run:{value:re.prototype.emit}});class Pi{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new re("setRealSize"),this.onUpdate=new re("update"),this.onError=new re("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class ls extends Pi{constructor(t,e){const{width:i,height:n}=e||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ft.UNPACK);const s=e.realWidth,o=e.realHeight;return i.width===s&&i.height===o?n.texSubImage2D(e.target,0,0,0,s,o,e.format,i.type,this.data):(i.width=s,i.height=o,n.texImage2D(e.target,0,i.internalFormat,s,o,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const lv={scaleMode:fe.NEAREST,alphaMode:Ft.NPM},Ma=class Fr extends Mi{constructor(t=null,e=null){super(),e=Object.assign({},Fr.defaultOptions,e);const{alphaMode:i,mipmap:n,anisotropicLevel:s,scaleMode:o,width:a,height:h,wrapMode:l,format:u,type:c,target:d,resolution:f,resourceOptions:p}=e;t&&!(t instanceof Pi)&&(t=Od(t,p),t.internal=!0),this.resolution=f||Q.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=o,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=_r(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Vu(this.realWidth)&&Vu(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Oe[this.cacheId],delete ae[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Fr.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=Q.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${_r()}`}s=t._pixiId}let o=Oe[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new Fr(t,e),o.cacheId=s,Fr.addToCache(o,s)),o}static fromBuffer(t,e,i,n){t=t||new Float32Array(e*i*4);const s=new ls(t,{width:e,height:i,...n==null?void 0:n.resourceOptions});let o,a;return t instanceof Float32Array?(o=V.RGBA,a=ot.FLOAT):t instanceof Int32Array?(o=V.RGBA_INTEGER,a=ot.INT):t instanceof Uint32Array?(o=V.RGBA_INTEGER,a=ot.UNSIGNED_INT):t instanceof Int16Array?(o=V.RGBA_INTEGER,a=ot.SHORT):t instanceof Uint16Array?(o=V.RGBA_INTEGER,a=ot.UNSIGNED_SHORT):t instanceof Int8Array?(o=V.RGBA,a=ot.BYTE):(o=V.RGBA,a=ot.UNSIGNED_BYTE),s.internal=!0,new Fr(s,Object.assign({},lv,{type:a,format:o},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Oe[e]&&Oe[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Oe[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Oe[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Oe[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Oe[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Ma.defaultOptions={mipmap:ye.POW2,anisotropicLevel:0,scaleMode:fe.LINEAR,wrapMode:kt.CLAMP,alphaMode:Ft.UNPACK,target:zr.TEXTURE_2D,format:V.RGBA,type:ot.UNSIGNED_BYTE},Ma._globalBatch=0;let ut=Ma;class Fa{constructor(){this.texArray=null,this.blend=0,this.type=de.TRIANGLES,this.start=0,this.size=0,this.data=null}}let uv=0;class wt{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=uv++,this.disposeRunner=new re("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?me.ELEMENT_ARRAY_BUFFER:me.ARRAY_BUFFER}get index(){return this.type===me.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new wt(t)}}class $n{constructor(t,e=0,i=!1,n=ot.FLOAT,s,o,a,h=1){this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=s,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,i,n,s){return new $n(t,e,i,n,s)}}const cv={Float32Array,Uint32Array,Int32Array,Uint8Array};function dv(r,t){let e=0,i=0;const n={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;const s=new ArrayBuffer(e*4);let o=null,a=0;for(let h=0;h<r.length;h++){const l=t[h],u=r[h],c=Bd(u);n[c]||(n[c]=new cv[c](s)),o=n[c];for(let d=0;d<u.length;d++){const f=(d/l|0)*i+a,p=d%l;o[f+p]=u[d]}a+=l}return new Float32Array(s)}const Zu={5126:4,5123:2,5121:1};let fv=0;const pv={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Xe{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=fv++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new re("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,n=!1,s,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof wt||(e instanceof Array&&(e=new Float32Array(e)),e=new wt(e));const l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,i,n,s);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new $n(u,i,n,s,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof wt||(t instanceof Array&&(t=new Uint16Array(t)),t=new wt(t)),t.type=me.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],i=new wt;let n;for(n in this.attributes){const s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),e.push(s.size*Zu[s.type]/4),s.buffer=0}for(i.data=dv(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Xe;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new wt(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new $n(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=me.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Xe,i=[],n=[],s=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)n[h]=n[h]||0,n[h]+=o.buffers[h].data.length,s[h]=0}for(let a=0;a<o.buffers.length;a++)i[a]=new pv[Bd(o.buffers[a].data)](n[a]),e.buffers[a]=new wt(i[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)i[h].set(o.buffers[h].data,s[h]),s[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=me.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let c=0;c<o.buffers.length;c++)if(o.buffers[c]!==o.indexBuffer){u=c;break}for(const c in o.attributes){const d=o.attributes[c];(d.buffer|0)===u&&(h+=d.size*Zu[d.type]/4)}for(let c=0;c<t.length;c++){const d=t[c].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[c].buffers[u].data.length/h,l+=d.length}}return e}}class Ld extends Xe{constructor(t=!1){super(),this._buffer=new wt(null,t,!1),this._indexBuffer=new wt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ot.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ot.FLOAT).addAttribute("aColor",this._buffer,4,!0,ot.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ot.FLOAT).addIndex(this._indexBuffer)}}const Vn=Math.PI*2,mv=180/Math.PI,gv=Math.PI/180;var St=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(St||{});class ct{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ct(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}ct.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Yi=[new ct,new ct,new ct,new ct];class ht{constructor(t=0,e=0,i=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=St.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new ht(0,0,0,0)}clone(){return new ht(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const F=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=F)return!1;const U=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>U}const i=this.left,n=this.right,s=this.top,o=this.bottom;if(n<=i||o<=s)return!1;const a=Yi[0].set(t.left,t.top),h=Yi[1].set(t.left,t.bottom),l=Yi[2].set(t.right,t.top),u=Yi[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=i||Math.min(a.x,h.x,l.x,u.x)>=n||Math.max(a.y,h.y,l.y,u.y)<=s||Math.min(a.y,h.y,l.y,u.y)>=o))return!1;const d=c*(h.y-a.y),f=c*(a.x-h.x),p=d*i+f*s,m=d*n+f*s,g=d*i+f*o,y=d*n+f*o;if(Math.max(p,m,g,y)<=d*a.x+f*a.y||Math.min(p,m,g,y)>=d*u.x+f*u.y)return!1;const x=c*(a.y-l.y),v=c*(l.x-a.x),E=x*i+v*s,w=x*n+v*s,I=x*i+v*o,T=x*n+v*o;return!(Math.max(E,w,I,T)<=x*a.x+v*a.y||Math.min(E,w,I,T)>=x*u.x+v*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=s-n,this}}ht.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class us{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=St.CIRC}clone(){return new us(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=i}getBounds(){return new ht(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}us.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class cs{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n,this.type=St.ELIP}clone(){return new cs(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new ht(this.x-this.width,this.y-this.height,this.width,this.height)}}cs.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class gr{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let n=0,s=e.length;n<s;n++)i.push(e[n].x,e[n].y);e=i}this.points=e,this.type=St.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new gr(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let s=0,o=n-1;s<n;o=s++){const a=this.points[s*2],h=this.points[s*2+1],l=this.points[o*2],u=this.points[o*2+1];h>e!=u>e&&t<(l-a)*((e-h)/(u-h))+a&&(i=!i)}return i}}gr.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,t)=>`${r}, ${t}`,"")}]`};class ds{constructor(t=0,e=0,i=0,n=0,s=20){this.x=t,this.y=e,this.width=i,this.height=n,this.radius=s,this.type=St.RREC}clone(){return new ds(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),s=e-(this.y+i);const o=i*i;if(n*n+s*s<=o||(n=t-(this.x+this.width-i),n*n+s*s<=o)||(s=e-(this.y+this.height-i),n*n+s*s<=o)||(n=t-(this.x+i),n*n+s*s<=o))return!0}return!1}}ds.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class vt{constructor(t=1,e=0,i=0,n=1,s=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,n,s,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new ct;const i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new ct;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this}setTransform(t,e,i,n,s,o,a,h,l){return this.a=Math.cos(a+l)*s,this.b=Math.sin(a+l)*s,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,n=this.c,s=this.d,o=t.pivot,a=-Math.atan2(-n,s),h=Math.atan2(i,e),l=Math.abs(a+h);return l<1e-5||Math.abs(Vn-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*i+o.y*s),t}invert(){const t=this.a,e=this.b,i=this.c,n=this.d,s=this.tx,o=t*n-e*i;return this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*s)/o,this.ty=-(t*this.ty-e*s)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new vt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new vt}static get TEMP_MATRIX(){return new vt}}vt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const or=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ar=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],hr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],lr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Da=[],Nd=[],Ki=Math.sign;function yv(){for(let r=0;r<16;r++){const t=[];Da.push(t);for(let e=0;e<16;e++){const i=Ki(or[r]*or[e]+hr[r]*ar[e]),n=Ki(ar[r]*or[e]+lr[r]*ar[e]),s=Ki(or[r]*hr[e]+hr[r]*lr[e]),o=Ki(ar[r]*hr[e]+lr[r]*lr[e]);for(let a=0;a<16;a++)if(or[a]===i&&ar[a]===n&&hr[a]===s&&lr[a]===o){t.push(a);break}}}for(let r=0;r<16;r++){const t=new vt;t.set(or[r],ar[r],hr[r],lr[r],0,0),Nd.push(t)}}yv();const yt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>or[r],uY:r=>ar[r],vX:r=>hr[r],vY:r=>lr[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>Da[r][t],sub:(r,t)=>Da[r][yt.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?yt.S:yt.N:Math.abs(t)*2<=Math.abs(r)?r>0?yt.E:yt.W:t>0?r>0?yt.SE:yt.SW:r>0?yt.NE:yt.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{const n=Nd[yt.inv(t)];n.tx=e,n.ty=i,r.append(n)}};class Pe{constructor(t,e,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Pe(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}Pe.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Ba=class{constructor(){this.worldTransform=new vt,this.localTransform=new vt,this.position=new Pe(this.onChange,this,0,0),this.scale=new Pe(this.onChange,this,1,1),this.pivot=new Pe(this.onChange,this,0,0),this.skew=new Pe(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};Ba.IDENTITY=new Ba;let Sh=Ba;Sh.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var vv=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,_v=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Qu(r,t,e){const i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function Xo(r){const t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function kd(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Xo(2*t);case"bvec3":return Xo(3*t);case"bvec4":return Xo(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Vr=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,t)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,t)=>r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,t)=>r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,t)=>r.type==="vec3"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}],xv={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},bv={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function wv(r,t){var i;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in r.uniforms){const s=t[n];if(!s){((i=r.uniforms[n])==null?void 0:i.group)===!0&&(r.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const o=r.uniforms[n];let a=!1;for(let h=0;h<Vr.length;h++)if(Vr[h].test(s,o)){e.push(Vr[h].code(n,o)),a=!0;break}if(!a){const h=(s.size===1&&!s.isArray?xv:bv)[s.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const Ud={};let Ir=Ud;function Tv(){if(Ir===Ud||Ir!=null&&Ir.isContextLost()){const r=Q.ADAPTER.createCanvas();let t;Q.PREFER_ENV>=br.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Ir=t}return Ir}let Zi;function Av(){if(!Zi){Zi=Vt.MEDIUM;const r=Tv();r&&r.getShaderPrecisionFormat&&(Zi=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision?Vt.HIGH:Vt.MEDIUM)}return Zi}function Ju(r,t){const e=r.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),i=r.getShaderInfoLog(t),n=i.split(`
`),s={},o=n.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!s[l]?(s[l]=!0,!0):!1),a=[""];o.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Ev(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||Ju(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||Ju(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}const Sv={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Gd(r){return Sv[r]}let Qi=null;const tc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Hd(r,t){if(!Qi){const e=Object.keys(tc);Qi={};for(let i=0;i<e.length;++i){const n=e[i];Qi[r[n]]=tc[n]}}return Qi[t]}function ec(r,t,e){if(r.substring(0,9)!=="precision"){let i=t;return t===Vt.HIGH&&e!==Vt.HIGH&&(i=Vt.MEDIUM),`precision ${i} float;
${r}`}else if(e!==Vt.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}let hi;function Cv(){if(typeof hi=="boolean")return hi;try{hi=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{hi=!1}return hi}let Pv=0;const Ji={},Oa=class Dr{constructor(t,e,i="pixi-shader",n={}){this.extra={},this.id=Pv++,this.vertexSrc=t||Dr.defaultVertexSrc,this.fragmentSrc=e||Dr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Ji[i]?(Ji[i]++,i+=`-${Ji[i]}`):Ji[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=ec(this.vertexSrc,Dr.defaultVertexPrecision,Vt.HIGH),this.fragmentSrc=ec(this.fragmentSrc,Dr.defaultFragmentPrecision,Av())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return _v}static get defaultFragmentSrc(){return vv}static from(t,e,i){const n=t+e;let s=ju[n];return s||(ju[n]=s=new Dr(t,e,i)),s}};Oa.defaultVertexPrecision=Vt.HIGH,Oa.defaultFragmentPrecision=Ce.apple.device?Vt.HIGH:Vt.MEDIUM;let Ie=Oa,Iv=0;class ie{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Iv++,this.static=!!e,this.ubo=!!i,t instanceof wt?(this.buffer=t,this.buffer.type=me.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new wt(new Float32Array(1)),this.buffer.type=me.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new ie(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new ie(t,e,i)}static uboFrom(t,e){return new ie(t,e??!0,!0)}}class ge{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof ie?this.uniformGroup=e:this.uniformGroup=new ie(e):this.uniformGroup=new ie({}),this.disposeRunner=new re("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const n=e.uniforms[i];if(n.group===!0&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const n=Ie.from(t,e);return new ge(n,i)}}class Rv{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let s=0;s<t;s++)i[s]=s;this.defaultGroupCache[t]=ie.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ie(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new vt,default:this.defaultGroupCache[t]};return new ge(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class La{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function Mv(){return!Ce.apple.device}function Fv(r){let t=!0;const e=Q.ADAPTER.getNavigator();if(Ce.tablet||Ce.phone){if(Ce.apple.device){const i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(Ce.android.device){const i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?r:4}class fs{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var Dv=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Bv=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const mi=class Zt extends fs{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Ld,this.vertexSize=6,this.state=xe.for2d(),this.size=Zt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Fv(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Mv(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return pt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Bv}static get defaultFragmentTemplate(){return Dv}setShaderGenerator({vertex:t=Zt.defaultVertexSrc,fragment:e=Zt.defaultFragmentTemplate}={}){this.shaderGenerator=new Rv(t,e)}contextChange(){const t=this.renderer.gl;Q.PREFER_ENV===br.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Zt.defaultMaxTextures),this.maxTextures=hv(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Zt,i=this.size/4,n=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Fa);for(;e.length<n;)e.push(new La);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=Zt._textureArrayPool,n=this.renderer.batch,s=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++ut._globalBatch,h=0,l=i[0],u=0;n.copyBoundTextures(s,e);for(let c=0;c<this._bufferSize;++c){const d=t[c];t[c]=null,d._batchEnabled!==a&&(l.count>=e&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,u,c),u=c,l=i[++h],++a),d._batchEnabled=a,d.touched=o,l.elements[l.count++]=d)}l.count>0&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let c=0;c<s.length;c++)s[c]=null;ut._globalBatch=a}buildDrawCalls(t,e,i){const{_bufferedElements:n,_attributeBuffer:s,_indexBuffer:o,vertexSize:a}=this,h=Zt._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let f=e;f<i;++f){const p=n[f],m=p._texture.baseTexture,g=Fd[m.alphaMode?1:0][p.blendMode];n[f]=null,e<f&&d.blend!==g&&(d.size=c-d.start,e=f,d=h[++l],d.texArray=t,d.start=c),this.packInterleavedGeometry(p,s,o,u,c),u+=p.vertexData.length/2*a,c+=p.indices.length,d.blend=g}e<i&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Zt.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,n=Zt._drawCallPool;let s=null;for(let o=0;o<t;o++){const{texArray:a,type:h,size:l,start:u,blend:c}=n[o];s!==a&&(s=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,i.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Zt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=zn(Math.ceil(t/8)),i=Xu(e),n=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new Ia(n*this.vertexSize*4)),s}getIndexBuffer(t){const e=zn(Math.ceil(t/12)),i=Xu(e),n=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(n)),s}packInterleavedGeometry(t,e,i,n,s){const{uint32View:o,float32View:a}=e,h=n/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=_t.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let m=0;m<c.length;m+=2)a[n++]=c[m],a[n++]=c[m+1],a[n++]=l[m],a[n++]=l[m+1],o[n++]=p,a[n++]=d;for(let m=0;m<u.length;m++)i[s++]=h+u[m]}};mi.defaultBatchSize=4096,mi.extension={name:"batch",type:q.RendererPlugin},mi._drawCallPool=[],mi._textureArrayPool=[];let ur=mi;tt.add(ur);var Ov=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Lv=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Na=class gi extends ge{constructor(t,e,i){const n=Ie.from(t||gi.defaultVertexSrc,e||gi.defaultFragmentSrc);super(n,i),this.padding=0,this.resolution=gi.defaultResolution,this.multisample=gi.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new xe}apply(t,e,i,n,s){t.applyFilter(this,e,i,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Lv}static get defaultFragmentSrc(){return Ov}};Na.defaultResolution=1,Na.defaultMultisample=Tt.NONE;let Ct=Na;class Xn{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new _t(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:n}=t,s=i??e;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Xn.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Xn.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"background"};tt.add(Xn);class zd{constructor(t){this.renderer=t,this.emptyRenderer=new fs(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,i,n){const{elements:s,ids:o,count:a}=t;let h=0;for(let l=0;l<a;l++){const u=s[l],c=u._batchLocation;if(c>=0&&c<n&&e[c]===u){o[l]=c;continue}for(;h<n;){const d=e[h];if(d&&d._batchEnabled===i&&d._batchLocation===h){h++;continue}o[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}zd.extension={type:q.RendererSystem,name:"batch"};tt.add(zd);let rc=0;class Wn{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=rc++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=rc++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(Q.PREFER_ENV>=br.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Wn.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Wn.extension={type:q.RendererSystem,name:"context"};tt.add(Wn);class ka{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new re("disposeFramebuffer"),this.multisample=Tt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new ut(null,{scaleMode:fe.NEAREST,resolution:1,mipmap:ye.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new ut(null,{scaleMode:fe.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ye.OFF,format:V.DEPTH_COMPONENT,type:ot.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class $d extends ut{constructor(t={}){if(typeof t=="number"){const e=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3];t={width:e,height:i,scaleMode:n,resolution:s}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Tt.NONE),super(null,t),this.mipmap=ye.OFF,this.valid=!0,this._clear=new _t([0,0,0,0]),this.framebuffer=new ka(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class We extends Pi{constructor(t){const e=t,i=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;super(i,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=sv(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,n){const s=t.gl,o=e.realWidth,a=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ft.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&i.width===o&&i.height===a?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,i.type,n):(i.width=o,i.height=a,s.texImage2D(e.target,0,i.internalFormat,e.format,i.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class Vd extends We{constructor(t,e){if(e=e||{},typeof t=="string"){const i=new Image;We.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??Q.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ft.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const o in s){const a=s[o];if(a!==i&&a.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Ch{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const n=e.width,s=e.height;if(i){const o=t.width/2/n,a=t.height/2/s,h=t.x/n+o,l=t.y/s+a;i=yt.add(i,yt.NW),this.x0=h+o*yt.uX(i),this.y0=l+a*yt.uY(i),i=yt.add(i,2),this.x1=h+o*yt.uX(i),this.y1=l+a*yt.uY(i),i=yt.add(i,2),this.x2=h+o*yt.uX(i),this.y2=l+a*yt.uY(i),i=yt.add(i,2),this.x3=h+o*yt.uX(i),this.y3=l+a*yt.uY(i)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Ch.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const ic=new Ch;function tn(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class j extends Mi{constructor(t,e,i,n,s,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new ht(0,0,1,1)),t instanceof j&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=ic,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new ct(o.x,o.y):new ct(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&ae[e.url]&&j.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,j.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new j(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===ic&&(this._uvs=new Ch),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=Q.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof ut){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${_r()}`,ut.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${_r()}`}s=t._pixiId}let o=ae[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!o&&!(t instanceof ut)?(e.resolution||(e.resolution=Me(t)),o=new j(new ut(t,e)),o.baseTexture.cacheId=s,ut.addToCache(o.baseTexture,s),j.addToCache(o,s)):!o&&t instanceof ut&&(o=new j(t),j.addToCache(o,s)),o}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=j.from(t,Object.assign({resourceOptions:i},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,i,n){return new j(ut.fromBuffer(t,e,i,n))}static fromLoader(t,e,i,n){const s=new ut(t,Object.assign({scaleMode:ut.defaultOptions.scaleMode,resolution:Me(e)},n)),{resource:o}=s;o instanceof Vd&&(o.url=e);const a=new j(s);return i||(i=e),ut.addToCache(a.baseTexture,i),j.addToCache(a,i),i!==e&&(ut.addToCache(a.baseTexture,e),j.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ae[e]&&ae[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),ae[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=ae[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete ae[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)ae[t.textureCacheIds[e]]===t&&delete ae[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:n,height:s}=t,o=e+n>this.baseTexture.width,a=i+s>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",l=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,u=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return j._EMPTY||(j._EMPTY=new j(new ut),tn(j._EMPTY),tn(j._EMPTY.baseTexture)),j._EMPTY}static get WHITE(){if(!j._WHITE){const t=Q.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),j._WHITE=new j(ut.from(t)),tn(j._WHITE),tn(j._WHITE.baseTexture)}return j._WHITE}}class wr extends j{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,o=Math.round(e*n)/n;this.valid=s>0&&o>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(s,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new wr(new $d(t))}}class Xd{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=Tt.NONE){const n=new $d(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new wr(n)}getOptimalTexture(t,e,i=1,n=Tt.NONE){let s;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=zn(t),e=zn(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let o=this.texturePool[s].pop();return o||(o=this.createTexture(t,e,n)),o.filterPoolKey=s,o.setResolution(i),o}getFilterTexture(t,e,i){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||Tt.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const i=this.texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Xd.SCREEN_KEY=-1;class Nv extends Xe{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Wd extends Xe{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new wt(this.vertices),this.uvBuffer=new wt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class kv{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Tt.NONE,this.sourceFrame=new ht,this.destinationFrame=new ht,this.bindingSourceFrame=new ht,this.bindingDestinationFrame=new ht,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const en=[new ct,new ct,new ct,new ct],Wo=new vt;class jd{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Xd,this.statePool=[],this.quad=new Nv,this.quadUv=new Wd,this.tempRect=new ht,this.activeState={},this.globalUniforms=new ie({outputFrame:new ht,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new kv,o=i.renderTexture;let a,h;if(o.current){const g=o.current;a=g.resolution,h=g.multisample}else a=i.resolution,h=i.multisample;let l=e[0].resolution||a,u=e[0].multisample??h,c=e[0].padding,d=e[0].autoFit,f=e[0].legacy??!0;for(let g=1;g<e.length;g++){const y=e[g];l=Math.min(l,y.resolution||a),u=Math.min(u,y.multisample??h),c=this.useMaxPadding?Math.max(c,y.padding):c+y.padding,d=d&&y.autoFit,f=f||(y.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(s),s.resolution=l,s.multisample=u,s.legacy=f,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(c);const p=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(Wo.copyFrom(i.projection.transform).invert(),p),d?(s.sourceFrame.fit(p),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(p)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,l,u),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const m=this.tempRect;m.x=0,m.y=0,m.width=s.sourceFrame.width,m.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(o.sourceFrame),s.bindingDestinationFrame.copyFrom(o.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,o.bind(s.renderTexture,s.sourceFrame,m),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*e.resolution),o[1]=Math.round(s[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*s[2]-.5*o[2],a[3]=e.sourceFrame.height*s[3]-.5*o[3],e.legacy){const l=n.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,h.renderTexture,ce.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<i.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),i[c].apply(this,l,u,ce.CLEAR,e);const d=l;l=u,u=d}i[c].apply(this,l,h.renderTexture,ce.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=ce.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===ce.CLEAR||e===ce.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(de.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(de.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:s}=e._texture,o=t.set(n.width,0,0,n.height,i.x,i.y),a=e.worldTransform.copyTo(vt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,n=Tt.NONE){return this.texturePool.getOptimalTexture(t,e,i,n)}getFilterTexture(t,e,i){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||Tt.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=en[0],n=en[1],s=en[2],o=en[3];i.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(s,s),t.apply(o,o);const a=Math.min(i.x,n.x,s.x,o.x),h=Math.min(i.y,n.y,s.y,o.y),l=Math.max(i.x,n.x,s.x,o.x),u=Math.max(i.y,n.y,s.y,o.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,i,n,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){const{a:o,b:a,c:h,d:l}=s;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}s=s?Wo.copyFrom(s):Wo.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}jd.extension={type:q.RendererSystem,name:"filter"};tt.add(jd);class Uv{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Tt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Gv=new ht;class qd{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new ka(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ht,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Q.PREFER_ENV===br.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>i,a=e.height>>i,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{const o=t.width>>i,a=t.height>>i;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=i,s.height=n,this.gl.viewport(t,e,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,n,s=Aa.COLOR|Aa.DEPTH){const{gl:o}=this;o.clearColor(t,e,i,n),o.clear(s)}initFramebuffer(t){const{gl:e}=this,i=new Uv(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let o=0;o<s;o++){const a=n[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let o=s.length;i.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const l=s[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+h))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){n.stencil=n.stencil||i.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH_STENCIL):t.depth&&t.stencil?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH24_STENCIL8):t.depth?(h=i.DEPTH_ATTACHMENT,l=i.DEPTH_COMPONENT24):(h=i.STENCIL_ATTACHMENT,l=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,l,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,l,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,n.stencil)}else n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=Tt.NONE;if(t<=1||e===null)return i;for(let n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return i===1&&(i=Tt.NONE),i}blit(t,e,i){const{current:n,renderer:s,gl:o,CONTEXT_UID:a}=this;if(s.context.webGLVersion!==2||!n)return;const h=n.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=n.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new ka(n.width,n.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=Gv,e.width=n.width,e.height=n.height),i||(i=e);const l=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const i=t.width,n=t.height,s=this.gl,o=e.stencil=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o);let a,h;this.renderer.context.webGLVersion===1?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH_STENCIL):t.depth?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH24_STENCIL8):(a=s.STENCIL_ATTACHMENT,h=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,h,i,n):s.renderbufferStorage(s.RENDERBUFFER,h,i,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,a,s.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ht}destroy(){this.renderer=null}}qd.extension={type:q.RendererSystem,name:"framebuffer"};tt.add(qd);const jo={5126:4,5123:2,5121:1};class Yd{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;Q.PREFER_ENV===br.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=n=>i.bindVertexArrayOES(n),t.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(n,s)=>i.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,o,a,h)=>i.drawElementsInstancedANGLE(n,s,o,a,h),t.drawArraysInstanced=(n,s,o,a)=>i.drawArraysInstancedANGLE(n,s,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const o=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];e.update(n)}}checkCompatibility(t,e){const i=t.attributes,n=e.attributeData;for(const s in n)if(!i[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const i=t.attributes,n=e.attributeData,s=["g",t.id];for(const o in i)n[o]&&s.push(o,n[o].location);return s.join("-")}initGeometryVao(t,e,i=!0){const n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[a.id]=u,u;const c=t.buffers,d=t.attributes,f={},p={};for(const m in c)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*jo[d[m].type];for(const m in d){const g=d[m],y=g.size;g.stride===void 0&&(f[g.buffer]===y*jo[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=y*jo[g.type])}u=n.createVertexArray(),n.bindVertexArray(u);for(let m=0;m<c.length;m++){const g=c[m];o.bind(g),i&&g._glBuffers[s].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,n.bindVertexArray(null),o.unbind(me.ARRAY_BUFFER),u}disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!i){if(o)for(let h=0;h<s.length;h++){const l=s[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&o.dispose(s[h],e))}if(!e){for(const h in i)if(h[0]==="g"){const l=i[h];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let h=null;for(const l in a){const u=a[l],c=o[u.buffer],d=c._glBuffers[n];if(e.attributeData[l]){h!==d&&(s.bind(c),h=d);const f=e.attributeData[l].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,u.size,u.type||i.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)i.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,n){const{gl:s}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(i||0)*a,n||1):s.drawElements(t,e||o.indexBuffer.data.length,h,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(t,i,e||o.getSize(),n||1):s.drawArrays(t,i,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Yd.extension={type:q.RendererSystem,name:"geometry"};tt.add(Yd);const nc=new vt;class Kd{constructor(t,e){this._texture=t,this.mapCoord=new vt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],o=t[n+1];e[n]=s*i.a+o*i.c+i.tx,e[n+1]=s*i.b+o*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=e.orig,s=e.trim;s&&(nc.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(nc));const o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/o.width,a[1]=(e._frame.y+h+l)/o.height,a[2]=(e._frame.x+e._frame.width-h+l)/o.width,a[3]=(e._frame.y+e._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}var Hv=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,zv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class $v extends Ct{constructor(t,e,i){let n=null;typeof t!="string"&&e===void 0&&i===void 0&&(n=t,t=void 0,e=void 0,i=void 0),super(t||zv,e||Hv,i),this.maskSprite=n,this.maskMatrix=new vt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,n){const s=this._maskSprite,o=s._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Kd(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))}}class Vv{constructor(t=null){this.type=At.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ct.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=At.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Zd{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const s=this.maskDataPool.pop()||new Vv;s.pooled=!0,s.maskObject=e,i=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==At.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case At.SCISSOR:this.renderer.scissor.push(i);break;case At.STENCIL:this.renderer.stencil.push(i);break;case At.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case At.COLOR:this.pushColorMask(i);break}i.type===At.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case At.SCISSOR:this.renderer.scissor.pop(e);break;case At.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case At.SPRITE:this.popSpriteMask(e);break;case At.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===At.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=At.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=At.SCISSOR:t.type=At.STENCIL:t.type=At.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new $v])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const s=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,n),i.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}Zd.extension={type:q.RendererSystem,name:"mask"};tt.add(Zd);class Qd{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const sc=new vt,oc=[],Jd=class bn extends Qd{constructor(t){super(t),this.glConst=Q.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:n}=this,s=n.renderTexture,o=i.getBounds(!0,oc.pop()??new ht);this.roundFrameToPixels(o,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:n,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||bn.isMatrixRotated(e.worldTransform)||bn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,n,s){bn.isMatrixRotated(s)||(s=s?sc.copyFrom(s):sc.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.renderer.filter.transformAABB(s,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&oc.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Jd.extension={type:q.RendererSystem,name:"scissor"};let Xv=Jd;tt.add(Xv);class tf extends Qd{constructor(t){super(t),this.glConst=Q.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(i._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}tf.extension={type:q.RendererSystem,name:"stencil"};tt.add(tf);class ef{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return pt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return pt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return pt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}ef.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"_plugin"};tt.add(ef);class rf{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new vt,this.transform=null}update(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,i,n){const s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=o*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-o-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}rf.extension={type:q.RendererSystem,name:"projection"};tt.add(rf);const Wv=new Sh,ac=new ht;class nf{constructor(t){this.renderer=t,this._tempMatrix=new vt}generateTexture(t,e){const{region:i,...n}=e||{},s=(i==null?void 0:i.copyTo(ac))||t.getLocalBounds(ac,!0),o=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/o),s.height=Math.max(s.height,1/o),n.width=s.width,n.height=s.height,n.resolution=o,n.multisample??(n.multisample=this.renderer.multisample);const a=wr.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const h=t.transform;return t.transform=Wv,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}}nf.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"textureGenerator"};tt.add(nf);const ir=new ht,li=new ht;class sf{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ht,this.destinationFrame=new ht,this.viewportFrame=new ht}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const n=this.renderer;this.current=t;let s,o,a;t?(s=t.baseTexture,a=s.resolution,e||(ir.width=t.frame.width,ir.height=t.frame.height,e=ir),i||(li.x=t.frame.x,li.y=t.frame.y,li.width=e.width,li.height=e.height,i=li),o=s.framebuffer):(a=n.resolution,e||(ir.width=n._view.screen.width,ir.height=n._view.screen.height,e=ir),i||(i=ir,i.width=e.width,i.height=e.height));const h=this.viewportFrame;h.x=i.x*a,h.y=i.y*a,h.width=i.width*a,h.height=i.height*a,t||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(i,e,a,!o),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=_t.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=s.width!==o.width||s.height!==o.height;if(a){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}sf.extension={type:q.RendererSystem,name:"renderTexture"};tt.add(sf);class jv{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function qv(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=t.getActiveAttrib(r,n);if(s.name.startsWith("gl_"))continue;const o=Hd(t,s.type),a={type:o,name:s.name,size:Gd(o),location:t.getAttribLocation(r,s.name)};e[s.name]=a}return e}function Yv(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const s=t.getActiveUniform(r,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),h=Hd(t,s.type);e[o]={name:o,index:n,type:h,size:s.size,isArray:a,value:kd(h,s.size)}}return e}function Kv(r,t){var a;const e=Qu(r,r.VERTEX_SHADER,t.vertexSrc),i=Qu(r,r.FRAGMENT_SHADER,t.fragmentSrc),n=r.createProgram();r.attachShader(n,e),r.attachShader(n,i);const s=(a=t.extra)==null?void 0:a.transformFeedbackVaryings;if(s&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS)||Ev(r,n,e,i),t.attributeData=qv(n,r),t.uniformData=Yv(n,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((l,u)=>l>u?1:-1);for(let l=0;l<h.length;l++)t.attributeData[h[l]].location=l,r.bindAttribLocation(n,l,h[l]);r.linkProgram(n)}r.deleteShader(e),r.deleteShader(i);const o={};for(const h in t.uniformData){const l=t.uniformData[h];o[h]={location:r.getUniformLocation(n,h),value:kd(l.type,l.size)}}return new jv(n,o)}function Zv(r,t,e,i,n){e.buffer.update(n)}const Qv={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},of={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function Jv(r){const t=r.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,i=0,n=0;for(let s=0;s<t.length;s++){const o=t[s];if(e=of[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!==0&&i<16){const a=i%e%16;i+=a,n+=a}i+e>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=e,i=e):(o.offset=n,i+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function t_(r,t){const e=[];for(const i in r)t[i]&&e.push(t[i]);return e.sort((i,n)=>i.index-n.index),e}function e_(r,t){if(!r.autoManage)return{size:0,syncFunc:Zv};const e=t_(r.uniforms,t),{uboElements:i,size:n}=Jv(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){const a=i[o],h=r.uniforms[a.data.name],l=a.data.name;let u=!1;for(let c=0;c<Vr.length;c++){const d=Vr[c];if(d.codeUbo&&d.test(a.data,h)){s.push(`offset = ${a.offset/4};`,Vr[c].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){const c=Gd(a.data.type),d=Math.max(of[a.data.type]/16,1),f=c/d,p=(4-f%4)%4;s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const c=Qv[a.data.type];s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${c};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let r_=0;const rn={textureCount:0,uboCount:0};class af{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=r_++}systemCheck(){if(!Cv())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(rn.textureCount=0,rn.uboCount=0,this.syncUniformGroup(t.uniformGroup,rn)),n}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=wv(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,rn,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=e_(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const n=t.uniforms,s=[`${i}-`];for(const o in n)s.push(o),e[o]&&s.push(e[o].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,n=Kv(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}af.extension={type:q.RendererSystem,name:"shader"};tt.add(af);class jn{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.1 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}jn.defaultOptions={hello:!1},jn.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"startup"};tt.add(jn);function i_(r,t=[]){return t[at.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.ADD]=[r.ONE,r.ONE],t[at.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.NONE]=[0,0],t[at.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[at.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[at.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[at.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[at.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[at.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[at.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[at.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[at.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[at.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}const n_=0,s_=1,o_=2,a_=3,h_=4,l_=5,hf=class Ua{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=at.NONE,this._blendEq=!1,this.map=[],this.map[n_]=this.setBlend,this.map[s_]=this.setOffset,this.map[o_]=this.setCullFace,this.map[a_]=this.setDepthTest,this.map[h_]=this.setFrontFace,this.map[l_]=this.setDepthMask,this.checks=[],this.defaultState=new xe,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=i_(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Ua.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Ua.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};hf.extension={type:q.RendererSystem,name:"state"};let u_=hf;tt.add(u_);class c_ extends Mi{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),i=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of i)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new re(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=i.find(o=>this._systemsHash[o]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const yi=class wn{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=wn.defaultMaxIdle,this.checkCountMax=wn.defaultCheckCountMax,this.mode=wn.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==bh.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let n=0;n<e.length;n++){const s=e[n];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,i=!0)}if(i){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}};yi.defaultMode=bh.AUTO,yi.defaultMaxIdle=3600,yi.defaultCheckCountMax=600,yi.extension={type:q.RendererSystem,name:"textureGC"};let cr=yi;tt.add(cr);class qo{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ot.UNSIGNED_BYTE,this.internalFormat=V.RGBA,this.samplerType=0}}function d_(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[r.RGB]:Z.FLOAT,[r.RGBA]:Z.FLOAT,[r.ALPHA]:Z.FLOAT,[r.LUMINANCE]:Z.FLOAT,[r.LUMINANCE_ALPHA]:Z.FLOAT,[r.R8]:Z.FLOAT,[r.R8_SNORM]:Z.FLOAT,[r.RG8]:Z.FLOAT,[r.RG8_SNORM]:Z.FLOAT,[r.RGB8]:Z.FLOAT,[r.RGB8_SNORM]:Z.FLOAT,[r.RGB565]:Z.FLOAT,[r.RGBA4]:Z.FLOAT,[r.RGB5_A1]:Z.FLOAT,[r.RGBA8]:Z.FLOAT,[r.RGBA8_SNORM]:Z.FLOAT,[r.RGB10_A2]:Z.FLOAT,[r.RGB10_A2UI]:Z.FLOAT,[r.SRGB8]:Z.FLOAT,[r.SRGB8_ALPHA8]:Z.FLOAT,[r.R16F]:Z.FLOAT,[r.RG16F]:Z.FLOAT,[r.RGB16F]:Z.FLOAT,[r.RGBA16F]:Z.FLOAT,[r.R32F]:Z.FLOAT,[r.RG32F]:Z.FLOAT,[r.RGB32F]:Z.FLOAT,[r.RGBA32F]:Z.FLOAT,[r.R11F_G11F_B10F]:Z.FLOAT,[r.RGB9_E5]:Z.FLOAT,[r.R8I]:Z.INT,[r.R8UI]:Z.UINT,[r.R16I]:Z.INT,[r.R16UI]:Z.UINT,[r.R32I]:Z.INT,[r.R32UI]:Z.UINT,[r.RG8I]:Z.INT,[r.RG8UI]:Z.UINT,[r.RG16I]:Z.INT,[r.RG16UI]:Z.UINT,[r.RG32I]:Z.INT,[r.RG32UI]:Z.UINT,[r.RGB8I]:Z.INT,[r.RGB8UI]:Z.UINT,[r.RGB16I]:Z.INT,[r.RGB16UI]:Z.UINT,[r.RGB32I]:Z.INT,[r.RGB32UI]:Z.UINT,[r.RGBA8I]:Z.INT,[r.RGBA8UI]:Z.UINT,[r.RGBA16I]:Z.INT,[r.RGBA16UI]:Z.UINT,[r.RGBA32I]:Z.INT,[r.RGBA32UI]:Z.UINT,[r.DEPTH_COMPONENT16]:Z.FLOAT,[r.DEPTH_COMPONENT24]:Z.FLOAT,[r.DEPTH_COMPONENT32F]:Z.FLOAT,[r.DEPTH_STENCIL]:Z.FLOAT,[r.DEPTH24_STENCIL8]:Z.FLOAT,[r.DEPTH32F_STENCIL8]:Z.FLOAT}:t={[r.RGB]:Z.FLOAT,[r.RGBA]:Z.FLOAT,[r.ALPHA]:Z.FLOAT,[r.LUMINANCE]:Z.FLOAT,[r.LUMINANCE_ALPHA]:Z.FLOAT,[r.DEPTH_STENCIL]:Z.FLOAT},t}function f_(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[ot.UNSIGNED_BYTE]:{[V.RGBA]:r.RGBA8,[V.RGB]:r.RGB8,[V.RG]:r.RG8,[V.RED]:r.R8,[V.RGBA_INTEGER]:r.RGBA8UI,[V.RGB_INTEGER]:r.RGB8UI,[V.RG_INTEGER]:r.RG8UI,[V.RED_INTEGER]:r.R8UI,[V.ALPHA]:r.ALPHA,[V.LUMINANCE]:r.LUMINANCE,[V.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[ot.BYTE]:{[V.RGBA]:r.RGBA8_SNORM,[V.RGB]:r.RGB8_SNORM,[V.RG]:r.RG8_SNORM,[V.RED]:r.R8_SNORM,[V.RGBA_INTEGER]:r.RGBA8I,[V.RGB_INTEGER]:r.RGB8I,[V.RG_INTEGER]:r.RG8I,[V.RED_INTEGER]:r.R8I},[ot.UNSIGNED_SHORT]:{[V.RGBA_INTEGER]:r.RGBA16UI,[V.RGB_INTEGER]:r.RGB16UI,[V.RG_INTEGER]:r.RG16UI,[V.RED_INTEGER]:r.R16UI,[V.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[ot.SHORT]:{[V.RGBA_INTEGER]:r.RGBA16I,[V.RGB_INTEGER]:r.RGB16I,[V.RG_INTEGER]:r.RG16I,[V.RED_INTEGER]:r.R16I},[ot.UNSIGNED_INT]:{[V.RGBA_INTEGER]:r.RGBA32UI,[V.RGB_INTEGER]:r.RGB32UI,[V.RG_INTEGER]:r.RG32UI,[V.RED_INTEGER]:r.R32UI,[V.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[ot.INT]:{[V.RGBA_INTEGER]:r.RGBA32I,[V.RGB_INTEGER]:r.RGB32I,[V.RG_INTEGER]:r.RG32I,[V.RED_INTEGER]:r.R32I},[ot.FLOAT]:{[V.RGBA]:r.RGBA32F,[V.RGB]:r.RGB32F,[V.RG]:r.RG32F,[V.RED]:r.R32F,[V.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[ot.HALF_FLOAT]:{[V.RGBA]:r.RGBA16F,[V.RGB]:r.RGB16F,[V.RG]:r.RG16F,[V.RED]:r.R16F},[ot.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:r.RGB565},[ot.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:r.RGBA4},[ot.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:r.RGB5_A1},[ot.UNSIGNED_INT_2_10_10_10_REV]:{[V.RGBA]:r.RGB10_A2,[V.RGBA_INTEGER]:r.RGB10_A2UI},[ot.UNSIGNED_INT_10F_11F_11F_REV]:{[V.RGB]:r.R11F_G11F_B10F},[ot.UNSIGNED_INT_5_9_9_9_REV]:{[V.RGB]:r.RGB9_E5},[ot.UNSIGNED_INT_24_8]:{[V.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[ot.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[V.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[ot.UNSIGNED_BYTE]:{[V.RGBA]:r.RGBA,[V.RGB]:r.RGB,[V.ALPHA]:r.ALPHA,[V.LUMINANCE]:r.LUMINANCE,[V.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[ot.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:r.RGB},[ot.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:r.RGBA},[ot.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:r.RGBA}},t}class lf{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ut,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=f_(t),this.samplerTypes=d_(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new qo(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new qo(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let s=t-1;s>=0;--s){const o=e[s];o&&o._glTextures[n].samplerType!==Z.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new qo(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var i;e.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??Z.FLOAT,this.webGLVersion===2&&t.type===ot.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),(n=t.resource)==null?void 0:n.upload(i,t,e))e.samplerType!==Z.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,o=t.realHeight,a=i.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,a.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&$r(this.managedTextures,n,1)}}updateTextureStyle(t){var i;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===ye.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=kt.CLAMP:e.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==ye.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===fe.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===fe.LINEAR){const s=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===fe.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===fe.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}lf.extension={type:q.RendererSystem,name:"texture"};tt.add(lf);class uf{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:n}=this;e&&n.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(i.buffer.update(a),a._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&s.dispose(a,e))}i&&(e||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}uf.extension={type:q.RendererSystem,name:"transformFeedback"};tt.add(uf);class qn{constructor(t){this.renderer=t}init(t){this.screen=new ht(0,0,t.width,t.height),this.element=t.view||Q.ADAPTER.createCanvas(),this.resolution=t.resolution||Q.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}qn.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},qn.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"_view"};tt.add(qn);Q.PREFER_ENV=br.WEBGL2;Q.STRICT_TEXTURE_CACHE=!1;Q.RENDER_OPTIONS={...Wn.defaultOptions,...Xn.defaultOptions,...qn.defaultOptions,...jn.defaultOptions};Object.defineProperties(Q,{WRAP_MODE:{get(){return ut.defaultOptions.wrapMode},set(r){pt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ut.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return ut.defaultOptions.scaleMode},set(r){pt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ut.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return ut.defaultOptions.mipmap},set(r){pt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ut.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return ut.defaultOptions.anisotropicLevel},set(r){pt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ut.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return pt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ct.defaultResolution},set(r){Ct.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return pt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ct.defaultMultisample},set(r){Ct.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return ur.defaultMaxTextures},set(r){pt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),ur.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return ur.defaultBatchSize},set(r){pt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),ur.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return ur.canUploadSameBuffer},set(r){pt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),ur.canUploadSameBuffer=r}},GC_MODE:{get(){return cr.defaultMode},set(r){pt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),cr.defaultMode=r}},GC_MAX_IDLE:{get(){return cr.defaultMaxIdle},set(r){pt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),cr.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return cr.defaultCheckCountMax},set(r){pt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),cr.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return Ie.defaultVertexPrecision},set(r){pt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Ie.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return Ie.defaultFragmentPrecision},set(r){pt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Ie.defaultFragmentPrecision=r}}});var xr=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(xr||{});class Yo{constructor(t,e=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const cf=class Bt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Yo(null,null,1/0),this.deltaMS=1/Bt.targetFPMS,this.elapsedMS=1/Bt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=xr.NORMAL){return this._addListener(new Yo(t,e,i))}addOnce(t,e,i=xr.NORMAL){return this._addListener(new Yo(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Bt.targetFPMS;const i=this._head;let n=i.next;for(;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Bt.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Bt._shared){const t=Bt._shared=new Bt;t.autoStart=!0,t._protected=!0}return Bt._shared}static get system(){if(!Bt._system){const t=Bt._system=new Bt;t.autoStart=!0,t._protected=!0}return Bt._system}};cf.targetFPMS=.06;let Nt=cf;Object.defineProperties(Q,{TARGET_FPMS:{get(){return Nt.targetFPMS},set(r){pt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Nt.targetFPMS=r}}});class df{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,xr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Nt.shared:new Nt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}df.extension=q.Application;tt.add(df);const ff=[];tt.handleByList(q.Renderer,ff);function pf(r){for(const t of ff)if(t.test(r))return new t(r);throw new Error("Unable to auto-detect a suitable renderer.")}var p_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,m_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const g_=p_,mf=m_;class gf{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=Tt.HIGH?this.multisample=Tt.HIGH:e>=Tt.MEDIUM?this.multisample=Tt.MEDIUM:e>=Tt.LOW?this.multisample=Tt.LOW:this.multisample=Tt.NONE}destroy(){}}gf.extension={type:q.RendererSystem,name:"_multisample"};tt.add(gf);class y_{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class yf{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,i){const{gl:n,CONTEXT_UID:s}=this;i=i||0;const o=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,o.buffer,i*256,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new y_(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}yf.extension={type:q.RendererSystem,name:"buffer"};tt.add(yf);class vf{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let n,s,o,a;if(e&&(n=e.renderTexture,s=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(n||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(s??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(e.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}vf.extension={type:q.RendererSystem,name:"objectRenderer"};tt.add(vf);const Tn=class Ga extends c_{constructor(t){super(),this.type=xh.WEBGL,t=Object.assign({},Q.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ie({projectionMatrix:new vt},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ga.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(pt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Ga.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:H1()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return pt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return pt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return pt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return pt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){pt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return pt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){pt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return pt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Tn.extension={type:q.Renderer,priority:1},Tn.__plugins={},Tn.__systems={};let ps=Tn;tt.handleByMap(q.RendererPlugin,ps.__plugins);tt.handleByMap(q.RendererSystem,ps.__systems);tt.add(ps);class _f extends Pi{constructor(t,e){const{width:i,height:n}=e||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const o=new ut;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Pi?this.addResourceAt(t[i],i):this.addResourceAt(Od(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}}class v_ extends _f{constructor(t,e){const{width:i,height:n}=e||{};let s,o;Array.isArray(t)?(s=t,o=t.length):o=t,super(o,{width:i,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=zr.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:n,itemDirtyIds:s,items:o}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,e.format,i.type,null);for(let h=0;h<n;h++){const l=o[h];s[h]<l.dirtyId&&(s[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0}}class __ extends We{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const xf=class vi extends _f{constructor(t,e){const{width:i,height:n,autoLoad:s,linkBaseTexture:o}=e||{};if(t&&t.length!==vi.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:n});for(let a=0;a<vi.SIDES;a++)this.items[a].target=zr.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=zr.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=zr.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const n=this.itemDirtyIds;for(let s=0;s<vi.SIDES;s++){const o=this.items[s];(n[s]<o.dirtyId||i.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,i),n[s]=o.dirtyId):n[s]<-1&&(t.gl.texImage2D(o.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),n[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===vi.SIDES}};xf.SIDES=6;let x_=xf;class Gr extends We{constructor(t,e){e=e||{};let i,n,s;typeof t=="string"?(i=Gr.EMPTY,n=t,s=!0):(i=t,n=null,s=!1),super(i),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??s,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const i=await Q.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ft.UNPACK?"premultiply":"none"});if(this.destroyed){s.close();return}this.source=s,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Gr._EMPTY=Gr._EMPTY??Q.ADAPTER.createCanvas(0,0),Gr._EMPTY}}const Ha=class An extends We{constructor(t,e){e=e||{},super(Q.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},An.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;We.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),n=Math.round(n),s=Math.round(s);const o=this.source;o.width=n,o.height=s,o._pixiId=`canvas_${_r()}`,o.getContext("2d").drawImage(t,0,0,e,i,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(t){const e=An.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&An.SVG_XML.test(t)}};Ha.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Ha.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let za=Ha;const $a=class Va extends We{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const n=t[0].src||t[0];We.crossOrigin(i,n,e.crossorigin);for(let s=0;s<t.length;++s){const o=document.createElement("source");let{src:a,mime:h}=t[s];if(a=a||t[s],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const l=a.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||Va.MIME_TYPES[u]||`video/${u}`}o.src=a,h&&(o.type=h),i.appendChild(o)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=Nt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Nt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Nt.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Nt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Va.TYPES.includes(e)}};$a.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],$a.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let bf=$a;Ra.push(Gr,Vd,__,bf,za,ls,x_,v_);class Yn{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?ht.EMPTY:(t=t||new ht(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:n,c:s,d:o,tx:a,ty:h}=t,l=i*e.x+s*e.y+a,u=n*e.x+o*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,i=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,this.minX=e,this.minY=i,this.maxX=n,this.maxY=s}addFrame(t,e,i,n,s){this.addFrameMatrix(t.worldTransform,e,i,n,s)}addFrameMatrix(t,e,i,n,s){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=o*e+h*i+u,y=a*e+l*i+c;d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*n+h*i+u,y=a*n+l*i+c,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*e+h*s+u,y=a*e+l*s+c,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*n+h*s+u,y=a*n+l*s+c,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,i){let n=this.minX,s=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<i;h+=2){const l=t[h],u=t[h+1];n=l<n?l:n,s=u<s?u:s,o=l>o?l:o,a=u>a?u:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a}addVertices(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)}addVerticesMatrix(t,e,i,n,s=0,o=s){const a=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let y=i;y<n;y+=2){const x=e[y],v=e[y+1],E=a*x+l*v+c,w=u*v+h*x+d;f=Math.min(f,E-s),m=Math.max(m,E+s),p=Math.min(p,w-o),g=Math.max(g,w+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const e=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>u?o:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>u?o:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,n,s,o){t-=s,e-=o,i+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class xt extends Mi{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Sh,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Yn,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const n=e[i];Object.defineProperty(xt.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new ht),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new ht),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Yn);const e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(i==null?void 0:i.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,o}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,n){return e&&(t=e.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,i=1,n=1,s=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=n||1,this.rotation=s,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new b_),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*mv}set angle(t){this.transform.rotation=t*gv}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class b_ extends xt{constructor(){super(...arguments),this.sortDirty=null}}xt.prototype.displayObjectUpdateTransform=xt.prototype.updateTransform;const w_=new vt;function T_(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}const wf=class Xa extends xt{constructor(){super(),this.children=[],this.sortableChildren=Xa.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),n=this.getChildIndex(e);this.children[i]=e,this.children[n]=t,this.onChildrenChange(i<n?i:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);$r(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,$r(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,$r(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,n=e,s=n-i;let o;if(s>0&&s<=n){o=this.children.splice(i,s);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(T_),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const o=this.children[n];o.visible&&o.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,n;this.cullArea?(i=this.cullArea,n=this.worldTransform):this._render!==Xa.prototype._render&&(i=this.getBounds(!0));const s=t.projection.transform;if(s&&(n?(n=w_.copyFrom(n),n.prepend(s)):n=s),i&&e.intersects(i,n))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const h=this.children[o],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let i=0,n=this.children.length;i<n;++i)this.children[i].render(t)}}renderAdvanced(t){var s,o,a;const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<e.length;h++)e[h].enabled&&this._enabledFilters.push(e[h])}const n=e&&((s=this._enabledFilters)==null?void 0:s.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==At.NONE));if(n&&t.batch.flush(),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let h=0,l=this.children.length;h<l;++h)this.children[h].render(t)}n&&t.batch.flush(),i&&t.mask.pop(this),e&&((a=this._enabledFilters)!=null&&a.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,i=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<i.length;++n)i[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};wf.defaultSortableChildren=!1;let Gt=wf;Gt.prototype.containerUpdateTransform=Gt.prototype.updateTransform;Object.defineProperties(Q,{SORTABLE_CHILDREN:{get(){return Gt.defaultSortableChildren},set(r){pt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Gt.defaultSortableChildren=r}}});const ui=new ct,A_=new Uint16Array([0,1,2,0,2,3]);class Qr extends Gt{constructor(t){super(),this._anchor=new Pe(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new _t(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=at.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||j.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=A_,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Q.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=He(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=He(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,d=this._anchor;let f=0,p=0,m=0,g=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,g=u.y-d._y*c.height,m=g+u.height):(p=-d._x*c.width,f=p+c.width,g=-d._y*c.height,m=g+c.height),l[0]=i*p+s*g+a,l[1]=o*g+n*p+h,l[2]=i*f+s*g+a,l[3]=o*g+n*f+h,l[4]=i*f+s*m+a,l[5]=o*m+n*f+h,l[6]=i*p+s*m+a,l[7]=o*m+n*p+h,this._roundPixels){const y=Q.RESOLUTION;for(let x=0;x<l.length;++x)l[x]=Math.round(l[x]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,n=this._anchor,s=this.transform.worldTransform,o=s.a,a=s.b,h=s.c,l=s.d,u=s.tx,c=s.ty,d=-n._x*i.width,f=d+i.width,p=-n._y*i.height,m=p+i.height;if(e[0]=o*d+h*p+u,e[1]=l*p+a*d+c,e[2]=o*f+h*p+u,e[3]=l*p+a*f+c,e[4]=o*f+h*m+u,e[5]=l*m+a*f+c,e[6]=o*d+h*m+u,e[7]=l*m+a*d+c,this._roundPixels){const g=Q.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*g)/g}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Yn),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new ht),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,ui);const e=this._texture.orig.width,i=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return ui.x>=n&&ui.x<n+e&&(s=-i*this.anchor.y,ui.y>=s&&ui.y<s+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof j?t:j.from(t,e);return new Qr(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=He(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=He(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||j.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Tf=new vt;xt.prototype._cacheAsBitmap=!1;xt.prototype._cacheData=null;xt.prototype._cacheAsBitmapResolution=null;xt.prototype._cacheAsBitmapMultisample=null;class E_{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(xt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let t;r?(this._cacheData||(this._cacheData=new E_),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});xt.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};xt.prototype._initCachedDisplayObject=function(r){var d,f;if((d=this._cacheData)!=null&&d.sprite)return;const t=this.alpha;this.alpha=1,r.batch.flush();const e=this.getLocalBounds(new ht,!0);if((f=this.filters)!=null&&f.length){const p=this.filters[0].padding;e.pad(p)}const i=this.cacheAsBitmapResolution||r.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);const n=r.renderTexture.current,s=r.renderTexture.sourceFrame.clone(),o=r.renderTexture.destinationFrame.clone(),a=r.projection.transform,h=wr.create({width:e.width,height:e.height,resolution:i,multisample:this.cacheAsBitmapMultisample??r.multisample}),l=`cacheAsBitmap_${_r()}`;this._cacheData.textureCacheId=l,ut.addToCache(h.baseTexture,l),j.addToCache(h,l);const u=this.transform.localTransform.copyTo(Tf).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=a,r.renderTexture.bind(n,s,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const c=new Qr(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)};xt.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};xt.prototype._initCachedDisplayObjectCanvas=function(r){var u;if((u=this._cacheData)!=null&&u.sprite)return;const t=this.getLocalBounds(new ht,!0),e=this.alpha;this.alpha=1;const i=r.canvasContext.activeContext,n=r._projTransform,s=this.cacheAsBitmapResolution||r.resolution;t.ceil(s),t.width=Math.max(t.width,1/s),t.height=Math.max(t.height,1/s);const o=wr.create({width:t.width,height:t.height,resolution:s}),a=`cacheAsBitmap_${_r()}`;this._cacheData.textureCacheId=a,ut.addToCache(o.baseTexture,a),j.addToCache(o,a);const h=Tf;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new Qr(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(t.x/t.width),l.anchor.y=-(t.y/t.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};xt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};xt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};xt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ut.removeFromCache(this._cacheData.textureCacheId),j.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};xt.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};xt.prototype.name=null;Gt.prototype.getChildByName=function(r,t){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===r)return this.children[e];if(t)for(let e=0,i=this.children.length;e<i;e++){const n=this.children[e];if(!n.getChildByName)continue;const s=n.getChildByName(r,!0);if(s)return s}return null};xt.prototype.getGlobalPosition=function(r=new ct,t=!1){return this.parent?this.parent.toGlobal(this.position,r,t):(r.x=this.position.x,r.y=this.position.y),r};var S_=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class C_ extends Ct{constructor(t=1){super(g_,S_,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const P_={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},I_=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function R_(r){const t=P_[r],e=t.length;let i=I_,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<r;a++){let h=s.replace("%index%",a.toString());o=a,a>=e&&(o=r-a-1),h=h.replace("%value%",t[o].toString()),n+=h,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}const M_=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function F_(r,t){const e=Math.ceil(r/2);let i=M_,n="",s;t?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<r;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(e-1)}.0`),n+=a,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}class Wa extends Ct{constructor(t,e=8,i=4,n=Ct.defaultResolution,s=5){const o=F_(s,t),a=R_(s);super(o,a),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,n);else{const s=t.getFilterTexture(),o=t.renderer;let a=e,h=s;this.state.blend=!1,t.applyFilter(this,a,h,ce.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,ce.BLIT),this.uniforms.uSampler=h;const u=h;h=a,a=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,i,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class D_ extends Ct{constructor(t=8,e=4,i=Ct.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Wa(!0,t,e,i,n),this.blurYFilter=new Wa(!1,t,e,i,n),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,n){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,ce.CLEAR),this.blurYFilter.apply(t,a,i,n),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,i,n):this.blurXFilter.apply(t,e,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var B_=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ja extends Ct{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(mf,B_,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,n,s]=_t.shared.setValue(t).toArray(),o=[i,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),s=Math.sqrt,o=1/3,a=s(o),h=i+(1-i)*o,l=o*(1-i)-a*n,u=o*(1-i)+a*n,c=o*(1-i)+a*n,d=i+o*(1-i),f=o*(1-i)-a*n,p=o*(1-i)-a*n,m=o*(1-i)+a*n,g=i+o*(1-i),y=[h,l,u,0,0,c,d,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const i=(t||0)+1,n=-.5*(i-1),s=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const i=t*2/3+1,n=(i-1)*-.5,s=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,n,s){t=t||.2,e=e||.15,i=i||16770432,n=n||3375104;const o=_t.shared,[a,h,l]=o.setValue(i).toArray(),[u,c,d]=o.setValue(n).toArray(),f=[.3,.59,.11,0,0,a,h,l,t,0,u,c,d,e,0,a-u,h-c,l-d,0,0];this._loadMatrix(f,s)}night(t,e){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}ja.prototype.grayscale=ja.prototype.greyscale;var O_=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,L_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class N_ extends Ct{constructor(t,e){const i=new vt;t.renderable=!1,super(L_,O_,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,e==null&&(e=20),this.scale=new ct(e,e)}apply(t,e,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,o=Math.sqrt(s.a*s.a+s.b*s.b),a=Math.sqrt(s.c*s.c+s.d*s.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=s.a/o,this.uniforms.rotation[1]=s.b/o,this.uniforms.rotation[2]=s.c/a,this.uniforms.rotation[3]=s.d/a),t.applyFilter(this,e,i,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var k_=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,U_=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class G_ extends Ct{constructor(){super(U_,k_)}}var H_=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class z_ extends Ct{constructor(t=.5,e=Math.random()){super(mf,H_,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const hc={AlphaFilter:C_,BlurFilter:D_,BlurFilterPass:Wa,ColorMatrixFilter:ja,DisplacementFilter:N_,FXAAFilter:G_,NoiseFilter:z_};Object.entries(hc).forEach(([r,t])=>{Object.defineProperty(hc,r,{get(){return pt("7.1.0",`filters.${r} has moved to ${r}`),t}})});class $_{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Nt.system.add(this.tickerUpdate,this,xr.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Nt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Ge=new $_;class Bi{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Bi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ct,this.page=new ct,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Kn extends Bi{constructor(){super(...arguments),this.client=new ct,this.movement=new ct,this.offset=new ct,this.global=new ct,this.screen=new ct}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,s,o,a,h,l,u,c,d,f,p,m){throw new Error("Method not implemented.")}}class Qt extends Kn{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Xr extends Kn{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Xr.DOM_DELTA_PIXEL=0,Xr.DOM_DELTA_LINE=1,Xr.DOM_DELTA_PAGE=2;const V_=2048,X_=new ct,Ko=new ct;class W_{constructor(t){this.dispatch=new Mi,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,n=e.length;i<n;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Ge.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[i](this.rootTarget,this.rootTarget.eventMode,X_.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=i.length-1;n<s;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let s=i.length-1;s>=0;s--)n.forEach(o=>{t.currentTarget=i[s],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let i=0;i<V_&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,n,s,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Ge.pauseUpdate=!1),t.interactiveChildren&&t.children){const u=t.children;for(let c=u.length-1;c>=0;c--){const d=u[c],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,n,s,o||s(t,i));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const h=this._isInteractive(e),l=t.isInteractive();return l&&l&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:h&&!s(t,i)&&n(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,n,s){if(this._interactivePrune(t)||s(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Ge.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const u=h[l],c=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,i,n,s);if(c){if(c.length>0&&!c[c.length-1].parent)continue;const d=t.isInteractive();return(c.length>0||d)&&c.push(t),c}}}const o=this._isInteractive(e),a=t.isInteractive();return o&&n(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var i;if(t.hitArea&&(t.worldTransform.applyInverse(e,Ko),!t.hitArea.contains(Ko.x,Ko.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var s,o;e=e??t.type;const i=`on${e}`;(o=(s=t.currentTarget)[i])==null||o.call(s,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var h,l;if(!(t instanceof Qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(((h=n.overTargets)==null?void 0:h.length)>0&&s!==e.target){const u=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,u,s);if(this.dispatchEvent(c,"pointerout"),i&&this.dispatchEvent(c,"mouseout"),!e.composedPath().includes(s)){const d=this.createPointerEvent(t,"pointerleave",s);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}if(s!==e.target){const u=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(e,u);this.dispatchEvent(c,"pointerover"),i&&this.dispatchEvent(c,"mouseover");let d=s==null?void 0:s.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const f=this.clonePointerEvent(e,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==s&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),i&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(l=e.target)==null?void 0:l.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var o;if(!(t instanceof Qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(o=i.target)==null?void 0:o.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=s;if(s&&!i.composedPath().includes(s)){let a=s;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const h=i.button===2;this.notifyTarget(i,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const h=n.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){const l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let s=i;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Xr)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const n=this.allocateEvent(Qt);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Xr);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Qt);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Qt&&e instanceof Qt&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Kn&&e instanceof Kn&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let n=0,s=i.length;n<s&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeListener(e,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,t)}}const j_=1,q_={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},qa=class Ya{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new W_(null),Ge.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Qt(null),this.rootWheelEvent=new Xr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Ya.defaultEventFeatures},{set:(e,i,n)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),e[i]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,Ya._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,n=e.length;i<n;i++){const s=e[i],o=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Ge.pointerMoved();const e=this.normalizeToPointerData(t);for(let i=0,n=e.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,o=n.length;s<o;s++){const a=this.bootstrapEvent(this.rootPointerEvent,n[s]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let i=0,n=e.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Ge.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Ge.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Ge.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(i-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const s=t.changedTouches[i];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=j_),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=q_[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};qa.extension={name:"events",type:[q.RendererSystem,q.CanvasRendererSystem]},qa.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Ka=qa;tt.add(Ka);function lc(r){return r==="dynamic"||r==="static"}const Y_={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??lc(Ka.defaultEventMode)},set interactive(r){pt("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Ka.defaultEventMode},set eventMode(r){this._internalInteractive=lc(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.on(r,t,n)},removeEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,n)},dispatchEvent(r){if(!(r instanceof Bi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};xt.mixin(Y_);const K_={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};xt.mixin(K_);const Z_=9,nn=100,Q_=0,J_=0,uc=2,cc=1,tx=-1e3,ex=-1e3,rx=2;class Af{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Ce.tablet||Ce.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${nn}px`,e.style.height=`${nn}px`,e.style.position="absolute",e.style.top=`${Q_}px`,e.style.left=`${J_}px`,e.style.zIndex=uc.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${cc}px`,t.style.height=`${cc}px`,t.style.position="absolute",t.style.top=`${tx}px`,t.style.left=`${ex}px`,t.style.zIndex=rx.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(Ce.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:h}=this.renderer,l=n/o*h,u=s/a*h;let c=this.div;c.style.left=`${e}px`,c.style.top=`${i}px`,c.style.width=`${o}px`,c.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,$r(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{c=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(c.style.left=`${(m.tx+p.x*m.a)*l}px`,c.style.top=`${(m.ty+p.y*m.d)*u}px`,c.style.width=`${p.width*m.a*l}px`,c.style.height=`${p.height*m.d*u}px`):(p=f.getBounds(),this.capHitArea(p),c.style.left=`${p.x*l}px`,c.style.top=`${p.y*u}px`,c.style.width=`${p.width*l}px`,c.style.height=`${p.height*u}px`,c.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(c.title=f.accessibleTitle),c.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&c.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==c.title||f.tabIndex!==c.tabIndex)&&(c.title=f.accessibleTitle,c.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${nn}px`,e.style.height=`${nn}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=uc.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new Bi(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>n.dispatchEvent(s,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===Z_&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Af.extension={name:"accessibility",type:[q.RendererPlugin,q.CanvasRendererPlugin]};tt.add(Af);const Ef=class Za{constructor(t){this.stage=new Gt,t=Object.assign({forceCanvas:!1},t),this.renderer=pf(t),Za._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const i=Za._plugins.slice(0);i.reverse(),i.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Ef._plugins=[];let ix=Ef;tt.handleByList(q.Application,ix._plugins);class Sf{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,i=s}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Sf.extension=q.Application;tt.add(Sf);const dc={loader:q.LoadParser,resolver:q.ResolveParser,cache:q.CacheParser,detection:q.DetectionParser};tt.handle(q.Asset,r=>{const t=r.ref;Object.entries(dc).filter(([e])=>!!t[e]).forEach(([e,i])=>tt.add(Object.assign(t[e],{extension:t[e].extension??i})))},r=>{const t=r.ref;Object.keys(dc).filter(e=>!!t[e]).forEach(e=>tt.remove(t[e]))});class nx{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Jr(r,t){if(Array.isArray(t)){for(const e of t)if(r.startsWith(`data:${e}`))return!0;return!1}return r.startsWith(`data:${t}`)}function Ke(r,t){const e=r.split("?")[0],i=Pt.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const ee=(r,t,e=!1)=>(Array.isArray(r)||(r=[r]),t?r.map(i=>typeof i=="string"||e?t(i):i):r),Qa=(r,t)=>{const e=t.split("?")[1];return e&&(r+=`?${e}`),r};function Cf(r,t,e,i,n){const s=t[e];for(let o=0;o<s.length;o++){const a=s[o];e<t.length-1?Cf(r.replace(i[e],a),t,e+1,i,n):n.push(r.replace(i[e],a))}}function sx(r){const t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){const n=[];e.forEach(s=>{const o=s.substring(1,s.length-1).split(",");n.push(o)}),Cf(r,n,0,e,i)}else i.push(r);return i}const Zn=r=>!Array.isArray(r);class ox{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=ee(t);let n;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.test(e)){n=h.getCacheableAssets(i,e);break}}n||(n={},i.forEach(a=>{n[a]=e}));const s=Object.keys(n),o={cacheKeys:s,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,o)}),s.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,n[a])}),e instanceof j){const a=e;i.forEach(h=>{a.baseTexture!==j.EMPTY.baseTexture&&ut.addToCache(a.baseTexture,h),j.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const fr=new ox;class ax{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var o,a;let n=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((o=l.test)!=null&&o.call(l,t,e,this))){s=l;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),i.parser=s;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((a=l.testParse)==null?void 0:a.call(l,n,e,this))&&(n=await l.parse(n,e,this)||n,i.parser=l)}return n})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const n={},s=Zn(t),o=ee(t,l=>({alias:[l],src:l})),a=o.length,h=o.map(async l=>{const u=Pt.toAbsolute(l.src);if(!n[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),n[l.src]=await this.promiseCache[u].promise,e&&e(++i/a)}catch(c){throw delete this.promiseCache[u],delete n[l.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(h),s?n[o[0].src]:n}async unload(t){const e=ee(t,i=>({alias:[i],src:i})).map(async i=>{var o,a;const n=Pt.toAbsolute(i.src),s=this.promiseCache[n];if(s){const h=await s.promise;delete this.promiseCache[n],(a=(o=s.parser)==null?void 0:o.unload)==null||a.call(o,h,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var se=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(se||{});const hx=".json",lx="application/json",ux={extension:{type:q.LoadParser,priority:se.Low},name:"loadJson",test(r){return Jr(r,lx)||Ke(r,hx)},async load(r){return await(await Q.ADAPTER.fetch(r)).json()}};tt.add(ux);const cx=".txt",dx="text/plain",fx={name:"loadTxt",extension:{type:q.LoadParser,priority:se.Low},test(r){return Jr(r,dx)||Ke(r,cx)},async load(r){return await(await Q.ADAPTER.fetch(r)).text()}};tt.add(fx);const px=["normal","bold","100","200","300","400","500","600","700","800","900"],mx=[".ttf",".otf",".woff",".woff2"],gx=["font/ttf","font/otf","font/woff","font/woff2"],yx=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function vx(r){const t=Pt.extname(r),e=Pt.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1));let i=e.length>0;for(const s of e)if(!s.match(yx)){i=!1;break}let n=e.join(" ");return i||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const _x={extension:{type:q.LoadParser,priority:se.Low},name:"loadWebFont",test(r){return Jr(r,gx)||Ke(r,mx)},async load(r,t){var i,n,s;const e=Q.ADAPTER.getFontFaceSet();if(e){const o=[],a=((i=t.data)==null?void 0:i.family)??vx(r),h=((s=(n=t.data)==null?void 0:n.weights)==null?void 0:s.filter(u=>px.includes(u)))??["normal"],l=t.data??{};for(let u=0;u<h.length;u++){const c=h[u],d=new FontFace(a,`url(${encodeURI(r)})`,{...l,weight:c});await d.load(),e.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>Q.ADAPTER.getFontFaceSet().delete(t))}};tt.add(_x);let fc=0,Zo;const xx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",bx={code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${xx}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},wx={code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Qo;class Tx{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([bx.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",n=>{i.terminate(),URL.revokeObjectURL(e),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Zo===void 0&&(Zo=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Zo&&(Qo||(Qo=URL.createObjectURL(new Blob([wx.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Qo),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[fc]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:fc++,id:i})}}const pc=new Tx;function Oi(r,t,e){r.resource.internal=!0;const i=new j(r),n=()=>{delete t.promiseCache[e],fr.has(e)&&fr.remove(e)};return i.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),i}const Ax=[".jpeg",".jpg",".png",".webp",".avif"],Ex=["image/jpeg","image/png","image/webp","image/avif"];async function Sx(r){const t=await Q.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const ms={name:"loadTextures",extension:{type:q.LoadParser,priority:se.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return Jr(r,Ex)||Ke(r,Ax)},async load(r,t,e){var a;const i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;i?this.config.preferWorkers&&await pc.isImageBitmapSupported()?n=await pc.loadImageBitmap(r):n=await Sx(r):n=await new Promise((h,l)=>{const u=new Image;u.crossOrigin=this.config.crossOrigin,u.src=r,u.complete?h(u):(u.onload=()=>h(u),u.onerror=c=>l(c))});const s={...t.data};s.resolution??(s.resolution=Me(r)),i&&((a=s.resourceOptions)==null?void 0:a.ownsImageBitmap)===void 0&&(s.resourceOptions={...s.resourceOptions},s.resourceOptions.ownsImageBitmap=!0);const o=new ut(n,s);return o.resource.src=r,Oi(o,e,r)},unload(r){r.destroy(!0)}};tt.add(ms);const Cx=".svg",Px="image/svg+xml",Ix={extension:{type:q.LoadParser,priority:se.High},name:"loadSVG",test(r){return Jr(r,Px)||Ke(r,Cx)},async testParse(r){return za.test(r)},async parse(r,t,e){var s;const i=new za(r,(s=t==null?void 0:t.data)==null?void 0:s.resourceOptions);await i.load();const n=new ut(i,{resolution:Me(r),...t==null?void 0:t.data});return n.resource.src=t.src,Oi(n,e,t.src)},async load(r,t){return(await Q.ADAPTER.fetch(r)).text()},unload:ms.unload};tt.add(Ix);const Rx=[".mp4",".m4v",".webm",".ogv"],Mx=["video/mp4","video/webm","video/ogg"],Fx={name:"loadVideo",extension:{type:q.LoadParser,priority:se.High},config:{defaultAutoPlay:!0},test(r){return Jr(r,Mx)||Ke(r,Rx)},async load(r,t,e){var o;let i;const n=await(await Q.ADAPTER.fetch(r)).blob(),s=URL.createObjectURL(n);try{const a={autoPlay:this.config.defaultAutoPlay,...(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions},h=new bf(s,a);await h.load();const l=new ut(h,{alphaMode:await G1(),resolution:Me(r),...t==null?void 0:t.data});l.resource.src=r,i=Oi(l,e,r),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(s)})}catch(a){throw URL.revokeObjectURL(s),a}return i},unload(r){r.destroy(!0)}};tt.add(Fx);class Dx{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,name:i,src:n,srcs:s}=t;return ee(e||i||n||s,o=>typeof o=="string"?o:Array.isArray(o)?o.map(a=>(a==null?void 0:a.src)??(a==null?void 0:a.srcs)??a):o!=null&&o.src||o!=null&&o.srcs?o.src??o.srcs:o,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(n=>{const s=n.src??n.srcs,o=n.alias??n.name;let a;if(typeof o=="string"){const h=this._createBundleAssetId(t,o);i.push(h),a=[o,h]}else{const h=o.map(l=>this._createBundleAssetId(t,l));i.push(...h),a=[...o,...h]}this.add({...n,alias:a,src:s})}):Object.keys(e).forEach(n=>{const s=[n,this._createBundleAssetId(t,n)];if(typeof e[n]=="string")this.add({alias:s,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:s,src:e[n]});else{const o=e[n],a=o.src??o.srcs;this.add({...o,alias:s,src:Array.isArray(a)?a:[a]})}i.push(...s)}),this._bundles[t]=i}add(t,e,i,n,s){const o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(pt("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:i,format:n,loadParser:s})):Array.isArray(t)?o.push(...t):o.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},ee(o).forEach(h=>{const{src:l,srcs:u}=h;let{data:c,format:d,loadParser:f}=h;const p=ee(l||u).map(y=>typeof y=="string"?sx(y):Array.isArray(y)?y:[y]),m=this.getAlias(h);Array.isArray(m)?m.forEach(a):a(m);const g=[];p.forEach(y=>{y.forEach(x=>{let v={};if(typeof x!="object"){v.src=x;for(let E=0;E<this._parsers.length;E++){const w=this._parsers[E];if(w.test(x)){v=w.parse(x);break}}}else c=x.data??c,d=x.format??d,f=x.loadParser??f,v={...v,...x};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${v.src}`);v=this.buildResolvedAsset(v,{aliases:m,data:c,format:d,loadParser:f}),g.push(v)})}),m.forEach(y=>{this._assetMap[y]=g})})}resolveBundle(t){const e=Zn(t);t=ee(t);const i={};return t.forEach(n=>{const s=this._bundles[n];if(s){const o=this.resolve(s),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(n,h)]=l}i[n]=a}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const n in e)i[n]=e[n].src;return i}return e.src}resolve(t){const e=Zn(t);t=ee(t);const i={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const o=s[0],a=this._getPreferredOrder(s);a==null||a.priority.forEach(h=>{a.params[h].forEach(l=>{const u=s.filter(c=>c[h]?c[h]===l:!1);u.length&&(s=u)})}),this._resolverHash[n]=s[0]??o}else this._resolverHash[n]=this.buildResolvedAsset({alias:[n],src:n},{});i[n]=this._resolverHash[n]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:i,data:n,loadParser:s,format:o}=e;return(this._basePath||this._rootPath)&&(t.src=Pt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.format=o??t.src.split(".").pop(),t.srcs=t.src,t.name=t.alias,t}}class Bx{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Dx,this.loader=new ax,this.cache=fr,this._backgroundLoader=new nx(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var s,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=((s=t.texturePreference)==null?void 0:s.resolution)??1,i=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,n,s){this.resolver.add(t,e,i,n,s)}async load(t,e){this._initialized||await this.init();const i=Zn(t),n=ee(t).map(a=>{if(typeof a!="string"){const h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),s=this.resolver.resolve(n),o=await this._mapLoadToResolve(s,e);return i?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},o=Object.keys(n);let a=0,h=0;const l=()=>{e==null||e(++a/h)},u=o.map(c=>{const d=n[c];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{s[c]=f})});return await Promise.all(u),i?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return fr.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=fr.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(i,e);this._backgroundLoader.active=!0;const o={};return i.forEach((a,h)=>{const l=s[a.src],u=[a.src];a.alias&&u.push(...a.alias),o[n[h]]=l,fr.set(u,l)}),o}async unload(t){this._initialized||await this.init();const e=ee(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=ee(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{fr.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,n)=>e.indexOf(i)===n),e}get detections(){return this._detections}get preferWorkers(){return ms.config.preferWorkers}set preferWorkers(t){pt("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const sn=new Bx;tt.handleByList(q.LoadParser,sn.loader.parsers).handleByList(q.ResolveParser,sn.resolver.parsers).handleByList(q.CacheParser,sn.cache.parsers).handleByList(q.DetectionParser,sn.detections);const Ox={extension:q.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof j),getCacheableAssets:(r,t)=>{const e={};return r.forEach(i=>{t.forEach((n,s)=>{e[i+(s===0?"":s+1)]=n})}),e}};tt.add(Ox);const Lx={extension:{type:q.DetectionParser,priority:1},test:async()=>{const r="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=";return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r})},add:async r=>[...r,"avif"],remove:async r=>r.filter(t=>t!=="avif")};tt.add(Lx);const Nx={extension:{type:q.DetectionParser,priority:0},test:async()=>{const r="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=";return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r})},add:async r=>[...r,"webp"],remove:async r=>r.filter(t=>t!=="webp")};tt.add(Nx);const mc=["png","jpg","jpeg"],kx={extension:{type:q.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...mc],remove:async r=>r.filter(t=>!mc.includes(t))};tt.add(kx);const Ux="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Ph(r){return Ux?!1:document.createElement("video").canPlayType(r)!==""}const Gx={extension:{type:q.DetectionParser,priority:0},test:async()=>Ph("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(t=>t!=="webm")};tt.add(Gx);const Hx={extension:{type:q.DetectionParser,priority:0},test:async()=>Ph("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(t=>t!=="mp4"&&t!=="m4v")};tt.add(Hx);const zx={extension:{type:q.DetectionParser,priority:0},test:async()=>Ph("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(t=>t!=="ogv")};tt.add(zx);const $x={extension:q.ResolveParser,test:ms.test,parse:r=>{var t;return{resolution:parseFloat(((t=Q.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:r.split(".").pop(),src:r}}};tt.add($x);var Ot=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r))(Ot||{});const Qn={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Ae,Br;function gc(){Br={s3tc:Ae.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ae.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Ae.getExtension("WEBGL_compressed_texture_etc"),etc1:Ae.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Ae.getExtension("WEBGL_compressed_texture_pvrtc")||Ae.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Ae.getExtension("WEBGL_compressed_texture_atc"),astc:Ae.getExtension("WEBGL_compressed_texture_astc")}}const Vx={extension:{type:q.DetectionParser,priority:2},test:async()=>{const r=Q.ADAPTER.createCanvas().getContext("webgl");return r?(Ae=r,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{Br||gc();const t=[];for(const e in Br)Br[e]&&t.push(e);return[...t,...r]},remove:async r=>(Br||gc(),r.filter(t=>!(t in Br)))};tt.add(Vx);class Xx extends ls{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,n;typeof t=="string"?(i=t,n=new Uint8Array):(i=null,n=t),super(n,e),this.origin=i,this.buffer=n?new Ia(n):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Ia(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class yr extends Xx{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=yr._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||yr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let s=0,o=this.levels;s<o;s++){const{levelID:a,levelWidth:h,levelHeight:l,levelBuffer:u}=this._levelBuffers[s];n.compressedTexImage2D(n.TEXTURE_2D,a,this.format,h,l,0,u)}return!0}onBlobLoaded(){this._levelBuffers=yr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,n,s,o,a){const h=new Array(i);let l=t.byteOffset,u=o,c=a,d=u+n-1&~(n-1),f=c+s-1&~(s-1),p=d*f*Qn[e];for(let m=0;m<i;m++)h[m]={levelID:m,levelWidth:i>1?u:d,levelHeight:i>1?c:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,u=u>>1||1,c=c>>1||1,d=u+n-1&~(n-1),f=c+s-1&~(s-1),p=d*f*Qn[e];return h}}const Jo=4,on=124,Wx=32,yc=20,jx=542327876,an={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},qx={FOURCC:2},hn={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},Yx=1,Kx=2,Zx=4,Qx=64,Jx=512,tb=131072,eb=827611204,rb=861165636,ib=894720068,nb=808540228,sb=4,ob={[eb]:Ot.COMPRESSED_RGBA_S3TC_DXT1_EXT,[rb]:Ot.COMPRESSED_RGBA_S3TC_DXT3_EXT,[ib]:Ot.COMPRESSED_RGBA_S3TC_DXT5_EXT},ab={70:Ot.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Ot.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Ot.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Ot.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Ot.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Ot.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function hb(r){const t=new Uint32Array(r);if(t[0]!==jx)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(r,0,on/Uint32Array.BYTES_PER_ELEMENT),i=e[an.HEIGHT],n=e[an.WIDTH],s=e[an.MIPMAP_COUNT],o=new Uint32Array(r,an.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Wx/Uint32Array.BYTES_PER_ELEMENT),a=o[Yx];if(a&Zx){const h=o[qx.FOURCC];if(h!==nb){const x=ob[h],v=Jo+on,E=new Uint8Array(r,v);return[new yr(E,{format:x,width:n,height:i,levels:s})]}const l=Jo+on,u=new Uint32Array(t.buffer,l,yc/Uint32Array.BYTES_PER_ELEMENT),c=u[hn.DXGI_FORMAT],d=u[hn.RESOURCE_DIMENSION],f=u[hn.MISC_FLAG],p=u[hn.ARRAY_SIZE],m=ab[c];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(f===sb)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const g=new Array,y=Jo+on+yc;if(p===1)g.push(new Uint8Array(r,y));else{const x=Qn[m];let v=0,E=n,w=i;for(let T=0;T<s;T++){const F=Math.max(1,E+3&-4),U=Math.max(1,w+3&-4),G=F*U*x;v+=G,E=E>>>1,w=w>>>1}let I=y;for(let T=0;T<p;T++)g.push(new Uint8Array(r,I,v)),I+=v}return g.map(x=>new yr(x,{format:m,width:n,height:i,levels:s}))}throw a&Qx?new Error("DDSParser does not support uncompressed texture data."):a&Jx?new Error("DDSParser does not supported YUV uncompressed texture data."):a&tb?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&Kx?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const vc=[171,75,84,88,32,49,49,187,13,10,26,10],lb=67305985,Kt={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Ja=64,_c={[ot.UNSIGNED_BYTE]:1,[ot.UNSIGNED_SHORT]:2,[ot.INT]:4,[ot.UNSIGNED_INT]:4,[ot.FLOAT]:4,[ot.HALF_FLOAT]:8},ub={[V.RGBA]:4,[V.RGB]:3,[V.RG]:2,[V.RED]:1,[V.LUMINANCE]:1,[V.LUMINANCE_ALPHA]:2,[V.ALPHA]:1},cb={[ot.UNSIGNED_SHORT_4_4_4_4]:2,[ot.UNSIGNED_SHORT_5_5_5_1]:2,[ot.UNSIGNED_SHORT_5_6_5]:2};function db(r,t,e=!1){const i=new DataView(t);if(!fb(r,i))return null;const n=i.getUint32(Kt.ENDIANNESS,!0)===lb,s=i.getUint32(Kt.GL_TYPE,n),o=i.getUint32(Kt.GL_FORMAT,n),a=i.getUint32(Kt.GL_INTERNAL_FORMAT,n),h=i.getUint32(Kt.PIXEL_WIDTH,n),l=i.getUint32(Kt.PIXEL_HEIGHT,n)||1,u=i.getUint32(Kt.PIXEL_DEPTH,n)||1,c=i.getUint32(Kt.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=i.getUint32(Kt.NUMBER_OF_FACES,n),f=i.getUint32(Kt.NUMBER_OF_MIPMAP_LEVELS,n),p=i.getUint32(Kt.BYTES_OF_KEY_VALUE_DATA,n);if(l===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");const m=4,g=4,y=h+3&-4,x=l+3&-4,v=new Array(c);let E=h*l;s===0&&(E=y*x);let w;if(s!==0?_c[s]?w=_c[s]*ub[o]:w=cb[s]:w=Qn[a],w===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const I=e?mb(i,p,n):null;let T=E*w,F=h,U=l,G=y,z=x,M=Ja+p;for(let B=0;B<f;B++){const S=i.getUint32(M,n);let N=M+4;for(let _=0;_<c;_++){let A=v[_];A||(A=v[_]=new Array(f)),A[B]={levelID:B,levelWidth:f>1||s!==0?F:G,levelHeight:f>1||s!==0?U:z,levelBuffer:new Uint8Array(t,N,T)},N+=T}M+=S+4,M=M%4!==0?M+4-M%4:M,F=F>>1||1,U=U>>1||1,G=F+m-1&-4,z=U+g-1&-4,T=G*z*w}return s!==0?{uncompressed:v.map(B=>{let S=B[0].levelBuffer,N=!1;return s===ot.FLOAT?S=new Float32Array(B[0].levelBuffer.buffer,B[0].levelBuffer.byteOffset,B[0].levelBuffer.byteLength/4):s===ot.UNSIGNED_INT?(N=!0,S=new Uint32Array(B[0].levelBuffer.buffer,B[0].levelBuffer.byteOffset,B[0].levelBuffer.byteLength/4)):s===ot.INT&&(N=!0,S=new Int32Array(B[0].levelBuffer.buffer,B[0].levelBuffer.byteOffset,B[0].levelBuffer.byteLength/4)),{resource:new ls(S,{width:B[0].levelWidth,height:B[0].levelHeight}),type:s,format:N?pb(o):o}}),kvData:I}:{compressed:v.map(B=>new yr(null,{format:a,width:h,height:l,levels:f,levelBuffers:B})),kvData:I}}function fb(r,t){for(let e=0;e<vc.length;e++)if(t.getUint8(e)!==vc[e])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function pb(r){switch(r){case V.RGBA:return V.RGBA_INTEGER;case V.RGB:return V.RGB_INTEGER;case V.RG:return V.RG_INTEGER;case V.RED:return V.RED_INTEGER;default:return r}}function mb(r,t,e){const i=new Map;let n=0;for(;n<t;){const s=r.getUint32(Ja+n,e),o=Ja+n+4,a=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<s&&r.getUint8(o+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(r.buffer,o,h)),u=new DataView(r.buffer,o+h+1,s-h-1);i.set(l,u),n+=4+s+a}return i}const gb={extension:{type:q.LoadParser,priority:se.High},name:"loadDDS",test(r){return Ke(r,".dds")},async load(r,t,e){const i=await(await Q.ADAPTER.fetch(r)).arrayBuffer(),n=hb(i).map(s=>{const o=new ut(s,{mipmap:ye.OFF,alphaMode:Ft.NO_PREMULTIPLIED_ALPHA,resolution:Me(r),...t.data});return Oi(o,e,r)});return n.length===1?n[0]:n},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};tt.add(gb);const yb={extension:{type:q.LoadParser,priority:se.High},name:"loadKTX",test(r){return Ke(r,".ktx")},async load(r,t,e){const i=await(await Q.ADAPTER.fetch(r)).arrayBuffer(),{compressed:n,uncompressed:s,kvData:o}=db(r,i),a=n??s,h={mipmap:ye.OFF,alphaMode:Ft.NO_PREMULTIPLIED_ALPHA,resolution:Me(r),...t.data},l=a.map(u=>{a===s&&Object.assign(h,{type:u.type,format:u.format});const c=u.resource??u,d=new ut(c,h);return d.ktxKeyValueData=o,Oi(d,e,r)});return l.length===1?l[0]:l},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};tt.add(yb);const vb={extension:q.ResolveParser,test:r=>{const t=r.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(t)},parse:r=>{var t,e;if(r.split("?")[0].split(".").pop()==="ktx"){const i=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(i.some(n=>r.endsWith(n)))return{resolution:parseFloat(((t=Q.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:i.find(n=>r.endsWith(n)),src:r}}return{resolution:parseFloat(((e=Q.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:r.split(".").pop(),src:r}}};tt.add(vb);const ln=new ht,_b=4,Pf=class _i{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,n){const s=new Image;return s.src=await this.base64(t,e,i,n),s}async base64(t,e,i,n){const s=this.canvas(t,n);if(s.toBlob!==void 0)return new Promise((o,a)=>{s.toBlob(h=>{if(!h){a(new Error("ICanvas.toBlob failed!"));return}const l=new FileReader;l.onload=()=>o(l.result),l.onerror=a,l.readAsDataURL(h)},e,i)});if(s.toDataURL!==void 0)return s.toDataURL(e,i);if(s.convertToBlob!==void 0){const o=await s.convertToBlob({type:e,quality:i});return new Promise((a,h)=>{const l=new FileReader;l.onload=()=>a(l.result),l.onerror=h,l.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:i,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);o&&_i._flipY(i,n,s),a&&_i._unpremultiplyAlpha(i);const h=new rv(n,s,1),l=new ImageData(new Uint8ClampedArray(i.buffer),n,s);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){const{pixels:i,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);return o&&_i._flipY(i,n,s),a&&_i._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let n,s=!1,o=!1,a,h=!1;t&&(t instanceof wr?a=t:(a=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),h=!0,e&&(ln.width=e.width,ln.height=e.height,e=ln)));const l=i.gl;if(a){if(n=a.baseTexture.resolution,e=e??a.frame,s=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===V.RGBA,!h){i.renderTexture.bind(a);const f=a.framebuffer.glFramebuffers[i.CONTEXT_UID];f.blitFramebuffer&&i.framebuffer.bind(f.blitFramebuffer)}}else n=i.resolution,e||(e=ln,e.width=i.width/n,e.height=i.height/n),s=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();const u=Math.max(Math.round(e.width*n),1),c=Math.max(Math.round(e.height*n),1),d=new Uint8Array(_b*u*c);return l.readPixels(Math.round(e.x*n),Math.round(e.y*n),u,c,l.RGBA,l.UNSIGNED_BYTE,d),h&&(a==null||a.destroy(!0)),{pixels:d,width:u,height:c,flipY:s,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,i){const n=e<<2,s=i>>1,o=new Uint8Array(n);for(let a=0;a<s;a++){const h=a*n,l=(i-a-1)*n;o.set(t.subarray(h,h+n)),t.copyWithin(h,l,l+n),t.set(o,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const n=t[i+3];if(n!==0){const s=255.001/n;t[i]=t[i]*s+.5,t[i+1]=t[i+1]*s+.5,t[i+2]=t[i+2]*s+.5}}}};Pf.extension={name:"extract",type:q.RendererSystem};let xb=Pf;tt.add(xb);const Jn={build(r){const t=r.points;let e,i,n,s,o,a;if(r.type===St.CIRC){const p=r.shape;e=p.x,i=p.y,o=a=p.radius,n=s=0}else if(r.type===St.ELIP){const p=r.shape;e=p.x,i=p.y,o=p.width,a=p.height,n=s=0}else{const p=r.shape,m=p.width/2,g=p.height/2;e=p.x+m,i=p.y+g,o=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),n=m-o,s=g-a}if(!(o>=0&&a>=0&&n>=0&&s>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(n?4:0)+(s?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=i+s,t[2]=t[4]=e-n,t[5]=t[7]=i-s;return}let u=0,c=h*4+(n?2:0)+2,d=c,f=l;{const p=n+o,m=s,g=e+p,y=e-p,x=i+m;if(t[u++]=g,t[u++]=x,t[--c]=x,t[--c]=y,s){const v=i-m;t[d++]=y,t[d++]=v,t[--f]=v,t[--f]=g}}for(let p=1;p<h;p++){const m=Math.PI/2*(p/h),g=n+Math.cos(m)*o,y=s+Math.sin(m)*a,x=e+g,v=e-g,E=i+y,w=i-y;t[u++]=x,t[u++]=E,t[--c]=E,t[--c]=v,t[d++]=v,t[d++]=w,t[--f]=w,t[--f]=x}{const p=n,m=s+a,g=e+p,y=e-p,x=i+m,v=i-m;t[u++]=g,t[u++]=x,t[--f]=v,t[--f]=g,n&&(t[u++]=y,t[u++]=x,t[--f]=v,t[--f]=y)}},triangulate(r,t){const e=r.points,i=t.points,n=t.indices;if(e.length===0)return;let s=i.length/2;const o=s;let a,h;if(r.type!==St.RREC){const u=r.shape;a=u.x,h=u.y}else{const u=r.shape;a=u.x+u.width/2,h=u.y+u.height/2}const l=r.matrix;i.push(r.matrix?l.a*a+l.c*h+l.tx:a,r.matrix?l.b*a+l.d*h+l.ty:h),s++,i.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)i.push(e[u],e[u+1]),n.push(s++,o,s);n.push(o+1,o,s)}};function xc(r,t=!1){const e=r.length;if(e<6)return;let i=0;for(let n=0,s=r[e-2],o=r[e-1];n<e;n+=2){const a=r[n],h=r[n+1];i+=(a-s)*(h+o),s=a,o=h}if(!t&&i>0||t&&i<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const o=e-s-2,a=e-s-1,h=s,l=s+1;[r[o],r[h]]=[r[h],r[o]],[r[a],r[l]]=[r[l],r[a]]}}}const If={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points;const i=r.holes,n=t.points,s=t.indices;if(e.length>=6){xc(e,!1);const o=[];for(let l=0;l<i.length;l++){const u=i[l];xc(u.points,!0),o.push(e.length/2),e=e.concat(u.points)}const a=Qy(e,o,2);if(!a)return;const h=n.length/2;for(let l=0;l<a.length;l+=3)s.push(a[l]+h),s.push(a[l+1]+h),s.push(a[l+2]+h);for(let l=0;l<e.length;l++)n.push(e[l])}}},bb={build(r){const t=r.shape,e=t.x,i=t.y,n=t.width,s=t.height,o=r.points;o.length=0,n>=0&&s>=0&&o.push(e,i,e+n,i,e+n,i+s,e,i+s)},triangulate(r,t){const e=r.points,i=t.points;if(e.length===0)return;const n=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},wb={build(r){Jn.build(r)},triangulate(r,t){Jn.triangulate(r,t)}};var zt=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(zt||{}),ze=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(ze||{});const Yr={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class bc{static curveTo(t,e,i,n,s,o){const a=o[o.length-2],h=o[o.length-1]-e,l=a-t,u=n-e,c=i-t,d=Math.abs(h*c-l*u);if(d<1e-8||s===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const f=h*h+l*l,p=u*u+c*c,m=h*u+l*c,g=s*Math.sqrt(f)/d,y=s*Math.sqrt(p)/d,x=g*m/f,v=y*m/p,E=g*c+y*l,w=g*u+y*h,I=l*(y+x),T=h*(y+x),F=c*(g+v),U=u*(g+v),G=Math.atan2(T-w,I-E),z=Math.atan2(U-w,F-E);return{cx:E+t,cy:w+e,radius:s,startAngle:G,endAngle:z,anticlockwise:l*u>c*h}}static arc(t,e,i,n,s,o,a,h,l){const u=a-o,c=Yr._segmentsCount(Math.abs(u)*s,Math.ceil(Math.abs(u)/Vn)*40),d=u/(c*2),f=d*2,p=Math.cos(d),m=Math.sin(d),g=c-1,y=g%1/g;for(let x=0;x<=g;++x){const v=x+y*x,E=d+o+f*v,w=Math.cos(E),I=-Math.sin(E);l.push((p*w+m*I)*s+i,(p*-I+m*w)*s+n)}}}class Tb{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Ih{static curveLength(t,e,i,n,s,o,a,h){let l=0,u=0,c=0,d=0,f=0,p=0,m=0,g=0,y=0,x=0,v=0,E=t,w=e;for(let I=1;I<=10;++I)u=I/10,c=u*u,d=c*u,f=1-u,p=f*f,m=p*f,g=m*t+3*p*u*i+3*f*c*s+d*a,y=m*e+3*p*u*n+3*f*c*o+d*h,x=E-g,v=w-y,E=g,w=y,l+=Math.sqrt(x*x+v*v);return l}static curveTo(t,e,i,n,s,o,a){const h=a[a.length-2],l=a[a.length-1];a.length-=2;const u=Yr._segmentsCount(Ih.curveLength(h,l,t,e,i,n,s,o));let c=0,d=0,f=0,p=0,m=0;a.push(h,l);for(let g=1,y=0;g<=u;++g)y=g/u,c=1-y,d=c*c,f=d*c,p=y*y,m=p*y,a.push(f*h+3*d*y*t+3*c*p*i+m*s,f*l+3*d*y*e+3*c*p*n+m*o)}}function wc(r,t,e,i,n,s,o,a){const h=r-e*n,l=t-i*n,u=r+e*s,c=t+i*s;let d,f;o?(d=i,f=-e):(d=-i,f=e);const p=h+d,m=l+f,g=u+d,y=c+f;return a.push(p,m,g,y),2}function nr(r,t,e,i,n,s,o,a){const h=e-r,l=i-t;let u=Math.atan2(h,l),c=Math.atan2(n-r,s-t);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);let d=u;const f=c-u,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=f/g;if(d+=y,a){o.push(r,t,e,i);for(let x=1,v=d;x<g;x++,v+=y)o.push(r,t,r+Math.sin(v)*m,t+Math.cos(v)*m);o.push(r,t,n,s)}else{o.push(e,i,r,t);for(let x=1,v=d;x<g;x++,v+=y)o.push(r+Math.sin(v)*m,t+Math.cos(v)*m,r,t);o.push(n,s,r,t)}return g*2}function Ab(r,t){const e=r.shape;let i=r.points||e.points.slice();const n=t.closePointEps;if(i.length===0)return;const s=r.lineStyle,o=new ct(i[0],i[1]),a=new ct(i[i.length-2],i[i.length-1]),h=e.type!==St.POLY||e.closeStroke,l=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(h){i=i.slice(),l&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const A=(o.x+a.x)*.5,b=(a.y+o.y)*.5;i.unshift(A,b),i.push(A,b)}const u=t.points,c=i.length/2;let d=i.length;const f=u.length/2,p=s.width/2,m=p*p,g=s.miterLimit*s.miterLimit;let y=i[0],x=i[1],v=i[2],E=i[3],w=0,I=0,T=-(x-E),F=y-v,U=0,G=0,z=Math.sqrt(T*T+F*F);T/=z,F/=z,T*=p,F*=p;const M=s.alignment,B=(1-M)*2,S=M*2;h||(s.cap===ze.ROUND?d+=nr(y-T*(B-S)*.5,x-F*(B-S)*.5,y-T*B,x-F*B,y+T*S,x+F*S,u,!0)+2:s.cap===ze.SQUARE&&(d+=wc(y,x,T,F,B,S,!0,u))),u.push(y-T*B,x-F*B,y+T*S,x+F*S);for(let A=1;A<c-1;++A){y=i[(A-1)*2],x=i[(A-1)*2+1],v=i[A*2],E=i[A*2+1],w=i[(A+1)*2],I=i[(A+1)*2+1],T=-(x-E),F=y-v,z=Math.sqrt(T*T+F*F),T/=z,F/=z,T*=p,F*=p,U=-(E-I),G=v-w,z=Math.sqrt(U*U+G*G),U/=z,G/=z,U*=p,G*=p;const b=v-y,R=x-E,C=v-w,P=I-E,D=b*C+R*P,O=R*C-P*b,H=O<0;if(Math.abs(O)<.001*Math.abs(D)){u.push(v-T*B,E-F*B,v+T*S,E+F*S),D>=0&&(s.join===zt.ROUND?d+=nr(v,E,v-T*B,E-F*B,v-U*B,E-G*B,u,!1)+4:d+=2,u.push(v-U*S,E-G*S,v+U*B,E+G*B));continue}const $=(-T+y)*(-F+E)-(-T+v)*(-F+x),Y=(-U+w)*(-G+E)-(-U+v)*(-G+I),W=(b*Y-C*$)/O,K=(P*$-R*Y)/O,et=(W-v)*(W-v)+(K-E)*(K-E),X=v+(W-v)*B,rt=E+(K-E)*B,nt=v-(W-v)*S,lt=E-(K-E)*S,dt=Math.min(b*b+R*R,C*C+P*P),J=H?B:S,st=dt+J*J*m,It=et<=st;let Ht=s.join;if(Ht===zt.MITER&&et/m>g&&(Ht=zt.BEVEL),It)switch(Ht){case zt.MITER:{u.push(X,rt,nt,lt);break}case zt.BEVEL:{H?u.push(X,rt,v+T*S,E+F*S,X,rt,v+U*S,E+G*S):u.push(v-T*B,E-F*B,nt,lt,v-U*B,E-G*B,nt,lt),d+=2;break}case zt.ROUND:{H?(u.push(X,rt,v+T*S,E+F*S),d+=nr(v,E,v+T*S,E+F*S,v+U*S,E+G*S,u,!0)+4,u.push(X,rt,v+U*S,E+G*S)):(u.push(v-T*B,E-F*B,nt,lt),d+=nr(v,E,v-T*B,E-F*B,v-U*B,E-G*B,u,!1)+4,u.push(v-U*B,E-G*B,nt,lt));break}}else{switch(u.push(v-T*B,E-F*B,v+T*S,E+F*S),Ht){case zt.MITER:{H?u.push(nt,lt,nt,lt):u.push(X,rt,X,rt),d+=2;break}case zt.ROUND:{H?d+=nr(v,E,v+T*S,E+F*S,v+U*S,E+G*S,u,!0)+2:d+=nr(v,E,v-T*B,E-F*B,v-U*B,E-G*B,u,!1)+2;break}}u.push(v-U*B,E-G*B,v+U*S,E+G*S),d+=2}}y=i[(c-2)*2],x=i[(c-2)*2+1],v=i[(c-1)*2],E=i[(c-1)*2+1],T=-(x-E),F=y-v,z=Math.sqrt(T*T+F*F),T/=z,F/=z,T*=p,F*=p,u.push(v-T*B,E-F*B,v+T*S,E+F*S),h||(s.cap===ze.ROUND?d+=nr(v-T*(B-S)*.5,E-F*(B-S)*.5,v-T*B,E-F*B,v+T*S,E+F*S,u,!1)+2:s.cap===ze.SQUARE&&(d+=wc(v,E,T,F,B,S,!1,u)));const N=t.indices,_=Yr.epsilon*Yr.epsilon;for(let A=f;A<d+f-2;++A)y=u[A*2],x=u[A*2+1],v=u[(A+1)*2],E=u[(A+1)*2+1],w=u[(A+2)*2],I=u[(A+2)*2+1],!(Math.abs(y*(E-I)+v*(I-x)+w*(x-E))<_)&&N.push(A,A+1,A+2)}function Eb(r,t){let e=0;const i=r.shape,n=r.points||i.points,s=i.type!==St.POLY||i.closeStroke;if(n.length===0)return;const o=t.points,a=t.indices,h=n.length/2,l=o.length/2;let u=l;for(o.push(n[0],n[1]),e=1;e<h;e++)o.push(n[e*2],n[e*2+1]),a.push(u,u+1),u++;s&&a.push(u,l)}function Tc(r,t){r.lineStyle.native?Eb(r,t):Ab(r,t)}class Rh{static curveLength(t,e,i,n,s,o){const a=t-2*i+s,h=e-2*n+o,l=2*i-2*t,u=2*n-2*e,c=4*(a*a+h*h),d=4*(a*l+h*u),f=l*l+u*u,p=2*Math.sqrt(c+d+f),m=Math.sqrt(c),g=2*c*m,y=2*Math.sqrt(f),x=d/m;return(g*p+m*d*(p-y)+(4*f*c-d*d)*Math.log((2*m+x+p)/(x+y)))/(4*g)}static curveTo(t,e,i,n,s){const o=s[s.length-2],a=s[s.length-1],h=Yr._segmentsCount(Rh.curveLength(o,a,t,e,i,n));let l=0,u=0;for(let c=1;c<=h;++c){const d=c/h;l=o+(t-o)*d,u=a+(e-a)*d,s.push(l+(t+(i-t)*d-l)*d,u+(e+(n-e)*d-u)*d)}}}const ta={[St.POLY]:If,[St.CIRC]:Jn,[St.ELIP]:Jn,[St.RECT]:bb,[St.RREC]:wb},Ac=[],un=[];class ts{constructor(t,e=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new ts(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Rr=new ct,Rf=class Mf extends Ld{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Yn,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),un.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Ac.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,n=null){const s=new ts(t,e,i,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new ts(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=n.lineStyle,n.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const n=e[i];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,Rr):Rr.copyFrom(t),n.shape.contains(Rr.x,Rr.y))){let s=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(Rr.x,Rr.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,n=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],n=i.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;const l=e[h],u=l.fillStyle,c=l.lineStyle;ta[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=d===0?u:c;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=kt.REPEAT,d===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-g;y!==0&&(i&&!this._compareStyles(n,f)&&(i.end(m,g),i=null),i||(i=Ac.pop()||new Tb,i.begin(f,m,g),this.batches.push(i),n=f),this.addUvs(this.points,t,f.texture,g,y,f.matrix))}}const s=this.indices.length,o=this.points.length/2;if(i&&i.end(s,o),this.batches.length===0){this.batchable=!0;return}const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const i=this.graphicsData[t],n=i.fillStyle,s=i.lineStyle;if(n&&!n.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const n=t[e];for(let s=0;s<n.size;s++){const o=n.start+s;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<Mf.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++ut._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),un.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let n=un.pop();n||(n=new Fa,n.texArray=new La),n.texArray.count=0,n.start=0,n.size=0,n.type=de.TRIANGLES;let s=0,o=null,a=0,h=!1,l=de.TRIANGLES,u=0;this.drawCalls.push(n);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],f=8,p=d.style,m=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,l=h?de.LINES:de.TRIANGLES,o=null,s=f,t++),o!==m&&(o=m,m._batchEnabled!==t&&(s===f&&(t++,s=0,n.size>0&&(n=un.pop(),n||(n=new Fa,n.texArray=new La),this.drawCalls.push(n)),n.start=u,n.size=0,n.texArray.count=0,n.type=l),m.touched=1,m._batchEnabled=t,m._batchLocation=s,m.wrapMode=kt.REPEAT,n.texArray.elements[n.texArray.count++]=m,s++)),n.size+=d.size,u+=d.size,a=m._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart)}ut._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,n=this.textureIds,s=new ArrayBuffer(t.length*3*4),o=new Float32Array(s),a=new Uint32Array(s);let h=0;for(let l=0;l<t.length/2;l++)o[h++]=t[l*2],o[h++]=t[l*2+1],o[h++]=e[l*2],o[h++]=e[l*2+1],a[h++]=i[l],o[h++]=n[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?If.triangulate(t,this):ta[t.type].triangulate(t,this)}processLine(t){Tc(t,this);for(let e=0;e<t.holes.length;e++)Tc(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];ta[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const n=t[i*2],s=t[i*2+1];t[i*2]=e.a*n+e.c*s+e.tx,t[i*2+1]=e.b*n+e.d*s+e.ty}}addColors(t,e,i,n,s=0){const o=_t.shared.setValue(e).toLittleEndianNumber(),a=_t.shared.setValue(o).toPremultiplied(i);t.length=Math.max(t.length,s+n);for(let h=0;h<n;h++)t[s+h]=a}addTextureIds(t,e,i,n=0){t.length=Math.max(t.length,n+i);for(let s=0;s<i;s++)t[n+s]=e}addUvs(t,e,i,n,s,o=null){let a=0;const h=e.length,l=i.frame;for(;a<s;){let c=t[(n+a)*2],d=t[(n+a)*2+1];if(o){const f=o.a*c+o.c*d+o.tx;d=o.b*c+o.d*d+o.ty,c=f}a++,e.push(c/l.width,d/l.height)}const u=i.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,i,h,s)}adjustUvs(t,e,i,n){const s=e.baseTexture,o=1e-6,a=i+n*2,h=e.frame,l=h.width/s.width,u=h.height/s.height;let c=h.x/h.width,d=h.y/h.height,f=Math.floor(t[i]+o),p=Math.floor(t[i+1]+o);for(let m=i+2;m<a;m+=2)f=Math.min(f,Math.floor(t[m]+o)),p=Math.min(p,Math.floor(t[m+1]+o));c-=f,d-=p;for(let m=i;m<a;m+=2)t[m]=(t[m]+c)*l,t[m+1]=(t[m+1]+d)*u}};Rf.BATCHABLE_SIZE=100;let Sb=Rf;class gs{constructor(){this.color=16777215,this.alpha=1,this.texture=j.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new gs;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=j.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Mh extends gs{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ze.BUTT,this.join=zt.MITER,this.miterLimit=10}clone(){const t=new Mh;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ze.BUTT,this.join=zt.MITER,this.miterLimit=10}}const ea={},th=class En extends Gt{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new gs,this._lineStyle=new Mh,this._matrix=null,this._holeMode=!1,this.state=xe.for2d(),this._geometry=t||new Sb,this._geometry.refCount++,this._transformID=-1,this._tintColor=new _t(16777215),this.blendMode=at.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new En(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,n=.5,s=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:n,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:j.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ze.BUTT,join:zt.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new gr,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new gr,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,n=i[i.length-2],s=i[i.length-1];return(n!==t||s!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,n){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),Rh.curveTo(t,e,i,n,s),this}bezierCurveTo(t,e,i,n,s,o){return this._initCurve(),Ih.curveTo(t,e,i,n,s,o,this.currentPath.points),this}arcTo(t,e,i,n,s){this._initCurve(t,e);const o=this.currentPath.points,a=bc.curveTo(t,e,i,n,s,o);if(a){const{cx:h,cy:l,radius:u,startAngle:c,endAngle:d,anticlockwise:f}=a;this.arc(h,l,u,c,d,f)}return this}arc(t,e,i,n,s,o=!1){if(n===s)return this;if(!o&&s<=n?s+=Vn:o&&n<=s&&(n+=Vn),s-n===0)return this;const a=t+Math.cos(n)*i,h=e+Math.sin(n)*i,l=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const c=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-h);c<l&&d<l||u.push(a,h)}else this.moveTo(a,h),u=this.currentPath.points;return bc.arc(a,h,t,e,i,n,s,o,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:j.WHITE,color:t,alpha:e})}normalizeColor(t){const e=_t.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:j.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,n){return this.drawShape(new ht(t,e,i,n))}drawRoundedRect(t,e,i,n,s){return this.drawShape(new ds(t,e,i,n,s))}drawCircle(t,e,i){return this.drawShape(new us(t,e,i))}drawEllipse(t,e,i,n){return this.drawShape(new cs(t,e,i,n))}drawPolygon(...t){let e,i=!0;const n=t[0];n.points?(i=n.closeStroke,e=n.points):Array.isArray(t[0])?e=t[0]:e=t;const s=new gr(e);return s.closeStroke=i,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===St.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let n=0;n<i;n++){const s=t.batches[n],o=s.style.color,a=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,s.start*2,s.size),u={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:_t.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[n]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,n=this.worldAlpha,s=e.uniforms,o=i.drawCalls;s.translationMatrix=this.transform.worldTransform,_t.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let a=0,h=o.length;a<h;a++)this._renderDrawCallDirect(t,i.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:i,type:n,size:s,start:o}=e,a=i.count;for(let h=0;h<a;h++)t.texture.bind(i.elements[h],h);t.geometry.draw(n,s,o)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!ea[i]){const{maxTextures:n}=t.plugins[i],s=new Int32Array(n);for(let h=0;h<n;h++)s[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new vt,default:ie.from({uSamplers:s},!0)},a=t.plugins[i]._shader.program;ea[i]=new ge(a,o)}e=ea[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:n,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,i,n,s)}containsPoint(t){return this.worldTransform.applyInverse(t,En._TEMP_POINT),this._geometry.containsPoint(En._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=_t.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this._geometry.points,u=this.vertexData;let c=0;for(let d=0;d<l.length;d+=2){const f=l[d],p=l[d+1];u[c++]=i*f+s*p+a,u[c++]=o*p+n*f+h}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};th.curves=Yr,th._TEMP_POINT=new ct;let Ti=th;class Cb{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const ra=new ct,Ec=new gr,Ff=class Df extends Gt{constructor(t,e,i,n=de.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||xe.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Q.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===de.TRIANGLES&&e.length<Df.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,h=n.d,l=n.tx,u=n.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){const f=e[d*2],p=e[d*2+1];c[d*2]=s*f+a*p+l,c[d*2+1]=o*f+h*p+u}if(this._roundPixels){const d=Q.RESOLUTION;for(let f=0;f<c.length;++f)c[f]=Math.round(c[f]*d)/d}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Cb(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ra);const e=this.geometry.getBuffer("aVertexPosition").data,i=Ec.points,n=this.geometry.getIndex().data,s=n.length,o=this.drawMode===4?3:1;for(let a=0;a+2<s;a+=o){const h=n[a]*2,l=n[a+1]*2,u=n[a+2]*2;if(i[0]=e[h],i[1]=e[h+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[u],i[5]=e[u+1],Ec.contains(ra.x,ra.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Ff.BATCHABLE_SIZE=100;let Kr=Ff;class Li extends Xe{constructor(t,e,i){super();const n=new wt(t),s=new wt(e,!0),o=new wt(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,ot.FLOAT).addAttribute("aTextureCoord",s,2,!1,ot.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var Pb=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Ib=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Zr extends ge{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:vt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||Ie.from(Ib,Pb),i),this._colorDirty=!1,this.uvMatrix=new Kd(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new _t(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;_t.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Rb extends Li{constructor(t=200,e,i=0){super(new Float32Array(e.length*4),new Float32Array(e.length*4),new Uint16Array((e.length-1)*6)),this.points=e,this._width=t,this.textureScale=i,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),i.data=new Float32Array(t.length*4),n.data=new Uint16Array((t.length-1)*6));const s=i.data,o=n.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;let a=0,h=t[0];const l=this._width*this.textureScale,u=t.length;for(let d=0;d<u;d++){const f=d*4;if(this.textureScale>0){const p=h.x-t[d].x,m=h.y-t[d].y,g=Math.sqrt(p*p+m*m);h=t[d],a+=g/l}else a=d/(u-1);s[f]=a,s[f+1]=0,s[f+2]=a,s[f+3]=1}let c=0;for(let d=0;d<u-1;d++){const f=d*2;o[c++]=f,o[c++]=f+1,o[c++]=f+2,o[c++]=f+2,o[c++]=f+1,o[c++]=f+3}i.update(),n.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e=t[0],i,n=0,s=0;const o=this.buffers[0].data,a=t.length,h=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<a;l++){const u=t[l],c=l*4;l<t.length-1?i=t[l+1]:i=u,s=-(i.x-e.x),n=i.y-e.y;const d=Math.sqrt(n*n+s*s);d<1e-6?(n=0,s=0):(n/=d,s/=d,n*=h,s*=h),o[c]=u.x+n,o[c+1]=u.y+s,o[c+2]=u.x-n,o[c+3]=u.y-s,e=u}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class Sc extends Kr{constructor(t,e,i=0){const n=new Rb(t.height,e,i),s=new Zr(t);i>0&&(t.baseTexture.wrapMode=kt.REPEAT),super(n,s),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}}class Cc{constructor(t,e,i){this.geometry=new Xe,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||ot.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new wt(tv(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new wt(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=n,n+=a.size,this.staticStride+=a.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new wt(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===ot.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===ot.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,i){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,i,s.type===ot.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,i,s.type===ot.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Mb=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,Fb=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Bf extends fs{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new vt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ot.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ge.from(Fb,Mb,{}),this.state=xe.for2d()}render(t){const e=t.children,i=t._maxSize,n=t._batchSize,s=this.renderer;let o=e.length;if(o===0)return;o>i&&!t.autoResize&&(o=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=Dd(t.blendMode,l),s.state.set(this.state);const u=s.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=_t.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=n,p+=1){let m=o-f;m>n&&(m=n),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const g=a[p];g.uploadDynamic(e,f,m);const y=t._bufferUpdateIDs[p]||0;d=d||g._updateID<y,d&&(g._updateID=t._updateID,g.uploadStatic(e,f,m)),s.geometry.bind(g.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,n=t._batchSize,s=t._properties;for(let o=0;o<i;o+=n)e.push(new Cc(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new Cc(this.properties,i,e)}uploadVertices(t,e,i,n,s,o){let a=0,h=0,l=0,u=0;for(let c=0;c<i;++c){const d=t[e+c],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,y=f.orig;g?(h=g.x-d.anchor.x*y.width,a=h+g.width,u=g.y-d.anchor.y*y.height,l=u+g.height):(a=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),u=y.height*-d.anchor.y),n[o]=h*p,n[o+1]=u*m,n[o+s]=a*p,n[o+s+1]=u*m,n[o+s*2]=a*p,n[o+s*2+1]=l*m,n[o+s*3]=h*p,n[o+s*3+1]=l*m,o+=s*4}}uploadPosition(t,e,i,n,s,o){for(let a=0;a<i;a++){const h=t[e+a].position;n[o]=h.x,n[o+1]=h.y,n[o+s]=h.x,n[o+s+1]=h.y,n[o+s*2]=h.x,n[o+s*2+1]=h.y,n[o+s*3]=h.x,n[o+s*3+1]=h.y,o+=s*4}}uploadRotation(t,e,i,n,s,o){for(let a=0;a<i;a++){const h=t[e+a].rotation;n[o]=h,n[o+s]=h,n[o+s*2]=h,n[o+s*3]=h,o+=s*4}}uploadUvs(t,e,i,n,s,o){for(let a=0;a<i;++a){const h=t[e+a]._texture._uvs;h?(n[o]=h.x0,n[o+1]=h.y0,n[o+s]=h.x1,n[o+s+1]=h.y1,n[o+s*2]=h.x2,n[o+s*2+1]=h.y2,n[o+s*3]=h.x3,n[o+s*3+1]=h.y3,o+=s*4):(n[o]=0,n[o+1]=0,n[o+s]=0,n[o+s+1]=0,n[o+s*2]=0,n[o+s*2+1]=0,n[o+s*3]=0,n[o+s*3+1]=0,o+=s*4)}}uploadTint(t,e,i,n,s,o){for(let a=0;a<i;++a){const h=t[e+a],l=_t.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);n[o]=l,n[o+s]=l,n[o+s*2]=l,n[o+s*3]=l,o+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Bf.extension={name:"particle",type:q.RendererPlugin};tt.add(Bf);var ys=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(ys||{});const cn={willReadFrequently:!0},he=class it{static get experimentalLetterSpacingSupported(){let t=it._experimentalLetterSpacingSupported;if(t!==void 0){const e=Q.ADAPTER.getCanvasRenderingContext2D().prototype;t=it._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,n,s,o,a,h,l){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=s,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,i,n=it._canvas){i=i??e.wordWrap;const s=e.toFontString(),o=it.measureFont(s);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const a=n.getContext("2d",cn);a.font=s;const h=(i?it.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let u=0;for(let p=0;p<h.length;p++){const m=it._measureText(h[p],e.letterSpacing,a);l[p]=m,u=Math.max(u,m)}let c=u+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const d=e.lineHeight||o.fontSize+e.strokeThickness;let f=Math.max(d,o.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new it(t,e,c,f,h,l,d+e.leading,u,o)}static _measureText(t,e,i){let n=!1;it.experimentalLetterSpacingSupported&&(it.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let s=i.measureText(t).width;return s>0&&(n?s-=e:s+=(it.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,i=it._canvas){const n=i.getContext("2d",cn);let s=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,c=it.collapseSpaces(u),d=it.collapseNewlines(u);let f=!c;const p=e.wordWrapWidth+l,m=it.tokenize(t);for(let g=0;g<m.length;g++){let y=m[g];if(it.isNewline(y)){if(!d){a+=it.addLine(o),f=!c,o="",s=0;continue}y=" "}if(c){const v=it.isBreakingSpace(y),E=it.isBreakingSpace(o[o.length-1]);if(v&&E)continue}const x=it.getFromCache(y,l,h,n);if(x>p)if(o!==""&&(a+=it.addLine(o),o="",s=0),it.canBreakWords(y,e.breakWords)){const v=it.wordWrapSplit(y);for(let E=0;E<v.length;E++){let w=v[E],I=w,T=1;for(;v[E+T];){const U=v[E+T];if(!it.canBreakChars(I,U,y,E,e.breakWords))w+=U;else break;I=U,T++}E+=T-1;const F=it.getFromCache(w,l,h,n);F+s>p&&(a+=it.addLine(o),f=!1,o="",s=0),o+=w,s+=F}}else{o.length>0&&(a+=it.addLine(o),o="",s=0);const v=g===m.length-1;a+=it.addLine(y,!v),f=!1,o="",s=0}else x+s>p&&(f=!1,a+=it.addLine(o),o="",s=0),(o.length>0||!it.isBreakingSpace(y)||f)&&(o+=y,s+=x)}return a+=it.addLine(o,!1),a}static addLine(t,e=!0){return t=it.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,n){let s=i[t];return typeof s!="number"&&(s=it._measureText(t,e,n)+e,i[t]=s),s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!it.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:it._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:it._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],o=t[n+1];if(it.isBreakingSpace(s,o)||it.isNewline(s)){i!==""&&(e.push(i),i=""),e.push(s);continue}i+=s}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,s){return!0}static wordWrapSplit(t){return it.graphemeSegmenter(t)}static measureFont(t){if(it._fonts[t])return it._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=it._canvas,n=it._context;n.font=t;const s=it.METRICS_STRING+it.BASELINE_SYMBOL,o=Math.ceil(n.measureText(s).width);let a=Math.ceil(n.measureText(it.BASELINE_SYMBOL).width);const h=Math.ceil(it.HEIGHT_MULTIPLIER*a);if(a=a*it.BASELINE_MULTIPLIER|0,o===0||h===0)return it._fonts[t]=e,e;i.width=o,i.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,a);const l=n.getImageData(0,0,o,h).data,u=l.length,c=o*4;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let m=0;m<c;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f+=c;else break}for(e.ascent=a-d,f=u-c,p=!1,d=h;d>a;--d){for(let m=0;m<c;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f-=c;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,it._fonts[t]=e,e}static clearMetrics(t=""){t?delete it._fonts[t]:it._fonts={}}static get _canvas(){var t;if(!it.__canvas){let e;try{const i=new OffscreenCanvas(0,0);if((t=i.getContext("2d",cn))!=null&&t.measureText)return it.__canvas=i,i;e=Q.ADAPTER.createCanvas()}catch{e=Q.ADAPTER.createCanvas()}e.width=e.height=10,it.__canvas=e}return it.__canvas}static get _context(){return it.__context||(it.__context=it._canvas.getContext("2d",cn)),it.__context}};he.METRICS_STRING="|ÉqÅ",he.BASELINE_SYMBOL="M",he.BASELINE_MULTIPLIER=1.4,he.HEIGHT_MULTIPLIER=2,he.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const r=new Intl.Segmenter;return t=>[...r.segment(t)].map(e=>e.segment)}return r=>[...r]})(),he.experimentalLetterSpacing=!1,he._fonts={},he._newlines=[10,13],he._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let ke=he;const Db=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Of=class xi{constructor(t){this.styleID=0,this.reset(),na(this,t,t)}clone(){const t={};return na(t,this,xi.defaultStyle),new xi(t)}reset(){na(this,xi.defaultStyle,xi.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=ia(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=ia(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){Bb(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=ia(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let n=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!Db.includes(n)&&(n=`"${n}"`),e[i]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Of.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ys.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let je=Of;function ia(r){const t=_t.shared,e=i=>{const n=t.setValue(i);return n.alpha===1?n.toHex():n.toRgbaString()};return Array.isArray(r)?r.map(e):e(r)}function Bb(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function na(r,t,e){for(const i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}const Ob={texture:!0,children:!1,baseTexture:!0},Lf=class eh extends Qr{constructor(t,e,i){let n=!1;i||(i=Q.ADAPTER.createCanvas(),n=!0),i.width=3,i.height=3;const s=j.from(i);s.orig=new ht,s.trim=new ht,super(s),this._ownCanvas=n,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=eh.defaultResolution??Q.RESOLUTION,this._autoResolution=eh.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return ke.experimentalLetterSpacing}static set experimentalLetterSpacing(t){pt("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ke.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,n=ke.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,o=n.height,a=n.lines,h=n.lineHeight,l=n.lineWidths,u=n.maxLineWidth,c=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let d,f;const p=e.dropShadow?2:1;for(let m=0;m<p;++m){const g=e.dropShadow&&m===0,y=g?Math.ceil(Math.max(1,o)+e.padding*2):0,x=y*this._resolution;if(g){i.fillStyle="black",i.strokeStyle="black";const E=e.dropShadowColor,w=e.dropShadowBlur*this._resolution,I=e.dropShadowDistance*this._resolution;i.shadowColor=_t.shared.setValue(E).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=w,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*I,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*I+x}else i.fillStyle=this._generateFillStyle(e,a,n),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let v=(h-c.fontSize)/2;h-c.fontSize<0&&(v=0);for(let E=0;E<a.length;E++)d=e.strokeThickness/2,f=e.strokeThickness/2+E*h+c.ascent+v,e.align==="right"?d+=u-l[E]:e.align==="center"&&(d+=(u-l[E])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[E],d+e.padding,f+e.padding-y,!0),e.fill&&this.drawLetterSpacing(a[E],d+e.padding,f+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,i,n=!1){const s=this._style.letterSpacing;let o=!1;if(ke.experimentalLetterSpacingSupported&&(ke.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||o){n?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let a=e;const h=ke.graphemeSegmenter(t);let l=this.context.measureText(t).width,u=0;for(let c=0;c<h.length;++c){const d=h[c];n?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);let f="";for(let p=c+1;p<h.length;++p)f+=h[p];u=this.context.measureText(f).width,a+=l-u+s,l=u}}updateTexture(){const t=this.canvas;if(this._style.trim){const o=nv(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}const e=this._texture,i=this._style,n=i.trim?0:i.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const n=t.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let s;const o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-o-a*2,l=this.canvas.height/this._resolution-o-a*2,u=n.slice(),c=t.fillGradientStops.slice();if(!c.length){const d=u.length+1;for(let f=1;f<d;++f)c.push(f/d)}if(u.unshift(n[0]),c.unshift(0),u.push(n[n.length-1]),c.push(1),t.fillGradientType===ys.LINEAR_VERTICAL){s=this.context.createLinearGradient(h/2,a,h/2,l+a);const d=i.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){const p=i.lineHeight*(f-1)+d,m=i.lineHeight*f;let g=m;f>0&&p>m&&(g=(m+p)/2);const y=m+d,x=i.lineHeight*(f+1);let v=y;f+1<e.length&&x<y&&(v=(y+x)/2);const E=(v-g)/l;for(let w=0;w<u.length;w++){let I=0;typeof c[w]=="number"?I=c[w]:I=w/u.length;let T=Math.min(1,Math.max(0,g/l+I*E));T=Number(T.toFixed(5)),s.addColorStop(T,u[w])}}}else{s=this.context.createLinearGradient(a,l/2,h+a,l/2);const d=u.length+1;let f=1;for(let p=0;p<u.length;p++){let m;typeof c[p]=="number"?m=c[p]:m=f/d,s.addColorStop(m,u[p]),f++}}return s}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Ob,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=He(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=He(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof je?this._style=t:this._style=new je(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Lf.defaultAutoResolution=!0;let Nf=Lf;class Lb{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Nb(r,t){var i;let e=!1;if((i=r==null?void 0:r._textures)!=null&&i.length){for(let n=0;n<r._textures.length;n++)if(r._textures[n]instanceof j){const s=r._textures[n].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function kb(r,t){if(r.baseTexture instanceof ut){const e=r.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Ub(r,t){if(r._texture&&r._texture instanceof j){const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Gb(r,t){return t instanceof Nf?(t.updateText(!0),!0):!1}function Hb(r,t){if(t instanceof je){const e=t.toFontString();return ke.measureFont(e),!0}return!1}function zb(r,t){if(r instanceof Nf){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function $b(r,t){return r instanceof je?(t.includes(r)||t.push(r),!0):!1}const kf=class Uf{constructor(t){this.limiter=new Lb(Uf.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(zb),this.registerFindHook($b),this.registerFindHook(Nb),this.registerFindHook(kb),this.registerFindHook(Ub),this.registerUploadHook(Gb),this.registerUploadHook(Hb)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Nt.system.addOnce(this.tick,this,xr.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Nt.system.addOnce(this.tick,this,xr.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Gt)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Nt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};kf.uploadsPerFrame=4;let rh=kf;Object.defineProperties(Q,{UPLOADS_PER_FRAME:{get(){return rh.uploadsPerFrame},set(r){pt("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),rh.uploadsPerFrame=r}}});function Gf(r,t){return t instanceof ut?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1}function Vb(r,t){if(!(t instanceof Ti))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let n=0;n<i.length;n++){const{texture:s}=i[n].style;s&&Gf(r,s.baseTexture)}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0}function Xb(r,t){return r instanceof Ti?(t.push(r),!0):!1}class Hf extends rh{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Xb),this.registerUploadHook(Gf),this.registerUploadHook(Vb)}}Hf.extension={name:"prepare",type:q.RendererSystem};tt.add(Hf);var Wb=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,jb=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,qb=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Pc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Yb=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const dn=new vt;class zf extends fs{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Wd,this.state=xe.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=ge.from(Pc,Yb,e),this.shader=t.context.webGLVersion>1?ge.from(jb,Wb,e):ge.from(Pc,qb,e)}render(t){const e=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-s,n[1]=n[3]=-o,n[2]=n[4]=1-s,n[5]=n[7]=1-o,i.invalidate();const a=t._texture,h=a.baseTexture,l=h.alphaMode>0,u=t.tileTransform.localTransform,c=t.uvMatrix;let d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==kt.CLAMP:h.wrapMode===kt.CLAMP&&(h.wrapMode=kt.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,m=a.height,g=t._width,y=t._height;dn.set(u.a*p/g,u.b*p/y,u.c*m/g,u.d*m/y,u.tx/g,u.ty/y),dn.invert(),d?dn.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=dn.toArray(!0),f.uniforms.uColor=_t.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(i),this.state.blendMode=Dd(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}zf.extension={name:"tilingSprite",type:q.RendererPlugin};tt.add(zf);const $f=class bi{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof j?t:null,this.baseTexture=t instanceof ut?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const n=this.baseTexture.resource;this.resolution=this._updateResolution(i||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=Me(t,null);return i===null&&(i=parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=bi.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=bi.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const n=this._frameKeys[e],s=this._frames[n],o=s.frame;if(o){let a=null,h=null;const l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,u=new ht(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?a=new ht(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new ht(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(h=new ht(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new j(this.baseTexture,a,u,h,s.rotated?2:0,s.anchor,s.borders),j.addToCache(this.textures[n],n.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const n=t[e][i];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*bi.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*bi.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};$f.BATCH_SIZE=1e3;let Ic=$f;const Kb=["jpg","png","jpeg","avif","webp"];function Vf(r,t,e){const i={};if(r.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[n]=t.textures[n]}),!e){const n=Pt.dirname(r[0]);t.linkedSheets.forEach((s,o)=>{const a=Vf([`${n}/${t.data.meta.related_multi_packs[o]}`],s,!0);Object.assign(i,a)})}return i}const Zb={extension:q.Asset,cache:{test:r=>r instanceof Ic,getCacheableAssets:(r,t)=>Vf(r,t,!1)},resolver:{test:r=>{const t=r.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&Kb.includes(i)},parse:r=>{var e;const t=r.split(".");return{resolution:parseFloat(((e=Q.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:t[t.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:q.LoadParser,priority:se.Normal},async testParse(r,t){return Pt.extname(t.src).toLowerCase()===".json"&&!!r.frames},async parse(r,t,e){var h,l;let i=Pt.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let n=i+r.meta.image;n=Qa(n,t.src);const s=(await e.load([n]))[n],o=new Ic(s.baseTexture,r,t.src);await o.parse();const a=(h=r==null?void 0:r.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(a)){const u=[];for(const d of a){if(typeof d!="string")continue;let f=i+d;(l=t.data)!=null&&l.ignoreMultiPack||(f=Qa(f,t.src),u.push(e.load({src:f,data:{ignoreMultiPack:!0}})))}const c=await Promise.all(u);o.linkedSheets=c,c.forEach(d=>{d.linkedSheets=[o].concat(o.linkedSheets.filter(f=>f!==d))})}return o},unload(r){r.destroy(!0)}}};tt.add(Zb);class es{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Sn{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const o=e[s].match(/^[a-z]+/gm)[0],a=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in a){const u=a[l].split("="),c=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[c]=p}i[o].push(h)}const n=new es;return i.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),i.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),i.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),i.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),i.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),i.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class ih{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new es,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<i.length;l++)e.info.push({face:i[l].getAttribute("face"),size:parseInt(i[l].getAttribute("size"),10)});for(let l=0;l<n.length;l++)e.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(let l=0;l<s.length;l++)e.page.push({id:parseInt(s[l].getAttribute("id"),10)||0,file:s[l].getAttribute("file")});for(let l=0;l<o.length;l++){const u=o[l];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return e}}class nh{static test(t){return typeof t=="string"&&t.includes("<font>")?ih.test(Q.ADAPTER.parseXML(t)):!1}static parse(t){return ih.parse(Q.ADAPTER.parseXML(t))}}const sa=[Sn,ih,nh];function Qb(r){for(let t=0;t<sa.length;t++)if(sa[t].test(r))return sa[t];return null}function Jb(r,t,e,i,n,s){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=r.width/i-h-l*2,c=r.height/i-h-l*2,d=o.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),e.fillGradientType===ys.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,l,u/2,c+l);let p=0;const m=(s.fontProperties.fontSize+e.strokeThickness)/c;for(let g=0;g<n.length;g++){const y=s.lineHeight*g;for(let x=0;x<d.length;x++){let v=0;typeof f[x]=="number"?v=f[x]:v=x/d.length;const E=y/c+v*m;let w=Math.max(p,E);w=Math.min(w,1),a.addColorStop(w,d[x]),p=w}}}else{a=t.createLinearGradient(l,c/2,u+l,c/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let y;typeof f[g]=="number"?y=f[g]:y=m/p,a.addColorStop(y,d[g]),m++}}return a}function tw(r,t,e,i,n,s,o){const a=e.text,h=e.fontProperties;t.translate(i,n),t.scale(s,s);const l=o.strokeThickness/2,u=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=Jb(r,t,o,s,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const c=o.dropShadowColor,d=o.dropShadowBlur*s,f=o.dropShadowDistance*s;t.shadowColor=_t.shared.setValue(c).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,u+e.lineHeight-h.descent),o.fill&&t.fillText(a,l,u+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Cn(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function Xf(r){return Array.from?Array.from(r):r.split("")}function ew(r){typeof r=="string"&&(r=[r]);const t=[];for(let e=0,i=r.length;e<i;e++){const n=r[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...Xf(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Le=class le{constructor(t,e,i){var u;const[n]=t.info,[s]=t.common,[o]=t.page,[a]=t.distanceField,h=Me(o.file),l={};this._ownsTextures=i,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/h,this.chars={},this.pageTextures=l;for(let c=0;c<t.page.length;c++){const{id:d,file:f}=t.page[c];l[d]=e instanceof Array?e[c]:e[f],a!=null&&a.fieldType&&a.fieldType!=="none"&&(l[d].baseTexture.alphaMode=Ft.NO_PREMULTIPLIED_ALPHA,l[d].baseTexture.mipmap=ye.OFF)}for(let c=0;c<t.char.length;c++){const{id:d,page:f}=t.char[c];let{x:p,y:m,width:g,height:y,xoffset:x,yoffset:v,xadvance:E}=t.char[c];p/=h,m/=h,g/=h,y/=h,x/=h,v/=h,E/=h;const w=new ht(p+l[f].frame.x/h,m+l[f].frame.y/h,g,y);this.chars[d]={xOffset:x,yOffset:v,xAdvance:E,kerning:{},texture:new j(l[f].baseTexture,w),page:f}}for(let c=0;c<t.kerning.length;c++){let{first:d,second:f,amount:p}=t.kerning[c];d/=h,f/=h,p/=h,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=((u=a==null?void 0:a.fieldType)==null?void 0:u.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let n;if(t instanceof es)n=t;else{const o=Qb(t);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(t)}e instanceof j&&(e=[e]);const s=new le(n,e,i);return le.available[s.font]=s,s}static uninstall(t){const e=le.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete le.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:s,resolution:o,textureWidth:a,textureHeight:h,...l}=Object.assign({},le.defaultOptions,i),u=ew(n),c=e instanceof je?e:new je(e),d=a,f=new es;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};let p=0,m=0,g,y,x,v=0;const E=[];for(let I=0;I<u.length;I++){g||(g=Q.ADAPTER.createCanvas(),g.width=a,g.height=h,y=g.getContext("2d"),x=new ut(g,{resolution:o,...l}),E.push(new j(x)),f.page.push({id:E.length-1,file:""}));const T=u[I],F=ke.measureText(T,c,!1,g),U=F.width,G=Math.ceil(F.height),z=Math.ceil((c.fontStyle==="italic"?2:1)*U);if(m>=h-G*o){if(m===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${T}')`);--I,g=null,y=null,x=null,m=0,p=0,v=0;continue}if(v=Math.max(G+F.fontProperties.descent,v),z*o+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${T}')`);--I,m+=v*o,m=Math.ceil(m),p=0,v=0;continue}tw(g,y,F,p,m,o,c);const M=Cn(F.text);f.char.push({id:M,page:E.length-1,x:p/o,y:m/o,width:z,height:G,xoffset:0,yoffset:0,xadvance:U-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(z+2*s)*o,p=Math.ceil(p)}if(!(i!=null&&i.skipKerning))for(let I=0,T=u.length;I<T;I++){const F=u[I];for(let U=0;U<T;U++){const G=u[U],z=y.measureText(F).width,M=y.measureText(G).width,B=y.measureText(F+G).width-(z+M);B&&f.kerning.push({first:Cn(F),second:Cn(G),amount:B})}}const w=new le(f,E,!0);return le.available[t]!==void 0&&le.uninstall(t),le.available[t]=w,w}};Le.ALPHA=[["a","z"],["A","Z"]," "],Le.NUMERIC=[["0","9"]],Le.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Le.ASCII=[[" ","~"]],Le.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Le.ALPHANUMERIC},Le.available={};let Ne=Le;var rw=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,iw=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Rc=[],Mc=[],Fc=[],nw=class Wf extends Gt{constructor(t,e={}){super();const{align:i,tint:n,maxWidth:s,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},Wf.styleDefaults,e);if(!Ne.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new _t(n),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new Pe(()=>{this.dirty=!0},this,0,0),this._roundPixels=Q.ROUND_PIXELS,this.dirty=!0,this._resolution=Q.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var z;const t=Ne.available[this._fontName],e=this.fontSize,i=e/t.size,n=new ct,s=[],o=[],a=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=Xf(h),u=this._maxWidth*t.size/e,c=t.distanceFieldType==="none"?Rc:Mc;let d=null,f=0,p=0,m=0,g=-1,y=0,x=0,v=0,E=0;for(let M=0;M<l.length;M++){const B=l[M],S=Cn(B);if(/(?:\s)/.test(B)&&(g=M,y=f,E++),B==="\r"||B===`
`){o.push(f),a.push(-1),p=Math.max(p,f),++m,++x,n.x=0,n.y+=t.lineHeight,d=null,E=0;continue}const N=t.chars[S];if(!N)continue;d&&N.kerning[d]&&(n.x+=N.kerning[d]);const _=Fc.pop()||{texture:j.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ct};_.texture=N.texture,_.line=m,_.charCode=S,_.position.x=Math.round(n.x+N.xOffset+this._letterSpacing/2),_.position.y=Math.round(n.y+N.yOffset),_.prevSpaces=E,s.push(_),f=_.position.x+Math.max(N.xAdvance-N.xOffset,N.texture.orig.width),n.x+=N.xAdvance+this._letterSpacing,v=Math.max(v,N.yOffset+N.texture.height),d=S,g!==-1&&u>0&&n.x>u&&(++x,$r(s,1+g-x,1+M-g),M=g,g=-1,o.push(y),a.push(s.length>0?s[s.length-1].prevSpaces:0),p=Math.max(p,y),m++,n.x=0,n.y+=t.lineHeight,d=null,E=0)}const w=l[l.length-1];w!=="\r"&&w!==`
`&&(/(?:\s)/.test(w)&&(f=y),o.push(f),p=Math.max(p,f),a.push(-1));const I=[];for(let M=0;M<=m;M++){let B=0;this._align==="right"?B=p-o[M]:this._align==="center"?B=(p-o[M])/2:this._align==="justify"&&(B=a[M]<0?0:(p-o[M])/a[M]),I.push(B)}const T=s.length,F={},U=[],G=this._activePagesMeshData;c.push(...G);for(let M=0;M<T;M++){const B=s[M].texture,S=B.baseTexture.uid;if(!F[S]){let N=c.pop();if(!N){const A=new Li;let b,R;t.distanceFieldType==="none"?(b=new Zr(j.EMPTY),R=at.NORMAL):(b=new Zr(j.EMPTY,{program:Ie.from(iw,rw),uniforms:{uFWidth:0}}),R=at.NORMAL_NPM);const C=new Kr(A,b);C.blendMode=R,N={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:C,vertices:null,uvs:null,indices:null}}N.index=0,N.indexCount=0,N.vertexCount=0,N.uvsCount=0,N.total=0;const{_textureCache:_}=this;_[S]=_[S]||new j(B.baseTexture),N.mesh.texture=_[S],N.mesh.tint=this._tintColor.value,U.push(N),F[S]=N}F[S].total++}for(let M=0;M<G.length;M++)U.includes(G[M])||this.removeChild(G[M].mesh);for(let M=0;M<U.length;M++)U[M].mesh.parent!==this&&this.addChild(U[M].mesh);this._activePagesMeshData=U;for(const M in F){const B=F[M],S=B.total;if(!(((z=B.indices)==null?void 0:z.length)>6*S)||B.vertices.length<Kr.BATCHABLE_SIZE*2)B.vertices=new Float32Array(8*S),B.uvs=new Float32Array(8*S),B.indices=new Uint16Array(6*S);else{const N=B.total,_=B.vertices;for(let A=N*4*2;A<_.length;A++)_[A]=0}B.mesh.size=6*S}for(let M=0;M<T;M++){const B=s[M];let S=B.position.x+I[B.line]*(this._align==="justify"?B.prevSpaces:1);this._roundPixels&&(S=Math.round(S));const N=S*i,_=B.position.y*i,A=B.texture,b=F[A.baseTexture.uid],R=A.frame,C=A._uvs,P=b.index++;b.indices[P*6+0]=0+P*4,b.indices[P*6+1]=1+P*4,b.indices[P*6+2]=2+P*4,b.indices[P*6+3]=0+P*4,b.indices[P*6+4]=2+P*4,b.indices[P*6+5]=3+P*4,b.vertices[P*8+0]=N,b.vertices[P*8+1]=_,b.vertices[P*8+2]=N+R.width*i,b.vertices[P*8+3]=_,b.vertices[P*8+4]=N+R.width*i,b.vertices[P*8+5]=_+R.height*i,b.vertices[P*8+6]=N,b.vertices[P*8+7]=_+R.height*i,b.uvs[P*8+0]=C.x0,b.uvs[P*8+1]=C.y0,b.uvs[P*8+2]=C.x1,b.uvs[P*8+3]=C.y1,b.uvs[P*8+4]=C.x2,b.uvs[P*8+5]=C.y2,b.uvs[P*8+6]=C.x3,b.uvs[P*8+7]=C.y3}this._textWidth=p*i,this._textHeight=(n.y+t.lineHeight)*i;for(const M in F){const B=F[M];if(this.anchor.x!==0||this.anchor.y!==0){let A=0;const b=this._textWidth*this.anchor.x,R=this._textHeight*this.anchor.y;for(let C=0;C<B.total;C++)B.vertices[A++]-=b,B.vertices[A++]-=R,B.vertices[A++]-=b,B.vertices[A++]-=R,B.vertices[A++]-=b,B.vertices[A++]-=R,B.vertices[A++]-=b,B.vertices[A++]-=R}this._maxLineHeight=v*i;const S=B.mesh.geometry.getBuffer("aVertexPosition"),N=B.mesh.geometry.getBuffer("aTextureCoord"),_=B.mesh.geometry.getIndex();S.data=B.vertices,N.data=B.uvs,_.data=B.indices,S.update(),N.update(),_.update()}for(let M=0;M<s.length;M++)Fc.push(s[M]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:n}=Ne.available[this._fontName];if(i!=="none"){const{a:s,b:o,c:a,d:h}=this.worldTransform,l=Math.sqrt(s*s+o*o),u=Math.sqrt(a*a+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=this.fontSize/n,f=t._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*e*d*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Ne.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Ne.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Ne.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i=Ne.available[this._fontName].distanceFieldType==="none"?Rc:Mc;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>e[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=j.EMPTY});for(const n in e)e[n].destroy(),delete e[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};nw.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const sw=[".xml",".fnt"],ow={extension:{type:q.LoadParser,priority:se.Normal},name:"loadBitmapFont",test(r){return sw.includes(Pt.extname(r).toLowerCase())},async testParse(r){return Sn.test(r)||nh.test(r)},async parse(r,t,e){const i=Sn.test(r)?Sn.parse(r):nh.parse(r),{src:n}=t,{page:s}=i,o=[];for(let l=0;l<s.length;++l){const u=s[l].file;let c=Pt.join(Pt.dirname(n),u);c=Qa(c,n),o.push(c)}const a=await e.load(o),h=o.map(l=>a[l]);return Ne.install(i,h,!0)},async load(r,t){return(await Q.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};tt.add(ow);const sh=class Or extends je{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Or(Object.keys(Or.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Or.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=Or;if(i[t]){const n=i[t];return this._fonts.push(n),n.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return Q.ADAPTER.fetch(t).then(n=>n.blob()).then(async n=>new Promise((s,o)=>{const a=URL.createObjectURL(n),h=new FileReader;h.onload=()=>s([a,h.result]),h.onerror=o,h.readAsDataURL(n)})).then(async([n,s])=>{const o=Object.assign({family:Pt.basename(t,Pt.extname(t)),weight:"normal",style:"normal",display:"auto",src:n,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);i[t]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Q1(t)),typeof t=="number"?Z1(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const s=`${i}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,Or.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=Q.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};sh.availableFonts={},sh.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let oa=sh;const fn=class Lr extends Qr{constructor(t="",e={}){super(j.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,n=j.from(i,{scaleMode:Q.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new ht,n.trim=new ht,this.texture=n;const s="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(s,"svg"),h=document.createElementNS(s,"foreignObject"),l=document.createElementNS(o,"div"),u=document.createElementNS(o,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=Lr.defaultMaxWidth,this.maxHeight=Lr.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=Lr.defaultAutoResolution,this._resolution=Lr.defaultResolution??Q.RESOLUTION,this.text=t,this.style=e}measureText(t){var u,c;const{text:e,style:i,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(n)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:a}=s;(o>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const h=Math.min(this.maxWidth,Math.ceil(o)),l=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",h.toString()),this._svgRoot.setAttribute("height",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:(u=this._style)==null?void 0:u.toCSS(n)}),this._styleElement.textContent=(c=this._style)==null?void 0:c.toGlobalCSS()),{width:h+i.padding*2,height:l+i.padding*2}}async updateText(t=!0){const{style:e,_image:i,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:o}=this.measureText();i.width=n.width=Math.ceil(Math.max(1,s)),i.height=n.height=Math.ceil(Math.max(1,o)),this._updateID++;const a=this._updateID;await new Promise(h=>{n.onload=async()=>{if(a<this._updateID){h();return}await e.onBeforeDraw(),i.src=n.src,n.onload=null,n.src="",this.updateTexture(),h()};const l=new XMLSerializer().serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:n}=this,{padding:s}=t,{baseTexture:o}=e;e.trim.width=e._frame.width=i.width/n,e.trim.height=e._frame.height=i.height/n,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(i.width,i.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var i,n,s,o,a;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Lr.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((i=this._style)==null||i.cleanFonts()),this._style=e,(n=this._svgRoot)==null||n.remove(),this._svgRoot=e,(s=this._domElement)==null||s.remove(),this._domElement=e,(o=this._foreignObject)==null||o.remove(),this._foreignObject=e,(a=this._styleElement)==null||a.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=He(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=He(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof oa?(this.ownsStyle=!1,this._style=t):t instanceof je?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=oa.from(t)):(this.ownsStyle=!0,this._style=new oa(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};fn.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},fn.defaultMaxWidth=2024,fn.defaultMaxHeight=2024,fn.defaultAutoResolution=!0;class FT{constructor(t){const e={width:xd,height:bd,antialias:!0,backgroundAlpha:0,clearBeforeRender:!0,preserveDrawingBuffer:!0,...t};this.renderer=pf(e),this.stage=new Gt}destroy(){var i,n,s,o,a;(i=this.stage)==null||i.destroy({children:!0,texture:!0,baseTexture:!0}),this.stage=void 0;const t=(n=this.renderer)==null?void 0:n.type,e=this.renderer instanceof ps?(s=this.renderer)==null?void 0:s.gl:void 0;t===xh.WEBGL&&e&&((o=e==null?void 0:e.getExtension("WEBGL_lose_context"))==null||o.loseContext()),(a=this.renderer)==null||a.destroy(!0),this.renderer=void 0}get view(){var t;return(t=this.renderer)==null?void 0:t.view}render(){var t;this.stage!=null&&((t=this.renderer)==null||t.render(this.stage))}}class aw extends _d{constructor(t,e,i){var n;super(e,i),this.ctx=t,this.container=new Gt,(n=this.ctx.stage)==null||n.addChild(this.container)}render(){this.ctx.render()}addChild(t){this.container.addChild(t)}clearLayer(){this.container.removeChildren().forEach(e=>{e.destroy()})}onMount(t){var e,i;super.onMount(t),this.pixiViewContainer=((e=this.element)==null?void 0:e.querySelector("#webgl-layer"))??void 0,this.pixiViewContainer||(this.pixiViewContainer=document.createElement("div"),this.pixiViewContainer.setAttribute("id",`${this.id}`),this.pixiViewContainer.setAttribute("class","webgl-layer"),this.ctx.view!=null&&this.pixiViewContainer.appendChild(this.ctx.view),(i=this.element)==null||i.appendChild(this.pixiViewContainer),this.updateStyle())}onUnmount(t){var e,i;super.onUnmount(t),this.clearLayer(),(e=this.ctx.stage)==null||e.removeChild(this.container),this.container.destroy(),(i=this.pixiViewContainer)==null||i.remove(),this.pixiViewContainer=void 0}onResize(t){var e;super.onResize(t),(e=this.ctx.renderer)==null||e.resize(t.width,t.height)}onRescale(t){super.onRescale(t);const e=t.xBounds[0]>t.xBounds[1],i=t.yBounds[0]>t.yBounds[1];this.setContainerPosition(t.xScale(0),t.yScale(0)),this.setContainerScale(t.xRatio*(e?-1:1),t.yRatio*(i?-1:1))}setContainerPosition(t,e){this.container.position.set(t,e)}setContainerScale(t,e){this.container.scale.set(t,e)}updateStyle(t){var s;const e=t||this.isVisible,i=this.interactive?"auto":"none";this.container.visible=e;const n=[["position","absolute"],["pointer-events",`${i}`],["z-index",`${this.order}`],["opacity",`${this.opacity}`]].map(o=>o.join(":")).join(";");(s=this.pixiViewContainer)==null||s.setAttribute("style",n)}setVisibility(t,e){super.setVisibility(t,e),this.pixiViewContainer&&this.updateStyle(t)}onOpacityChanged(t){this.pixiViewContainer&&this.updateStyle()}onOrderChanged(t){this.pixiViewContainer&&this.updateStyle()}onInteractivityChanged(t){this.pixiViewContainer&&this.updateStyle()}renderType(){var t;return(t=this.ctx.renderer)==null?void 0:t.type}}function Fh(r){throw new Error(`Unexpected object: ${JSON.stringify(r)}`)}const hw=r=>r.kind==="pAndASymbol",lw=r=>r.kind==="cementSqueeze",uw=r=>r.kind==="cementPlug",cw=(r,t,e)=>i=>{switch(i.kind){case"screen":return r(i);case"tubing":return t(i);case"completionSymbol":return e(i);default:return Fh(i)}},Ze=(r,t)=>{switch(t){case"Perforation":return r.Perforation(t);case"Open hole gravel pack":return r.OpenHoleGravelPack(t);case"Open hole frac pack":return r.OpenHoleFracPack(t);case"Cased hole fracturation":return r.CasedHoleFracturation(t);case"Cased hole frac pack":return r.CasedHoleFracPack(t);case"Cased hole gravel pack":return r.CasedHoleGravelPack(t);default:return Fh(t)}},dw=r=>Ze({Perforation:()=>!1,OpenHoleGravelPack:()=>!0,OpenHoleFracPack:()=>!0,CasedHoleFracturation:()=>!1,CasedHoleGravelPack:()=>!0,CasedHoleFracPack:()=>!0},r.subKind);function fw(r){return Ze({Perforation:()=>!1,OpenHoleGravelPack:()=>!1,OpenHoleFracPack:()=>!0,CasedHoleFracturation:()=>!0,CasedHoleGravelPack:()=>!1,CasedHoleFracPack:()=>!0},r.subKind)}function pw(r){return Ze({Perforation:()=>!0,OpenHoleGravelPack:()=>!1,OpenHoleFracPack:()=>!1,CasedHoleFracturation:()=>!1,CasedHoleGravelPack:()=>!1,CasedHoleFracPack:()=>!1},r.subKind)}function mw(r){return Ze({Perforation:()=>!1,OpenHoleGravelPack:()=>!1,OpenHoleFracPack:()=>!1,CasedHoleFracturation:()=>!1,CasedHoleGravelPack:()=>!0,CasedHoleFracPack:()=>!1},r.subKind)}function gw(r){return Ze({Perforation:()=>!1,OpenHoleGravelPack:()=>!1,OpenHoleFracPack:()=>!1,CasedHoleFracturation:()=>!1,CasedHoleGravelPack:()=>!1,CasedHoleFracPack:()=>!0},r.subKind)}const yw=r=>r.subKind==="Cased hole fracturation",vw=(r,t)=>r.start<t.end&&r.end>t.start,_w=r=>({holeLayerId:`${r}-hole`,casingLayerId:`${r}-casing`,completionLayerId:`${r}-completion`,cementLayerId:`${r}-cement`,pAndALayerId:`${r}-pAndA`,perforationLayerId:`${r}-perforation`}),xw={firstColor:"#8c541d",secondColor:"#eee3d8",lineColor:"#8b4513"},bw={solidColor:"#dcdcdc",lineColor:"#575757",shoeSize:{width:$y,length:Vy},windowOptions:{dashColor:"#dc0000",dashLength:5,spaceLength:3}},ww={stroke:"rgba(0, 0, 0, 0.25)",yellow:"#FFFC00",grey:"gray",red:"#FF5050",outline:"black",transparent:"rgba(255, 255, 255, 0)",spikeWidth:50,spikeLength:50,packingOpacity:.7,fracLineCurve:10,fracLineLength:25,scalingFactor:25},Tw={firstColor:"#c7b9ab",secondColor:"#5b5b5b",scalingFactor:4},Aw={firstColor:"#8b6713",secondColor:"#000000",scalingFactor:4},Ew={scalingFactor:4,lineColor:"#63666a"},Sw={scalingFactor:1,innerColor:"#eeeeff",outerColor:"#777788"},Cw={firstColor:"#c7b9ab",secondColor:"#000000",scalingFactor:4},Pw=16,Iw=6;function Ee(r){const t=$e(r);if(t!=null){const e=t==null?void 0:t.formatHex();return parseInt(e.replace("#","0x"))}else throw Error(`Could not format string ${r} to hex code.`)}function DT(r){return typeof r=="string"?r:`#${r.toString(Pw).padStart(Iw,"0")}`}const Rw=2147483648,Mw=4294967295;function BT(r,t,e){const i=e.filter(f=>f.data.values),n=Nw(i),s=new Map,o=Ow(n,t,s);Lw(o);const a=Fw(n,r),h=zw(r,o,t),l=Bw(s,h),c=[...Dw(l,r),...Object.values(h).flat().filter(f=>!f.exclude)];return{lines:a,areas:c}}function Fw(r,t){return r.filter(i=>i.visualization==="line").map(i=>({id:i.name,label:i.name,width:2,color:Ee(i.color||"black"),data:t.map((n,s)=>[n[0],i.values[s]])}))}function Dw(r,t){return r.map((i,n)=>{const s=n+1<r.length?r[n+1]:null;return{id:i.id,color:Ee(i.color),data:t.map((o,a)=>[o[0],i.top[a],...s?[s.top[a]]:[]])}})}function Bw(r,t){return Array.from(r.values()).sort((i,n)=>i.age-n.age).filter(i=>{const n=t[i.name],s=n&&n.length>0;return s||console.warn(`Intersection surface group '${i.name}' has no valid entries and will be discarded.`),s}).map((i,n)=>{const o=t[i.name][0];return{id:i.name,label:i.name,color:Uw(n),top:o.data.map(a=>a[1])}})}function Ow(r,t,e){const i=t&&t.find(o=>o.stratUnitLevel===1),n=i?i.identifier:"SEABED";return r.filter(o=>o.visualization==="interval"||o.visualization==="none").map(o=>{const a=[],h=jf(t,o.name,a);h||console.warn(`No match for ${o.name} in strat column`);const l=a[0]||h,u=l&&l.identifier||n;return l&&!e.has(u)&&e.set(u,{age:l.topAge,name:l.identifier}),{...o,unit:h,group:u}})}function Lw(r){r.sort((t,e)=>{if(!t.unit&&!e.unit)return 0;if(!t.unit)return-1;if(!e.unit)return 1;const i=t.isBase?t.unit.baseAge:t.unit.topAge,n=e.isBase?e.unit.baseAge:e.unit.topAge;return i!==n?i-n:t.isBase&&!e.isBase?1:!t.isBase&&e.isBase?-1:t.unit.stratUnitLevel-e.unit.stratUnitLevel})}function jf(r,t,e=[]){const i=r.find(n=>n.identifier.toLowerCase()===t.toLowerCase());if(i){let n=i;do e.unshift(n),n=r.find(s=>s.identifier===n.stratUnitParent);while(n);return i}return null}function Nw(r){return r.map(t=>{const e=t.visualSettings.displayName,i=e.replace(/\s(Base|Top)/gi,""),n=e.toLowerCase().endsWith("base");return{name:i,isBase:n,values:t.data.values,color:t.visualSettings.colors.crossSection,visualization:t.visualSettings.crossSection.toLowerCase()}})}function kw(r){return r.colorR===null||r.colorG===null||r.colorB===null?Rw:r.colorR<<16|r.colorG<<8|r.colorB}const Uw=kc().domain([0,100]).range(qp(Si("#e6f1cf","#85906d"),10));function Gw(r,t,e,i){const n=t+1;if(!e||n>=e.length)return;const s=e.findIndex(o=>o.isBase&&o.name===r.name);if(s!==-1)return s;for(let o=n;o<e.length;o++){const a=e[o];if(!(a!=null&&a.isBase)||Hw(r,a,i))return o}}function Hw(r,t,e){const i=[];return jf(e,r.name,i),i.some(n=>t.name===n.identifier)}function zw(r,t,e){return t.reduce((n,s,o)=>{var a;if(!s.isBase){n[s.group]||(n[s.group]=[]);const h=Gw(s,o,t,e);(a=n[s.group])==null||a.push({id:s.name,label:s.name,color:s.unit&&kw(s.unit)||Mw,exclude:s.visualization==="none"||!s.unit,data:r.map((l,u)=>{const c=s.values[u]!=null?$w(h,t,u):void 0;return[l[0],s.values[u],c]})})}return n},{})}function $w(r,t,e){var i,n;if(!(!t||!r||r>=t.length)){for(let s=r;s<t.length;s++)if(((i=t[s])==null?void 0:i.values[e])!=null)return(n=t[s])==null?void 0:n.values[e]}}const Vw={dash:[10,5],width:1,color:16777215,alpha:1,scale:1,useTexture:!1,alignment:.5},ue=class ue{constructor(t,e={}){this.cursor=new ct,this.scale=1,this.graphics=t,e={...Vw,...e},this.dash=e.dash,this.dashSize=this.dash.reduce((i,n)=>i+n),this.useTexture=e.useTexture,this.options=e,this.setLineStyle()}setLineStyle(){const t=this.options;if(this.useTexture){const e=ue.getTexture(t,this.dashSize);this.graphics.lineTextureStyle({width:t.width*t.scale,color:t.color,alpha:t.alpha,texture:e,alignment:t.alignment})}else this.graphics.lineStyle({width:t.width*t.scale,color:t.color,alpha:t.alpha,cap:t.cap,join:t.join,alignment:t.alignment});this.scale=t.scale}static distance(t,e,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))}moveTo(t,e){return this.lineLength=0,this.cursor.set(t,e),this.start=new ct(t,e),this.graphics.moveTo(this.cursor.x,this.cursor.y),this}lineTo(t,e,i){typeof this.lineLength===void 0&&this.moveTo(0,0);const s=ue.distance(this.cursor.x,this.cursor.y,t,e),o=Math.atan2(e-this.cursor.y,t-this.cursor.x),a=i&&t===this.start.x&&e===this.start.y;if(this.useTexture)if(this.graphics.moveTo(this.cursor.x,this.cursor.y),this.adjustLineStyle(o),a&&this.dash.length%2===0){const h=Math.min(this.dash[this.dash.length-1],s);this.graphics.lineTo(t-Math.cos(o)*h,e-Math.sin(o)*h),this.graphics.closePath()}else this.graphics.lineTo(t,e);else{const h=Math.cos(o),l=Math.sin(o);let u=this.cursor.x,c=this.cursor.y;const d=this.lineLength%(this.dashSize*this.scale);let f=0,p=0,m=0;for(let y=0;y<this.dash.length;y++){const x=this.dash[y]*this.scale;if(d<m+x){f=y,p=d-m;break}else m+=x}let g=s;for(;g>0;){const y=this.dash[f]*this.scale-p,x=g>y?y:g;if(a&&ue.distance(u+h*x,c+l*x,this.start.x,this.start.y)<=x){if(f%2===0){const E=ue.distance(u,c,this.start.x,this.start.y)-this.dash[this.dash.length-1]*this.scale;u+=h*E,c+=l*E,this.graphics.lineTo(u,c)}break}u+=h*x,c+=l*x,f%2?this.graphics.moveTo(u,c):this.graphics.lineTo(u,c),g-=x,f++,f=f===this.dash.length?0:f,p=0}}return this.lineLength+=s,this.cursor.set(t,e),this}closePath(){this.lineTo(this.start.x,this.start.y,!0)}drawCircle(t,e,i,n=80,s){const o=Math.PI*2/n;let a=0,h;s?(h=new ct(t+Math.cos(a)*i,e+Math.sin(a)*i),s.apply(h,h),this.moveTo(h[0],h[1])):(h=new ct(t+Math.cos(a)*i,e+Math.sin(a)*i),this.moveTo(h.x,h.y)),a+=o;for(let l=1;l<n+1;l++){const u=l===n?h:[t+Math.cos(a)*i,e+Math.sin(a)*i];this.lineTo(u[0],u[1]),a+=o}return this}drawEllipse(t,e,i,n,s=80,o){const a=Math.PI*2/s;let h;const l=new ct;for(let u=0;u<Math.PI*2;u+=a){let c=t-i*Math.sin(u),d=e-n*Math.cos(u);o&&(l.set(c,d),o.apply(l,l),c=l.x,d=l.y),u===0?(this.moveTo(c,d),h={x:c,y:d}):this.lineTo(c,d)}return this.lineTo(h.x,h.y,!0),this}drawPolygon(t,e){const i=new ct;if(typeof t[0]=="number")if(e){i.set(t[0],t[1]),e.apply(i,i),this.moveTo(i.x,i.y);for(let n=2;n<t.length;n+=2)i.set(t[n],t[n+1]),e.apply(i,i),this.lineTo(i.x,i.y,n===t.length-2)}else{this.moveTo(t[0],t[1]);for(let n=2;n<t.length;n+=2)this.lineTo(t[n],t[n+1],n===t.length-2)}else if(e){const n=t[0];i.copyFrom(n),e.apply(i,i),this.moveTo(i.x,i.y);for(let s=1;s<t.length;s++){const o=t[s];i.copyFrom(o),e.apply(i,i),this.lineTo(i.x,i.y,s===t.length-1)}}else{const n=t[0];this.moveTo(n.x,n.y);for(let s=1;s<t.length;s++){const o=t[s];this.lineTo(o.x,o.y,s===t.length-1)}}return this}drawRect(t,e,i,n,s){if(s){const o=new ct;o.set(t,e),s.apply(o,o),this.moveTo(o.x,o.y),o.set(t+i,e),s.apply(o,o),this.lineTo(o.x,o.y),o.set(t+i,e+n),s.apply(o,o),this.lineTo(o.x,o.y),o.set(t,e+n),s.apply(o,o),this.lineTo(o.x,o.y),o.set(t,e),s.apply(o,o),this.lineTo(o.x,o.y,!0)}else this.moveTo(t,e).lineTo(t+i,e).lineTo(t+i,e+n).lineTo(t,e+n).lineTo(t,e,!0);return this}adjustLineStyle(t){const e=this.graphics.line;e.matrix=new vt,t&&e.matrix.rotate(t),this.scale!==1&&e.matrix.scale(this.scale,this.scale);const i=-this.lineLength;e.matrix.translate(this.cursor.x+i*Math.cos(t),this.cursor.y+i*Math.sin(t)),this.graphics.lineStyle(e)}static getTexture(t,e){const i=t.dash.toString();if(ue.dashTextureCache[i])return ue.dashTextureCache[i];const n=document.createElement("canvas");n.width=e,n.height=Math.ceil(t.width);const s=n.getContext("2d");if(!s){console.warn("Did not get context from canvas");return}s.strokeStyle="white",s.globalAlpha=t.alpha,s.lineWidth=t.width;let o=0;const a=t.width/2;s.moveTo(o,a);for(let l=0;l<t.dash.length;l+=2)o+=t.dash[l],s.lineTo(o,a),t.dash.length!==l+1&&(o+=t.dash[l+1],s.moveTo(o,a));s.stroke();const h=ue.dashTextureCache[i]=j.from(n);return h.baseTexture.scaleMode=fe.NEAREST,h}};ue.dashTextureCache={};let oh=ue;const ah=r=>new qc(r.x,r.y),Xw=r=>new ct(r[0],r[1]),qf=r=>{if(r.length<2)return[new qc(0)];let t;return r.map((e,i,n)=>{const s=n[i],o=n[i+1];if(i<n.length-1&&s!=null&&o!=null){const a=ah(s);return t=ah(o).sub(a).rotate90().normalized(),t}return t})},Yf=(r,t,e)=>{const i=ah(r);return Xw(i.add(t.scale(e)))},hh=(r,t,e)=>{if(r.length!==t.length)throw new Error("Number of vectors does not match number of points");return r.map((i,n)=>{const s=t[n];if(s!=null)return Yf(i,s,e);throw new Error(`Trying to read index ${n} of point ${i}, but no such vector was found!`)})},Dc=(r,t,e,i)=>r<=i&&e<=t,Ww=(r,t,e,i)=>r<i&&e<t,jw=r=>Array.from(new Set(r)),vs=(r,t,e,i)=>{const n=i.filter(o=>Dc(r,t,o.start,o.end)),s=e.filter(o=>Dc(r,t,o.start,o.end));return{overlappingHoles:n,overlappingOuterStrings:s}},_s=([r,t],e)=>{const s=e.flatMap(a=>[a.start-1e-4,a.start,a.end,a.end+1e-4]).filter(a=>a>=r&&a<=t);return s.push(r),s.push(t),jw(s).sort((a,h)=>a-h)},Lt=r=>r.kind==="casing"?r.innerDiameter:r.diameter,Kf=(r,t,e,i)=>{const s=r.find(l=>l.start<=i&&l.end>=i),o=s?s.diameter:0,a=t.filter(l=>Lt(l)>o).sort((l,u)=>Lt(l)-Lt(u)).find(l=>l.start<=i&&l.end>=i),h=e.find(l=>l.start<=i&&l.end>=i&&l.diameter>o);return a?Lt(a):h?h.diameter:100},qw=(r,t,e,i)=>{const s=r.sort((a,h)=>h.diameter-a.diameter).find(a=>a.start<=e&&a.end>=e),o=t.find(a=>a.start<=e&&a.end>=e);return s&&i!=="Open hole frac pack"&&i!=="Open hole gravel pack"?Lt(s):o?o.diameter:100},Yw=(r,t,e,i)=>{const s=r.sort((l,u)=>Lt(l)-Lt(u)).find(l=>l.start<=i&&l.end>=i);if(s)return Lt(s);const o=r.length?Math.min(...r.map(l=>Lt(l))):0,a=t.sort((l,u)=>Lt(l)-Lt(u)).find(l=>l.start<=i&&l.end>=i&&o<=Lt(l));if(a)return Lt(a);const h=e.find(l=>l.start<=i&&l.end>=i&&l.diameter);return h?h.diameter:100},Kw=(r,t,e,i,n,s)=>{const{attachedStrings:o,nonAttachedStrings:a}=Dh(r.referenceIds,t,e);if(o.length===0)throw new Error(`Invalid cement data, can't find referenced casing/completion string for cement with id '${r.id}'`);o.sort((m,g)=>m.end-g.end);const h=o[o.length-1].end,{overlappingOuterStrings:l,overlappingHoles:u}=vs(r.toc,h,a,i),c=[...l,...u].map(m=>({start:m.start,end:m.end}));return _s([r.toc,h],c).flatMap((m,g,y)=>{if(g===y.length-1)return[];const x=y[g+1],v=Kf(o,l,u,m);return[{top:m,bottom:x,diameter:v*n}]}).map(m=>({diameter:m.diameter,points:s(m.top,m.bottom)}))},Dh=(r,t,e)=>[...t,...e].reduce((i,n)=>r.includes(n.id)?{...i,attachedStrings:[...i.attachedStrings,n]}:{...i,nonAttachedStrings:[...i.nonAttachedStrings,n]},{attachedStrings:[],nonAttachedStrings:[]}),Zw=(r,t,e,i,n,s)=>{const{attachedStrings:o,nonAttachedStrings:a}=Dh(r.referenceIds,t,e);if(o.length===0)throw new Error(`Invalid cement squeeze data, can't find referenced casing/completion for squeeze with id '${r.id}'`);const{overlappingOuterStrings:h,overlappingHoles:l}=vs(r.start,r.end,a,i),u=[...h,...l].map(p=>({start:p.start,end:p.end}));return _s([r.start,r.end],u).flatMap((p,m,g)=>{if(m===g.length-1)return[];const y=g[m+1],x=Kf(o,h,l,p);return[{top:p,bottom:y,diameter:x*n}]}).map(p=>({diameter:p.diameter,points:s(p.top,p.bottom)}))},Qw=(r,t,e,i,n,s)=>{const{attachedStrings:o,nonAttachedStrings:a}=Dh(r.referenceIds,t,e),{overlappingHoles:h,overlappingOuterStrings:l}=vs(r.start,r.end,a,i),u=[...o,...h,...l].map(p=>({start:p.start,end:p.end}));return _s([r.start,r.end],u).flatMap((p,m,g)=>{if(m===g.length-1)return[];const y=g[m+1],x=Yw(o,l,h,p);return[{top:p,bottom:y,diameter:x*n}]}).map(p=>({diameter:p.diameter,points:s(p.top,p.bottom)}))},Jw=(r,t,e,i,n)=>{const o=t.createLinearGradient(0,0,0,r.height);return o.addColorStop(0,e),o.addColorStop(.5-n,i),o.addColorStop(.5+n,i),o.addColorStop(1,e),o},tT=({firstColor:r,secondColor:t},e,i)=>{const n=document.createElement("canvas");n.width=e,n.height=i;const s=n.getContext("2d");if(s==null)throw Error("Could not get canvas context!");return s.fillStyle=Jw(n,s,r,t,0),s.fillRect(0,0,n.width,n.height),j.from(n)},eT=({scalingFactor:r})=>{const t=document.createElement("canvas"),e=Ve*r;t.width=e,t.height=e;const i=t.getContext("2d");if(i==null)throw Error("Could not get canvas context!");i.fillStyle="white",i.fillRect(0,0,t.width,t.height);const n=e/10;i.strokeStyle="#AAAAAA",i.lineWidth=n,i.beginPath();const s=e/3;for(let o=-t.width;o<t.width;o++)i.moveTo(-t.width+s*o,-t.height),i.lineTo(t.width+s*o,t.height*2);return i.stroke(),j.from(t)},rT=({innerColor:r,outerColor:t,scalingFactor:e})=>{const i=Ve*e,n=document.createElement("canvas");n.width=i,n.height=i;const s=n.getContext("2d");if(s==null)throw Error("Could not get canvas context!");const o=s.createLinearGradient(0,0,0,i),a=.3,h=.7;return o.addColorStop(0,t),o.addColorStop(a,r),o.addColorStop(h,r),o.addColorStop(1,t),s.fillStyle=o,s.fillRect(0,0,n.width,n.height),j.from(n)},iT=({firstColor:r,secondColor:t,scalingFactor:e})=>{const i=document.createElement("canvas"),n=Ve*e,s=e;i.width=n,i.height=n;const o=i.getContext("2d");if(o==null)throw Error("Could not get canvas context!");o.fillStyle=r,o.fillRect(0,0,i.width,i.height),o.lineWidth=s,o.fillStyle=t,o.beginPath();const a=n/12;for(let h=-i.width;h<i.width;h++)o.moveTo(-i.width+a*h,-i.height),o.lineTo(i.width+a*h,i.height);return o.stroke(),j.from(i)},nT=({firstColor:r,secondColor:t,scalingFactor:e})=>{const i=document.createElement("canvas"),n=Ve*e;i.width=n,i.height=n;const s=i.getContext("2d");if(s==null)throw Error("Could not get canvas context!");s.fillStyle=r,s.fillRect(0,0,i.width,i.height),s.lineWidth=e,s.strokeStyle=t,s.beginPath(),s.setLineDash([20,10]);const o=n/12;for(let a=-i.width;a<i.width;a++)s.moveTo(-i.width+o*a,-i.height),s.lineTo(i.width+o*a,i.height*2);return s.stroke(),j.from(i)},sT=({firstColor:r,secondColor:t,scalingFactor:e})=>{const i=document.createElement("canvas"),n=Ve*e,s=e;i.width=n,i.height=n;const o=i.getContext("2d");if(o==null)throw Error("Could not get canvas context!");o.lineWidth=s,o.fillStyle=r,o.strokeStyle=t,o.fillRect(0,0,i.width,i.height),o.beginPath(),o.setLineDash([20,10]);const a=n/12;for(let h=-i.width;h<i.width;h++)o.moveTo(-i.width+a*h,-i.height),o.lineTo(i.width+a*h,i.height*2);return o.stroke(),j.from(i)},Pn=(r,t)=>{const e=qf(t),i=hh(t,e,r);return{leftPath:hh(t,e,-r),rightPath:i}},aa=(r,t)=>({kind:"casing",start:r,end:t}),oT=(r,t)=>({kind:"casing-window",start:r,end:t}),aT=r=>{const t=(r.windows||[]).filter(e=>Ww(r.start,r.end,e.start,e.end)).reduce(({intervals:e,lastBottom:i},n,s,o)=>{const a=i<n.start?aa(i,n.start):null,h=a?a.end:i,l=Math.max(h,n.start),u=Math.min(r.end,n.end),c=oT(l,u),d=u,p=s===o.length-1&&d<r.end?aa(d,r.end):null,m=[a,c,p].filter(g=>g!=null);return{intervals:[...e,...m],lastBottom:d}},{intervals:[],lastBottom:r.start});return t.intervals.length?t.intervals:[aa(r.start,r.end)]},hT=(r,t,e)=>{const i=t.diameter*r,n=i/2,o=t.innerDiameter*r/2,a=n-o,h=aT(t).map(l=>{const u=e(l.start,l.end),{leftPath:c,rightPath:d}=Pn(n,u);return{kind:l.kind,leftPath:c,rightPath:d,pathPoints:u}});return{kind:"casing",id:t.id,referenceDiameter:i,referenceRadius:n,sections:h,casingWallWidth:a,hasShoe:t.hasShoe,bottom:t.end}},lT=(r,t,e,i,n)=>{const{overlappingOuterStrings:s,overlappingHoles:o}=vs(r.start,r.end,t,e),a=[...s,...o].map(c=>({start:c.start,end:c.end}));return _s([r.start,r.end],a).flatMap((c,d,f)=>{if(d===f.length-1)return[];const p=f[d+1],m=qw(s,o,c,r.subKind);return[{top:c,bottom:p,diameter:m*i}]}).map(c=>{const d=n(c.top,c.bottom);return{diameter:c.diameter,points:d}})},xs=(r,t,e)=>{const{packingOpacity:i,yellow:n}=e;t.fillStyle=n,t.strokeStyle=n;const s=[0,0],o=[r.width,r.height];t.save(),t.globalAlpha=i,t.fillRect(...s,...o),t.restore()},Bh=(r,t,e,i,n)=>{const{fracLineCurve:s}=i,o=10,a=r.width/o,h=e/3*i.scalingFactor,l=h/4,u=h/2,c=0,d=n==="diameter"?0:u;t.globalAlpha=i.packingOpacity;const f=()=>{for(let p=-1;p<o;p++){const m=[p*a+c+a/2,r.height/2-l-d-l];t.beginPath();const g=[...m],y=[m[0]-s*2,m[1]-l/4],x=[m[0],m[1]-l/2],v=[m[0]+s*2,m[1]-l/2-l/4],E=[m[0],m[1]-l];t.bezierCurveTo(...g,...y,...x),t.bezierCurveTo(...x,...v,...E),t.stroke()}for(let p=-1;p<o;p++){const m=[p*a+a+c+a/2,r.height/2+h/2+d];t.beginPath();const g=[...m],y=[m[0]-s*2,m[1]+l/4],x=[m[0],m[1]+l/2],v=[m[0]+s*2,m[1]+l/2+l/4],E=[m[0],m[1]+l];t.bezierCurveTo(...g,...y,...x),t.bezierCurveTo(...x,...v,...E),t.stroke()}};t.strokeStyle=i.yellow,t.lineWidth=6,t.save(),f(),t.restore(),t.lineWidth=1,t.strokeStyle=i.outline,f(),t.closePath()},uT=(r,t,e,i)=>{const s=r.width/4;t.strokeStyle=i.outline;const o=e/3*i.scalingFactor;t.lineWidth=1;const a=o/2;for(let h=0;h<=4;h++){const l=[h*s,r.height/2-o/2],u=[l[0]-s/2,l[1]-a],c=[l[0]-s,l[1]];t.beginPath(),t.moveTo(...l),t.lineTo(...u),t.lineTo(...c),t.fill(),t.lineWidth=1,t.stroke()}for(let h=0;h<=4;h++){const l=[h*s,r.height/2+o/2],u=[l[0]-s/2,l[1]+a],c=[l[0]-s,l[1]];t.beginPath(),t.moveTo(...l),t.lineTo(...u),t.lineTo(...c),t.fill(),t.lineWidth=1,t.stroke()}t.closePath()},ve=(r="Error!",t)=>{console.error(`${r}`);const e=document.createElement("canvas"),i=Ve;e.width=i/2,e.height=i;const n=e.getContext("2d"),s=[0,0],o=[e.width,e.height];if(n==null)throw Error("Could not get canvas context!");return n.fillStyle="#ff00ff",n.fillRect(...s,...o),new j(j.from(e,{wrapMode:kt.CLAMP}).baseTexture,void 0,new ht(0,0,e.width,e.height),void 0,yt.MIRROR_HORIZONTAL)},qe=(r,t)=>{const e=document.createElement("canvas"),n=r.diameter*t.scalingFactor;e.width=n/2,e.height=n;const s=e.getContext("2d");if(s==null)throw Error("Could not get canvas context!");return{canvas:e,ctx:s}},Ye=r=>new j(j.from(r,{wrapMode:kt.CLAMP}).baseTexture,void 0,new ht(0,0,r.width,r.height),void 0,yt.MIRROR_HORIZONTAL),cT=(r,t)=>e=>t.some(i=>e(i)&&vw(r,i)),Oh={packing:()=>ve(),fracLines:()=>ve(),spikes:(r,t,e,i)=>{const{canvas:n,ctx:s}=qe(t,i),o=cT(r,e),a=o(mw),h=o(yw),l=o(gw),c=a||h||l?i.yellow:i.red;return s.globalAlpha=i.packingOpacity,r.isOpen?(s.fillStyle=c,s.strokeStyle=c):(s.fillStyle=i.grey,s.strokeStyle=i.grey),uT(n,s,t.diameter,i),l&&Bh(n,s,t.diameter,i,"spike"),Ye(n)}},Zf={packing:()=>ve(),fracLines:(r,t)=>{const{canvas:e,ctx:i}=qe(r,t);return Bh(e,i,r.diameter,t,"diameter"),Ye(e)},spikes:()=>ve()},rs={packing:(r,t)=>{const{canvas:e,ctx:i}=qe(r,t);return xs(e,i,t),Ye(e)},fracLines:(r,t)=>{const{canvas:e}=qe(r,t);return Ye(e)},spikes:()=>ve()},Lh={packing:(r,t)=>{const{canvas:e,ctx:i}=qe(r,t);return xs(e,i,t),Ye(e)},fracLines:()=>ve(),spikes:()=>ve()},Nh={packing:(r,t)=>{const{canvas:e,ctx:i}=qe(r,t);return xs(e,i,t),Ye(e)},fracLines:()=>ve(),spikes:()=>ve()},kh={packing:(r,t,e)=>{const{canvas:i,ctx:n}=qe(t,e);return xs(i,n,e),Ye(i)},fracLines:(r,t)=>{const{canvas:e,ctx:i}=qe(r,t);return Bh(e,i,r.diameter,t,"diameter"),Ye(e)},spikes:()=>ve()},dT=(r,t,e)=>Ze({Perforation:()=>Oh.packing(),CasedHoleFracturation:()=>rs.packing(t,e),CasedHoleFracPack:()=>rs.packing(t,e),OpenHoleGravelPack:()=>Nh.packing(t,e),OpenHoleFracPack:()=>kh.packing(r,t,e),CasedHoleGravelPack:()=>Lh.packing(t,e)},r.subKind),fT=(r,t,e)=>Ze({Perforation:()=>Oh.fracLines(),OpenHoleGravelPack:()=>Nh.fracLines(),OpenHoleFracPack:()=>kh.fracLines(t,e),CasedHoleFracturation:()=>Zf.fracLines(t,e),CasedHoleGravelPack:()=>Lh.fracLines(),CasedHoleFracPack:()=>rs.fracLines(t,e)},r.subKind),pT=(r,t,e,i)=>Ze({Perforation:()=>Oh.spikes(r,e,t,i),OpenHoleGravelPack:()=>Nh.spikes(),OpenHoleFracPack:()=>kh.spikes(),CasedHoleFracturation:()=>Zf.spikes(),CasedHoleGravelPack:()=>Lh.spikes(),CasedHoleFracPack:()=>rs.spikes()},r.subKind);class mT extends Li{constructor(t){const e=Rs(t,i=>i.points.length);super(new Float32Array(e*4),new Float32Array(e*4),new Uint16Array((e-1)*6)),this.segments=t,this.build()}get width(){return la(this.segments,t=>t.diameter)}build(){var p,m,g,y,x,v,E,w;const t=this.segments;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex(),s=Rs(t,I=>I.points.length);if(s<1)return;e.data.length/4!==s&&(e.data=new Float32Array(s*4),i.data=new Float32Array(s*4),n.data=new Uint16Array((s-1)*6));const o=i.data,a=n.data;o[0]=0,o[1]=0,o[2]=0,o[3]=1;const h=t.length,l=la(t,I=>I.diameter);let u=0,c=0,d=0,f=0;for(let I=0;I<h;I++){let T=(p=t[I])==null?void 0:p.points[0];const F=l,U=((m=t[I])==null?void 0:m.diameter)/l/2,G=(g=t[I])==null?void 0:g.points.length;for(let z=0;z<G;z++){const M=T.x-((x=(y=t[I])==null?void 0:y.points[z])==null?void 0:x.x),B=T.y-((E=(v=t[I])==null?void 0:v.points[z])==null?void 0:E.y),S=Math.sqrt(M*M+B*B);T=(w=t[I])==null?void 0:w.points[z],u+=S/F,o[c]=u,o[c+1]=.5-U,o[c+2]=u,o[c+3]=.5+U,c+=4}for(let z=0;z<G-1;z++)a[f++]=d,a[f++]=d+1,a[f++]=d+2,a[f++]=d+2,a[f++]=d+1,a[f++]=d+3,d+=2;d+=2}i.update(),n.update(),this.updateVertices()}updateVertices(){var s,o,a,h,l,u,c,d;const t=this.segments;if(Rs(t,f=>f.points.length)<1)return;const i=t.length;let n=0;for(let f=0;f<i;f++){let p=(s=t[f])==null?void 0:s.points[0],m,g=0,y=0;const x=(o=this.buffers[0])==null?void 0:o.data,v=(a=t[f])==null?void 0:a.points.length;let E=0;for(let w=0;w<v;w++){const I=(h=t[f])==null?void 0:h.points[w];E=n+w*4,w<((l=t[f])==null?void 0:l.points.length)-1?m=(u=t[f])==null?void 0:u.points[w+1]:m=I,y=-(m.x-p.x),g=m.y-p.y;const T=Math.sqrt(g*g+y*y),F=((c=t[f])==null?void 0:c.diameter)/2;g/=T,y/=T,g*=F,y*=F,x!=null&&(x[E]=I.x+g,x[E+1]=I.y+y,x[E+2]=I.x-g,x[E+3]=I.y-y),p=I}n=E+4}(d=this.buffers[0])==null||d.update()}update(){this.build()}}class gT extends Kr{constructor(t,e){const i=new mT(e),n=new Zr(t);t.baseTexture.wrapMode=kt.REPEAT,super(i,n),this.autoUpdate=!0}_render(t){const e=this.geometry;this.autoUpdate&&e.update(),super._render(t)}}class yT extends Li{constructor(t,e=200){super(new Float32Array(t.length*4),new Float32Array(t.length*4),new Uint16Array((t.length-1)*6)),this.points=t,this._width=e,this.build()}get width(){return this._width}build(){var c,d;const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),i.data=new Float32Array(t.length*4),n.data=new Uint16Array((t.length-1)*6));const s=i.data,o=n.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;let a=0,h=t[0];const l=t.length;for(let f=0;f<l;f++){const p=f*4,m=h.x-((c=t[f])==null?void 0:c.x),g=h.y-((d=t[f])==null?void 0:d.y),y=Math.sqrt(m*m+g*g);h=t[f],a+=y/this._width,s[p]=a,s[p+1]=0,s[p+2]=a,s[p+3]=1}let u=0;for(let f=0;f<l-1;f++){const p=f*2;o[u++]=p,o[u++]=p+1,o[u++]=p+2,o[u++]=p+2,o[u++]=p+1,o[u++]=p+3}i.update(),n.update(),this.updateVertices()}updateVertices(){var h,l;const t=this.points;if(t.length<1)return;let e=t[0],i,n=0,s=0;const o=(h=this.buffers[0])==null?void 0:h.data,a=t.length;for(let u=0;u<a;u++){const c=t[u],d=u*4;u<t.length-1?i=t[u+1]:i=c,s=-(i.x-e.x),n=i.y-e.y;const f=Math.sqrt(n*n+s*s),p=this._width/2;n/=f,s/=f,n*=p,s*=p,o[d]=c.x+n,o[d+1]=c.y+s,o[d+2]=c.x-n,o[d+3]=c.y-s,e=c}(l=this.buffers[0])==null||l.update()}update(){this.build()}}class vT extends Kr{constructor(t,e,i){const n=new yT(e,i),s=new Zr(t);t.baseTexture.wrapMode=kt.REPEAT,super(n,s),this.autoUpdate=!0}_render(t){const e=this.geometry;this.autoUpdate&&e.update(),super._render(t)}}class _T extends Li{constructor(t,e=200){super(new Float32Array(t.length*4),new Float32Array(t.length*4),new Uint16Array((t.length-1)*6)),this.points=t,this._width=e,this.build()}build(){var f,p,m,g;const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),i.data=new Float32Array(t.length*4),n.data=new Uint16Array((t.length-1)*6));const s=t.length;let o=0,a=t[0];for(let y=0;y<s;y++){const x=a.x-((f=t[y])==null?void 0:f.x),v=a.y-((p=t[y])==null?void 0:p.y),E=Math.sqrt(x*x+v*v);a=t[y],o+=E}const h=i.data,l=n.data;h[0]=0,h[1]=0,h[2]=0,h[3]=1;let u=0,c=t[0];for(let y=0;y<s;y++){const x=y*4,v=c.x-((m=t[y])==null?void 0:m.x),E=c.y-((g=t[y])==null?void 0:g.y),w=Math.sqrt(v*v+E*E);c=t[y],u+=w/o,h[x]=u,h[x+1]=0,h[x+2]=u,h[x+3]=1}let d=0;for(let y=0;y<s-1;y++){const x=y*2;l[d++]=x,l[d++]=x+1,l[d++]=x+2,l[d++]=x+2,l[d++]=x+1,l[d++]=x+3}i.update(),n.update(),this.updateVertices()}updateVertices(){var h,l;const t=this.points;if(t.length<1)return;let e=t[0],i,n=0,s=0;const o=(h=this.buffers[0])==null?void 0:h.data,a=t.length;for(let u=0;u<a;u++){const c=t[u],d=u*4;u<t.length-1?i=t[u+1]:i=c,s=-(i.x-e.x),n=i.y-e.y;const f=Math.sqrt(n*n+s*s),p=this._width/2;n/=f,s/=f,n*=p,s*=p,o[d]=c.x+n,o[d+1]=c.y+s,o[d+2]=c.x-n,o[d+3]=c.y-s,e=c}(l=this.buffers[0])==null||l.update()}update(){this.updateVertices()}}class xT extends Kr{constructor(t,e){const i=new _T(e,t.height),n=new Zr(t);super(i,n),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}}const bT=(r,t,e)=>i=>{switch(i.kind){case"casing":return r(i);case"cement":return t(i);case"cementSqueeze":return e(i);default:return Fh(i)}},wT=r=>({exaggerationFactor:2,internalLayerOptions:_w(r),holeOptions:xw,casingOptions:bw,cementOptions:Tw,cementSqueezeOptions:Aw,screenOptions:Ew,tubingOptions:Sw,cementPlugOptions:Cw,perforationOptions:ww}),is=class is extends aw{constructor(t,e,i){super(t,e,i),this.internalLayerVisibility={holeLayerId:!0,casingLayerId:!0,completionLayerId:!0,cementLayerId:!0,pAndALayerId:!0,perforationLayerId:!0},this.cementTextureCache=null,this.cementSqueezeTextureCache=null,this.cementPlugTextureCache=null,this.holeTextureCache=null,this.screenTextureCache=null,this.tubingTextureCache=null,this.textureSymbolCacheArray=null,this.scalingFactors={height:600,zFactor:1,yScale:On()},this.getZFactorScaledPathForPoints=(n,s)=>{var h;const o=l=>l*this.scalingFactors.zFactor;return(((h=this.referenceSystem)==null?void 0:h.getCurtainPath(n,s,!0))??[]).map(l=>new ct(l.point[0],o(l.point[1])))},this.drawBigPolygon=(n,s=0)=>{const o=new Ti;o.beginFill(s),o.drawPolygon(n),o.endFill(),this.addChild(o)},this.perforationRopeAndTextureReferences=[],this.prepareSymbolRenderObject=n=>{const{exaggerationFactor:s=1}=this.options,o=n.diameter*s;return{pathPoints:this.getZFactorScaledPathForPoints(n.start,n.end),referenceDiameter:o,symbolKey:n.symbolKey}},this.drawSymbolComponent=({pathPoints:n,referenceDiameter:s,symbolKey:o})=>{const a=this.getSymbolTexture(o,s);this.drawSVGRope(n,a)},this.drawHoleSize=(n,s)=>{if(s==null)return;const o=this.getZFactorScaledPathForPoints(s.start,s.end);if(o.length===0)return;const{exaggerationFactor:a=1,holeOptions:h}=this.options,l=s.diameter*a,{rightPath:u,leftPath:c}=Pn(l/2,o),d=this.getHoleTexture(h,l,n);this.drawHoleRope(o,d,n),this.drawOutline(c,u,Ee(h.lineColor),Hy*a,"TopAndBottom",0)},this.drawCasing=n=>{const{casingOptions:s}=this.options,o=Ee(s.solidColor),a=Ee(s.lineColor);n.sections.forEach((h,l,u)=>{const c=is.getOutlineClosureType(l,u.length-1),d=this.createCasingTexture(n.referenceDiameter);this.drawRope(h.pathPoints,d,o),h.kind==="casing-window"?this.drawCasingWindowOutline(h.leftPath,h.rightPath,s,n.casingWallWidth):this.drawOutline(h.leftPath,h.rightPath,a,n.casingWallWidth,c)})},this.generateShoe=(n,s,o,a)=>{const h=n-o,l=n,u=this.getZFactorScaledPathForPoints(h,l),c=qf(u),d=hh(u,c,s*(a<0?-1:1)),f=u[u.length-1],p=c[c.length-1],m=Yf(f,p,a+s*(a<0?-1:1));return[...d,m]},this.createCementSqueezeShape=(n,s,o,a)=>{const{exaggerationFactor:h=1}=this.options;return Zw(n,s,o,a,h,this.getZFactorScaledPathForPoints)},this.createPerforationShape=(n,s,o)=>{const{exaggerationFactor:a=1}=this.options;return lT(n,s,o,a,this.getZFactorScaledPathForPoints)},this.options={...this.options,...wT(this.id),...i}}onUnmount(t){super.onUnmount(t),this.cementTextureCache=null,this.cementSqueezeTextureCache=null,this.holeTextureCache=null,this.screenTextureCache=null,this.tubingTextureCache=null,this.textureSymbolCacheArray=null}onUpdate(t){super.onUpdate(t),this.clearLayer(),this.preRender(),this.render()}onRescale(t){const e=this.scalingFactors.zFactor!==t.zFactor;this.scalingFactors={height:t.height,zFactor:t.zFactor,yScale:t.yScale},super.optionsRescale(t);const i=this.yRatio(),n=t.xBounds[0]>t.xBounds[1],s=t.yBounds[0]>t.yBounds[1];this.setContainerPosition(t.xScale(0),t.yScale(0)),this.setContainerScale(t.xRatio*(n?-1:1),i*(s?-1:1)),e&&(this.clearLayer(),this.preRender()),this.render()}setVisibility(t,e){if(e===this.id){super.setVisibility(t,e);return}const{internalLayerOptions:i}=this.options,s=(i?Object.entries(i):[]).find(([a,h])=>h===e),o=s==null?void 0:s[0];o&&(this.internalLayerVisibility[o]=t,this.clearLayer(),this.preRender(),this.render())}getInternalLayerIds(){const{internalLayerOptions:t}=this.options;return t?Object.values(t):[]}yRatio(){const t=this.scalingFactors.yScale.domain(),i=(t[1]-t[0])*this.scalingFactors.zFactor,n=[t[0],t[0]+i];return Math.abs(this.scalingFactors.height/(n[1]-n[0]))}drawRope(t,e,i){if(t.length===0)return;const n=new Sc(e,t,1);n.tint=i||n.tint,this.addChild(n)}drawOutline(t,e,i,n=1,s="None",o=1){const a=t.map(c=>c.clone()).reverse(),h=e[0],l=a[0],u=new Ti;u.lineStyle(n,i,void 0,o),u.moveTo(h.x,h.y),e.forEach(c=>u.lineTo(c.x,c.y)),(s==="None"||s==="Top")&&u.moveTo(l.x,l.y),a.forEach(c=>u.lineTo(c.x,c.y)),(s==="TopAndBottom"||s==="Top")&&u.lineTo(h.x,h.y),this.addChild(u)}drawCasingWindowOutline(t,e,{lineColor:i,windowOptions:n},s=1){var m,g;const o=!!((g=(m=this.referenceSystem)==null?void 0:m.options)!=null&&g.calculateDisplacementFromBottom),[a,h]=o?[t,e]:[e,t],[l,u]=o?[1,0]:[0,1],c=new Ti;c.lineStyle(s,Ee(i),void 0,u);const d=a[0];c.moveTo(d.x,d.y),a.forEach(y=>c.lineTo(y.x,y.y));const f=new oh(c,{dash:[n.dashLength,n.spaceLength],color:Ee(n.dashColor),width:s,alignment:l}),p=h[0];f.moveTo(p.x,p.y),h.forEach(y=>{f.lineTo(y.x,y.y)}),this.addChild(c)}preRender(){if(!this.data||!this.referenceSystem)return;const{exaggerationFactor:t=1}=this.options,{holeSizes:e,casings:i,cements:n,completion:s,symbols:o,pAndA:a,perforations:h}=this.data;this.updateSymbolCache(o),e.sort((m,g)=>g.diameter-m.diameter);const l=e.length>0?(la(e,m=>m.diameter)??0)*t:Gy*t;this.internalLayerVisibility.holeLayerId&&e.forEach(m=>this.drawHoleSize(l,m)),i.sort((m,g)=>g.diameter-m.diameter);const u=i.map(m=>this.createCasingRenderObject(m)),c=n.map(m=>({kind:"cement",segments:Kw(m,i,s,e,t,this.getZFactorScaledPathForPoints),casingIds:(m.referenceIds||[]).filter(g=>g)})),[d,f]=a.reduce(([m,g],y)=>lw(y)?[[y,...m],g]:[m,[y,...g]],[[],[]]),p=d.map(m=>({kind:"cementSqueeze",segments:this.createCementSqueezeShape(m,i,s,e),casingIds:m.referenceIds}));if(this.sortCementAndCasingRenderObjects(u,c,p).forEach(bT(m=>{this.internalLayerVisibility.casingLayerId&&(this.drawCasing(m),m.hasShoe&&this.drawShoe(m.bottom,m.referenceRadius))},m=>{if(this.internalLayerVisibility.cementLayerId){const g=this.getCementTexture();g&&this.drawComplexRope(m.segments,g)}},m=>{if(this.internalLayerVisibility.pAndALayerId){const g=this.getCementSqueezeTexture();g&&this.drawComplexRope(m.segments,g)}})),this.perforationRopeAndTextureReferences.forEach(({rope:m,texture:g})=>{m.destroy({children:!0,texture:!0,baseTexture:!0}),g.destroy(!0)}),this.perforationRopeAndTextureReferences=[],this.internalLayerVisibility.perforationLayerId){const{perforationOptions:m}=this.options,g=h.filter(dw),y=h.filter(fw),x=h.filter(pw);g.forEach(v=>{const w=this.createPerforationShape(v,i,e).reduce((I,T)=>(I[T.diameter]||(I[T.diameter]=[]),I[T.diameter]=[...I[T.diameter]??[],T],I),{});Object.values(w).forEach(I=>{const T=dT(v,I[0],m),F=this.drawComplexRope(I,T);F&&this.perforationRopeAndTextureReferences.push({rope:F,texture:T})})}),x.forEach(v=>{const I=this.createPerforationShape(v,i,e).map(T=>({...T,diameter:T.diameter*3})).reduce((T,F)=>(T[F.diameter]||(T[F.diameter]=[]),T[F.diameter]=[...T[F.diameter]??[],F],T),{});Object.values(I).forEach(T=>{T.forEach(F=>{const U=pT(v,h,F,m),G=this.drawComplexRope([F],U);G&&this.perforationRopeAndTextureReferences.push({rope:G,texture:U})})})}),y.forEach(v=>{const I=this.createPerforationShape(v,i,e).map(T=>({...T,diameter:T.diameter*3})).reduce((T,F)=>(T[F.diameter]||(T[F.diameter]=[]),T[F.diameter]=[...T[F.diameter]??[],F],T),{});Object.values(I).forEach(T=>{T.forEach(F=>{const U=fT(v,F,m),G=this.drawComplexRope([F],U);G&&this.perforationRopeAndTextureReferences.push({rope:G,texture:U})})})})}this.internalLayerVisibility.completionLayerId&&s.forEach(cw(m=>this.drawScreen(m),m=>this.drawTubing(m),m=>{const g=this.prepareSymbolRenderObject(m);this.drawSymbolComponent(g)})),this.internalLayerVisibility.pAndALayerId&&f.forEach(m=>{if(hw(m)){const g=this.prepareSymbolRenderObject(m);this.drawSymbolComponent(g)}uw(m)&&this.drawCementPlug(m,i,s,e)})}updateSymbolCache(t){if(this.textureSymbolCacheArray||(this.textureSymbolCacheArray={}),!t)return;const e=Object.keys(this.textureSymbolCacheArray);Object.entries(t).forEach(([i,n])=>{!e.includes(i)&&this.textureSymbolCacheArray&&(this.textureSymbolCacheArray[i]=j.from(n))})}drawCementPlug(t,e,i,n){const{exaggerationFactor:s=1,cementPlugOptions:o}=this.options,a=Qw(t,e,i,n,s,this.getZFactorScaledPathForPoints);o&&this.drawComplexRope(a,this.getCementPlugTexture(o));const{rightPath:h,leftPath:l}=a.reduce((u,c)=>{const{leftPath:d,rightPath:f}=Pn(c.diameter/2,c.points);return{rightPath:[...u.rightPath,...f],leftPath:[...u.leftPath,...d]}},{rightPath:[],leftPath:[]});this.drawOutline(l,h,Ee("black"),.25,"TopAndBottom")}createCasingRenderObject(t){const{exaggerationFactor:e=1}=this.options;return hT(e,t,this.getZFactorScaledPathForPoints)}getCementPlugTexture(t){return this.cementPlugTextureCache||(this.cementPlugTextureCache=nT(t)),this.cementPlugTextureCache}drawSVGRope(t,e){if(t.length===0)return;const i=new xT(e,t);this.addChild(i)}getSymbolTexture(t,e){var n,s;const i=(s=(n=this.textureSymbolCacheArray)==null?void 0:n[t])==null?void 0:s.baseTexture;return i?new j(i,void 0,new ht(0,0,0,e),void 0,yt.MAIN_DIAGONAL):void 0}drawHoleRope(t,e,i){if(t.length===0)return;const n=new Sc(e,t,i/Ve);this.addChild(n)}getHoleTexture(t,e,i){const n=Ve,s=n,o=n,a=e/i*n;this.holeTextureCache||(this.holeTextureCache=tT(t,o,s));const h=this.holeTextureCache.baseTexture,l=(s-a)/2,u=new ht(0,l,o,a);return new j(h,u)}sortCementAndCasingRenderObjects(t,e,i){let n=0;const{result:s}=t.reduce((o,a)=>{const h=o.remainingCement.find(u=>u.casingIds.includes(a.id)),l=o.remainingCementSqueezes.filter(u=>u.casingIds.includes(a.id));return h&&(h.zIndex=n++),l.forEach(u=>u.zIndex=n++),a.zIndex=n++,{result:[...o.result,h,a,...l],remainingCement:o.remainingCement.filter(u=>u!==h),remainingCementSqueezes:o.remainingCementSqueezes.filter(u=>!l.includes(u))}},{result:[],remainingCement:e,remainingCementSqueezes:i});return s.filter(o=>o!=null).sort((o,a)=>o.zIndex-a.zIndex)}drawComplexRope(t,e){if(t.length===0)return;const i=new gT(e,t);return this.addChild(i),i}createCasingTexture(t){return new j(j.WHITE.baseTexture,void 0,new ht(0,0,16,t))}drawShoe(t,e){const{exaggerationFactor:i=1,casingOptions:n}=this.options,s=n.shoeSize.width*i,o=n.shoeSize.length*i,a=this.generateShoe(t,e,o,s),h=this.generateShoe(t,e,o,-s);this.drawBigPolygon(h),this.drawBigPolygon(a)}getCementTexture(){if(!this.cementTextureCache){const{cementOptions:t}=this.options;t&&(this.cementTextureCache=iT(t))}return this.cementTextureCache}getCementSqueezeTexture(){if(!this.cementSqueezeTextureCache){const{cementSqueezeOptions:t}=this.options;t&&(this.cementSqueezeTextureCache=sT(t))}return this.cementSqueezeTextureCache}drawScreen({start:t,end:e,diameter:i}){const{exaggerationFactor:n=1,screenOptions:s}=this.options,o=n*i,a=this.getZFactorScaledPathForPoints(t,e),{leftPath:h,rightPath:l}=Pn(o/2,a),u=this.getScreenTexture();u&&(this.drawCompletionRope(a,u,o),this.drawOutline(h,l,Ee(s.lineColor),zy*n,"TopAndBottom"))}drawTubing({diameter:t,start:e,end:i}){const{exaggerationFactor:n=1,tubingOptions:s}=this.options,o=n*t,a=this.getZFactorScaledPathForPoints(e,i),h=this.getTubingTexture(s);this.drawCompletionRope(a,h,o)}getTubingTexture(t){return this.tubingTextureCache||(this.tubingTextureCache=rT(t)),this.tubingTextureCache}getScreenTexture(){if(!this.screenTextureCache){const{screenOptions:t}=this.options;t&&(this.screenTextureCache=eT(t))}return this.screenTextureCache}drawCompletionRope(t,e,i){if(t.length===0)return;const n=new vT(e,t,i);this.addChild(n)}};is.getOutlineClosureType=(t,e)=>t===0?t===e?"TopAndBottom":"Top":t===e?"Bottom":"None";let Bc=is;const OT=r=>{const t=document.createElement("div");return t.setAttribute("style",`display: flex;flex:1;flex-direction:column; width: ${r}px;height:100%; background-color: white; padding: 12px;`),t},LT=(r,t)=>{const e=document.createElement("div");return e.className="story-layer-container",e.setAttribute("style",`height: ${t}px; width: ${r}px;background-color: #eee;`),e.setAttribute("height",`${t}`),e.setAttribute("width",`${r}`),e},NT=r=>{const t=document.createElement("div");return t.className="button-container",t.setAttribute("style",`width: ${r}px;background-color: white;`),t},kT=()=>{const r=document.createElement("p"),t=[];let e;function i(){window.requestAnimationFrame(()=>{const n=performance.now();for(;t.length>0&&t[0]<=n-1e3;)t.shift();t.push(n),e=t.length,r.innerHTML=`FPS: ${e}`,i()})}return i(),r},UT=r=>{const t=document.createElement("p");return t.innerHTML=r,t};export{MT as C,xd as D,Ti as G,PT as H,_d as L,FT as P,Bc as S,IT as V,CT as Z,Fh as a,NT as b,OT as c,LT as d,kT as e,UT as f,BT as g,y0 as h,DT as i,qc as j,RT as k,aw as l,bd as m,ST as n,ET as o,On as p,$e as q,AT as r,Ue as s,Be as t,er as u};
