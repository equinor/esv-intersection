import{g as Mc,c as Fs,a as lf}from"./_commonjsHelpers-de833af9.js";const cf={order:1,layerOpacity:1,interactive:!1};class Fc{constructor(t,e){this._interactive=!1,this._id=t||`layer-${Math.floor(Math.random()*1e3)}`;const i=e||cf;this._order=i.order||1,this._options={...i},this.loading=!1,this._element=void 0,this._opacity=i.layerOpacity||1,this._visible=!0,this._interactive=i.interactive||!1,e&&e.data&&this.setData(e.data),this._referenceSystem=e==null?void 0:e.referenceSystem,this.onMount=this.onMount.bind(this),this.onUnmount=this.onUnmount.bind(this),this.onUpdate=this.onUpdate.bind(this),this.onRescale=this.onRescale.bind(this),this.onResize=this.onResize.bind(this),this.onOrderChanged=this.onOrderChanged.bind(this),this.onOpacityChanged=this.onOpacityChanged.bind(this),this.setVisibility=this.setVisibility.bind(this)}get id(){return this._id}get element(){return this._element}get options(){return this._options}set options(t){this._options=t}set isLoading(t){this.loading=t}get isLoading(){return this.loading}set opacity(t){this._opacity=t,this.onOpacityChanged(t)}get opacity(){return this._opacity}set order(t){this._order=t,this.onOrderChanged(t)}get order(){return this._order}set interactive(t){this._interactive=t,this.onInteractivityChanged(t)}get interactive(){return this._interactive}get referenceSystem(){return this._referenceSystem}set referenceSystem(t){this._referenceSystem=t}get data(){return this.getData()}set data(t){this.setData(t)}get isVisible(){return this._visible}getData(){return this._data}setData(t){this._data=t,this.element&&t!=null&&this.onUpdate({data:t})}clearData(t=!0){this._data=void 0,t&&(this.referenceSystem=void 0),this.onUpdate({})}setVisibility(t,e){this._visible=t}onMount(t){this._element=t.elm,this._options.onMount&&this._options.onMount(t,this)}onUnmount(t){this._options.onUnmount&&t!=null&&this._options.onUnmount(t,this)}onResize(t){this._options.onResize&&this._options.onResize(t,this)}onUpdate(t){t.data&&(this._data=t.data),this._options.onUpdate&&this._options.onUpdate(t,this)}onRescale(t){this.optionsRescale(t)}optionsRescale(t){this._options.onRescale&&this._options.onRescale(t,this)}getInternalLayerIds(){return[]}}const Bc=200,Dc=300,fT=40,pT=30,uf=100,df=.6,ff=.3,pf=8,mf=16,Ue=64,mT=1;class gT extends Fc{onOpacityChanged(t){this.canvas&&this.updateStyle()}onOrderChanged(t){this.canvas&&this.updateStyle()}onInteractivityChanged(t){this.canvas&&this.updateStyle()}setVisibility(t){super.setVisibility(t),this.canvas&&this.updateStyle(t)}updateStyle(t){var s;const i=t||this.isVisible?"visible":"hidden",n=this.interactive?"auto":"none";(s=this.canvas)==null||s.setAttribute("style",`position:absolute;pointer-events:${n};z-index:${this.order};opacity:${this.opacity};visibility:${i}`)}onMount(t){super.onMount(t);const{elm:e}=t,i=t.width||parseInt((e==null?void 0:e.getAttribute("width"))??"",10)||Bc,n=t.height||parseInt((e==null?void 0:e.getAttribute("height"))??"",10)||Dc;this.elm=e;let s;this.canvas||(s=document.createElement("canvas"),this.canvas=s,t.elm.appendChild(s)),this.canvas.setAttribute("id",`${this.id}`),this.canvas.setAttribute("width",`${i}px`),this.canvas.setAttribute("height",`${n}px`),this.canvas.setAttribute("class","canvas-layer"),this.updateStyle(),this.ctx=this.canvas.getContext("2d")??void 0}onUnmount(){var t;super.onUnmount(),(t=this.canvas)==null||t.remove(),this.canvas=void 0}onResize(t){const{ctx:e}=this,{width:i,height:n}=t;e==null||e.canvas.setAttribute("width",`${i}px`),e==null||e.canvas.setAttribute("height",`${n}px`)}onUpdate(t){super.onUpdate(t)}resetTransform(){var t;(t=this.ctx)==null||t.resetTransform()}setTransform(t){var n,s;this.resetTransform();const e=t.xBounds[0]>t.xBounds[1],i=t.yBounds[0]>t.yBounds[1];(n=this.ctx)==null||n.translate(t.xScale(0),t.yScale(0)),(s=this.ctx)==null||s.scale(t.xRatio*(e?-1:1),t.yRatio*(i?-1:1))}clearCanvas(){const{ctx:t,canvas:e}=this;t==null||t.save(),t==null||t.resetTransform(),t==null||t.clearRect(0,0,(e==null?void 0:e.width)??0,(e==null?void 0:e.height)??0),t==null||t.restore()}}var Co="http://www.w3.org/1999/xhtml";const wh={svg:"http://www.w3.org/2000/svg",xhtml:Co,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ms(r){var t=r+="",e=t.indexOf(":");return e>=0&&(t=r.slice(0,e))!=="xmlns"&&(r=r.slice(e+1)),wh.hasOwnProperty(t)?{space:wh[t],local:r}:r}function gf(r){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Co&&t.documentElement.namespaceURI===Co?t.createElement(r):t.createElementNS(e,r)}}function yf(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Lc(r){var t=ms(r);return(t.local?yf:gf)(t)}function _f(){}function Ga(r){return r==null?_f:function(){return this.querySelector(r)}}function vf(r){typeof r!="function"&&(r=Ga(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=new Array(o),h,l,c=0;c<o;++c)(h=s[c])&&(l=r.call(h,h.__data__,c,s))&&("__data__"in h&&(l.__data__=h.__data__),a[c]=l);return new Ft(i,this._parents)}function xf(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function bf(){return[]}function Nc(r){return r==null?bf:function(){return this.querySelectorAll(r)}}function wf(r){return function(){return xf(r.apply(this,arguments))}}function Tf(r){typeof r=="function"?r=wf(r):r=Nc(r);for(var t=this._groups,e=t.length,i=[],n=[],s=0;s<e;++s)for(var o=t[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&(i.push(r.call(h,h.__data__,l,o)),n.push(h));return new Ft(i,n)}function Oc(r){return function(){return this.matches(r)}}function kc(r){return function(t){return t.matches(r)}}var Af=Array.prototype.find;function Ef(r){return function(){return Af.call(this.children,r)}}function Sf(){return this.firstElementChild}function Cf(r){return this.select(r==null?Sf:Ef(typeof r=="function"?r:kc(r)))}var If=Array.prototype.filter;function Pf(){return Array.from(this.children)}function Rf(r){return function(){return If.call(this.children,r)}}function Mf(r){return this.selectAll(r==null?Pf:Rf(typeof r=="function"?r:kc(r)))}function Ff(r){typeof r!="function"&&(r=Oc(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=[],h,l=0;l<o;++l)(h=s[l])&&r.call(h,h.__data__,l,s)&&a.push(h);return new Ft(i,this._parents)}function Uc(r){return new Array(r.length)}function Bf(){return new Ft(this._enter||this._groups.map(Uc),this._parents)}function On(r,t){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=t}On.prototype={constructor:On,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,t){return this._parent.insertBefore(r,t)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function Df(r){return function(){return r}}function Lf(r,t,e,i,n,s){for(var o=0,a,h=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):e[o]=new On(r,s[o]);for(;o<h;++o)(a=t[o])&&(n[o]=a)}function Nf(r,t,e,i,n,s,o){var a,h,l=new Map,c=t.length,u=s.length,d=new Array(c),f;for(a=0;a<c;++a)(h=t[a])&&(d[a]=f=o.call(h,h.__data__,a,t)+"",l.has(f)?n[a]=h:l.set(f,h));for(a=0;a<u;++a)f=o.call(r,s[a],a,s)+"",(h=l.get(f))?(i[a]=h,h.__data__=s[a],l.delete(f)):e[a]=new On(r,s[a]);for(a=0;a<c;++a)(h=t[a])&&l.get(d[a])===h&&(n[a]=h)}function Of(r){return r.__data__}function kf(r,t){if(!arguments.length)return Array.from(this,Of);var e=t?Nf:Lf,i=this._parents,n=this._groups;typeof r!="function"&&(r=Df(r));for(var s=n.length,o=new Array(s),a=new Array(s),h=new Array(s),l=0;l<s;++l){var c=i[l],u=n[l],d=u.length,f=Uf(r.call(c,c&&c.__data__,l,i)),p=f.length,m=a[l]=new Array(p),g=o[l]=new Array(p),y=h[l]=new Array(d);e(c,u,m,g,y,f,t);for(var v=0,_=0,x,w;v<p;++v)if(x=m[v]){for(v>=_&&(_=v+1);!(w=g[_])&&++_<p;);x._next=w||null}}return o=new Ft(o,i),o._enter=a,o._exit=h,o}function Uf(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function Gf(){return new Ft(this._exit||this._groups.map(Uc),this._parents)}function Hf(r,t,e){var i=this.enter(),n=this,s=this.exit();return typeof r=="function"?(i=r(i),i&&(i=i.selection())):i=i.append(r+""),t!=null&&(n=t(n),n&&(n=n.selection())),e==null?s.remove():e(s),i&&n?i.merge(n).order():n}function zf(r){for(var t=r.selection?r.selection():r,e=this._groups,i=t._groups,n=e.length,s=i.length,o=Math.min(n,s),a=new Array(n),h=0;h<o;++h)for(var l=e[h],c=i[h],u=l.length,d=a[h]=new Array(u),f,p=0;p<u;++p)(f=l[p]||c[p])&&(d[p]=f);for(;h<n;++h)a[h]=e[h];return new Ft(a,this._parents)}function $f(){for(var r=this._groups,t=-1,e=r.length;++t<e;)for(var i=r[t],n=i.length-1,s=i[n],o;--n>=0;)(o=i[n])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Vf(r){r||(r=Xf);function t(u,d){return u&&d?r(u.__data__,d.__data__):!u-!d}for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s){for(var o=e[s],a=o.length,h=n[s]=new Array(a),l,c=0;c<a;++c)(l=o[c])&&(h[c]=l);h.sort(t)}return new Ft(n,this._parents).order()}function Xf(r,t){return r<t?-1:r>t?1:r>=t?0:NaN}function Wf(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function jf(){return Array.from(this)}function Yf(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var i=r[t],n=0,s=i.length;n<s;++n){var o=i[n];if(o)return o}return null}function qf(){let r=0;for(const t of this)++r;return r}function Zf(){return!this.node()}function Kf(r){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],s=0,o=n.length,a;s<o;++s)(a=n[s])&&r.call(a,a.__data__,s,n);return this}function Qf(r){return function(){this.removeAttribute(r)}}function Jf(r){return function(){this.removeAttributeNS(r.space,r.local)}}function tp(r,t){return function(){this.setAttribute(r,t)}}function ep(r,t){return function(){this.setAttributeNS(r.space,r.local,t)}}function rp(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(r):this.setAttribute(r,e)}}function ip(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,e)}}function np(r,t){var e=ms(r);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((t==null?e.local?Jf:Qf:typeof t=="function"?e.local?ip:rp:e.local?ep:tp)(e,t))}function Gc(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function sp(r){return function(){this.style.removeProperty(r)}}function op(r,t,e){return function(){this.style.setProperty(r,t,e)}}function ap(r,t,e){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(r):this.style.setProperty(r,i,e)}}function hp(r,t,e){return arguments.length>1?this.each((t==null?sp:typeof t=="function"?ap:op)(r,t,e??"")):Vr(this.node(),r)}function Vr(r,t){return r.style.getPropertyValue(t)||Gc(r).getComputedStyle(r,null).getPropertyValue(t)}function lp(r){return function(){delete this[r]}}function cp(r,t){return function(){this[r]=t}}function up(r,t){return function(){var e=t.apply(this,arguments);e==null?delete this[r]:this[r]=e}}function dp(r,t){return arguments.length>1?this.each((t==null?lp:typeof t=="function"?up:cp)(r,t)):this.node()[r]}function Hc(r){return r.trim().split(/^|\s+/)}function Ha(r){return r.classList||new zc(r)}function zc(r){this._node=r,this._names=Hc(r.getAttribute("class")||"")}zc.prototype={add:function(r){var t=this._names.indexOf(r);t<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var t=this._names.indexOf(r);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function $c(r,t){for(var e=Ha(r),i=-1,n=t.length;++i<n;)e.add(t[i])}function Vc(r,t){for(var e=Ha(r),i=-1,n=t.length;++i<n;)e.remove(t[i])}function fp(r){return function(){$c(this,r)}}function pp(r){return function(){Vc(this,r)}}function mp(r,t){return function(){(t.apply(this,arguments)?$c:Vc)(this,r)}}function gp(r,t){var e=Hc(r+"");if(arguments.length<2){for(var i=Ha(this.node()),n=-1,s=e.length;++n<s;)if(!i.contains(e[n]))return!1;return!0}return this.each((typeof t=="function"?mp:t?fp:pp)(e,t))}function yp(){this.textContent=""}function _p(r){return function(){this.textContent=r}}function vp(r){return function(){var t=r.apply(this,arguments);this.textContent=t??""}}function xp(r){return arguments.length?this.each(r==null?yp:(typeof r=="function"?vp:_p)(r)):this.node().textContent}function bp(){this.innerHTML=""}function wp(r){return function(){this.innerHTML=r}}function Tp(r){return function(){var t=r.apply(this,arguments);this.innerHTML=t??""}}function Ap(r){return arguments.length?this.each(r==null?bp:(typeof r=="function"?Tp:wp)(r)):this.node().innerHTML}function Ep(){this.nextSibling&&this.parentNode.appendChild(this)}function Sp(){return this.each(Ep)}function Cp(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ip(){return this.each(Cp)}function Pp(r){var t=typeof r=="function"?r:Lc(r);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Rp(){return null}function Mp(r,t){var e=typeof r=="function"?r:Lc(r),i=t==null?Rp:typeof t=="function"?t:Ga(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)})}function Fp(){var r=this.parentNode;r&&r.removeChild(this)}function Bp(){return this.each(Fp)}function Dp(){var r=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function Lp(){var r=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function Np(r){return this.select(r?Lp:Dp)}function Op(r){return arguments.length?this.property("__data__",r):this.node().__data__}function kp(r){return function(t){r.call(this,t,this.__data__)}}function Up(r){return r.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}})}function Gp(r){return function(){var t=this.__on;if(t){for(var e=0,i=-1,n=t.length,s;e<n;++e)s=t[e],(!r.type||s.type===r.type)&&s.name===r.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function Hp(r,t,e){return function(){var i=this.__on,n,s=kp(t);if(i){for(var o=0,a=i.length;o<a;++o)if((n=i[o]).type===r.type&&n.name===r.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=e),n.value=t;return}}this.addEventListener(r.type,s,e),n={type:r.type,name:r.name,value:t,listener:s,options:e},i?i.push(n):this.__on=[n]}}function zp(r,t,e){var i=Up(r+""),n,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var h=0,l=a.length,c;h<l;++h)for(n=0,c=a[h];n<s;++n)if((o=i[n]).type===c.type&&o.name===c.name)return c.value}return}for(a=t?Hp:Gp,n=0;n<s;++n)this.each(a(i[n],t,e));return this}function Xc(r,t,e){var i=Gc(r),n=i.CustomEvent;typeof n=="function"?n=new n(t,e):(n=i.document.createEvent("Event"),e?(n.initEvent(t,e.bubbles,e.cancelable),n.detail=e.detail):n.initEvent(t,!1,!1)),r.dispatchEvent(n)}function $p(r,t){return function(){return Xc(this,r,t)}}function Vp(r,t){return function(){return Xc(this,r,t.apply(this,arguments))}}function Xp(r,t){return this.each((typeof t=="function"?Vp:$p)(r,t))}function*Wp(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var i=r[t],n=0,s=i.length,o;n<s;++n)(o=i[n])&&(yield o)}var Wc=[null];function Ft(r,t){this._groups=r,this._parents=t}function Ni(){return new Ft([[document.documentElement]],Wc)}function jp(){return this}Ft.prototype=Ni.prototype={constructor:Ft,select:vf,selectAll:Tf,selectChild:Cf,selectChildren:Mf,filter:Ff,data:kf,enter:Bf,exit:Gf,join:Hf,merge:zf,selection:jp,order:$f,sort:Vf,call:Wf,nodes:jf,node:Yf,size:qf,empty:Zf,each:Kf,attr:np,style:hp,property:dp,classed:gp,text:xp,html:Ap,raise:Sp,lower:Ip,append:Pp,insert:Mp,remove:Bp,clone:Np,datum:Op,on:zp,dispatch:Xp,[Symbol.iterator]:Wp};function De(r){return typeof r=="string"?new Ft([[document.querySelector(r)]],[document.documentElement]):new Ft([[r]],Wc)}function Yp(r){let t;for(;t=r.sourceEvent;)r=t;return r}function qe(r,t){if(r=Yp(r),t===void 0&&(t=r.currentTarget),t){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=r.clientX,i.y=r.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var n=t.getBoundingClientRect();return[r.clientX-n.left-t.clientLeft,r.clientY-n.top-t.clientTop]}}return[r.pageX,r.pageY]}var _r=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(_r||{}),za=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(za||{}),Io=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(Io||{}),j=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(j||{}),oe=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(oe||{}),D=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(D||{}),Or=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(Or||{}),X=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(X||{}),G=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(G||{}),ae=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(ae||{}),Mt=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(Mt||{}),ue=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(ue||{}),Et=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(Et||{}),ie=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(ie||{}),$a=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))($a||{}),Nt=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(Nt||{}),mt=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(mt||{}),ft=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(ft||{}),he=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(he||{});const qp={createCanvas:(r,t)=>{const e=document.createElement("canvas");return e.width=r,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")},H={ADAPTER:qp,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Bs=/iPhone/i,Th=/iPod/i,Ah=/iPad/i,Eh=/\biOS-universal(?:.+)Mac\b/i,Ds=/\bAndroid(?:.+)Mobile\b/i,Sh=/Android/i,xr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Vi=/Silk/i,me=/Windows Phone/i,Ch=/\bWindows(?:.+)ARM\b/i,Ih=/BlackBerry/i,Ph=/BB10/i,Rh=/Opera Mini/i,Mh=/\b(CriOS|Chrome)(?:.+)Mobile/i,Fh=/Mobile(?:.+)Firefox\b/i,Bh=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function Zp(r){return function(t){return t.test(r)}}function Dh(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var n=Zp(e),s={apple:{phone:n(Bs)&&!n(me),ipod:n(Th),tablet:!n(Bs)&&(n(Ah)||Bh(t))&&!n(me),universal:n(Eh),device:(n(Bs)||n(Th)||n(Ah)||n(Eh)||Bh(t))&&!n(me)},amazon:{phone:n(xr),tablet:!n(xr)&&n(Vi),device:n(xr)||n(Vi)},android:{phone:!n(me)&&n(xr)||!n(me)&&n(Ds),tablet:!n(me)&&!n(xr)&&!n(Ds)&&(n(Vi)||n(Sh)),device:!n(me)&&(n(xr)||n(Vi)||n(Ds)||n(Sh))||n(/\bokhttp\b/i)},windows:{phone:n(me),tablet:n(Ch),device:n(me)||n(Ch)},other:{blackberry:n(Ih),blackberry10:n(Ph),opera:n(Rh),firefox:n(Fh),chrome:n(Mh),device:n(Ih)||n(Ph)||n(Rh)||n(Fh)||n(Mh)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const Kp=Dh.default??Dh,be=Kp(globalThis.navigator);H.RETINA_PREFIX=/@([0-9\.]+)x/;H.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var jc={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function s(h,l,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new n(c,u||h,d),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new i:delete h._events[l]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)t.call(c,u)&&l.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=e?e+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},a.prototype.listenerCount=function(l){var c=e?e+l:l,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(l,c,u,d,f,p){var m=e?e+l:l;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,v,_;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,u),!0;case 4:return g.fn.call(g.context,c,u,d),!0;case 5:return g.fn.call(g.context,c,u,d,f),!0;case 6:return g.fn.call(g.context,c,u,d,f,p),!0}for(_=1,v=new Array(y-1);_<y;_++)v[_-1]=arguments[_];g.fn.apply(g.context,v)}else{var x=g.length,w;for(_=0;_<x;_++)switch(g[_].once&&this.removeListener(l,g[_].fn,void 0,!0),y){case 1:g[_].fn.call(g[_].context);break;case 2:g[_].fn.call(g[_].context,c);break;case 3:g[_].fn.call(g[_].context,c,u);break;case 4:g[_].fn.call(g[_].context,c,u,d);break;default:if(!v)for(w=1,v=new Array(y-1);w<y;w++)v[w-1]=arguments[w];g[_].fn.apply(g[_].context,v)}}return!0},a.prototype.on=function(l,c,u){return s(this,l,c,u,!1)},a.prototype.once=function(l,c,u){return s(this,l,c,u,!0)},a.prototype.removeListener=function(l,c,u,d){var f=e?e+l:l;if(!this._events[f])return this;if(!c)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&o(this,f);else{for(var m=0,g=[],y=p.length;m<y;m++)(p[m].fn!==c||d&&!p[m].once||u&&p[m].context!==u)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=e?e+l:l,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,r.exports=a})(jc);var Qp=jc.exports;const Oi=Mc(Qp);var Va={exports:{}};Va.exports=gs;Va.exports.default=gs;function gs(r,t,e){e=e||2;var i=t&&t.length,n=i?t[0]*e:r.length,s=Yc(r,0,n,e,!0),o=[];if(!s||s.next===s.prev)return o;var a,h,l,c,u,d,f;if(i&&(s=i0(r,t,s,e)),r.length>80*e){a=l=r[0],h=c=r[1];for(var p=e;p<n;p+=e)u=r[p],d=r[p+1],u<a&&(a=u),d<h&&(h=d),u>l&&(l=u),d>c&&(c=d);f=Math.max(l-a,c-h),f=f!==0?32767/f:0}return Ii(s,o,e,a,h,f,0),o}function Yc(r,t,e,i,n){var s,o;if(n===Mo(r,t,e,i)>0)for(s=t;s<e;s+=i)o=Lh(s,r[s],r[s+1],o);else for(s=e-i;s>=t;s-=i)o=Lh(s,r[s],r[s+1],o);return o&&ys(o,o.next)&&(Ri(o),o=o.next),o}function pr(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(ys(e,e.next)||lt(e.prev,e,e.next)===0)){if(Ri(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Ii(r,t,e,i,n,s,o){if(r){!o&&s&&h0(r,i,n,s);for(var a=r,h,l;r.prev!==r.next;){if(h=r.prev,l=r.next,s?t0(r,i,n,s):Jp(r)){t.push(h.i/e|0),t.push(r.i/e|0),t.push(l.i/e|0),Ri(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=e0(pr(r),t,e),Ii(r,t,e,i,n,s,2)):o===2&&r0(r,t,e,i,n,s):Ii(pr(r),t,e,i,n,s,1);break}}}}function Jp(r){var t=r.prev,e=r,i=r.next;if(lt(t,e,i)>=0)return!1;for(var n=t.x,s=e.x,o=i.x,a=t.y,h=e.y,l=i.y,c=n<s?n<o?n:o:s<o?s:o,u=a<h?a<l?a:l:h<l?h:l,d=n>s?n>o?n:o:s>o?s:o,f=a>h?a>l?a:l:h>l?h:l,p=i.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&Mr(n,a,s,h,o,l,p.x,p.y)&&lt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function t0(r,t,e,i){var n=r.prev,s=r,o=r.next;if(lt(n,s,o)>=0)return!1;for(var a=n.x,h=s.x,l=o.x,c=n.y,u=s.y,d=o.y,f=a<h?a<l?a:l:h<l?h:l,p=c<u?c<d?c:d:u<d?u:d,m=a>h?a>l?a:l:h>l?h:l,g=c>u?c>d?c:d:u>d?u:d,y=Po(f,p,t,e,i),v=Po(m,g,t,e,i),_=r.prevZ,x=r.nextZ;_&&_.z>=y&&x&&x.z<=v;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==n&&_!==o&&Mr(a,c,h,u,l,d,_.x,_.y)&&lt(_.prev,_,_.next)>=0||(_=_.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==n&&x!==o&&Mr(a,c,h,u,l,d,x.x,x.y)&&lt(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==n&&_!==o&&Mr(a,c,h,u,l,d,_.x,_.y)&&lt(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==n&&x!==o&&Mr(a,c,h,u,l,d,x.x,x.y)&&lt(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function e0(r,t,e){var i=r;do{var n=i.prev,s=i.next.next;!ys(n,s)&&qc(n,i,i.next,s)&&Pi(n,s)&&Pi(s,n)&&(t.push(n.i/e|0),t.push(i.i/e|0),t.push(s.i/e|0),Ri(i),Ri(i.next),i=r=s),i=i.next}while(i!==r);return pr(i)}function r0(r,t,e,i,n,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&u0(o,a)){var h=Zc(o,a);o=pr(o,o.next),h=pr(h,h.next),Ii(o,t,e,i,n,s,0),Ii(h,t,e,i,n,s,0);return}a=a.next}o=o.next}while(o!==r)}function i0(r,t,e,i){var n=[],s,o,a,h,l;for(s=0,o=t.length;s<o;s++)a=t[s]*i,h=s<o-1?t[s+1]*i:r.length,l=Yc(r,a,h,i,!1),l===l.next&&(l.steiner=!0),n.push(c0(l));for(n.sort(n0),s=0;s<n.length;s++)e=s0(n[s],e);return e}function n0(r,t){return r.x-t.x}function s0(r,t){var e=o0(r,t);if(!e)return t;var i=Zc(e,r);return pr(i,i.next),pr(e,e.next)}function o0(r,t){var e=t,i=r.x,n=r.y,s=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var a=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>s&&(s=a,o=e.x<e.next.x?e:e.next,a===i))return o}e=e.next}while(e!==t);if(!o)return null;var h=o,l=o.x,c=o.y,u=1/0,d;e=o;do i>=e.x&&e.x>=l&&i!==e.x&&Mr(n<c?i:s,n,l,c,n<c?s:i,n,e.x,e.y)&&(d=Math.abs(n-e.y)/(i-e.x),Pi(e,r)&&(d<u||d===u&&(e.x>o.x||e.x===o.x&&a0(o,e)))&&(o=e,u=d)),e=e.next;while(e!==h);return o}function a0(r,t){return lt(r.prev,r,t.prev)<0&&lt(t.next,r,r.next)<0}function h0(r,t,e,i){var n=r;do n.z===0&&(n.z=Po(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,l0(n)}function l0(r){var t,e,i,n,s,o,a,h,l=1;do{for(e=r,r=null,s=null,o=0;e;){for(o++,i=e,a=0,t=0;t<l&&(a++,i=i.nextZ,!!i);t++);for(h=l;a>0||h>0&&i;)a!==0&&(h===0||!i||e.z<=i.z)?(n=e,e=e.nextZ,a--):(n=i,i=i.nextZ,h--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;e=i}s.nextZ=null,l*=2}while(o>1);return r}function Po(r,t,e,i,n){return r=(r-e)*n|0,t=(t-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function c0(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Mr(r,t,e,i,n,s,o,a){return(n-o)*(t-a)>=(r-o)*(s-a)&&(r-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(s-a)>=(n-o)*(i-a)}function u0(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!d0(r,t)&&(Pi(r,t)&&Pi(t,r)&&f0(r,t)&&(lt(r.prev,r,t.prev)||lt(r,t.prev,t))||ys(r,t)&&lt(r.prev,r,r.next)>0&&lt(t.prev,t,t.next)>0)}function lt(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function ys(r,t){return r.x===t.x&&r.y===t.y}function qc(r,t,e,i){var n=Wi(lt(r,t,e)),s=Wi(lt(r,t,i)),o=Wi(lt(e,i,r)),a=Wi(lt(e,i,t));return!!(n!==s&&o!==a||n===0&&Xi(r,e,t)||s===0&&Xi(r,i,t)||o===0&&Xi(e,r,i)||a===0&&Xi(e,t,i))}function Xi(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function Wi(r){return r>0?1:r<0?-1:0}function d0(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&qc(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Pi(r,t){return lt(r.prev,r,r.next)<0?lt(r,t,r.next)>=0&&lt(r,r.prev,t)>=0:lt(r,t,r.prev)<0||lt(r,r.next,t)<0}function f0(r,t){var e=r,i=!1,n=(r.x+t.x)/2,s=(r.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function Zc(r,t){var e=new Ro(r.i,r.x,r.y),i=new Ro(t.i,t.x,t.y),n=r.next,s=t.prev;return r.next=t,t.prev=r,e.next=n,n.prev=e,i.next=e,e.prev=i,s.next=i,i.prev=s,i}function Lh(r,t,e,i){var n=new Ro(r,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Ri(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ro(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}gs.deviation=function(r,t,e,i){var n=t&&t.length,s=n?t[0]*e:r.length,o=Math.abs(Mo(r,0,s,e));if(n)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,c=a<h-1?t[a+1]*e:r.length;o-=Math.abs(Mo(r,l,c,e))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*e,f=i[a+1]*e,p=i[a+2]*e;u+=Math.abs((r[d]-r[p])*(r[f+1]-r[d+1])-(r[d]-r[f])*(r[p+1]-r[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function Mo(r,t,e,i){for(var n=0,s=t,o=e-i;s<e;s+=i)n+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return n}gs.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var o=0;o<t;o++)e.vertices.push(r[n][s][o]);n>0&&(i+=r[n-1].length,e.holes.push(i))}return e};var p0=Va.exports;const m0=Mc(p0);var kn={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */kn.exports;(function(r,t){(function(e){var i=t&&!t.nodeType&&t,n=r&&!r.nodeType&&r,s=typeof Fs=="object"&&Fs;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,h=36,l=1,c=26,u=38,d=700,f=72,p=128,m="-",g=/^xn--/,y=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-l,w=Math.floor,C=String.fromCharCode,T;function S(P){throw new RangeError(_[P])}function F(P,M){for(var W=P.length,Q=[];W--;)Q[W]=M(P[W]);return Q}function O(P,M){var W=P.split("@"),Q="";W.length>1&&(Q=W[0]+"@",P=W[1]),P=P.replace(v,".");var q=P.split("."),et=F(q,M).join(".");return Q+et}function N(P){for(var M=[],W=0,Q=P.length,q,et;W<Q;)q=P.charCodeAt(W++),q>=55296&&q<=56319&&W<Q?(et=P.charCodeAt(W++),(et&64512)==56320?M.push(((q&1023)<<10)+(et&1023)+65536):(M.push(q),W--)):M.push(q);return M}function B(P){return F(P,function(M){var W="";return M>65535&&(M-=65536,W+=C(M>>>10&1023|55296),M=56320|M&1023),W+=C(M),W}).join("")}function A(P){return P-48<10?P-22:P-65<26?P-65:P-97<26?P-97:h}function b(P,M){return P+22+75*(P<26)-((M!=0)<<5)}function I(P,M,W){var Q=0;for(P=W?w(P/d):P>>1,P+=w(P/M);P>x*c>>1;Q+=h)P=w(P/x);return w(Q+(x+1)*P/(P+u))}function E(P){var M=[],W=P.length,Q,q=0,et=p,rt=f,it,nt,_t,vt,ht,dt,pt,Zt,Kt;for(it=P.lastIndexOf(m),it<0&&(it=0),nt=0;nt<it;++nt)P.charCodeAt(nt)>=128&&S("not-basic"),M.push(P.charCodeAt(nt));for(_t=it>0?it+1:0;_t<W;){for(vt=q,ht=1,dt=h;_t>=W&&S("invalid-input"),pt=A(P.charCodeAt(_t++)),(pt>=h||pt>w((a-q)/ht))&&S("overflow"),q+=pt*ht,Zt=dt<=rt?l:dt>=rt+c?c:dt-rt,!(pt<Zt);dt+=h)Kt=h-Zt,ht>w(a/Kt)&&S("overflow"),ht*=Kt;Q=M.length+1,rt=I(q-vt,Q,vt==0),w(q/Q)>a-et&&S("overflow"),et+=w(q/Q),q%=Q,M.splice(q++,0,et)}return B(M)}function R(P){var M,W,Q,q,et,rt,it,nt,_t,vt,ht,dt=[],pt,Zt,Kt,ri;for(P=N(P),pt=P.length,M=p,W=0,et=f,rt=0;rt<pt;++rt)ht=P[rt],ht<128&&dt.push(C(ht));for(Q=q=dt.length,q&&dt.push(m);Q<pt;){for(it=a,rt=0;rt<pt;++rt)ht=P[rt],ht>=M&&ht<it&&(it=ht);for(Zt=Q+1,it-M>w((a-W)/Zt)&&S("overflow"),W+=(it-M)*Zt,M=it,rt=0;rt<pt;++rt)if(ht=P[rt],ht<M&&++W>a&&S("overflow"),ht==M){for(nt=W,_t=h;vt=_t<=et?l:_t>=et+c?c:_t-et,!(nt<vt);_t+=h)ri=nt-vt,Kt=h-vt,dt.push(C(b(vt+ri%Kt,0))),nt=w(ri/Kt);dt.push(C(b(nt,0))),et=I(W,Zt,Q==q),W=0,++Q}++W,++M}return dt.join("")}function L(P){return O(P,function(M){return g.test(M)?E(M.slice(4).toLowerCase()):M})}function z(P){return O(P,function(M){return y.test(M)?"xn--"+R(M):M})}if(o={version:"1.4.1",ucs2:{decode:N,encode:B},decode:E,encode:R,toASCII:z,toUnicode:L},i&&n)if(r.exports==i)n.exports=o;else for(T in o)o.hasOwnProperty(T)&&(i[T]=o[T]);else e.punycode=o})(Fs)})(kn,kn.exports);var g0=kn.exports,y0=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var s=Object.getOwnPropertySymbols(t);if(s.length!==1||s[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==n||o.enumerable!==!0)return!1}return!0},Nh=typeof Symbol<"u"&&Symbol,_0=y0,v0=function(){return typeof Nh!="function"||typeof Symbol!="function"||typeof Nh("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:_0()},x0="Function.prototype.bind called on incompatible ",Ls=Array.prototype.slice,b0=Object.prototype.toString,w0="[object Function]",T0=function(t){var e=this;if(typeof e!="function"||b0.call(e)!==w0)throw new TypeError(x0+e);for(var i=Ls.call(arguments,1),n,s=function(){if(this instanceof n){var c=e.apply(this,i.concat(Ls.call(arguments)));return Object(c)===c?c:this}else return e.apply(t,i.concat(Ls.call(arguments)))},o=Math.max(0,e.length-i.length),a=[],h=0;h<o;h++)a.push("$"+h);if(n=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var l=function(){};l.prototype=e.prototype,n.prototype=new l,l.prototype=null}return n},A0=T0,Xa=Function.prototype.bind||A0,E0=Xa,S0=E0.call(Function.call,Object.prototype.hasOwnProperty),tt,Xr=SyntaxError,Kc=Function,kr=TypeError,Ns=function(r){try{return Kc('"use strict"; return ('+r+").constructor;")()}catch{}},lr=Object.getOwnPropertyDescriptor;if(lr)try{lr({},"")}catch{lr=null}var Os=function(){throw new kr},C0=lr?function(){try{return arguments.callee,Os}catch{try{return lr(arguments,"callee").get}catch{return Os}}}():Os,br=v0(),ne=Object.getPrototypeOf||function(r){return r.__proto__},Ar={},I0=typeof Uint8Array>"u"?tt:ne(Uint8Array),cr={"%AggregateError%":typeof AggregateError>"u"?tt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?tt:ArrayBuffer,"%ArrayIteratorPrototype%":br?ne([][Symbol.iterator]()):tt,"%AsyncFromSyncIteratorPrototype%":tt,"%AsyncFunction%":Ar,"%AsyncGenerator%":Ar,"%AsyncGeneratorFunction%":Ar,"%AsyncIteratorPrototype%":Ar,"%Atomics%":typeof Atomics>"u"?tt:Atomics,"%BigInt%":typeof BigInt>"u"?tt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?tt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?tt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?tt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?tt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?tt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?tt:FinalizationRegistry,"%Function%":Kc,"%GeneratorFunction%":Ar,"%Int8Array%":typeof Int8Array>"u"?tt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?tt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?tt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":br?ne(ne([][Symbol.iterator]())):tt,"%JSON%":typeof JSON=="object"?JSON:tt,"%Map%":typeof Map>"u"?tt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!br?tt:ne(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?tt:Promise,"%Proxy%":typeof Proxy>"u"?tt:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?tt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?tt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!br?tt:ne(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?tt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":br?ne(""[Symbol.iterator]()):tt,"%Symbol%":br?Symbol:tt,"%SyntaxError%":Xr,"%ThrowTypeError%":C0,"%TypedArray%":I0,"%TypeError%":kr,"%Uint8Array%":typeof Uint8Array>"u"?tt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?tt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?tt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?tt:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?tt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?tt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?tt:WeakSet};try{null.error}catch(r){var P0=ne(ne(r));cr["%Error.prototype%"]=P0}var R0=function r(t){var e;if(t==="%AsyncFunction%")e=Ns("async function () {}");else if(t==="%GeneratorFunction%")e=Ns("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Ns("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=r("%AsyncGenerator%");n&&(e=ne(n.prototype))}return cr[t]=e,e},Oh={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ki=Xa,Un=S0,M0=ki.call(Function.call,Array.prototype.concat),F0=ki.call(Function.apply,Array.prototype.splice),kh=ki.call(Function.call,String.prototype.replace),Gn=ki.call(Function.call,String.prototype.slice),B0=ki.call(Function.call,RegExp.prototype.exec),D0=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,L0=/\\(\\)?/g,N0=function(t){var e=Gn(t,0,1),i=Gn(t,-1);if(e==="%"&&i!=="%")throw new Xr("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new Xr("invalid intrinsic syntax, expected opening `%`");var n=[];return kh(t,D0,function(s,o,a,h){n[n.length]=a?kh(h,L0,"$1"):o||s}),n},O0=function(t,e){var i=t,n;if(Un(Oh,i)&&(n=Oh[i],i="%"+n[0]+"%"),Un(cr,i)){var s=cr[i];if(s===Ar&&(s=R0(i)),typeof s>"u"&&!e)throw new kr("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:s}}throw new Xr("intrinsic "+t+" does not exist!")},Wa=function(t,e){if(typeof t!="string"||t.length===0)throw new kr("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new kr('"allowMissing" argument must be a boolean');if(B0(/^%?[^%]*%?$/,t)===null)throw new Xr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=N0(t),n=i.length>0?i[0]:"",s=O0("%"+n+"%",e),o=s.name,a=s.value,h=!1,l=s.alias;l&&(n=l[0],F0(i,M0([0,1],l)));for(var c=1,u=!0;c<i.length;c+=1){var d=i[c],f=Gn(d,0,1),p=Gn(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new Xr("property names with quotes must have matching quotes");if((d==="constructor"||!u)&&(h=!0),n+="."+d,o="%"+n+"%",Un(cr,o))a=cr[o];else if(a!=null){if(!(d in a)){if(!e)throw new kr("base intrinsic for "+t+" exists, but the property is not available.");return}if(lr&&c+1>=i.length){var m=lr(a,d);u=!!m,u&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[d]}else u=Un(a,d),a=a[d];u&&!h&&(cr[o]=a)}}return a},Qc={exports:{}};(function(r){var t=Xa,e=Wa,i=e("%Function.prototype.apply%"),n=e("%Function.prototype.call%"),s=e("%Reflect.apply%",!0)||t.call(n,i),o=e("%Object.getOwnPropertyDescriptor%",!0),a=e("%Object.defineProperty%",!0),h=e("%Math.max%");if(a)try{a({},"a",{value:1})}catch{a=null}r.exports=function(u){var d=s(t,n,arguments);if(o&&a){var f=o(d,"length");f.configurable&&a(d,"length",{value:1+h(0,u.length-(arguments.length-1))})}return d};var l=function(){return s(t,i,arguments)};a?a(r.exports,"apply",{value:l}):r.exports.apply=l})(Qc);var k0=Qc.exports,Jc=Wa,tu=k0,U0=tu(Jc("String.prototype.indexOf")),G0=function(t,e){var i=Jc(t,!!e);return typeof i=="function"&&U0(t,".prototype.")>-1?tu(i):i};const H0={},z0=Object.freeze(Object.defineProperty({__proto__:null,default:H0},Symbol.toStringTag,{value:"Module"})),$0=lf(z0);var ja=typeof Map=="function"&&Map.prototype,ks=Object.getOwnPropertyDescriptor&&ja?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Hn=ja&&ks&&typeof ks.get=="function"?ks.get:null,Uh=ja&&Map.prototype.forEach,Ya=typeof Set=="function"&&Set.prototype,Us=Object.getOwnPropertyDescriptor&&Ya?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,zn=Ya&&Us&&typeof Us.get=="function"?Us.get:null,Gh=Ya&&Set.prototype.forEach,V0=typeof WeakMap=="function"&&WeakMap.prototype,Ti=V0?WeakMap.prototype.has:null,X0=typeof WeakSet=="function"&&WeakSet.prototype,Ai=X0?WeakSet.prototype.has:null,W0=typeof WeakRef=="function"&&WeakRef.prototype,Hh=W0?WeakRef.prototype.deref:null,j0=Boolean.prototype.valueOf,Y0=Object.prototype.toString,q0=Function.prototype.toString,Z0=String.prototype.match,qa=String.prototype.slice,Ne=String.prototype.replace,K0=String.prototype.toUpperCase,zh=String.prototype.toLowerCase,eu=RegExp.prototype.test,$h=Array.prototype.concat,se=Array.prototype.join,Q0=Array.prototype.slice,Vh=Math.floor,Fo=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Gs=Object.getOwnPropertySymbols,Bo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Wr=typeof Symbol=="function"&&typeof Symbol.iterator=="object",wt=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Wr||"symbol")?Symbol.toStringTag:null,ru=Object.prototype.propertyIsEnumerable,Xh=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Wh(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||eu.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-Vh(-r):Vh(r);if(i!==r){var n=String(i),s=qa.call(t,n.length+1);return Ne.call(n,e,"$&_")+"."+Ne.call(Ne.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ne.call(t,e,"$&_")}var Do=$0,jh=Do.custom,Yh=nu(jh)?jh:null,J0=function r(t,e,i,n){var s=e||{};if(Fe(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Fe(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Fe(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Fe(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Fe(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return ou(t,s);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var h=String(t);return a?Wh(t,h):h}if(typeof t=="bigint"){var l=String(t)+"n";return a?Wh(t,l):l}var c=typeof s.depth>"u"?5:s.depth;if(typeof i>"u"&&(i=0),i>=c&&c>0&&typeof t=="object")return Lo(t)?"[Array]":"[Object]";var u=ym(s,i);if(typeof n>"u")n=[];else if(su(n,t)>=0)return"[Circular]";function d(A,b,I){if(b&&(n=Q0.call(n),n.push(b)),I){var E={depth:s.depth};return Fe(s,"quoteStyle")&&(E.quoteStyle=s.quoteStyle),r(A,E,i+1,n)}return r(A,s,i+1,n)}if(typeof t=="function"&&!qh(t)){var f=hm(t),p=ji(t,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+se.call(p,", ")+" }":"")}if(nu(t)){var m=Wr?Ne.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Bo.call(t);return typeof t=="object"&&!Wr?ii(m):m}if(pm(t)){for(var g="<"+zh.call(String(t.nodeName)),y=t.attributes||[],v=0;v<y.length;v++)g+=" "+y[v].name+"="+iu(tm(y[v].value),"double",s);return g+=">",t.childNodes&&t.childNodes.length&&(g+="..."),g+="</"+zh.call(String(t.nodeName))+">",g}if(Lo(t)){if(t.length===0)return"[]";var _=ji(t,d);return u&&!gm(_)?"["+No(_,u)+"]":"[ "+se.call(_,", ")+" ]"}if(rm(t)){var x=ji(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!ru.call(t,"cause")?"{ ["+String(t)+"] "+se.call($h.call("[cause]: "+d(t.cause),x),", ")+" }":x.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+se.call(x,", ")+" }"}if(typeof t=="object"&&o){if(Yh&&typeof t[Yh]=="function"&&Do)return Do(t,{depth:c-i});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(lm(t)){var w=[];return Uh&&Uh.call(t,function(A,b){w.push(d(b,t,!0)+" => "+d(A,t))}),Zh("Map",Hn.call(t),w,u)}if(dm(t)){var C=[];return Gh&&Gh.call(t,function(A){C.push(d(A,t))}),Zh("Set",zn.call(t),C,u)}if(cm(t))return Hs("WeakMap");if(fm(t))return Hs("WeakSet");if(um(t))return Hs("WeakRef");if(nm(t))return ii(d(Number(t)));if(om(t))return ii(d(Fo.call(t)));if(sm(t))return ii(j0.call(t));if(im(t))return ii(d(String(t)));if(!em(t)&&!qh(t)){var T=ji(t,d),S=Xh?Xh(t)===Object.prototype:t instanceof Object||t.constructor===Object,F=t instanceof Object?"":"null prototype",O=!S&&wt&&Object(t)===t&&wt in t?qa.call(We(t),8,-1):F?"Object":"",N=S||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",B=N+(O||F?"["+se.call($h.call([],O||[],F||[]),": ")+"] ":"");return T.length===0?B+"{}":u?B+"{"+No(T,u)+"}":B+"{ "+se.call(T,", ")+" }"}return String(t)};function iu(r,t,e){var i=(e.quoteStyle||t)==="double"?'"':"'";return i+r+i}function tm(r){return Ne.call(String(r),/"/g,"&quot;")}function Lo(r){return We(r)==="[object Array]"&&(!wt||!(typeof r=="object"&&wt in r))}function em(r){return We(r)==="[object Date]"&&(!wt||!(typeof r=="object"&&wt in r))}function qh(r){return We(r)==="[object RegExp]"&&(!wt||!(typeof r=="object"&&wt in r))}function rm(r){return We(r)==="[object Error]"&&(!wt||!(typeof r=="object"&&wt in r))}function im(r){return We(r)==="[object String]"&&(!wt||!(typeof r=="object"&&wt in r))}function nm(r){return We(r)==="[object Number]"&&(!wt||!(typeof r=="object"&&wt in r))}function sm(r){return We(r)==="[object Boolean]"&&(!wt||!(typeof r=="object"&&wt in r))}function nu(r){if(Wr)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Bo)return!1;try{return Bo.call(r),!0}catch{}return!1}function om(r){if(!r||typeof r!="object"||!Fo)return!1;try{return Fo.call(r),!0}catch{}return!1}var am=Object.prototype.hasOwnProperty||function(r){return r in this};function Fe(r,t){return am.call(r,t)}function We(r){return Y0.call(r)}function hm(r){if(r.name)return r.name;var t=Z0.call(q0.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function su(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function lm(r){if(!Hn||!r||typeof r!="object")return!1;try{Hn.call(r);try{zn.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function cm(r){if(!Ti||!r||typeof r!="object")return!1;try{Ti.call(r,Ti);try{Ai.call(r,Ai)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function um(r){if(!Hh||!r||typeof r!="object")return!1;try{return Hh.call(r),!0}catch{}return!1}function dm(r){if(!zn||!r||typeof r!="object")return!1;try{zn.call(r);try{Hn.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function fm(r){if(!Ai||!r||typeof r!="object")return!1;try{Ai.call(r,Ai);try{Ti.call(r,Ti)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function pm(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function ou(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return ou(qa.call(r,0,t.maxStringLength),t)+i}var n=Ne.call(Ne.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,mm);return iu(n,"single",t)}function mm(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+K0.call(t.toString(16))}function ii(r){return"Object("+r+")"}function Hs(r){return r+" { ? }"}function Zh(r,t,e,i){var n=i?No(e,i):se.call(e,", ");return r+" ("+t+") {"+n+"}"}function gm(r){for(var t=0;t<r.length;t++)if(su(r[t],`
`)>=0)return!1;return!0}function ym(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=se.call(Array(r.indent+1)," ");else return null;return{base:e,prev:se.call(Array(t+1),e)}}function No(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+se.call(r,","+e)+`
`+t.prev}function ji(r,t){var e=Lo(r),i=[];if(e){i.length=r.length;for(var n=0;n<r.length;n++)i[n]=Fe(r,n)?t(r[n],r):""}var s=typeof Gs=="function"?Gs(r):[],o;if(Wr){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var h in r)Fe(r,h)&&(e&&String(Number(h))===h&&h<r.length||Wr&&o["$"+h]instanceof Symbol||(eu.call(/[^\w$]/,h)?i.push(t(h,r)+": "+t(r[h],r)):i.push(h+": "+t(r[h],r))));if(typeof Gs=="function")for(var l=0;l<s.length;l++)ru.call(r,s[l])&&i.push("["+t(s[l])+"]: "+t(r[s[l]],r));return i}var Za=Wa,Jr=G0,_m=J0,vm=Za("%TypeError%"),Yi=Za("%WeakMap%",!0),qi=Za("%Map%",!0),xm=Jr("WeakMap.prototype.get",!0),bm=Jr("WeakMap.prototype.set",!0),wm=Jr("WeakMap.prototype.has",!0),Tm=Jr("Map.prototype.get",!0),Am=Jr("Map.prototype.set",!0),Em=Jr("Map.prototype.has",!0),Ka=function(r,t){for(var e=r,i;(i=e.next)!==null;e=i)if(i.key===t)return e.next=i.next,i.next=r.next,r.next=i,i},Sm=function(r,t){var e=Ka(r,t);return e&&e.value},Cm=function(r,t,e){var i=Ka(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},Im=function(r,t){return!!Ka(r,t)},Pm=function(){var t,e,i,n={assert:function(s){if(!n.has(s))throw new vm("Side channel does not contain "+_m(s))},get:function(s){if(Yi&&s&&(typeof s=="object"||typeof s=="function")){if(t)return xm(t,s)}else if(qi){if(e)return Tm(e,s)}else if(i)return Sm(i,s)},has:function(s){if(Yi&&s&&(typeof s=="object"||typeof s=="function")){if(t)return wm(t,s)}else if(qi){if(e)return Em(e,s)}else if(i)return Im(i,s);return!1},set:function(s,o){Yi&&s&&(typeof s=="object"||typeof s=="function")?(t||(t=new Yi),bm(t,s,o)):qi?(e||(e=new qi),Am(e,s,o)):(i||(i={key:{},next:null}),Cm(i,s,o))}};return n},Rm=String.prototype.replace,Mm=/%20/g,zs={RFC1738:"RFC1738",RFC3986:"RFC3986"},Qa={default:zs.RFC3986,formatters:{RFC1738:function(r){return Rm.call(r,Mm,"+")},RFC3986:function(r){return String(r)}},RFC1738:zs.RFC1738,RFC3986:zs.RFC3986},Fm=Qa,$s=Object.prototype.hasOwnProperty,or=Array.isArray,Qt=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r}(),Bm=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(or(i)){for(var n=[],s=0;s<i.length;++s)typeof i[s]<"u"&&n.push(i[s]);e.obj[e.prop]=n}}},au=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(i[n]=t[n]);return i},Dm=function r(t,e,i){if(!e)return t;if(typeof e!="object"){if(or(t))t.push(e);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!$s.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var n=t;return or(t)&&!or(e)&&(n=au(t,i)),or(t)&&or(e)?(e.forEach(function(s,o){if($s.call(t,o)){var a=t[o];a&&typeof a=="object"&&s&&typeof s=="object"?t[o]=r(a,s,i):t.push(s)}else t[o]=s}),t):Object.keys(e).reduce(function(s,o){var a=e[o];return $s.call(s,o)?s[o]=r(s[o],a,i):s[o]=a,s},n)},Lm=function(t,e){return Object.keys(e).reduce(function(i,n){return i[n]=e[n],i},t)},Nm=function(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Om=function(t,e,i,n,s){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),i==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var a="",h=0;h<o.length;++h){var l=o.charCodeAt(h);if(l===45||l===46||l===95||l===126||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||s===Fm.RFC1738&&(l===40||l===41)){a+=o.charAt(h);continue}if(l<128){a=a+Qt[l];continue}if(l<2048){a=a+(Qt[192|l>>6]+Qt[128|l&63]);continue}if(l<55296||l>=57344){a=a+(Qt[224|l>>12]+Qt[128|l>>6&63]+Qt[128|l&63]);continue}h+=1,l=65536+((l&1023)<<10|o.charCodeAt(h)&1023),a+=Qt[240|l>>18]+Qt[128|l>>12&63]+Qt[128|l>>6&63]+Qt[128|l&63]}return a},km=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],n=0;n<e.length;++n)for(var s=e[n],o=s.obj[s.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],c=o[l];typeof c=="object"&&c!==null&&i.indexOf(c)===-1&&(e.push({obj:o,prop:l}),i.push(c))}return Bm(e),t},Um=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},Gm=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},Hm=function(t,e){return[].concat(t,e)},zm=function(t,e){if(or(t)){for(var i=[],n=0;n<t.length;n+=1)i.push(e(t[n]));return i}return e(t)},hu={arrayToObject:au,assign:Lm,combine:Hm,compact:km,decode:Nm,encode:Om,isBuffer:Gm,isRegExp:Um,maybeMap:zm,merge:Dm},lu=Pm,wn=hu,Ei=Qa,$m=Object.prototype.hasOwnProperty,Kh={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},xe=Array.isArray,Vm=Array.prototype.push,cu=function(r,t){Vm.apply(r,xe(t)?t:[t])},Xm=Date.prototype.toISOString,Qh=Ei.default,bt={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:wn.encode,encodeValuesOnly:!1,format:Qh,formatter:Ei.formatters[Qh],indices:!1,serializeDate:function(t){return Xm.call(t)},skipNulls:!1,strictNullHandling:!1},Wm=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Vs={},jm=function r(t,e,i,n,s,o,a,h,l,c,u,d,f,p,m,g){for(var y=t,v=g,_=0,x=!1;(v=v.get(Vs))!==void 0&&!x;){var w=v.get(t);if(_+=1,typeof w<"u"){if(w===_)throw new RangeError("Cyclic object value");x=!0}typeof v.get(Vs)>"u"&&(_=0)}if(typeof h=="function"?y=h(e,y):y instanceof Date?y=u(y):i==="comma"&&xe(y)&&(y=wn.maybeMap(y,function(E){return E instanceof Date?u(E):E})),y===null){if(s)return a&&!p?a(e,bt.encoder,m,"key",d):e;y=""}if(Wm(y)||wn.isBuffer(y)){if(a){var C=p?e:a(e,bt.encoder,m,"key",d);return[f(C)+"="+f(a(y,bt.encoder,m,"value",d))]}return[f(e)+"="+f(String(y))]}var T=[];if(typeof y>"u")return T;var S;if(i==="comma"&&xe(y))p&&a&&(y=wn.maybeMap(y,a)),S=[{value:y.length>0?y.join(",")||null:void 0}];else if(xe(h))S=h;else{var F=Object.keys(y);S=l?F.sort(l):F}for(var O=n&&xe(y)&&y.length===1?e+"[]":e,N=0;N<S.length;++N){var B=S[N],A=typeof B=="object"&&typeof B.value<"u"?B.value:y[B];if(!(o&&A===null)){var b=xe(y)?typeof i=="function"?i(O,B):O:O+(c?"."+B:"["+B+"]");g.set(t,_);var I=lu();I.set(Vs,g),cu(T,r(A,b,i,n,s,o,i==="comma"&&p&&xe(y)?null:a,h,l,c,u,d,f,p,m,I))}}return T},Ym=function(t){if(!t)return bt;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||bt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=Ei.default;if(typeof t.format<"u"){if(!$m.call(Ei.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var n=Ei.formatters[i],s=bt.filter;return(typeof t.filter=="function"||xe(t.filter))&&(s=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:bt.addQueryPrefix,allowDots:typeof t.allowDots>"u"?bt.allowDots:!!t.allowDots,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:bt.charsetSentinel,delimiter:typeof t.delimiter>"u"?bt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:bt.encode,encoder:typeof t.encoder=="function"?t.encoder:bt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:bt.encodeValuesOnly,filter:s,format:i,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:bt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:bt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:bt.strictNullHandling}},qm=function(r,t){var e=r,i=Ym(t),n,s;typeof i.filter=="function"?(s=i.filter,e=s("",e)):xe(i.filter)&&(s=i.filter,n=s);var o=[];if(typeof e!="object"||e===null)return"";var a;t&&t.arrayFormat in Kh?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var h=Kh[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l=h==="comma"&&t&&t.commaRoundTrip;n||(n=Object.keys(e)),i.sort&&n.sort(i.sort);for(var c=lu(),u=0;u<n.length;++u){var d=n[u];i.skipNulls&&e[d]===null||cu(o,jm(e[d],d,h,l,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}var f=o.join(i.delimiter),p=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""},jr=hu,Oo=Object.prototype.hasOwnProperty,Zm=Array.isArray,gt={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:jr.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Km=function(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},uu=function(r,t){return r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1?r.split(","):r},Qm="utf8=%26%2310003%3B",Jm="utf8=%E2%9C%93",tg=function(t,e){var i={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=n.split(e.delimiter,s),a=-1,h,l=e.charset;if(e.charsetSentinel)for(h=0;h<o.length;++h)o[h].indexOf("utf8=")===0&&(o[h]===Jm?l="utf-8":o[h]===Qm&&(l="iso-8859-1"),a=h,h=o.length);for(h=0;h<o.length;++h)if(h!==a){var c=o[h],u=c.indexOf("]="),d=u===-1?c.indexOf("="):u+1,f,p;d===-1?(f=e.decoder(c,gt.decoder,l,"key"),p=e.strictNullHandling?null:""):(f=e.decoder(c.slice(0,d),gt.decoder,l,"key"),p=jr.maybeMap(uu(c.slice(d+1),e),function(m){return e.decoder(m,gt.decoder,l,"value")})),p&&e.interpretNumericEntities&&l==="iso-8859-1"&&(p=Km(p)),c.indexOf("[]=")>-1&&(p=Zm(p)?[p]:p),Oo.call(i,f)?i[f]=jr.combine(i[f],p):i[f]=p}return i},eg=function(r,t,e,i){for(var n=i?t:uu(t,e),s=r.length-1;s>=0;--s){var o,a=r[s];if(a==="[]"&&e.parseArrays)o=[].concat(n);else{o=e.plainObjects?Object.create(null):{};var h=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=parseInt(h,10);!e.parseArrays&&h===""?o={0:n}:!isNaN(l)&&a!==h&&String(l)===h&&l>=0&&e.parseArrays&&l<=e.arrayLimit?(o=[],o[l]=n):h!=="__proto__"&&(o[h]=n)}n=o}return n},rg=function(t,e,i,n){if(t){var s=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,h=i.depth>0&&o.exec(s),l=h?s.slice(0,h.index):s,c=[];if(l){if(!i.plainObjects&&Oo.call(Object.prototype,l)&&!i.allowPrototypes)return;c.push(l)}for(var u=0;i.depth>0&&(h=a.exec(s))!==null&&u<i.depth;){if(u+=1,!i.plainObjects&&Oo.call(Object.prototype,h[1].slice(1,-1))&&!i.allowPrototypes)return;c.push(h[1])}return h&&c.push("["+s.slice(h.index)+"]"),eg(c,e,i,n)}},ig=function(t){if(!t)return gt;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?gt.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?gt.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:gt.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:gt.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:gt.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:gt.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:gt.comma,decoder:typeof t.decoder=="function"?t.decoder:gt.decoder,delimiter:typeof t.delimiter=="string"||jr.isRegExp(t.delimiter)?t.delimiter:gt.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:gt.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:gt.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:gt.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:gt.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:gt.strictNullHandling}},ng=function(r,t){var e=ig(t);if(r===""||r===null||typeof r>"u")return e.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?tg(r,e):r,n=e.plainObjects?Object.create(null):{},s=Object.keys(i),o=0;o<s.length;++o){var a=s[o],h=rg(a,i[a],e,typeof r=="string");n=jr.merge(n,h,e)}return e.allowSparse===!0?n:jr.compact(n)},sg=qm,og=ng,ag=Qa,hg={formats:ag,parse:og,stringify:sg},lg=g0;function Ee(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var cg=/^([a-z0-9.+-]+:)/i,ug=/:[0-9]*$/,dg=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,fg=["<",">",'"',"`"," ","\r",`
`,"	"],pg=["{","}","|","\\","^","`"].concat(fg),ko=["'"].concat(pg),Jh=["%","/","?",";","#"].concat(ko),tl=["/","?","#"],mg=255,el=/^[+a-z0-9A-Z_-]{0,63}$/,gg=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,yg={javascript:!0,"javascript:":!0},Uo={javascript:!0,"javascript:":!0},Ur={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Go=hg;function _g(r,t,e){if(r&&typeof r=="object"&&r instanceof Ee)return r;var i=new Ee;return i.parse(r,t,e),i}Ee.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),n=i!==-1&&i<r.indexOf("#")?"?":"#",s=r.split(n),o=/\\/g;s[0]=s[0].replace(o,"/"),r=s.join(n);var a=r;if(a=a.trim(),!e&&r.split("#").length===1){var h=dg.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=Go.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=cg.exec(a);if(l){l=l[0];var c=l.toLowerCase();this.protocol=c,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var u=a.substr(0,2)==="//";u&&!(l&&Uo[l])&&(a=a.substr(2),this.slashes=!0)}if(!Uo[l]&&(u||l&&!Ur[l])){for(var d=-1,f=0;f<tl.length;f++){var p=a.indexOf(tl[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,g;d===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",d),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<Jh.length;f++){var p=a.indexOf(Jh[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var v=this.hostname.split(/\./),f=0,_=v.length;f<_;f++){var x=v[f];if(x&&!x.match(el)){for(var w="",C=0,T=x.length;C<T;C++)x.charCodeAt(C)>127?w+="x":w+=x[C];if(!w.match(el)){var S=v.slice(0,f),F=v.slice(f+1),O=x.match(gg);O&&(S.push(O[1]),F.unshift(O[2])),F.length&&(a="/"+F.join(".")+a),this.hostname=S.join(".");break}}}this.hostname.length>mg?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=lg.toASCII(this.hostname));var N=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+N,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!yg[c])for(var f=0,_=ko.length;f<_;f++){var A=ko[f];if(a.indexOf(A)!==-1){var b=encodeURIComponent(A);b===A&&(b=escape(A)),a=a.split(A).join(b)}}var I=a.indexOf("#");I!==-1&&(this.hash=a.substr(I),a=a.slice(0,I));var E=a.indexOf("?");if(E!==-1?(this.search=a.substr(E),this.query=a.substr(E+1),t&&(this.query=Go.parse(this.query)),a=a.slice(0,E)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Ur[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var N=this.pathname||"",R=this.search||"";this.path=N+R}return this.href=this.format(),this};Ee.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",n=!1,s="";this.host?n=r+this.host:this.hostname&&(n=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=Go.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Ur[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+n+e+o+i};Ee.prototype.resolve=function(r){return this.resolveObject(_g(r,!1,!0)).format()};Ee.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new Ee;t.parse(r,!1,!0),r=t}for(var e=new Ee,i=Object.keys(this),n=0;n<i.length;n++){var s=i[n];e[s]=this[s]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(e[h]=r[h])}return Ur[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!Ur[r.protocol]){for(var l=Object.keys(r),c=0;c<l.length;c++){var u=l[c];e[u]=r[u]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!Uo[r.protocol]){for(var _=(r.pathname||"").split("/");_.length&&!(r.host=_.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),_[0]!==""&&_.unshift(""),_.length<2&&_.unshift(""),e.pathname=_.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var d=e.pathname||"",f=e.search||"";e.path=d+f}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",m=r.host||r.pathname&&r.pathname.charAt(0)==="/",g=m||p||e.host&&r.pathname,y=g,v=e.pathname&&e.pathname.split("/")||[],_=r.pathname&&r.pathname.split("/")||[],x=e.protocol&&!Ur[e.protocol];if(x&&(e.hostname="",e.port=null,e.host&&(v[0]===""?v[0]=e.host:v.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(_[0]===""?_[0]=r.host:_.unshift(r.host)),r.host=null),g=g&&(_[0]===""||v[0]==="")),m)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,v=_;else if(_.length)v||(v=[]),v.pop(),v=v.concat(_),e.search=r.search,e.query=r.query;else if(r.search!=null){if(x){e.host=v.shift(),e.hostname=e.host;var w=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;w&&(e.auth=w.shift(),e.hostname=w.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!v.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var C=v.slice(-1)[0],T=(e.host||r.host||v.length>1)&&(C==="."||C==="..")||C==="",S=0,F=v.length;F>=0;F--)C=v[F],C==="."?v.splice(F,1):C===".."?(v.splice(F,1),S++):S&&(v.splice(F,1),S--);if(!g&&!y)for(;S--;S)v.unshift("..");g&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),T&&v.join("/").substr(-1)!=="/"&&v.push("");var O=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(x){e.hostname=O?"":v.length?v.shift():"",e.host=e.hostname;var w=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;w&&(e.auth=w.shift(),e.hostname=w.shift(),e.host=e.hostname)}return g=g||e.host&&v.length,g&&!O&&v.unshift(""),v.length>0?e.pathname=v.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};Ee.prototype.parseHost=function(){var r=this.host,t=ug.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};const rl={};function J(r,t,e=3){if(rl[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`),console.warn(i))),rl[t]=!0}function kt(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function ni(r){return r.split("?")[0].split("#")[0]}function vg(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function xg(r,t,e){return r.replace(new RegExp(vg(t),"g"),e)}function bg(r,t){let e="",i=0,n=-1,s=0,o=-1;for(let a=0;a<=r.length;++a){if(a<r.length)o=r.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),n=a,s=0;continue}}else if(e.length===2||e.length===1){e="",i=0,n=a,s=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${r.slice(n+1,a)}`:e=r.slice(n+1,a),i=a-n-1;n=a,s=0}else o===46&&s!==-1?++s:s=-1}return e}const At={toPosix(r){return xg(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){kt(r),r=this.toPosix(r);const t=/^file:\/\/\//.exec(r);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(r);return e?e[0]:""},toAbsolute(r,t,e){if(kt(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;const i=ni(this.toPosix(t??H.ADAPTER.getBaseUrl())),n=ni(this.toPosix(e??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?At.join(n,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(kt(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let t="";const e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));const i=r.endsWith("/");return r=bg(r,!1),r.length>0&&i&&(r+="/"),e?`/${r}`:t+r},isAbsolute(r){return kt(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let t;for(let e=0;e<r.length;++e){const i=r[e];if(kt(i),i.length>0)if(t===void 0)t=i;else{const n=r[e-1]??"";this.extname(n)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(r){if(kt(r),r.length===0)return".";r=this.toPosix(r);let t=r.charCodeAt(0);const e=t===47;let i=-1,n=!0;const s=this.getProtocol(r),o=r;r=r.slice(s.length);for(let a=r.length-1;a>=1;--a)if(t=r.charCodeAt(a),t===47){if(!n){i=a;break}}else n=!1;return i===-1?e?"/":this.isUrl(o)?s+r:s:e&&i===1?"//":s+r.slice(0,i)},rootname(r){kt(r),r=this.toPosix(r);let t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){const e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/")}return t},basename(r,t){kt(r),t&&kt(t),r=ni(this.toPosix(r));let e=0,i=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";let o=t.length-1,a=-1;for(s=r.length-1;s>=0;--s){const h=r.charCodeAt(s);if(h===47){if(!n){e=s+1;break}}else a===-1&&(n=!1,a=s+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(i=s):(o=-1,i=a))}return e===i?i=a:i===-1&&(i=r.length),r.slice(e,i)}for(s=r.length-1;s>=0;--s)if(r.charCodeAt(s)===47){if(!n){e=s+1;break}}else i===-1&&(n=!1,i=s+1);return i===-1?"":r.slice(e,i)},extname(r){kt(r),r=ni(this.toPosix(r));let t=-1,e=0,i=-1,n=!0,s=0;for(let o=r.length-1;o>=0;--o){const a=r.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}i===-1&&(n=!1,i=o+1),a===46?t===-1?t=o:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===e+1?"":r.slice(t,i)},parse(r){kt(r);const t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=ni(this.toPosix(r));let e=r.charCodeAt(0);const i=this.isAbsolute(r);let n;t.root=this.rootname(r),i||this.hasProtocol(r)?n=1:n=0;let s=-1,o=0,a=-1,h=!0,l=r.length-1,c=0;for(;l>=n;--l){if(e=r.charCodeAt(l),e===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),e===46?s===-1?s=l:c!==1&&(c=1):s!==-1&&(c=-1)}return s===-1||a===-1||c===0||c===1&&s===a-1&&s===o+1?a!==-1&&(o===0&&i?t.base=t.name=r.slice(1,a):t.base=t.name=r.slice(o,a)):(o===0&&i?(t.name=r.slice(1,s),t.base=r.slice(1,a)):(t.name=r.slice(o,s),t.base=r.slice(o,a)),t.ext=r.slice(s,a)),t.dir=this.dirname(r),t},sep:"/",delimiter:":"};let Xs;async function wg(){return Xs??(Xs=(async()=>{var s;const r=document.createElement("canvas").getContext("webgl");if(!r)return Et.UNPACK;const t=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!t)return Et.UNPACK;const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);const i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);const n=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,n),r.deleteFramebuffer(i),r.deleteTexture(e),(s=r.getExtension("WEBGL_lose_context"))==null||s.loseContext(),n[0]<=n[3]?Et.PMA:Et.UNPACK})()),Xs}let Ws;function Tg(){return typeof Ws>"u"&&(Ws=function(){var t;const r={stencil:!0,failIfMajorPerformanceCaveat:H.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!H.ADAPTER.getWebGLRenderingContext())return!1;const e=H.ADAPTER.createCanvas();let i=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);const n=!!((t=i==null?void 0:i.getContextAttributes())!=null&&t.stencil);if(i){const s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,n}catch{return!1}}()),Ws}var Ag={grad:.9,turn:360,rad:360/(2*Math.PI)},ge=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},yt=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0},Ot=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t},du=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},il=function(r){return{r:Ot(r.r,0,255),g:Ot(r.g,0,255),b:Ot(r.b,0,255),a:Ot(r.a)}},js=function(r){return{r:yt(r.r),g:yt(r.g),b:yt(r.b),a:yt(r.a,3)}},Eg=/^#([0-9a-f]{3,8})$/i,Zi=function(r){var t=r.toString(16);return t.length<2?"0"+t:t},fu=function(r){var t=r.r,e=r.g,i=r.b,n=r.a,s=Math.max(t,e,i),o=s-Math.min(t,e,i),a=o?s===t?(e-i)/o:s===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:n}},pu=function(r){var t=r.h,e=r.s,i=r.v,n=r.a;t=t/360*6,e/=100,i/=100;var s=Math.floor(t),o=i*(1-e),a=i*(1-(t-s)*e),h=i*(1-(1-t+s)*e),l=s%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:n}},nl=function(r){return{h:du(r.h),s:Ot(r.s,0,100),l:Ot(r.l,0,100),a:Ot(r.a)}},sl=function(r){return{h:yt(r.h),s:yt(r.s),l:yt(r.l),a:yt(r.a,3)}},ol=function(r){return pu((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Si=function(r){return{h:(t=fu(r)).h,s:(n=(200-(e=t.s))*(i=t.v)/100)>0&&n<200?e*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,i,n},Sg=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Cg=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ig=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Pg=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ho={string:[[function(r){var t=Eg.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?yt(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?yt(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var t=Ig.exec(r)||Pg.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:il({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(r){var t=Sg.exec(r)||Cg.exec(r);if(!t)return null;var e,i,n=nl({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(Ag[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return ol(n)},"hsl"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,n=r.a,s=n===void 0?1:n;return ge(t)&&ge(e)&&ge(i)?il({r:Number(t),g:Number(e),b:Number(i),a:Number(s)}):null},"rgb"],[function(r){var t=r.h,e=r.s,i=r.l,n=r.a,s=n===void 0?1:n;if(!ge(t)||!ge(e)||!ge(i))return null;var o=nl({h:Number(t),s:Number(e),l:Number(i),a:Number(s)});return ol(o)},"hsl"],[function(r){var t=r.h,e=r.s,i=r.v,n=r.a,s=n===void 0?1:n;if(!ge(t)||!ge(e)||!ge(i))return null;var o=function(a){return{h:du(a.h),s:Ot(a.s,0,100),v:Ot(a.v,0,100),a:Ot(a.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(s)});return pu(o)},"hsv"]]},al=function(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]]}return[null,void 0]},Rg=function(r){return typeof r=="string"?al(r.trim(),Ho.string):typeof r=="object"&&r!==null?al(r,Ho.object):[null,void 0]},Ys=function(r,t){var e=Si(r);return{h:e.h,s:Ot(e.s+100*t,0,100),l:e.l,a:e.a}},qs=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},hl=function(r,t){var e=Si(r);return{h:e.h,s:e.s,l:Ot(e.l+100*t,0,100),a:e.a}},zo=function(){function r(t){this.parsed=Rg(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return yt(qs(this.rgba),2)},r.prototype.isDark=function(){return qs(this.rgba)<.5},r.prototype.isLight=function(){return qs(this.rgba)>=.5},r.prototype.toHex=function(){return t=js(this.rgba),e=t.r,i=t.g,n=t.b,o=(s=t.a)<1?Zi(yt(255*s)):"","#"+Zi(e)+Zi(i)+Zi(n)+o;var t,e,i,n,s,o},r.prototype.toRgb=function(){return js(this.rgba)},r.prototype.toRgbString=function(){return t=js(this.rgba),e=t.r,i=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+i+", "+n+", "+s+")":"rgb("+e+", "+i+", "+n+")";var t,e,i,n,s},r.prototype.toHsl=function(){return sl(Si(this.rgba))},r.prototype.toHslString=function(){return t=sl(Si(this.rgba)),e=t.h,i=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+i+"%, "+n+"%, "+s+")":"hsl("+e+", "+i+"%, "+n+"%)";var t,e,i,n,s},r.prototype.toHsv=function(){return t=fu(this.rgba),{h:yt(t.h),s:yt(t.s),v:yt(t.v),a:yt(t.a,3)};var t},r.prototype.invert=function(){return Jt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},r.prototype.saturate=function(t){return t===void 0&&(t=.1),Jt(Ys(this.rgba,t))},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),Jt(Ys(this.rgba,-t))},r.prototype.grayscale=function(){return Jt(Ys(this.rgba,-1))},r.prototype.lighten=function(t){return t===void 0&&(t=.1),Jt(hl(this.rgba,t))},r.prototype.darken=function(t){return t===void 0&&(t=.1),Jt(hl(this.rgba,-t))},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},r.prototype.alpha=function(t){return typeof t=="number"?Jt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):yt(this.rgba.a,3);var e},r.prototype.hue=function(t){var e=Si(this.rgba);return typeof t=="number"?Jt({h:t,s:e.s,l:e.l,a:e.a}):yt(e.h)},r.prototype.isEqual=function(t){return this.toHex()===Jt(t).toHex()},r}(),Jt=function(r){return r instanceof zo?r:new zo(r)},ll=[],Mg=function(r){r.forEach(function(t){ll.indexOf(t)<0&&(t(zo,Ho),ll.push(t))})};function Fg(r,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in e)i[e[n]]=n;var s={};r.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=i[this.toHex()];if(l)return l;if(o!=null&&o.closest){var c=this.toRgb(),u=1/0,d="black";if(!s.length)for(var f in e)s[f]=new r(e[f]).toRgb();for(var p in e){var m=(a=c,h=s[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<u&&(u=m,d=p)}return d}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new r(h).toRgb():null},"name"])}Mg([Fg]);const Er=class Tn{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Tn)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,s)=>n===e[s]);if(t!==null&&e!==null){const n=Object.keys(t),s=Object.keys(e);return n.length!==s.length?!1:n.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,i,n]=this._components;return{r:t,g:e,b:i,a:n}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,n]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(n*255),t}toRgbArray(t){t=t??[];const[e,i,n]=this._components;return t[0]=e,t[1]=i,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,n,s]=Tn.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=n,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,n=this._int>>8&255,s=this._int&255;return e&&(i=i*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(t*255<<24)+(i<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,n,s]=this._components;return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t}normalize(t){let e,i,n,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,n=(o&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,n,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,n,s=255]=t,e/=255,i/=255,n/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=Tn.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=Jt(t);o.isValid()&&({r:e,g:i,b:n,a:s}=o.rgba,e/=255,i/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=n,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((n,s)=>{t[s]=Math.min(Math.max(n,e),i)}),t)}};Er.shared=new Er,Er.temp=new Er,Er.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let at=Er;function Bg(r){return J("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),at.shared.setValue(r).toHex()}function Dg(r){return J("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),at.shared.setValue(r).toNumber()}function Lg(){const r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[j.NORMAL_NPM]=j.NORMAL,r[j.ADD_NPM]=j.ADD,r[j.SCREEN_NPM]=j.SCREEN,t[j.NORMAL]=j.NORMAL_NPM,t[j.ADD]=j.ADD_NPM,t[j.SCREEN]=j.SCREEN_NPM;const e=[];return e.push(t),e.push(r),e}const mu=Lg();function gu(r,t){return mu[t?1:0][r]}function Ng(r,t=null){const e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,n=0;i<e;i+=6,n+=4)t[i+0]=n+0,t[i+1]=n+1,t[i+2]=n+2,t[i+3]=n+0,t[i+4]=n+2,t[i+5]=n+3;return t}function yu(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function $n(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function cl(r){return!(r&r-1)&&!!r}function ul(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function Gr(r,t,e){const i=r.length;let n;if(t>=i||e===0)return;e=t+e>i?i-t:e;const s=i-e;for(n=t;n<s;++n)r[n]=r[n+e];r.length=s}function Oe(r){return r===0?0:r<0?-1:1}let Og=0;function mr(){return++Og}const $o=class{constructor(r,t,e,i){this.left=r,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};$o.EMPTY=new $o(0,0,0,0);let dl=$o;const fl={},te=Object.create(null),Ie=Object.create(null);class kg{constructor(t,e,i){this._canvas=H.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||H.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function pl(r,t,e){for(let i=0,n=4*e*t;i<t;++i,n+=4)if(r[n+3]!==0)return!1;return!0}function ml(r,t,e,i,n){const s=4*t;for(let o=i,a=i*s+4*e;o<=n;++o,a+=s)if(r[a+3]!==0)return!1;return!0}function Ug(r){const{width:t,height:e}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const n=i.getImageData(0,0,t,e).data;let s=0,o=0,a=t-1,h=e-1;for(;o<e&&pl(n,t,o);)++o;if(o===e)return dl.EMPTY;for(;pl(n,t,h);)--h;for(;ml(n,t,s,o,h);)++s;for(;ml(n,t,a,o,h);)--a;return++a,++h,new dl(s,o,a,h)}function Gg(r){const t=Ug(r),{width:e,height:i}=t;let n=null;if(!t.isEmpty()){const s=r.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:n}}function Hg(r,t=globalThis.location){if(r.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Se(r,t=1){var i;const e=(i=H.RETINA_PREFIX)==null?void 0:i.exec(r);return e?parseFloat(e[1]):t}var U=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(U||{});const Vo=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},gl=(r,t)=>Vo(r).priority??t,$={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(Vo).forEach(t=>{t.type.forEach(e=>{var i,n;return(n=(i=this._removeHandlers)[e])==null?void 0:n.call(i,t)})}),this},add(...r){return r.map(Vo).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,n=this._queue;i[e]?i[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(r,t,e){const i=this._addHandlers,n=this._removeHandlers;if(i[r]||n[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=t,n[r]=e;const s=this._queue;return s[r]&&(s[r].forEach(o=>t(o)),delete s[r]),this},handleByMap(r,t){return this.handle(r,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(r,t,e=-1){return this.handle(r,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((n,s)=>gl(s,e)-gl(n,e)))},i=>{const n=t.indexOf(i.ref);n!==-1&&t.splice(n,1)})}};class Xo{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const zg=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function $g(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function Vg(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=zg.replace(/%forloop%/gi,$g(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}const Zs=0,Ks=1,Qs=2,Js=3,to=4,eo=5;class fe{constructor(){this.data=0,this.blendMode=j.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Zs)}set blend(t){!!(this.data&1<<Zs)!==t&&(this.data^=1<<Zs)}get offsets(){return!!(this.data&1<<Ks)}set offsets(t){!!(this.data&1<<Ks)!==t&&(this.data^=1<<Ks)}get culling(){return!!(this.data&1<<Qs)}set culling(t){!!(this.data&1<<Qs)!==t&&(this.data^=1<<Qs)}get depthTest(){return!!(this.data&1<<Js)}set depthTest(t){!!(this.data&1<<Js)!==t&&(this.data^=1<<Js)}get depthMask(){return!!(this.data&1<<eo)}set depthMask(t){!!(this.data&1<<eo)!==t&&(this.data^=1<<eo)}get clockwiseFrontFace(){return!!(this.data&1<<to)}set clockwiseFrontFace(t){!!(this.data&1<<to)!==t&&(this.data^=1<<to)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==j.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new fe;return t.depthTest=!1,t.blend=!0,t}}fe.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Wo=[];function _u(r,t){if(!r)return null;let e="";if(typeof r=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=Wo.length-1;i>=0;--i){const n=Wo[i];if(n.test&&n.test(r,e))return new n(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Wt{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,n,s,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][l](t,e,i,n,s,o,a,h);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Wt.prototype,{dispatch:{value:Wt.prototype.emit},run:{value:Wt.prototype.emit}});class Mi{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Wt("setRealSize"),this.onUpdate=new Wt("update"),this.onError=new Wt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class _s extends Mi{constructor(t,e){const{width:i,height:n}=e||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Et.UNPACK);const s=e.realWidth,o=e.realHeight;return i.width===s&&i.height===o?n.texSubImage2D(e.target,0,0,0,s,o,e.format,i.type,this.data):(i.width=s,i.height=o,n.texImage2D(e.target,0,i.internalFormat,s,o,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const Xg={scaleMode:ae.NEAREST,alphaMode:Et.NPM},jo=class Sr extends Oi{constructor(t=null,e=null){super(),e=Object.assign({},Sr.defaultOptions,e);const{alphaMode:i,mipmap:n,anisotropicLevel:s,scaleMode:o,width:a,height:h,wrapMode:l,format:c,type:u,target:d,resolution:f,resourceOptions:p}=e;t&&!(t instanceof Mi)&&(t=_u(t,p),t.internal=!0),this.resolution=f||H.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=o,this.format=c,this.type=u,this.target=d,this.alphaMode=i,this.uid=mr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=cl(this.realWidth)&&cl(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ie[this.cacheId],delete te[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Sr.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=H.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${mr()}`}s=t._pixiId}let o=Ie[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new Sr(t,e),o.cacheId=s,Sr.addToCache(o,s)),o}static fromBuffer(t,e,i,n){t=t||new Float32Array(e*i*4);const s=new _s(t,{width:e,height:i,...n==null?void 0:n.resourceOptions});let o,a;return t instanceof Float32Array?(o=D.RGBA,a=X.FLOAT):t instanceof Int32Array?(o=D.RGBA_INTEGER,a=X.INT):t instanceof Uint32Array?(o=D.RGBA_INTEGER,a=X.UNSIGNED_INT):t instanceof Int16Array?(o=D.RGBA_INTEGER,a=X.SHORT):t instanceof Uint16Array?(o=D.RGBA_INTEGER,a=X.UNSIGNED_SHORT):t instanceof Int8Array?(o=D.RGBA,a=X.BYTE):(o=D.RGBA,a=X.UNSIGNED_BYTE),s.internal=!0,new Sr(s,Object.assign({},Xg,{type:a,format:o},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ie[e]&&Ie[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Ie[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Ie[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Ie[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Ie[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};jo.defaultOptions={mipmap:ue.POW2,anisotropicLevel:0,scaleMode:ae.LINEAR,wrapMode:Mt.CLAMP,alphaMode:Et.UNPACK,target:Or.TEXTURE_2D,format:D.RGBA,type:X.UNSIGNED_BYTE},jo._globalBatch=0;let Z=jo;class Yo{constructor(){this.texArray=null,this.blend=0,this.type=oe.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Wg=0;class ut{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=Wg++,this.disposeRunner=new Wt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?he.ELEMENT_ARRAY_BUFFER:he.ARRAY_BUFFER}get index(){return this.type===he.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new ut(t)}}class Vn{constructor(t,e=0,i=!1,n=X.FLOAT,s,o,a,h=1){this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=s,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,i,n,s){return new Vn(t,e,i,n,s)}}const jg={Float32Array,Uint32Array,Int32Array,Uint8Array};function Yg(r,t){let e=0,i=0;const n={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;const s=new ArrayBuffer(e*4);let o=null,a=0;for(let h=0;h<r.length;h++){const l=t[h],c=r[h],u=yu(c);n[u]||(n[u]=new jg[u](s)),o=n[u];for(let d=0;d<c.length;d++){const f=(d/l|0)*i+a,p=d%l;o[f+p]=c[d]}a+=l}return new Float32Array(s)}const yl={5126:4,5123:2,5121:1};let qg=0;const Zg={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Ge{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=qg++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Wt("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,n=!1,s,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ut||(e instanceof Array&&(e=new Float32Array(e)),e=new ut(e));const l=t.split("|");if(l.length>1){for(let u=0;u<l.length;u++)this.addAttribute(l[u],e,i,n,s);return this}let c=this.buffers.indexOf(e);return c===-1&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new Vn(c,i,n,s,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof ut||(t instanceof Array&&(t=new Uint16Array(t)),t=new ut(t)),t.type=he.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],i=new ut;let n;for(n in this.attributes){const s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),e.push(s.size*yl[s.type]/4),s.buffer=0}for(i.data=Yg(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ge;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new ut(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new Vn(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=he.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Ge,i=[],n=[],s=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)n[h]=n[h]||0,n[h]+=o.buffers[h].data.length,s[h]=0}for(let a=0;a<o.buffers.length;a++)i[a]=new Zg[yu(o.buffers[a].data)](n[a]),e.buffers[a]=new ut(i[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)i[h].set(o.buffers[h].data,s[h]),s[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=he.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,c=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){c=u;break}for(const u in o.attributes){const d=o.attributes[u];(d.buffer|0)===c&&(h+=d.size*yl[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[u].buffers[c].data.length/h,l+=d.length}}return e}}class vu extends Ge{constructor(t=!1){super(),this._buffer=new ut(null,t,!1),this._indexBuffer=new ut(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,X.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,X.FLOAT).addAttribute("aColor",this._buffer,4,!0,X.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,X.FLOAT).addIndex(this._indexBuffer)}}const Xn=Math.PI*2,Kg=180/Math.PI,Qg=Math.PI/180;var xt=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(xt||{});class K{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new K(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}K.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Ki=[new K,new K,new K,new K];class Y{constructor(t=0,e=0,i=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=xt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Y(0,0,0,0)}clone(){return new Y(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const S=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=S)return!1;const F=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>F}const i=this.left,n=this.right,s=this.top,o=this.bottom;if(n<=i||o<=s)return!1;const a=Ki[0].set(t.left,t.top),h=Ki[1].set(t.left,t.bottom),l=Ki[2].set(t.right,t.top),c=Ki[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(c,c),Math.max(a.x,h.x,l.x,c.x)<=i||Math.min(a.x,h.x,l.x,c.x)>=n||Math.max(a.y,h.y,l.y,c.y)<=s||Math.min(a.y,h.y,l.y,c.y)>=o))return!1;const d=u*(h.y-a.y),f=u*(a.x-h.x),p=d*i+f*s,m=d*n+f*s,g=d*i+f*o,y=d*n+f*o;if(Math.max(p,m,g,y)<=d*a.x+f*a.y||Math.min(p,m,g,y)>=d*c.x+f*c.y)return!1;const v=u*(a.y-l.y),_=u*(l.x-a.x),x=v*i+_*s,w=v*n+_*s,C=v*i+_*o,T=v*n+_*o;return!(Math.max(x,w,C,T)<=v*a.x+_*a.y||Math.min(x,w,C,T)>=v*c.x+_*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=s-n,this}}Y.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class vs{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=xt.CIRC}clone(){return new vs(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=i}getBounds(){return new Y(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}vs.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class xs{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n,this.type=xt.ELIP}clone(){return new xs(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new Y(this.x-this.width,this.y-this.height,this.width,this.height)}}xs.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ur{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let n=0,s=e.length;n<s;n++)i.push(e[n].x,e[n].y);e=i}this.points=e,this.type=xt.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new ur(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let s=0,o=n-1;s<n;o=s++){const a=this.points[s*2],h=this.points[s*2+1],l=this.points[o*2],c=this.points[o*2+1];h>e!=c>e&&t<(l-a)*((e-h)/(c-h))+a&&(i=!i)}return i}}ur.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,t)=>`${r}, ${t}`,"")}]`};class bs{constructor(t=0,e=0,i=0,n=0,s=20){this.x=t,this.y=e,this.width=i,this.height=n,this.radius=s,this.type=xt.RREC}clone(){return new bs(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),s=e-(this.y+i);const o=i*i;if(n*n+s*s<=o||(n=t-(this.x+this.width-i),n*n+s*s<=o)||(s=e-(this.y+this.height-i),n*n+s*s<=o)||(n=t-(this.x+i),n*n+s*s<=o))return!0}return!1}}bs.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class ot{constructor(t=1,e=0,i=0,n=1,s=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,n,s,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new K;const i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new K;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this}setTransform(t,e,i,n,s,o,a,h,l){return this.a=Math.cos(a+l)*s,this.b=Math.sin(a+l)*s,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,n=this.c,s=this.d,o=t.pivot,a=-Math.atan2(-n,s),h=Math.atan2(i,e),l=Math.abs(a+h);return l<1e-5||Math.abs(Xn-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*i+o.y*s),t}invert(){const t=this.a,e=this.b,i=this.c,n=this.d,s=this.tx,o=t*n-e*i;return this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*s)/o,this.ty=-(t*this.ty-e*s)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new ot;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new ot}static get TEMP_MATRIX(){return new ot}}ot.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Qe=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Je=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],tr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],er=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],qo=[],xu=[],Qi=Math.sign;function Jg(){for(let r=0;r<16;r++){const t=[];qo.push(t);for(let e=0;e<16;e++){const i=Qi(Qe[r]*Qe[e]+tr[r]*Je[e]),n=Qi(Je[r]*Qe[e]+er[r]*Je[e]),s=Qi(Qe[r]*tr[e]+tr[r]*er[e]),o=Qi(Je[r]*tr[e]+er[r]*er[e]);for(let a=0;a<16;a++)if(Qe[a]===i&&Je[a]===n&&tr[a]===s&&er[a]===o){t.push(a);break}}}for(let r=0;r<16;r++){const t=new ot;t.set(Qe[r],Je[r],tr[r],er[r],0,0),xu.push(t)}}Jg();const st={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>Qe[r],uY:r=>Je[r],vX:r=>tr[r],vY:r=>er[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>qo[r][t],sub:(r,t)=>qo[r][st.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?st.S:st.N:Math.abs(t)*2<=Math.abs(r)?r>0?st.E:st.W:t>0?r>0?st.SE:st.SW:r>0?st.NE:st.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{const n=xu[st.inv(t)];n.tx=e,n.ty=i,r.append(n)}};class we{constructor(t,e,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new we(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}we.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Zo=class{constructor(){this.worldTransform=new ot,this.localTransform=new ot,this.position=new we(this.onChange,this,0,0),this.scale=new we(this.onChange,this,1,1),this.pivot=new we(this.onChange,this,0,0),this.skew=new we(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};Zo.IDENTITY=new Zo;let Ja=Zo;Ja.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var t1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,e1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function _l(r,t,e){const i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function ro(r){const t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function bu(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return ro(2*t);case"bvec3":return ro(3*t);case"bvec4":return ro(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Hr=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,t)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,t)=>r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,t)=>r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,t)=>r.type==="vec3"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}],r1={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},i1={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function n1(r,t){var i;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in r.uniforms){const s=t[n];if(!s){((i=r.uniforms[n])==null?void 0:i.group)===!0&&(r.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const o=r.uniforms[n];let a=!1;for(let h=0;h<Hr.length;h++)if(Hr[h].test(s,o)){e.push(Hr[h].code(n,o)),a=!0;break}if(!a){const h=(s.size===1&&!s.isArray?r1:i1)[s.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const wu={};let wr=wu;function s1(){if(wr===wu||wr!=null&&wr.isContextLost()){const r=H.ADAPTER.createCanvas();let t;H.PREFER_ENV>=_r.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),wr=t}return wr}let Ji;function o1(){if(!Ji){Ji=Nt.MEDIUM;const r=s1();r&&r.getShaderPrecisionFormat&&(Ji=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision?Nt.HIGH:Nt.MEDIUM)}return Ji}function vl(r,t){const e=r.getShaderSource(t).split(`
`).map((l,c)=>`${c}: ${l}`),i=r.getShaderInfoLog(t),n=i.split(`
`),s={},o=n.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!s[l]?(s[l]=!0,!0):!1),a=[""];o.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function a1(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||vl(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||vl(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}const h1={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Tu(r){return h1[r]}let tn=null;const xl={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Au(r,t){if(!tn){const e=Object.keys(xl);tn={};for(let i=0;i<e.length;++i){const n=e[i];tn[r[n]]=xl[n]}}return tn[t]}function bl(r,t,e){if(r.substring(0,9)!=="precision"){let i=t;return t===Nt.HIGH&&e!==Nt.HIGH&&(i=Nt.MEDIUM),`precision ${i} float;
${r}`}else if(e!==Nt.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}let si;function l1(){if(typeof si=="boolean")return si;try{si=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{si=!1}return si}let c1=0;const en={},Ko=class Cr{constructor(t,e,i="pixi-shader",n={}){this.extra={},this.id=c1++,this.vertexSrc=t||Cr.defaultVertexSrc,this.fragmentSrc=e||Cr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),en[i]?(en[i]++,i+=`-${en[i]}`):en[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=bl(this.vertexSrc,Cr.defaultVertexPrecision,Nt.HIGH),this.fragmentSrc=bl(this.fragmentSrc,Cr.defaultFragmentPrecision,o1())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return e1}static get defaultFragmentSrc(){return t1}static from(t,e,i){const n=t+e;let s=fl[n];return s||(fl[n]=s=new Cr(t,e,i)),s}};Ko.defaultVertexPrecision=Nt.HIGH,Ko.defaultFragmentPrecision=be.apple.device?Nt.HIGH:Nt.MEDIUM;let Te=Ko,u1=0;class jt{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=u1++,this.static=!!e,this.ubo=!!i,t instanceof ut?(this.buffer=t,this.buffer.type=he.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ut(new Float32Array(1)),this.buffer.type=he.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new jt(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new jt(t,e,i)}static uboFrom(t,e){return new jt(t,e??!0,!0)}}class le{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof jt?this.uniformGroup=e:this.uniformGroup=new jt(e):this.uniformGroup=new jt({}),this.disposeRunner=new Wt("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const n=e.uniforms[i];if(n.group===!0&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const n=Te.from(t,e);return new le(n,i)}}class d1{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let s=0;s<t;s++)i[s]=s;this.defaultGroupCache[t]=jt.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Te(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new ot,default:this.defaultGroupCache[t]};return new le(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class Qo{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function f1(){return!be.apple.device}function p1(r){let t=!0;const e=H.ADAPTER.getNavigator();if(be.tablet||be.phone){if(be.apple.device){const i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(be.android.device){const i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?r:4}class ws{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var m1=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,g1=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const fi=class Gt extends ws{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=vu,this.vertexSize=6,this.state=fe.for2d(),this.size=Gt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??p1(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??f1(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return J("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return g1}static get defaultFragmentTemplate(){return m1}setShaderGenerator({vertex:t=Gt.defaultVertexSrc,fragment:e=Gt.defaultFragmentTemplate}={}){this.shaderGenerator=new d1(t,e)}contextChange(){const t=this.renderer.gl;H.PREFER_ENV===_r.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Gt.defaultMaxTextures),this.maxTextures=Vg(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Gt,i=this.size/4,n=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Yo);for(;e.length<n;)e.push(new Qo);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=Gt._textureArrayPool,n=this.renderer.batch,s=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++Z._globalBatch,h=0,l=i[0],c=0;n.copyBoundTextures(s,e);for(let u=0;u<this._bufferSize;++u){const d=t[u];t[u]=null,d._batchEnabled!==a&&(l.count>=e&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,c,u),c=u,l=i[++h],++a),d._batchEnabled=a,d.touched=o,l.elements[l.count++]=d)}l.count>0&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,c,this._bufferSize),++h,++a);for(let u=0;u<s.length;u++)s[u]=null;Z._globalBatch=a}buildDrawCalls(t,e,i){const{_bufferedElements:n,_attributeBuffer:s,_indexBuffer:o,vertexSize:a}=this,h=Gt._drawCallPool;let l=this._dcIndex,c=this._aIndex,u=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let f=e;f<i;++f){const p=n[f],m=p._texture.baseTexture,g=mu[m.alphaMode?1:0][p.blendMode];n[f]=null,e<f&&d.blend!==g&&(d.size=u-d.start,e=f,d=h[++l],d.texArray=t,d.start=u),this.packInterleavedGeometry(p,s,o,c,u),c+=p.vertexData.length/2*a,u+=p.indices.length,d.blend=g}e<i&&(d.size=u-d.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Gt.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,n=Gt._drawCallPool;let s=null;for(let o=0;o<t;o++){const{texArray:a,type:h,size:l,start:c,blend:u}=n[o];s!==a&&(s=a,this.bindAndClearTexArray(a)),this.state.blendMode=u,i.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,c*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Gt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=$n(Math.ceil(t/8)),i=ul(e),n=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new Xo(n*this.vertexSize*4)),s}getIndexBuffer(t){const e=$n(Math.ceil(t/12)),i=ul(e),n=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(n)),s}packInterleavedGeometry(t,e,i,n,s){const{uint32View:o,float32View:a}=e,h=n/this.vertexSize,l=t.uvs,c=t.indices,u=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=at.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let m=0;m<u.length;m+=2)a[n++]=u[m],a[n++]=u[m+1],a[n++]=l[m],a[n++]=l[m+1],o[n++]=p,a[n++]=d;for(let m=0;m<c.length;m++)i[s++]=h+c[m]}};fi.defaultBatchSize=4096,fi.extension={name:"batch",type:U.RendererPlugin},fi._drawCallPool=[],fi._textureArrayPool=[];let rr=fi;$.add(rr);var y1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,_1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Jo=class pi extends le{constructor(t,e,i){const n=Te.from(t||pi.defaultVertexSrc,e||pi.defaultFragmentSrc);super(n,i),this.padding=0,this.resolution=pi.defaultResolution,this.multisample=pi.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new fe}apply(t,e,i,n,s){t.applyFilter(this,e,i,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return _1}static get defaultFragmentSrc(){return y1}};Jo.defaultResolution=1,Jo.defaultMultisample=ft.NONE;let Tt=Jo;class Wn{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new at(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:n}=t,s=i??e;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Wn.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Wn.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"background"};$.add(Wn);class Eu{constructor(t){this.renderer=t,this.emptyRenderer=new ws(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,i,n){const{elements:s,ids:o,count:a}=t;let h=0;for(let l=0;l<a;l++){const c=s[l],u=c._batchLocation;if(u>=0&&u<n&&e[u]===c){o[l]=u;continue}for(;h<n;){const d=e[h];if(d&&d._batchEnabled===i&&d._batchLocation===h){h++;continue}o[l]=h,c._batchLocation=h,e[h]=c;break}}}destroy(){this.renderer=null}}Eu.extension={type:U.RendererSystem,name:"batch"};$.add(Eu);let wl=0;class jn{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=wl++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=wl++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(H.PREFER_ENV>=_r.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}jn.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},jn.extension={type:U.RendererSystem,name:"context"};$.add(jn);class ta{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Wt("disposeFramebuffer"),this.multisample=ft.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Z(null,{scaleMode:ae.NEAREST,resolution:1,mipmap:ue.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Z(null,{scaleMode:ae.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ue.OFF,format:D.DEPTH_COMPONENT,type:X.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Su extends Z{constructor(t={}){if(typeof t=="number"){const e=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3];t={width:e,height:i,scaleMode:n,resolution:s}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=ft.NONE),super(null,t),this.mipmap=ue.OFF,this.valid=!0,this._clear=new at([0,0,0,0]),this.framebuffer=new ta(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class He extends Mi{constructor(t){const e=t,i=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;super(i,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=Hg(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,n){const s=t.gl,o=e.realWidth,a=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Et.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&i.width===o&&i.height===a?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,i.type,n):(i.width=o,i.height=a,s.texImage2D(e.target,0,i.internalFormat,e.format,i.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class Cu extends He{constructor(t,e){if(e=e||{},typeof t=="string"){const i=new Image;He.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??H.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Et.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const o in s){const a=s[o];if(a!==i&&a.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class th{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const n=e.width,s=e.height;if(i){const o=t.width/2/n,a=t.height/2/s,h=t.x/n+o,l=t.y/s+a;i=st.add(i,st.NW),this.x0=h+o*st.uX(i),this.y0=l+a*st.uY(i),i=st.add(i,2),this.x1=h+o*st.uX(i),this.y1=l+a*st.uY(i),i=st.add(i,2),this.x2=h+o*st.uX(i),this.y2=l+a*st.uY(i),i=st.add(i,2),this.x3=h+o*st.uX(i),this.y3=l+a*st.uY(i)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}th.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Tl=new th;function rn(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class k extends Oi{constructor(t,e,i,n,s,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Y(0,0,1,1)),t instanceof k&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=Tl,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new K(o.x,o.y):new K(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&te[e.url]&&k.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,k.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new k(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Tl&&(this._uvs=new th),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=H.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof Z){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${mr()}`,Z.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${mr()}`}s=t._pixiId}let o=te[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!o&&!(t instanceof Z)?(e.resolution||(e.resolution=Se(t)),o=new k(new Z(t,e)),o.baseTexture.cacheId=s,Z.addToCache(o.baseTexture,s),k.addToCache(o,s)):!o&&t instanceof Z&&(o=new k(t),k.addToCache(o,s)),o}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=k.from(t,Object.assign({resourceOptions:i},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,i,n){return new k(Z.fromBuffer(t,e,i,n))}static fromLoader(t,e,i,n){const s=new Z(t,Object.assign({scaleMode:Z.defaultOptions.scaleMode,resolution:Se(e)},n)),{resource:o}=s;o instanceof Cu&&(o.url=e);const a=new k(s);return i||(i=e),Z.addToCache(a.baseTexture,i),k.addToCache(a,i),i!==e&&(Z.addToCache(a.baseTexture,e),k.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),te[e]&&te[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),te[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=te[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete te[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)te[t.textureCacheIds[e]]===t&&delete te[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:n,height:s}=t,o=e+n>this.baseTexture.width,a=i+s>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",l=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,c=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${c}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return k._EMPTY||(k._EMPTY=new k(new Z),rn(k._EMPTY),rn(k._EMPTY.baseTexture)),k._EMPTY}static get WHITE(){if(!k._WHITE){const t=H.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),k._WHITE=new k(Z.from(t)),rn(k._WHITE),rn(k._WHITE.baseTexture)}return k._WHITE}}class vr extends k{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,o=Math.round(e*n)/n;this.valid=s>0&&o>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(s,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new vr(new Su(t))}}class Iu{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=ft.NONE){const n=new Su(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new vr(n)}getOptimalTexture(t,e,i=1,n=ft.NONE){let s;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=$n(t),e=$n(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let o=this.texturePool[s].pop();return o||(o=this.createTexture(t,e,n)),o.filterPoolKey=s,o.setResolution(i),o}getFilterTexture(t,e,i){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||ft.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const i=this.texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Iu.SCREEN_KEY=-1;class v1 extends Ge{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Pu extends Ge{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ut(this.vertices),this.uvBuffer=new ut(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class x1{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ft.NONE,this.sourceFrame=new Y,this.destinationFrame=new Y,this.bindingSourceFrame=new Y,this.bindingDestinationFrame=new Y,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const nn=[new K,new K,new K,new K],io=new ot;class Ru{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Iu,this.statePool=[],this.quad=new v1,this.quadUv=new Pu,this.tempRect=new Y,this.activeState={},this.globalUniforms=new jt({outputFrame:new Y,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new x1,o=i.renderTexture;let a,h;if(o.current){const g=o.current;a=g.resolution,h=g.multisample}else a=i.resolution,h=i.multisample;let l=e[0].resolution||a,c=e[0].multisample??h,u=e[0].padding,d=e[0].autoFit,f=e[0].legacy??!0;for(let g=1;g<e.length;g++){const y=e[g];l=Math.min(l,y.resolution||a),c=Math.min(c,y.multisample??h),u=this.useMaxPadding?Math.max(u,y.padding):u+y.padding,d=d&&y.autoFit,f=f||(y.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(s),s.resolution=l,s.multisample=c,s.legacy=f,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(u);const p=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(io.copyFrom(i.projection.transform).invert(),p),d?(s.sourceFrame.fit(p),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(p)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,l,c),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const m=this.tempRect;m.x=0,m.y=0,m.width=s.sourceFrame.width,m.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(o.sourceFrame),s.bindingDestinationFrame.copyFrom(o.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,o.bind(s.renderTexture,s.sourceFrame,m),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*e.resolution),o[1]=Math.round(s[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*s[2]-.5*o[2],a[3]=e.sourceFrame.height*s[3]-.5*o[3],e.legacy){const l=n.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,h.renderTexture,ie.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,c=this.getOptimalFilterTexture(l.width,l.height,e.resolution);c.filterFrame=l.filterFrame;let u=0;for(u=0;u<i.length-1;++u){u===1&&e.multisample>1&&(c=this.getOptimalFilterTexture(l.width,l.height,e.resolution),c.filterFrame=l.filterFrame),i[u].apply(this,l,c,ie.CLEAR,e);const d=l;l=c,c=d}i[u].apply(this,l,h.renderTexture,ie.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(c)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=ie.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===ie.CLEAR||e===ie.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(oe.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(oe.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:s}=e._texture,o=t.set(n.width,0,0,n.height,i.x,i.y),a=e.worldTransform.copyTo(ot.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,n=ft.NONE){return this.texturePool.getOptimalTexture(t,e,i,n)}getFilterTexture(t,e,i){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||ft.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=nn[0],n=nn[1],s=nn[2],o=nn[3];i.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(s,s),t.apply(o,o);const a=Math.min(i.x,n.x,s.x,o.x),h=Math.min(i.y,n.y,s.y,o.y),l=Math.max(i.x,n.x,s.x,o.x),c=Math.max(i.y,n.y,s.y,o.y);e.x=a,e.y=h,e.width=l-a,e.height=c-h}roundFrame(t,e,i,n,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){const{a:o,b:a,c:h,d:l}=s;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}s=s?io.copyFrom(s):io.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}Ru.extension={type:U.RendererSystem,name:"filter"};$.add(Ru);class b1{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ft.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const w1=new Y;class Mu{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new ta(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Y,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;H.PREFER_ENV===_r.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>i,a=e.height>>i,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{const o=t.width>>i,a=t.height>>i;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=i,s.height=n,this.gl.viewport(t,e,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,n,s=Io.COLOR|Io.DEPTH){const{gl:o}=this;o.clearColor(t,e,i,n),o.clear(s)}initFramebuffer(t){const{gl:e}=this,i=new b1(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let o=0;o<s;o++){const a=n[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let o=s.length;i.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const l=s[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,l.target,c._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+h))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){n.stencil=n.stencil||i.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH_STENCIL):t.depth&&t.stencil?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH24_STENCIL8):t.depth?(h=i.DEPTH_ATTACHMENT,l=i.DEPTH_COMPONENT24):(h=i.STENCIL_ATTACHMENT,l=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,l,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,l,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,n.stencil)}else n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=ft.NONE;if(t<=1||e===null)return i;for(let n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return i===1&&(i=ft.NONE),i}blit(t,e,i){const{current:n,renderer:s,gl:o,CONTEXT_UID:a}=this;if(s.context.webGLVersion!==2||!n)return;const h=n.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const c=n.colorTextures[0];if(!c)return;h.blitFramebuffer||(h.blitFramebuffer=new ta(n.width,n.height),h.blitFramebuffer.addColorTexture(0,c)),t=h.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=w1,e.width=n.width,e.height=n.height),i||(i=e);const l=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const i=t.width,n=t.height,s=this.gl,o=e.stencil=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o);let a,h;this.renderer.context.webGLVersion===1?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH_STENCIL):t.depth?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH24_STENCIL8):(a=s.STENCIL_ATTACHMENT,h=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,h,i,n):s.renderbufferStorage(s.RENDERBUFFER,h,i,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,a,s.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Y}destroy(){this.renderer=null}}Mu.extension={type:U.RendererSystem,name:"framebuffer"};$.add(Mu);const no={5126:4,5123:2,5121:1};class Fu{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;H.PREFER_ENV===_r.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=n=>i.bindVertexArrayOES(n),t.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(n,s)=>i.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,o,a,h)=>i.drawElementsInstancedANGLE(n,s,o,a,h),t.drawArraysInstanced=(n,s,o,a)=>i.drawArraysInstancedANGLE(n,s,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const o=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];e.update(n)}}checkCompatibility(t,e){const i=t.attributes,n=e.attributeData;for(const s in n)if(!i[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const i=t.attributes,n=e.attributeData,s=["g",t.id];for(const o in i)n[o]&&s.push(o,n[o].location);return s.join("-")}initGeometryVao(t,e,i=!0){const n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID];let c=l[h];if(c)return l[a.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const m in u)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*no[d[m].type];for(const m in d){const g=d[m],y=g.size;g.stride===void 0&&(f[g.buffer]===y*no[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=y*no[g.type])}c=n.createVertexArray(),n.bindVertexArray(c);for(let m=0;m<u.length;m++){const g=u[m];o.bind(g),i&&g._glBuffers[s].refCount++}return this.activateVao(t,a),l[a.id]=c,l[h]=c,n.bindVertexArray(null),o.unbind(he.ARRAY_BUFFER),c}disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!i){if(o)for(let h=0;h<s.length;h++){const l=s[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&o.dispose(s[h],e))}if(!e){for(const h in i)if(h[0]==="g"){const l=i[h];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let h=null;for(const l in a){const c=a[l],u=o[c.buffer],d=u._glBuffers[n];if(e.attributeData[l]){h!==d&&(s.bind(u),h=d);const f=e.attributeData[l].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(f,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,n){const{gl:s}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(i||0)*a,n||1):s.drawElements(t,e||o.indexBuffer.data.length,h,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(t,i,e||o.getSize(),n||1):s.drawArrays(t,i,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Fu.extension={type:U.RendererSystem,name:"geometry"};$.add(Fu);const Al=new ot;class Bu{constructor(t,e){this._texture=t,this.mapCoord=new ot,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],o=t[n+1];e[n]=s*i.a+o*i.c+i.tx,e[n+1]=s*i.b+o*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=e.orig,s=e.trim;s&&(Al.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Al));const o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/o.width,a[1]=(e._frame.y+h+l)/o.height,a[2]=(e._frame.x+e._frame.width-h+l)/o.width,a[3]=(e._frame.y+e._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}var T1=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,A1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class E1 extends Tt{constructor(t,e,i){let n=null;typeof t!="string"&&e===void 0&&i===void 0&&(n=t,t=void 0,e=void 0,i=void 0),super(t||A1,e||T1,i),this.maskSprite=n,this.maskMatrix=new ot}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,n){const s=this._maskSprite,o=s._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Bu(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))}}class S1{constructor(t=null){this.type=mt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Tt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=mt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Du{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const s=this.maskDataPool.pop()||new S1;s.pooled=!0,s.maskObject=e,i=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==mt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case mt.SCISSOR:this.renderer.scissor.push(i);break;case mt.STENCIL:this.renderer.stencil.push(i);break;case mt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case mt.COLOR:this.pushColorMask(i);break}i.type===mt.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case mt.SCISSOR:this.renderer.scissor.pop(e);break;case mt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case mt.SPRITE:this.popSpriteMask(e);break;case mt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===mt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=mt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=mt.SCISSOR:t.type=mt.STENCIL:t.type=mt.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new E1])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const s=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,n),i.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}Du.extension={type:U.RendererSystem,name:"mask"};$.add(Du);class Lu{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const El=new ot,Sl=[],Nu=class An extends Lu{constructor(t){super(t),this.glConst=H.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:n}=this,s=n.renderTexture,o=i.getBounds(!0,Sl.pop()??new Y);this.roundFrameToPixels(o,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:n,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||An.isMatrixRotated(e.worldTransform)||An.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,n,s){An.isMatrixRotated(s)||(s=s?El.copyFrom(s):El.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.renderer.filter.transformAABB(s,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Sl.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Nu.extension={type:U.RendererSystem,name:"scissor"};let C1=Nu;$.add(C1);class Ou extends Lu{constructor(t){super(t),this.glConst=H.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(i._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Ou.extension={type:U.RendererSystem,name:"stencil"};$.add(Ou);class ku{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return J("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}ku.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"_plugin"};$.add(ku);class Uu{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ot,this.transform=null}update(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,i,n){const s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=o*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-o-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}Uu.extension={type:U.RendererSystem,name:"projection"};$.add(Uu);const I1=new Ja,Cl=new Y;class Gu{constructor(t){this.renderer=t,this._tempMatrix=new ot}generateTexture(t,e){const{region:i,...n}=e||{},s=(i==null?void 0:i.copyTo(Cl))||t.getLocalBounds(Cl,!0),o=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/o),s.height=Math.max(s.height,1/o),n.width=s.width,n.height=s.height,n.resolution=o,n.multisample??(n.multisample=this.renderer.multisample);const a=vr.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const h=t.transform;return t.transform=I1,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}}Gu.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"textureGenerator"};$.add(Gu);const Ze=new Y,oi=new Y;class Hu{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Y,this.destinationFrame=new Y,this.viewportFrame=new Y}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const n=this.renderer;this.current=t;let s,o,a;t?(s=t.baseTexture,a=s.resolution,e||(Ze.width=t.frame.width,Ze.height=t.frame.height,e=Ze),i||(oi.x=t.frame.x,oi.y=t.frame.y,oi.width=e.width,oi.height=e.height,i=oi),o=s.framebuffer):(a=n.resolution,e||(Ze.width=n._view.screen.width,Ze.height=n._view.screen.height,e=Ze),i||(i=Ze,i.width=e.width,i.height=e.height));const h=this.viewportFrame;h.x=i.x*a,h.y=i.y*a,h.width=i.width*a,h.height=i.height*a,t||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(i,e,a,!o),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=at.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=s.width!==o.width||s.height!==o.height;if(a){let{x:h,y:l,width:c,height:u}=this.viewportFrame;h=Math.round(h),l=Math.round(l),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,c,u)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Hu.extension={type:U.RendererSystem,name:"renderTexture"};$.add(Hu);class P1{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function R1(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=t.getActiveAttrib(r,n);if(s.name.startsWith("gl_"))continue;const o=Au(t,s.type),a={type:o,name:s.name,size:Tu(o),location:t.getAttribLocation(r,s.name)};e[s.name]=a}return e}function M1(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const s=t.getActiveUniform(r,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),h=Au(t,s.type);e[o]={name:o,index:n,type:h,size:s.size,isArray:a,value:bu(h,s.size)}}return e}function F1(r,t){var a;const e=_l(r,r.VERTEX_SHADER,t.vertexSrc),i=_l(r,r.FRAGMENT_SHADER,t.fragmentSrc),n=r.createProgram();r.attachShader(n,e),r.attachShader(n,i);const s=(a=t.extra)==null?void 0:a.transformFeedbackVaryings;if(s&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS)||a1(r,n,e,i),t.attributeData=R1(n,r),t.uniformData=M1(n,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((l,c)=>l>c?1:-1);for(let l=0;l<h.length;l++)t.attributeData[h[l]].location=l,r.bindAttribLocation(n,l,h[l]);r.linkProgram(n)}r.deleteShader(e),r.deleteShader(i);const o={};for(const h in t.uniformData){const l=t.uniformData[h];o[h]={location:r.getUniformLocation(n,h),value:bu(l.type,l.size)}}return new P1(n,o)}function B1(r,t,e,i,n){e.buffer.update(n)}const D1={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},zu={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function L1(r){const t=r.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,i=0,n=0;for(let s=0;s<t.length;s++){const o=t[s];if(e=zu[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!==0&&i<16){const a=i%e%16;i+=a,n+=a}i+e>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=e,i=e):(o.offset=n,i+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function N1(r,t){const e=[];for(const i in r)t[i]&&e.push(t[i]);return e.sort((i,n)=>i.index-n.index),e}function O1(r,t){if(!r.autoManage)return{size:0,syncFunc:B1};const e=N1(r.uniforms,t),{uboElements:i,size:n}=L1(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){const a=i[o],h=r.uniforms[a.data.name],l=a.data.name;let c=!1;for(let u=0;u<Hr.length;u++){const d=Hr[u];if(d.codeUbo&&d.test(a.data,h)){s.push(`offset = ${a.offset/4};`,Hr[u].codeUbo(a.data.name,h)),c=!0;break}}if(!c)if(a.data.size>1){const u=Tu(a.data.type),d=Math.max(zu[a.data.type]/16,1),f=u/d,p=(4-f%4)%4;s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const u=D1[a.data.type];s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${u};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let k1=0;const sn={textureCount:0,uboCount:0};class $u{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=k1++}systemCheck(){if(!l1())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(sn.textureCount=0,sn.uboCount=0,this.syncUniformGroup(t.uniformGroup,sn)),n}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=n1(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,sn,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=O1(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const n=t.uniforms,s=[`${i}-`];for(const o in n)s.push(o),e[o]&&s.push(e[o].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,n=F1(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}$u.extension={type:U.RendererSystem,name:"shader"};$.add($u);class Yn{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.1 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Yn.defaultOptions={hello:!1},Yn.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"startup"};$.add(Yn);function U1(r,t=[]){return t[j.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.ADD]=[r.ONE,r.ONE],t[j.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.NONE]=[0,0],t[j.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[j.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[j.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[j.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[j.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[j.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[j.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[j.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[j.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[j.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[j.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}const G1=0,H1=1,z1=2,$1=3,V1=4,X1=5,Vu=class ea{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=j.NONE,this._blendEq=!1,this.map=[],this.map[G1]=this.setBlend,this.map[H1]=this.setOffset,this.map[z1]=this.setCullFace,this.map[$1]=this.setDepthTest,this.map[V1]=this.setFrontFace,this.map[X1]=this.setDepthMask,this.checks=[],this.defaultState=new fe,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=U1(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(ea.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(ea.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Vu.extension={type:U.RendererSystem,name:"state"};let W1=Vu;$.add(W1);class j1 extends Oi{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),i=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of i)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Wt(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=i.find(o=>this._systemsHash[o]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const mi=class En{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=En.defaultMaxIdle,this.checkCountMax=En.defaultCheckCountMax,this.mode=En.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==$a.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let n=0;n<e.length;n++){const s=e[n];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,i=!0)}if(i){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}};mi.defaultMode=$a.AUTO,mi.defaultMaxIdle=60*60,mi.defaultCheckCountMax=60*10,mi.extension={type:U.RendererSystem,name:"textureGC"};let ir=mi;$.add(ir);class so{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=X.UNSIGNED_BYTE,this.internalFormat=D.RGBA,this.samplerType=0}}function Y1(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[r.RGB]:G.FLOAT,[r.RGBA]:G.FLOAT,[r.ALPHA]:G.FLOAT,[r.LUMINANCE]:G.FLOAT,[r.LUMINANCE_ALPHA]:G.FLOAT,[r.R8]:G.FLOAT,[r.R8_SNORM]:G.FLOAT,[r.RG8]:G.FLOAT,[r.RG8_SNORM]:G.FLOAT,[r.RGB8]:G.FLOAT,[r.RGB8_SNORM]:G.FLOAT,[r.RGB565]:G.FLOAT,[r.RGBA4]:G.FLOAT,[r.RGB5_A1]:G.FLOAT,[r.RGBA8]:G.FLOAT,[r.RGBA8_SNORM]:G.FLOAT,[r.RGB10_A2]:G.FLOAT,[r.RGB10_A2UI]:G.FLOAT,[r.SRGB8]:G.FLOAT,[r.SRGB8_ALPHA8]:G.FLOAT,[r.R16F]:G.FLOAT,[r.RG16F]:G.FLOAT,[r.RGB16F]:G.FLOAT,[r.RGBA16F]:G.FLOAT,[r.R32F]:G.FLOAT,[r.RG32F]:G.FLOAT,[r.RGB32F]:G.FLOAT,[r.RGBA32F]:G.FLOAT,[r.R11F_G11F_B10F]:G.FLOAT,[r.RGB9_E5]:G.FLOAT,[r.R8I]:G.INT,[r.R8UI]:G.UINT,[r.R16I]:G.INT,[r.R16UI]:G.UINT,[r.R32I]:G.INT,[r.R32UI]:G.UINT,[r.RG8I]:G.INT,[r.RG8UI]:G.UINT,[r.RG16I]:G.INT,[r.RG16UI]:G.UINT,[r.RG32I]:G.INT,[r.RG32UI]:G.UINT,[r.RGB8I]:G.INT,[r.RGB8UI]:G.UINT,[r.RGB16I]:G.INT,[r.RGB16UI]:G.UINT,[r.RGB32I]:G.INT,[r.RGB32UI]:G.UINT,[r.RGBA8I]:G.INT,[r.RGBA8UI]:G.UINT,[r.RGBA16I]:G.INT,[r.RGBA16UI]:G.UINT,[r.RGBA32I]:G.INT,[r.RGBA32UI]:G.UINT,[r.DEPTH_COMPONENT16]:G.FLOAT,[r.DEPTH_COMPONENT24]:G.FLOAT,[r.DEPTH_COMPONENT32F]:G.FLOAT,[r.DEPTH_STENCIL]:G.FLOAT,[r.DEPTH24_STENCIL8]:G.FLOAT,[r.DEPTH32F_STENCIL8]:G.FLOAT}:t={[r.RGB]:G.FLOAT,[r.RGBA]:G.FLOAT,[r.ALPHA]:G.FLOAT,[r.LUMINANCE]:G.FLOAT,[r.LUMINANCE_ALPHA]:G.FLOAT,[r.DEPTH_STENCIL]:G.FLOAT},t}function q1(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[X.UNSIGNED_BYTE]:{[D.RGBA]:r.RGBA8,[D.RGB]:r.RGB8,[D.RG]:r.RG8,[D.RED]:r.R8,[D.RGBA_INTEGER]:r.RGBA8UI,[D.RGB_INTEGER]:r.RGB8UI,[D.RG_INTEGER]:r.RG8UI,[D.RED_INTEGER]:r.R8UI,[D.ALPHA]:r.ALPHA,[D.LUMINANCE]:r.LUMINANCE,[D.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[X.BYTE]:{[D.RGBA]:r.RGBA8_SNORM,[D.RGB]:r.RGB8_SNORM,[D.RG]:r.RG8_SNORM,[D.RED]:r.R8_SNORM,[D.RGBA_INTEGER]:r.RGBA8I,[D.RGB_INTEGER]:r.RGB8I,[D.RG_INTEGER]:r.RG8I,[D.RED_INTEGER]:r.R8I},[X.UNSIGNED_SHORT]:{[D.RGBA_INTEGER]:r.RGBA16UI,[D.RGB_INTEGER]:r.RGB16UI,[D.RG_INTEGER]:r.RG16UI,[D.RED_INTEGER]:r.R16UI,[D.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[X.SHORT]:{[D.RGBA_INTEGER]:r.RGBA16I,[D.RGB_INTEGER]:r.RGB16I,[D.RG_INTEGER]:r.RG16I,[D.RED_INTEGER]:r.R16I},[X.UNSIGNED_INT]:{[D.RGBA_INTEGER]:r.RGBA32UI,[D.RGB_INTEGER]:r.RGB32UI,[D.RG_INTEGER]:r.RG32UI,[D.RED_INTEGER]:r.R32UI,[D.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[X.INT]:{[D.RGBA_INTEGER]:r.RGBA32I,[D.RGB_INTEGER]:r.RGB32I,[D.RG_INTEGER]:r.RG32I,[D.RED_INTEGER]:r.R32I},[X.FLOAT]:{[D.RGBA]:r.RGBA32F,[D.RGB]:r.RGB32F,[D.RG]:r.RG32F,[D.RED]:r.R32F,[D.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[X.HALF_FLOAT]:{[D.RGBA]:r.RGBA16F,[D.RGB]:r.RGB16F,[D.RG]:r.RG16F,[D.RED]:r.R16F},[X.UNSIGNED_SHORT_5_6_5]:{[D.RGB]:r.RGB565},[X.UNSIGNED_SHORT_4_4_4_4]:{[D.RGBA]:r.RGBA4},[X.UNSIGNED_SHORT_5_5_5_1]:{[D.RGBA]:r.RGB5_A1},[X.UNSIGNED_INT_2_10_10_10_REV]:{[D.RGBA]:r.RGB10_A2,[D.RGBA_INTEGER]:r.RGB10_A2UI},[X.UNSIGNED_INT_10F_11F_11F_REV]:{[D.RGB]:r.R11F_G11F_B10F},[X.UNSIGNED_INT_5_9_9_9_REV]:{[D.RGB]:r.RGB9_E5},[X.UNSIGNED_INT_24_8]:{[D.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[X.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[D.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[X.UNSIGNED_BYTE]:{[D.RGBA]:r.RGBA,[D.RGB]:r.RGB,[D.ALPHA]:r.ALPHA,[D.LUMINANCE]:r.LUMINANCE,[D.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[X.UNSIGNED_SHORT_5_6_5]:{[D.RGB]:r.RGB},[X.UNSIGNED_SHORT_4_4_4_4]:{[D.RGBA]:r.RGBA},[X.UNSIGNED_SHORT_5_5_5_1]:{[D.RGBA]:r.RGBA}},t}class Xu{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Z,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=q1(t),this.samplerTypes=Y1(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new so(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new so(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let s=t-1;s>=0;--s){const o=e[s];o&&o._glTextures[n].samplerType!==G.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new so(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var i;e.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??G.FLOAT,this.webGLVersion===2&&t.type===X.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),(n=t.resource)==null?void 0:n.upload(i,t,e))e.samplerType!==G.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,o=t.realHeight,a=i.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,a.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&Gr(this.managedTextures,n,1)}}updateTextureStyle(t){var i;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===ue.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Mt.CLAMP:e.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==ue.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===ae.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===ae.LINEAR){const s=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===ae.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===ae.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Xu.extension={type:U.RendererSystem,name:"texture"};$.add(Xu);class Wu{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:n}=this;e&&n.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(i.buffer.update(a),a._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&s.dispose(a,e))}i&&(e||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Wu.extension={type:U.RendererSystem,name:"transformFeedback"};$.add(Wu);class qn{constructor(t){this.renderer=t}init(t){this.screen=new Y(0,0,t.width,t.height),this.element=t.view||H.ADAPTER.createCanvas(),this.resolution=t.resolution||H.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}qn.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},qn.extension={type:[U.RendererSystem,U.CanvasRendererSystem],name:"_view"};$.add(qn);H.PREFER_ENV=_r.WEBGL2;H.STRICT_TEXTURE_CACHE=!1;H.RENDER_OPTIONS={...jn.defaultOptions,...Wn.defaultOptions,...qn.defaultOptions,...Yn.defaultOptions};Object.defineProperties(H,{WRAP_MODE:{get(){return Z.defaultOptions.wrapMode},set(r){J("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Z.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return Z.defaultOptions.scaleMode},set(r){J("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Z.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return Z.defaultOptions.mipmap},set(r){J("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Z.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return Z.defaultOptions.anisotropicLevel},set(r){J("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Z.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return J("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Tt.defaultResolution},set(r){Tt.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return J("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Tt.defaultMultisample},set(r){Tt.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return rr.defaultMaxTextures},set(r){J("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),rr.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return rr.defaultBatchSize},set(r){J("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),rr.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return rr.canUploadSameBuffer},set(r){J("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),rr.canUploadSameBuffer=r}},GC_MODE:{get(){return ir.defaultMode},set(r){J("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),ir.defaultMode=r}},GC_MAX_IDLE:{get(){return ir.defaultMaxIdle},set(r){J("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),ir.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return ir.defaultCheckCountMax},set(r){J("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),ir.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return Te.defaultVertexPrecision},set(r){J("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Te.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return Te.defaultFragmentPrecision},set(r){J("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Te.defaultFragmentPrecision=r}}});var gr=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(gr||{});class oo{constructor(t,e=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const ju=class Ct{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new oo(null,null,1/0),this.deltaMS=1/Ct.targetFPMS,this.elapsedMS=1/Ct.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=gr.NORMAL){return this._addListener(new oo(t,e,i))}addOnce(t,e,i=gr.NORMAL){return this._addListener(new oo(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Ct.targetFPMS;const i=this._head;let n=i.next;for(;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Ct.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Ct._shared){const t=Ct._shared=new Ct;t.autoStart=!0,t._protected=!0}return Ct._shared}static get system(){if(!Ct._system){const t=Ct._system=new Ct;t.autoStart=!0,t._protected=!0}return Ct._system}};ju.targetFPMS=.06;let Rt=ju;Object.defineProperties(H,{TARGET_FPMS:{get(){return Rt.targetFPMS},set(r){J("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Rt.targetFPMS=r}}});class Yu{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,gr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Rt.shared:new Rt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Yu.extension=U.Application;$.add(Yu);const qu=[];$.handleByList(U.Renderer,qu);function Zu(r){for(const t of qu)if(t.test(r))return new t(r);throw new Error("Unable to auto-detect a suitable renderer.")}var Z1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,K1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Q1=Z1,Ku=K1;class Qu{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=ft.HIGH?this.multisample=ft.HIGH:e>=ft.MEDIUM?this.multisample=ft.MEDIUM:e>=ft.LOW?this.multisample=ft.LOW:this.multisample=ft.NONE}destroy(){}}Qu.extension={type:U.RendererSystem,name:"_multisample"};$.add(Qu);class J1{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Ju{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,i){const{gl:n,CONTEXT_UID:s}=this;i=i||0;const o=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,o.buffer,i*256,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new J1(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Ju.extension={type:U.RendererSystem,name:"buffer"};$.add(Ju);class td{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let n,s,o,a;if(e&&(n=e.renderTexture,s=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(n||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(s??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(e.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}td.extension={type:U.RendererSystem,name:"objectRenderer"};$.add(td);const Sn=class ra extends j1{constructor(t){super(),this.type=za.WEBGL,t=Object.assign({},H.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new jt({projectionMatrix:new ot},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:ra.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(J("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=ra.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:Tg()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return J("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return J("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return J("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return J("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){J("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return J("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){J("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return J("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Sn.extension={type:U.Renderer,priority:1},Sn.__plugins={},Sn.__systems={};let Ts=Sn;$.handleByMap(U.RendererPlugin,Ts.__plugins);$.handleByMap(U.RendererSystem,Ts.__systems);$.add(Ts);class ed extends Mi{constructor(t,e){const{width:i,height:n}=e||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const o=new Z;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Mi?this.addResourceAt(t[i],i):this.addResourceAt(_u(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}}class ty extends ed{constructor(t,e){const{width:i,height:n}=e||{};let s,o;Array.isArray(t)?(s=t,o=t.length):o=t,super(o,{width:i,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Or.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:n,itemDirtyIds:s,items:o}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,e.format,i.type,null);for(let h=0;h<n;h++){const l=o[h];s[h]<l.dirtyId&&(s[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0}}class ey extends He{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const rd=class gi extends ed{constructor(t,e){const{width:i,height:n,autoLoad:s,linkBaseTexture:o}=e||{};if(t&&t.length!==gi.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:n});for(let a=0;a<gi.SIDES;a++)this.items[a].target=Or.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=Or.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Or.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const n=this.itemDirtyIds;for(let s=0;s<gi.SIDES;s++){const o=this.items[s];(n[s]<o.dirtyId||i.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,i),n[s]=o.dirtyId):n[s]<-1&&(t.gl.texImage2D(o.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),n[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===gi.SIDES}};rd.SIDES=6;let ry=rd;class Fr extends He{constructor(t,e){e=e||{};let i,n,s;typeof t=="string"?(i=Fr.EMPTY,n=t,s=!0):(i=t,n=null,s=!1),super(i),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??s,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const i=await H.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Et.UNPACK?"premultiply":"none"});if(this.destroyed){s.close();return}this.source=s,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Fr._EMPTY=Fr._EMPTY??H.ADAPTER.createCanvas(0,0),Fr._EMPTY}}const ia=class Cn extends He{constructor(t,e){e=e||{},super(H.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Cn.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;He.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),n=Math.round(n),s=Math.round(s);const o=this.source;o.width=n,o.height=s,o._pixiId=`canvas_${mr()}`,o.getContext("2d").drawImage(t,0,0,e,i,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(t){const e=Cn.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Cn.SVG_XML.test(t)}};ia.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,ia.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let na=ia;const sa=class oa extends He{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const n=t[0].src||t[0];He.crossOrigin(i,n,e.crossorigin);for(let s=0;s<t.length;++s){const o=document.createElement("source");let{src:a,mime:h}=t[s];if(a=a||t[s],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const l=a.split("?").shift().toLowerCase(),c=l.slice(l.lastIndexOf(".")+1);h=h||oa.MIME_TYPES[c]||`video/${c}`}o.src=a,h&&(o.type=h),i.appendChild(o)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=Rt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Rt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Rt.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Rt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||oa.TYPES.includes(e)}};sa.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],sa.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let id=sa;Wo.push(Fr,Cu,ey,id,na,_s,ry,ty);class Zn{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Y.EMPTY:(t=t||new Y(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:n,c:s,d:o,tx:a,ty:h}=t,l=i*e.x+s*e.y+a,c=n*e.x+o*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let e=this.minX,i=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,this.minX=e,this.minY=i,this.maxX=n,this.maxY=s}addFrame(t,e,i,n,s){this.addFrameMatrix(t.worldTransform,e,i,n,s)}addFrameMatrix(t,e,i,n,s){const o=t.a,a=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=o*e+h*i+c,y=a*e+l*i+u;d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*n+h*i+c,y=a*n+l*i+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*e+h*s+c,y=a*e+l*s+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*n+h*s+c,y=a*n+l*s+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,i){let n=this.minX,s=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<i;h+=2){const l=t[h],c=t[h+1];n=l<n?l:n,s=c<s?c:s,o=l>o?l:o,a=c>a?c:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a}addVertices(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)}addVerticesMatrix(t,e,i,n,s=0,o=s){const a=t.a,h=t.b,l=t.c,c=t.d,u=t.tx,d=t.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let y=i;y<n;y+=2){const v=e[y],_=e[y+1],x=a*v+l*_+u,w=c*_+h*v+d;f=Math.min(f,x-s),m=Math.max(m,x+s),p=Math.min(p,w-o),g=Math.max(g,w+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const e=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>c?o:c}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>c?o:c}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,n,s,o){t-=s,e-=o,i+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class ct extends Oi{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ja,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Zn,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const n=e[i];Object.defineProperty(ct.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Y),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Zn);const e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(i==null?void 0:i.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,o}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,n){return e&&(t=e.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,i=1,n=1,s=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=n||1,this.rotation=s,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new iy),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Kg}set angle(t){this.transform.rotation=t*Qg}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class iy extends ct{constructor(){super(...arguments),this.sortDirty=null}}ct.prototype.displayObjectUpdateTransform=ct.prototype.updateTransform;const ny=new ot;function sy(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}const nd=class aa extends ct{constructor(){super(),this.children=[],this.sortableChildren=aa.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),n=this.getChildIndex(e);this.children[i]=e,this.children[n]=t,this.onChildrenChange(i<n?i:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);Gr(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,Gr(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Gr(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,n=e,s=n-i;let o;if(s>0&&s<=n){o=this.children.splice(i,s);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(sy),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const o=this.children[n];o.visible&&o.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,n;this.cullArea?(i=this.cullArea,n=this.worldTransform):this._render!==aa.prototype._render&&(i=this.getBounds(!0));const s=t.projection.transform;if(s&&(n?(n=ny.copyFrom(n),n.prepend(s)):n=s),i&&e.intersects(i,n))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const h=this.children[o],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let i=0,n=this.children.length;i<n;++i)this.children[i].render(t)}}renderAdvanced(t){var s,o,a;const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<e.length;h++)e[h].enabled&&this._enabledFilters.push(e[h])}const n=e&&((s=this._enabledFilters)==null?void 0:s.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==mt.NONE));if(n&&t.batch.flush(),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let h=0,l=this.children.length;h<l;++h)this.children[h].render(t)}n&&t.batch.flush(),i&&t.mask.pop(this),e&&((a=this._enabledFilters)!=null&&a.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,i=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<i.length;++n)i[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};nd.defaultSortableChildren=!1;let Bt=nd;Bt.prototype.containerUpdateTransform=Bt.prototype.updateTransform;Object.defineProperties(H,{SORTABLE_CHILDREN:{get(){return Bt.defaultSortableChildren},set(r){J("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Bt.defaultSortableChildren=r}}});const ai=new K,oy=new Uint16Array([0,1,2,0,2,3]);class ti extends Bt{constructor(t){super(),this._anchor=new we(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new at(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=j.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||k.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=oy,this.pluginName="batch",this.isSprite=!0,this._roundPixels=H.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Oe(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Oe(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let f=0,p=0,m=0,g=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,g=c.y-d._y*u.height,m=g+c.height):(p=-d._x*u.width,f=p+u.width,g=-d._y*u.height,m=g+u.height),l[0]=i*p+s*g+a,l[1]=o*g+n*p+h,l[2]=i*f+s*g+a,l[3]=o*g+n*f+h,l[4]=i*f+s*m+a,l[5]=o*m+n*f+h,l[6]=i*p+s*m+a,l[7]=o*m+n*p+h,this._roundPixels){const y=H.RESOLUTION;for(let v=0;v<l.length;++v)l[v]=Math.round(l[v]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,n=this._anchor,s=this.transform.worldTransform,o=s.a,a=s.b,h=s.c,l=s.d,c=s.tx,u=s.ty,d=-n._x*i.width,f=d+i.width,p=-n._y*i.height,m=p+i.height;if(e[0]=o*d+h*p+c,e[1]=l*p+a*d+u,e[2]=o*f+h*p+c,e[3]=l*p+a*f+u,e[4]=o*f+h*m+c,e[5]=l*m+a*f+u,e[6]=o*d+h*m+c,e[7]=l*m+a*d+u,this._roundPixels){const g=H.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*g)/g}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Zn),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,ai);const e=this._texture.orig.width,i=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return ai.x>=n&&ai.x<n+e&&(s=-i*this.anchor.y,ai.y>=s&&ai.y<s+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof k?t:k.from(t,e);return new ti(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Oe(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Oe(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||k.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const sd=new ot;ct.prototype._cacheAsBitmap=!1;ct.prototype._cacheData=null;ct.prototype._cacheAsBitmapResolution=null;ct.prototype._cacheAsBitmapMultisample=null;class ay{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ct.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let t;r?(this._cacheData||(this._cacheData=new ay),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});ct.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};ct.prototype._initCachedDisplayObject=function(r){var d,f;if((d=this._cacheData)!=null&&d.sprite)return;const t=this.alpha;this.alpha=1,r.batch.flush();const e=this.getLocalBounds(new Y,!0);if((f=this.filters)!=null&&f.length){const p=this.filters[0].padding;e.pad(p)}const i=this.cacheAsBitmapResolution||r.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);const n=r.renderTexture.current,s=r.renderTexture.sourceFrame.clone(),o=r.renderTexture.destinationFrame.clone(),a=r.projection.transform,h=vr.create({width:e.width,height:e.height,resolution:i,multisample:this.cacheAsBitmapMultisample??r.multisample}),l=`cacheAsBitmap_${mr()}`;this._cacheData.textureCacheId=l,Z.addToCache(h.baseTexture,l),k.addToCache(h,l);const c=this.transform.localTransform.copyTo(sd).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=a,r.renderTexture.bind(n,s,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const u=new ti(h);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(e.x/e.width),u.anchor.y=-(e.y/e.height),u.alpha=t,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};ct.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};ct.prototype._initCachedDisplayObjectCanvas=function(r){var c;if((c=this._cacheData)!=null&&c.sprite)return;const t=this.getLocalBounds(new Y,!0),e=this.alpha;this.alpha=1;const i=r.canvasContext.activeContext,n=r._projTransform,s=this.cacheAsBitmapResolution||r.resolution;t.ceil(s),t.width=Math.max(t.width,1/s),t.height=Math.max(t.height,1/s);const o=vr.create({width:t.width,height:t.height,resolution:s}),a=`cacheAsBitmap_${mr()}`;this._cacheData.textureCacheId=a,Z.addToCache(o.baseTexture,a),k.addToCache(o,a);const h=sd;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new ti(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(t.x/t.width),l.anchor.y=-(t.y/t.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};ct.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};ct.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};ct.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Z.removeFromCache(this._cacheData.textureCacheId),k.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};ct.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};ct.prototype.name=null;Bt.prototype.getChildByName=function(r,t){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===r)return this.children[e];if(t)for(let e=0,i=this.children.length;e<i;e++){const n=this.children[e];if(!n.getChildByName)continue;const s=n.getChildByName(r,!0);if(s)return s}return null};ct.prototype.getGlobalPosition=function(r=new K,t=!1){return this.parent?this.parent.toGlobal(this.position,r,t):(r.x=this.position.x,r.y=this.position.y),r};var hy=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class ly extends Tt{constructor(t=1){super(Q1,hy,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const cy={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},uy=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function dy(r){const t=cy[r],e=t.length;let i=uy,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<r;a++){let h=s.replace("%index%",a.toString());o=a,a>=e&&(o=r-a-1),h=h.replace("%value%",t[o].toString()),n+=h,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}const fy=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function py(r,t){const e=Math.ceil(r/2);let i=fy,n="",s;t?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<r;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(e-1)}.0`),n+=a,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}class ha extends Tt{constructor(t,e=8,i=4,n=Tt.defaultResolution,s=5){const o=py(s,t),a=dy(s);super(o,a),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,n);else{const s=t.getFilterTexture(),o=t.renderer;let a=e,h=s;this.state.blend=!1,t.applyFilter(this,a,h,ie.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,ie.BLIT),this.uniforms.uSampler=h;const c=h;h=a,a=c,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,i,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class my extends Tt{constructor(t=8,e=4,i=Tt.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new ha(!0,t,e,i,n),this.blurYFilter=new ha(!1,t,e,i,n),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,n){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,ie.CLEAR),this.blurYFilter.apply(t,a,i,n),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,i,n):this.blurXFilter.apply(t,e,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var gy=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class la extends Tt{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Ku,gy,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,n,s]=at.shared.setValue(t).toArray(),o=[i,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),s=Math.sqrt,o=1/3,a=s(o),h=i+(1-i)*o,l=o*(1-i)-a*n,c=o*(1-i)+a*n,u=o*(1-i)+a*n,d=i+o*(1-i),f=o*(1-i)-a*n,p=o*(1-i)-a*n,m=o*(1-i)+a*n,g=i+o*(1-i),y=[h,l,c,0,0,u,d,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const i=(t||0)+1,n=-.5*(i-1),s=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const i=t*2/3+1,n=(i-1)*-.5,s=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,n,s){t=t||.2,e=e||.15,i=i||16770432,n=n||3375104;const o=at.shared,[a,h,l]=o.setValue(i).toArray(),[c,u,d]=o.setValue(n).toArray(),f=[.3,.59,.11,0,0,a,h,l,t,0,c,u,d,e,0,a-c,h-u,l-d,0,0];this._loadMatrix(f,s)}night(t,e){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}la.prototype.grayscale=la.prototype.greyscale;var yy=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,_y=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class vy extends Tt{constructor(t,e){const i=new ot;t.renderable=!1,super(_y,yy,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,e==null&&(e=20),this.scale=new K(e,e)}apply(t,e,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,o=Math.sqrt(s.a*s.a+s.b*s.b),a=Math.sqrt(s.c*s.c+s.d*s.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=s.a/o,this.uniforms.rotation[1]=s.b/o,this.uniforms.rotation[2]=s.c/a,this.uniforms.rotation[3]=s.d/a),t.applyFilter(this,e,i,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var xy=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,by=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class wy extends Tt{constructor(){super(by,xy)}}var Ty=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class Ay extends Tt{constructor(t=.5,e=Math.random()){super(Ku,Ty,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Il={AlphaFilter:ly,BlurFilter:my,BlurFilterPass:ha,ColorMatrixFilter:la,DisplacementFilter:vy,FXAAFilter:wy,NoiseFilter:Ay};Object.entries(Il).forEach(([r,t])=>{Object.defineProperty(Il,r,{get(){return J("7.1.0",`filters.${r} has moved to ${r}`),t}})});class Ey{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Rt.system.add(this.tickerUpdate,this,gr.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Rt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Le=new Ey;class Ui{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Ui.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new K,this.page=new K,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Kn extends Ui{constructor(){super(...arguments),this.client=new K,this.movement=new K,this.offset=new K,this.global=new K,this.screen=new K}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,s,o,a,h,l,c,u,d,f,p,m){throw new Error("Method not implemented.")}}class Ht extends Kn{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class zr extends Kn{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}zr.DOM_DELTA_PIXEL=0,zr.DOM_DELTA_LINE=1,zr.DOM_DELTA_PAGE=2;const Sy=2048,Cy=new K,ao=new K;class Iy{constructor(t){this.dispatch=new Oi,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,n=e.length;i<n;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Le.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[i](this.rootTarget,this.rootTarget.eventMode,Cy.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=i.length-1;n<s;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let s=i.length-1;s>=0;s--)n.forEach(o=>{t.currentTarget=i[s],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let i=0;i<Sy&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,n,s,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Le.pauseUpdate=!1),t.interactiveChildren&&t.children){const c=t.children;for(let u=c.length-1;u>=0;u--){const d=c[u],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,n,s,o||s(t,i));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const h=this._isInteractive(e),l=t.isInteractive();return l&&l&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:h&&!s(t,i)&&n(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,n,s){if(this._interactivePrune(t)||s(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Le.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const c=h[l],u=this.hitTestRecursive(c,this._isInteractive(e)?e:c.eventMode,i,n,s);if(u){if(u.length>0&&!u[u.length-1].parent)continue;const d=t.isInteractive();return(u.length>0||d)&&u.push(t),u}}}const o=this._isInteractive(e),a=t.isInteractive();return o&&n(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var i;if(t.hitArea&&(t.worldTransform.applyInverse(e,ao),!t.hitArea.contains(ao.x,ao.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var s,o;e=e??t.type;const i=`on${e}`;(o=(s=t.currentTarget)[i])==null||o.call(s,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Ht)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var h,l;if(!(t instanceof Ht)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(((h=n.overTargets)==null?void 0:h.length)>0&&s!==e.target){const c=t.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(t,c,s);if(this.dispatchEvent(u,"pointerout"),i&&this.dispatchEvent(u,"mouseout"),!e.composedPath().includes(s)){const d=this.createPointerEvent(t,"pointerleave",s);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(s!==e.target){const c=t.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(e,c);this.dispatchEvent(u,"pointerover"),i&&this.dispatchEvent(u,"mouseover");let d=s==null?void 0:s.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const f=this.clonePointerEvent(e,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==s&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),i&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(u)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(l=e.target)==null?void 0:l.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var o;if(!(t instanceof Ht)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(o=i.target)==null?void 0:o.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Ht)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Ht)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=s;if(s&&!i.composedPath().includes(s)){let a=s;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const h=i.button===2;this.notifyTarget(i,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const h=n.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){const l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Ht)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let s=i;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof zr)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const n=this.allocateEvent(Ht);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(zr);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Ht);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Ht&&e instanceof Ht&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Kn&&e instanceof Kn&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let n=0,s=i.length;n<s&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeListener(e,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,t)}}const Py=1,Ry={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ca=class ua{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Iy(null),Le.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Ht(null),this.rootWheelEvent=new zr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...ua.defaultEventFeatures},{set:(e,i,n)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),e[i]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,ua._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,n=e.length;i<n;i++){const s=e[i],o=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Le.pointerMoved();const e=this.normalizeToPointerData(t);for(let i=0,n=e.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,o=n.length;s<o;s++){const a=this.bootstrapEvent(this.rootPointerEvent,n[s]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let i=0,n=e.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Le.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Le.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Le.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(i-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const s=t.changedTouches[i];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=Py),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Ry[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};ca.extension={name:"events",type:[U.RendererSystem,U.CanvasRendererSystem]},ca.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let da=ca;$.add(da);function Pl(r){return r==="dynamic"||r==="static"}const My={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Pl(da.defaultEventMode)},set interactive(r){J("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??da.defaultEventMode},set eventMode(r){this._internalInteractive=Pl(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.on(r,t,n)},removeEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,n)},dispatchEvent(r){if(!(r instanceof Ui))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};ct.mixin(My);const Fy={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ct.mixin(Fy);const By=9,on=100,Dy=0,Ly=0,Rl=2,Ml=1,Ny=-1e3,Oy=-1e3,ky=2;class od{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(be.tablet||be.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${on}px`,e.style.height=`${on}px`,e.style.position="absolute",e.style.top=`${Dy}px`,e.style.left=`${Ly}px`,e.style.zIndex=Rl.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Ml}px`,t.style.height=`${Ml}px`,t.style.position="absolute",t.style.top=`${Ny}px`,t.style.left=`${Oy}px`,t.style.zIndex=ky.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(be.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:h}=this.renderer,l=n/o*h,c=s/a*h;let u=this.div;u.style.left=`${e}px`,u.style.top=`${i}px`,u.style.width=`${o}px`,u.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,Gr(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{u=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(u.style.left=`${(m.tx+p.x*m.a)*l}px`,u.style.top=`${(m.ty+p.y*m.d)*c}px`,u.style.width=`${p.width*m.a*l}px`,u.style.height=`${p.height*m.d*c}px`):(p=f.getBounds(),this.capHitArea(p),u.style.left=`${p.x*l}px`,u.style.top=`${p.y*c}px`,u.style.width=`${p.width*l}px`,u.style.height=`${p.height*c}px`,u.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(u.title=f.accessibleTitle),u.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&u.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==u.title||f.tabIndex!==u.tabIndex)&&(u.title=f.accessibleTitle,u.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${on}px`,e.style.height=`${on}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Rl.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new Ui(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>n.dispatchEvent(s,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===By&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}od.extension={name:"accessibility",type:[U.RendererPlugin,U.CanvasRendererPlugin]};$.add(od);const ad=class fa{constructor(t){this.stage=new Bt,t=Object.assign({forceCanvas:!1},t),this.renderer=Zu(t),fa._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const i=fa._plugins.slice(0);i.reverse(),i.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};ad._plugins=[];let Uy=ad;$.handleByList(U.Application,Uy._plugins);class hd{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,i=s}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}hd.extension=U.Application;$.add(hd);const Fl={loader:U.LoadParser,resolver:U.ResolveParser,cache:U.CacheParser,detection:U.DetectionParser};$.handle(U.Asset,r=>{const t=r.ref;Object.entries(Fl).filter(([e])=>!!t[e]).forEach(([e,i])=>$.add(Object.assign(t[e],{extension:t[e].extension??i})))},r=>{const t=r.ref;Object.keys(Fl).filter(e=>!!t[e]).forEach(e=>$.remove(t[e]))});class Gy{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function ei(r,t){if(Array.isArray(t)){for(const e of t)if(r.startsWith(`data:${e}`))return!0;return!1}return r.startsWith(`data:${t}`)}function je(r,t){const e=r.split("?")[0],i=At.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const $t=(r,t,e=!1)=>(Array.isArray(r)||(r=[r]),t?r.map(i=>typeof i=="string"||e?t(i):i):r),pa=(r,t)=>{const e=t.split("?")[1];return e&&(r+=`?${e}`),r};function ld(r,t,e,i,n){const s=t[e];for(let o=0;o<s.length;o++){const a=s[o];e<t.length-1?ld(r.replace(i[e],a),t,e+1,i,n):n.push(r.replace(i[e],a))}}function Hy(r){const t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){const n=[];e.forEach(s=>{const o=s.substring(1,s.length-1).split(",");n.push(o)}),ld(r,n,0,e,i)}else i.push(r);return i}const Qn=r=>!Array.isArray(r);class zy{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=$t(t);let n;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.test(e)){n=h.getCacheableAssets(i,e);break}}n||(n={},i.forEach(a=>{n[a]=e}));const s=Object.keys(n),o={cacheKeys:s,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,o)}),s.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,n[a])}),e instanceof k){const a=e;i.forEach(h=>{a.baseTexture!==k.EMPTY.baseTexture&&Z.addToCache(a.baseTexture,h),k.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const ar=new zy;class $y{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var o,a;let n=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((o=l.test)!=null&&o.call(l,t,e,this))){s=l;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),i.parser=s;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((a=l.testParse)==null?void 0:a.call(l,n,e,this))&&(n=await l.parse(n,e,this)||n,i.parser=l)}return n})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const n={},s=Qn(t),o=$t(t,l=>({alias:[l],src:l})),a=o.length,h=o.map(async l=>{const c=At.toAbsolute(l.src);if(!n[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),n[l.src]=await this.promiseCache[c].promise,e&&e(++i/a)}catch(u){throw delete this.promiseCache[c],delete n[l.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(h),s?n[o[0].src]:n}async unload(t){const e=$t(t,i=>({alias:[i],src:i})).map(async i=>{var o,a;const n=At.toAbsolute(i.src),s=this.promiseCache[n];if(s){const h=await s.promise;delete this.promiseCache[n],(a=(o=s.parser)==null?void 0:o.unload)==null||a.call(o,h,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Yt=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(Yt||{});const Vy=".json",Xy="application/json",Wy={extension:{type:U.LoadParser,priority:Yt.Low},name:"loadJson",test(r){return ei(r,Xy)||je(r,Vy)},async load(r){return await(await H.ADAPTER.fetch(r)).json()}};$.add(Wy);const jy=".txt",Yy="text/plain",qy={name:"loadTxt",extension:{type:U.LoadParser,priority:Yt.Low},test(r){return ei(r,Yy)||je(r,jy)},async load(r){return await(await H.ADAPTER.fetch(r)).text()}};$.add(qy);const Zy=["normal","bold","100","200","300","400","500","600","700","800","900"],Ky=[".ttf",".otf",".woff",".woff2"],Qy=["font/ttf","font/otf","font/woff","font/woff2"],Jy=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function t_(r){const t=At.extname(r),e=At.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1));let i=e.length>0;for(const s of e)if(!s.match(Jy)){i=!1;break}let n=e.join(" ");return i||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const e_={extension:{type:U.LoadParser,priority:Yt.Low},name:"loadWebFont",test(r){return ei(r,Qy)||je(r,Ky)},async load(r,t){var i,n,s;const e=H.ADAPTER.getFontFaceSet();if(e){const o=[],a=((i=t.data)==null?void 0:i.family)??t_(r),h=((s=(n=t.data)==null?void 0:n.weights)==null?void 0:s.filter(c=>Zy.includes(c)))??["normal"],l=t.data??{};for(let c=0;c<h.length;c++){const u=h[c],d=new FontFace(a,`url(${encodeURI(r)})`,{...l,weight:u});await d.load(),e.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>H.ADAPTER.getFontFaceSet().delete(t))}};$.add(e_);let Bl=0,ho;const r_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",i_={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${r_}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},n_={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let lo;class s_{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([i_.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",n=>{i.terminate(),URL.revokeObjectURL(e),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){ho===void 0&&(ho=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<ho&&(lo||(lo=URL.createObjectURL(new Blob([n_.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(lo),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[Bl]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Bl++,id:i})}}const Dl=new s_;function Gi(r,t,e){r.resource.internal=!0;const i=new k(r),n=()=>{delete t.promiseCache[e],ar.has(e)&&ar.remove(e)};return i.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),i}const o_=[".jpeg",".jpg",".png",".webp",".avif"],a_=["image/jpeg","image/png","image/webp","image/avif"];async function h_(r){const t=await H.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const As={name:"loadTextures",extension:{type:U.LoadParser,priority:Yt.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return ei(r,a_)||je(r,o_)},async load(r,t,e){var a;const i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;i?this.config.preferWorkers&&await Dl.isImageBitmapSupported()?n=await Dl.loadImageBitmap(r):n=await h_(r):n=await new Promise((h,l)=>{const c=new Image;c.crossOrigin=this.config.crossOrigin,c.src=r,c.complete?h(c):(c.onload=()=>h(c),c.onerror=u=>l(u))});const s={...t.data};s.resolution??(s.resolution=Se(r)),i&&((a=s.resourceOptions)==null?void 0:a.ownsImageBitmap)===void 0&&(s.resourceOptions={...s.resourceOptions},s.resourceOptions.ownsImageBitmap=!0);const o=new Z(n,s);return o.resource.src=r,Gi(o,e,r)},unload(r){r.destroy(!0)}};$.add(As);const l_=".svg",c_="image/svg+xml",u_={extension:{type:U.LoadParser,priority:Yt.High},name:"loadSVG",test(r){return ei(r,c_)||je(r,l_)},async testParse(r){return na.test(r)},async parse(r,t,e){var s;const i=new na(r,(s=t==null?void 0:t.data)==null?void 0:s.resourceOptions);await i.load();const n=new Z(i,{resolution:Se(r),...t==null?void 0:t.data});return n.resource.src=t.src,Gi(n,e,t.src)},async load(r,t){return(await H.ADAPTER.fetch(r)).text()},unload:As.unload};$.add(u_);const d_=[".mp4",".m4v",".webm",".ogv"],f_=["video/mp4","video/webm","video/ogg"],p_={name:"loadVideo",extension:{type:U.LoadParser,priority:Yt.High},config:{defaultAutoPlay:!0},test(r){return ei(r,f_)||je(r,d_)},async load(r,t,e){var o;let i;const n=await(await H.ADAPTER.fetch(r)).blob(),s=URL.createObjectURL(n);try{const a={autoPlay:this.config.defaultAutoPlay,...(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions},h=new id(s,a);await h.load();const l=new Z(h,{alphaMode:await wg(),resolution:Se(r),...t==null?void 0:t.data});l.resource.src=r,i=Gi(l,e,r),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(s)})}catch(a){throw URL.revokeObjectURL(s),a}return i},unload(r){r.destroy(!0)}};$.add(p_);class m_{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,name:i,src:n,srcs:s}=t;return $t(e||i||n||s,o=>typeof o=="string"?o:Array.isArray(o)?o.map(a=>(a==null?void 0:a.src)??(a==null?void 0:a.srcs)??a):o!=null&&o.src||o!=null&&o.srcs?o.src??o.srcs:o,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(n=>{const s=n.src??n.srcs,o=n.alias??n.name;let a;if(typeof o=="string"){const h=this._createBundleAssetId(t,o);i.push(h),a=[o,h]}else{const h=o.map(l=>this._createBundleAssetId(t,l));i.push(...h),a=[...o,...h]}this.add({...n,alias:a,src:s})}):Object.keys(e).forEach(n=>{const s=[n,this._createBundleAssetId(t,n)];if(typeof e[n]=="string")this.add({alias:s,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:s,src:e[n]});else{const o=e[n],a=o.src??o.srcs;this.add({...o,alias:s,src:Array.isArray(a)?a:[a]})}i.push(...s)}),this._bundles[t]=i}add(t,e,i,n,s){const o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(J("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:i,format:n,loadParser:s})):Array.isArray(t)?o.push(...t):o.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},$t(o).forEach(h=>{const{src:l,srcs:c}=h;let{data:u,format:d,loadParser:f}=h;const p=$t(l||c).map(y=>typeof y=="string"?Hy(y):Array.isArray(y)?y:[y]),m=this.getAlias(h);Array.isArray(m)?m.forEach(a):a(m);const g=[];p.forEach(y=>{y.forEach(v=>{let _={};if(typeof v!="object"){_.src=v;for(let x=0;x<this._parsers.length;x++){const w=this._parsers[x];if(w.test(v)){_=w.parse(v);break}}}else u=v.data??u,d=v.format??d,f=v.loadParser??f,_={..._,...v};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${_.src}`);_=this.buildResolvedAsset(_,{aliases:m,data:u,format:d,loadParser:f}),g.push(_)})}),m.forEach(y=>{this._assetMap[y]=g})})}resolveBundle(t){const e=Qn(t);t=$t(t);const i={};return t.forEach(n=>{const s=this._bundles[n];if(s){const o=this.resolve(s),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(n,h)]=l}i[n]=a}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const n in e)i[n]=e[n].src;return i}return e.src}resolve(t){const e=Qn(t);t=$t(t);const i={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const o=s[0],a=this._getPreferredOrder(s);a==null||a.priority.forEach(h=>{a.params[h].forEach(l=>{const c=s.filter(u=>u[h]?u[h]===l:!1);c.length&&(s=c)})}),this._resolverHash[n]=s[0]??o}else this._resolverHash[n]=this.buildResolvedAsset({alias:[n],src:n},{});i[n]=this._resolverHash[n]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:i,data:n,loadParser:s,format:o}=e;return(this._basePath||this._rootPath)&&(t.src=At.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.format=o??t.src.split(".").pop(),t.srcs=t.src,t.name=t.alias,t}}class g_{constructor(){this._detections=[],this._initialized=!1,this.resolver=new m_,this.loader=new $y,this.cache=ar,this._backgroundLoader=new Gy(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var s,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=((s=t.texturePreference)==null?void 0:s.resolution)??1,i=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,n,s){this.resolver.add(t,e,i,n,s)}async load(t,e){this._initialized||await this.init();const i=Qn(t),n=$t(t).map(a=>{if(typeof a!="string"){const h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),s=this.resolver.resolve(n),o=await this._mapLoadToResolve(s,e);return i?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},o=Object.keys(n);let a=0,h=0;const l=()=>{e==null||e(++a/h)},c=o.map(u=>{const d=n[u];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{s[u]=f})});return await Promise.all(c),i?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ar.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=ar.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(i,e);this._backgroundLoader.active=!0;const o={};return i.forEach((a,h)=>{const l=s[a.src],c=[a.src];a.alias&&c.push(...a.alias),o[n[h]]=l,ar.set(c,l)}),o}async unload(t){this._initialized||await this.init();const e=$t(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=$t(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{ar.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,n)=>e.indexOf(i)===n),e}get detections(){return this._detections}get preferWorkers(){return As.config.preferWorkers}set preferWorkers(t){J("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const an=new g_;$.handleByList(U.LoadParser,an.loader.parsers).handleByList(U.ResolveParser,an.resolver.parsers).handleByList(U.CacheParser,an.cache.parsers).handleByList(U.DetectionParser,an.detections);const y_={extension:U.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof k),getCacheableAssets:(r,t)=>{const e={};return r.forEach(i=>{t.forEach((n,s)=>{e[i+(s===0?"":s+1)]=n})}),e}};$.add(y_);const __={extension:{type:U.DetectionParser,priority:1},test:async()=>{const r="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=";return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r})},add:async r=>[...r,"avif"],remove:async r=>r.filter(t=>t!=="avif")};$.add(__);const v_={extension:{type:U.DetectionParser,priority:0},test:async()=>{const r="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=";return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r})},add:async r=>[...r,"webp"],remove:async r=>r.filter(t=>t!=="webp")};$.add(v_);const Ll=["png","jpg","jpeg"],x_={extension:{type:U.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...Ll],remove:async r=>r.filter(t=>!Ll.includes(t))};$.add(x_);const b_="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function eh(r){return b_?!1:document.createElement("video").canPlayType(r)!==""}const w_={extension:{type:U.DetectionParser,priority:0},test:async()=>eh("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(t=>t!=="webm")};$.add(w_);const T_={extension:{type:U.DetectionParser,priority:0},test:async()=>eh("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(t=>t!=="mp4"&&t!=="m4v")};$.add(T_);const A_={extension:{type:U.DetectionParser,priority:0},test:async()=>eh("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(t=>t!=="ogv")};$.add(A_);const E_={extension:U.ResolveParser,test:As.test,parse:r=>{var t;return{resolution:parseFloat(((t=H.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:r.split(".").pop(),src:r}}};$.add(E_);var It=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r))(It||{});const Jn={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let _e,Ir;function Nl(){Ir={s3tc:_e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:_e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:_e.getExtension("WEBGL_compressed_texture_etc"),etc1:_e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:_e.getExtension("WEBGL_compressed_texture_pvrtc")||_e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:_e.getExtension("WEBGL_compressed_texture_atc"),astc:_e.getExtension("WEBGL_compressed_texture_astc")}}const S_={extension:{type:U.DetectionParser,priority:2},test:async()=>{const r=H.ADAPTER.createCanvas().getContext("webgl");return r?(_e=r,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{Ir||Nl();const t=[];for(const e in Ir)Ir[e]&&t.push(e);return[...t,...r]},remove:async r=>(Ir||Nl(),r.filter(t=>!(t in Ir)))};$.add(S_);class C_ extends _s{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,n;typeof t=="string"?(i=t,n=new Uint8Array):(i=null,n=t),super(n,e),this.origin=i,this.buffer=n?new Xo(n):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Xo(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class dr extends C_{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=dr._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||dr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let s=0,o=this.levels;s<o;s++){const{levelID:a,levelWidth:h,levelHeight:l,levelBuffer:c}=this._levelBuffers[s];n.compressedTexImage2D(n.TEXTURE_2D,a,this.format,h,l,0,c)}return!0}onBlobLoaded(){this._levelBuffers=dr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,n,s,o,a){const h=new Array(i);let l=t.byteOffset,c=o,u=a,d=c+n-1&~(n-1),f=u+s-1&~(s-1),p=d*f*Jn[e];for(let m=0;m<i;m++)h[m]={levelID:m,levelWidth:i>1?c:d,levelHeight:i>1?u:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,c=c>>1||1,u=u>>1||1,d=c+n-1&~(n-1),f=u+s-1&~(s-1),p=d*f*Jn[e];return h}}const co=4,hn=124,I_=32,Ol=20,P_=542327876,ln={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},R_={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},cn={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},M_=1,F_=2,B_=4,D_=64,L_=512,N_=131072,O_=827611204,k_=861165636,U_=894720068,G_=808540228,H_=4,z_={[O_]:It.COMPRESSED_RGBA_S3TC_DXT1_EXT,[k_]:It.COMPRESSED_RGBA_S3TC_DXT3_EXT,[U_]:It.COMPRESSED_RGBA_S3TC_DXT5_EXT},$_={70:It.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:It.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:It.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:It.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:It.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:It.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:It.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:It.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:It.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function V_(r){const t=new Uint32Array(r);if(t[0]!==P_)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(r,0,hn/Uint32Array.BYTES_PER_ELEMENT),i=e[ln.HEIGHT],n=e[ln.WIDTH],s=e[ln.MIPMAP_COUNT],o=new Uint32Array(r,ln.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,I_/Uint32Array.BYTES_PER_ELEMENT),a=o[M_];if(a&B_){const h=o[R_.FOURCC];if(h!==G_){const v=z_[h],_=co+hn,x=new Uint8Array(r,_);return[new dr(x,{format:v,width:n,height:i,levels:s})]}const l=co+hn,c=new Uint32Array(t.buffer,l,Ol/Uint32Array.BYTES_PER_ELEMENT),u=c[cn.DXGI_FORMAT],d=c[cn.RESOURCE_DIMENSION],f=c[cn.MISC_FLAG],p=c[cn.ARRAY_SIZE],m=$_[u];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${u}`);if(f===H_)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const g=new Array,y=co+hn+Ol;if(p===1)g.push(new Uint8Array(r,y));else{const v=Jn[m];let _=0,x=n,w=i;for(let T=0;T<s;T++){const S=Math.max(1,x+3&-4),F=Math.max(1,w+3&-4),O=S*F*v;_+=O,x=x>>>1,w=w>>>1}let C=y;for(let T=0;T<p;T++)g.push(new Uint8Array(r,C,_)),C+=_}return g.map(v=>new dr(v,{format:m,width:n,height:i,levels:s}))}throw a&D_?new Error("DDSParser does not support uncompressed texture data."):a&L_?new Error("DDSParser does not supported YUV uncompressed texture data."):a&N_?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&F_?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const kl=[171,75,84,88,32,49,49,187,13,10,26,10],X_=67305985,Ut={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},ma=64,Ul={[X.UNSIGNED_BYTE]:1,[X.UNSIGNED_SHORT]:2,[X.INT]:4,[X.UNSIGNED_INT]:4,[X.FLOAT]:4,[X.HALF_FLOAT]:8},W_={[D.RGBA]:4,[D.RGB]:3,[D.RG]:2,[D.RED]:1,[D.LUMINANCE]:1,[D.LUMINANCE_ALPHA]:2,[D.ALPHA]:1},j_={[X.UNSIGNED_SHORT_4_4_4_4]:2,[X.UNSIGNED_SHORT_5_5_5_1]:2,[X.UNSIGNED_SHORT_5_6_5]:2};function Y_(r,t,e=!1){const i=new DataView(t);if(!q_(r,i))return null;const n=i.getUint32(Ut.ENDIANNESS,!0)===X_,s=i.getUint32(Ut.GL_TYPE,n),o=i.getUint32(Ut.GL_FORMAT,n),a=i.getUint32(Ut.GL_INTERNAL_FORMAT,n),h=i.getUint32(Ut.PIXEL_WIDTH,n),l=i.getUint32(Ut.PIXEL_HEIGHT,n)||1,c=i.getUint32(Ut.PIXEL_DEPTH,n)||1,u=i.getUint32(Ut.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=i.getUint32(Ut.NUMBER_OF_FACES,n),f=i.getUint32(Ut.NUMBER_OF_MIPMAP_LEVELS,n),p=i.getUint32(Ut.BYTES_OF_KEY_VALUE_DATA,n);if(l===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const m=4,g=4,y=h+3&-4,v=l+3&-4,_=new Array(u);let x=h*l;s===0&&(x=y*v);let w;if(s!==0?Ul[s]?w=Ul[s]*W_[o]:w=j_[s]:w=Jn[a],w===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const C=e?K_(i,p,n):null;let T=x*w,S=h,F=l,O=y,N=v,B=ma+p;for(let A=0;A<f;A++){const b=i.getUint32(B,n);let I=B+4;for(let E=0;E<u;E++){let R=_[E];R||(R=_[E]=new Array(f)),R[A]={levelID:A,levelWidth:f>1||s!==0?S:O,levelHeight:f>1||s!==0?F:N,levelBuffer:new Uint8Array(t,I,T)},I+=T}B+=b+4,B=B%4!==0?B+4-B%4:B,S=S>>1||1,F=F>>1||1,O=S+m-1&~(m-1),N=F+g-1&~(g-1),T=O*N*w}return s!==0?{uncompressed:_.map(A=>{let b=A[0].levelBuffer,I=!1;return s===X.FLOAT?b=new Float32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4):s===X.UNSIGNED_INT?(I=!0,b=new Uint32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4)):s===X.INT&&(I=!0,b=new Int32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4)),{resource:new _s(b,{width:A[0].levelWidth,height:A[0].levelHeight}),type:s,format:I?Z_(o):o}}),kvData:C}:{compressed:_.map(A=>new dr(null,{format:a,width:h,height:l,levels:f,levelBuffers:A})),kvData:C}}function q_(r,t){for(let e=0;e<kl.length;e++)if(t.getUint8(e)!==kl[e])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function Z_(r){switch(r){case D.RGBA:return D.RGBA_INTEGER;case D.RGB:return D.RGB_INTEGER;case D.RG:return D.RG_INTEGER;case D.RED:return D.RED_INTEGER;default:return r}}function K_(r,t,e){const i=new Map;let n=0;for(;n<t;){const s=r.getUint32(ma+n,e),o=ma+n+4,a=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<s&&r.getUint8(o+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(r.buffer,o,h)),c=new DataView(r.buffer,o+h+1,s-h-1);i.set(l,c),n+=4+s+a}return i}const Q_={extension:{type:U.LoadParser,priority:Yt.High},name:"loadDDS",test(r){return je(r,".dds")},async load(r,t,e){const i=await(await H.ADAPTER.fetch(r)).arrayBuffer(),n=V_(i).map(s=>{const o=new Z(s,{mipmap:ue.OFF,alphaMode:Et.NO_PREMULTIPLIED_ALPHA,resolution:Se(r),...t.data});return Gi(o,e,r)});return n.length===1?n[0]:n},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};$.add(Q_);const J_={extension:{type:U.LoadParser,priority:Yt.High},name:"loadKTX",test(r){return je(r,".ktx")},async load(r,t,e){const i=await(await H.ADAPTER.fetch(r)).arrayBuffer(),{compressed:n,uncompressed:s,kvData:o}=Y_(r,i),a=n??s,h={mipmap:ue.OFF,alphaMode:Et.NO_PREMULTIPLIED_ALPHA,resolution:Se(r),...t.data},l=a.map(c=>{a===s&&Object.assign(h,{type:c.type,format:c.format});const u=c.resource??c,d=new Z(u,h);return d.ktxKeyValueData=o,Gi(d,e,r)});return l.length===1?l[0]:l},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};$.add(J_);const tv={extension:U.ResolveParser,test:r=>{const t=r.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(t)},parse:r=>{var t,e;if(r.split("?")[0].split(".").pop()==="ktx"){const i=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(i.some(n=>r.endsWith(n)))return{resolution:parseFloat(((t=H.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:i.find(n=>r.endsWith(n)),src:r}}return{resolution:parseFloat(((e=H.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:r.split(".").pop(),src:r}}};$.add(tv);const un=new Y,ev=4,cd=class yi{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,n){const s=new Image;return s.src=await this.base64(t,e,i,n),s}async base64(t,e,i,n){const s=this.canvas(t,n);if(s.toBlob!==void 0)return new Promise((o,a)=>{s.toBlob(h=>{if(!h){a(new Error("ICanvas.toBlob failed!"));return}const l=new FileReader;l.onload=()=>o(l.result),l.onerror=a,l.readAsDataURL(h)},e,i)});if(s.toDataURL!==void 0)return s.toDataURL(e,i);if(s.convertToBlob!==void 0){const o=await s.convertToBlob({type:e,quality:i});return new Promise((a,h)=>{const l=new FileReader;l.onload=()=>a(l.result),l.onerror=h,l.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:i,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);o&&yi._flipY(i,n,s),a&&yi._unpremultiplyAlpha(i);const h=new kg(n,s,1),l=new ImageData(new Uint8ClampedArray(i.buffer),n,s);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){const{pixels:i,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);return o&&yi._flipY(i,n,s),a&&yi._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let n,s=!1,o=!1,a,h=!1;t&&(t instanceof vr?a=t:(a=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),h=!0,e&&(un.width=e.width,un.height=e.height,e=un)));const l=i.gl;if(a){if(n=a.baseTexture.resolution,e=e??a.frame,s=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===D.RGBA,!h){i.renderTexture.bind(a);const f=a.framebuffer.glFramebuffers[i.CONTEXT_UID];f.blitFramebuffer&&i.framebuffer.bind(f.blitFramebuffer)}}else n=i.resolution,e||(e=un,e.width=i.width/n,e.height=i.height/n),s=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();const c=Math.max(Math.round(e.width*n),1),u=Math.max(Math.round(e.height*n),1),d=new Uint8Array(ev*c*u);return l.readPixels(Math.round(e.x*n),Math.round(e.y*n),c,u,l.RGBA,l.UNSIGNED_BYTE,d),h&&(a==null||a.destroy(!0)),{pixels:d,width:c,height:u,flipY:s,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,i){const n=e<<2,s=i>>1,o=new Uint8Array(n);for(let a=0;a<s;a++){const h=a*n,l=(i-a-1)*n;o.set(t.subarray(h,h+n)),t.copyWithin(h,l,l+n),t.set(o,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const n=t[i+3];if(n!==0){const s=255.001/n;t[i]=t[i]*s+.5,t[i+1]=t[i+1]*s+.5,t[i+2]=t[i+2]*s+.5}}}};cd.extension={name:"extract",type:U.RendererSystem};let rv=cd;$.add(rv);const ts={build(r){const t=r.points;let e,i,n,s,o,a;if(r.type===xt.CIRC){const p=r.shape;e=p.x,i=p.y,o=a=p.radius,n=s=0}else if(r.type===xt.ELIP){const p=r.shape;e=p.x,i=p.y,o=p.width,a=p.height,n=s=0}else{const p=r.shape,m=p.width/2,g=p.height/2;e=p.x+m,i=p.y+g,o=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),n=m-o,s=g-a}if(!(o>=0&&a>=0&&n>=0&&s>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(n?4:0)+(s?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=i+s,t[2]=t[4]=e-n,t[5]=t[7]=i-s;return}let c=0,u=h*4+(n?2:0)+2,d=u,f=l;{const p=n+o,m=s,g=e+p,y=e-p,v=i+m;if(t[c++]=g,t[c++]=v,t[--u]=v,t[--u]=y,s){const _=i-m;t[d++]=y,t[d++]=_,t[--f]=_,t[--f]=g}}for(let p=1;p<h;p++){const m=Math.PI/2*(p/h),g=n+Math.cos(m)*o,y=s+Math.sin(m)*a,v=e+g,_=e-g,x=i+y,w=i-y;t[c++]=v,t[c++]=x,t[--u]=x,t[--u]=_,t[d++]=_,t[d++]=w,t[--f]=w,t[--f]=v}{const p=n,m=s+a,g=e+p,y=e-p,v=i+m,_=i-m;t[c++]=g,t[c++]=v,t[--f]=_,t[--f]=g,n&&(t[c++]=y,t[c++]=v,t[--f]=_,t[--f]=y)}},triangulate(r,t){const e=r.points,i=t.points,n=t.indices;if(e.length===0)return;let s=i.length/2;const o=s;let a,h;if(r.type!==xt.RREC){const c=r.shape;a=c.x,h=c.y}else{const c=r.shape;a=c.x+c.width/2,h=c.y+c.height/2}const l=r.matrix;i.push(r.matrix?l.a*a+l.c*h+l.tx:a,r.matrix?l.b*a+l.d*h+l.ty:h),s++,i.push(e[0],e[1]);for(let c=2;c<e.length;c+=2)i.push(e[c],e[c+1]),n.push(s++,o,s);n.push(o+1,o,s)}};function Gl(r,t=!1){const e=r.length;if(e<6)return;let i=0;for(let n=0,s=r[e-2],o=r[e-1];n<e;n+=2){const a=r[n],h=r[n+1];i+=(a-s)*(h+o),s=a,o=h}if(!t&&i>0||t&&i<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const o=e-s-2,a=e-s-1,h=s,l=s+1;[r[o],r[h]]=[r[h],r[o]],[r[a],r[l]]=[r[l],r[a]]}}}const ud={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points;const i=r.holes,n=t.points,s=t.indices;if(e.length>=6){Gl(e,!1);const o=[];for(let l=0;l<i.length;l++){const c=i[l];Gl(c.points,!0),o.push(e.length/2),e=e.concat(c.points)}const a=m0(e,o,2);if(!a)return;const h=n.length/2;for(let l=0;l<a.length;l+=3)s.push(a[l]+h),s.push(a[l+1]+h),s.push(a[l+2]+h);for(let l=0;l<e.length;l++)n.push(e[l])}}},iv={build(r){const t=r.shape,e=t.x,i=t.y,n=t.width,s=t.height,o=r.points;o.length=0,n>=0&&s>=0&&o.push(e,i,e+n,i,e+n,i+s,e,i+s)},triangulate(r,t){const e=r.points,i=t.points;if(e.length===0)return;const n=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},nv={build(r){ts.build(r)},triangulate(r,t){ts.triangulate(r,t)}};var Lt=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(Lt||{}),ke=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(ke||{});const Yr={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Hl{static curveTo(t,e,i,n,s,o){const a=o[o.length-2],h=o[o.length-1]-e,l=a-t,c=n-e,u=i-t,d=Math.abs(h*u-l*c);if(d<1e-8||s===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const f=h*h+l*l,p=c*c+u*u,m=h*c+l*u,g=s*Math.sqrt(f)/d,y=s*Math.sqrt(p)/d,v=g*m/f,_=y*m/p,x=g*u+y*l,w=g*c+y*h,C=l*(y+v),T=h*(y+v),S=u*(g+_),F=c*(g+_),O=Math.atan2(T-w,C-x),N=Math.atan2(F-w,S-x);return{cx:x+t,cy:w+e,radius:s,startAngle:O,endAngle:N,anticlockwise:l*c>u*h}}static arc(t,e,i,n,s,o,a,h,l){const c=a-o,u=Yr._segmentsCount(Math.abs(c)*s,Math.ceil(Math.abs(c)/Xn)*40),d=c/(u*2),f=d*2,p=Math.cos(d),m=Math.sin(d),g=u-1,y=g%1/g;for(let v=0;v<=g;++v){const _=v+y*v,x=d+o+f*_,w=Math.cos(x),C=-Math.sin(x);l.push((p*w+m*C)*s+i,(p*-C+m*w)*s+n)}}}class sv{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class rh{static curveLength(t,e,i,n,s,o,a,h){let l=0,c=0,u=0,d=0,f=0,p=0,m=0,g=0,y=0,v=0,_=0,x=t,w=e;for(let C=1;C<=10;++C)c=C/10,u=c*c,d=u*c,f=1-c,p=f*f,m=p*f,g=m*t+3*p*c*i+3*f*u*s+d*a,y=m*e+3*p*c*n+3*f*u*o+d*h,v=x-g,_=w-y,x=g,w=y,l+=Math.sqrt(v*v+_*_);return l}static curveTo(t,e,i,n,s,o,a){const h=a[a.length-2],l=a[a.length-1];a.length-=2;const c=Yr._segmentsCount(rh.curveLength(h,l,t,e,i,n,s,o));let u=0,d=0,f=0,p=0,m=0;a.push(h,l);for(let g=1,y=0;g<=c;++g)y=g/c,u=1-y,d=u*u,f=d*u,p=y*y,m=p*y,a.push(f*h+3*d*y*t+3*u*p*i+m*s,f*l+3*d*y*e+3*u*p*n+m*o)}}function zl(r,t,e,i,n,s,o,a){const h=r-e*n,l=t-i*n,c=r+e*s,u=t+i*s;let d,f;o?(d=i,f=-e):(d=-i,f=e);const p=h+d,m=l+f,g=c+d,y=u+f;return a.push(p,m,g,y),2}function Ke(r,t,e,i,n,s,o,a){const h=e-r,l=i-t;let c=Math.atan2(h,l),u=Math.atan2(n-r,s-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=f/g;if(d+=y,a){o.push(r,t,e,i);for(let v=1,_=d;v<g;v++,_+=y)o.push(r,t,r+Math.sin(_)*m,t+Math.cos(_)*m);o.push(r,t,n,s)}else{o.push(e,i,r,t);for(let v=1,_=d;v<g;v++,_+=y)o.push(r+Math.sin(_)*m,t+Math.cos(_)*m,r,t);o.push(n,s,r,t)}return g*2}function ov(r,t){const e=r.shape;let i=r.points||e.points.slice();const n=t.closePointEps;if(i.length===0)return;const s=r.lineStyle,o=new K(i[0],i[1]),a=new K(i[i.length-2],i[i.length-1]),h=e.type!==xt.POLY||e.closeStroke,l=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(h){i=i.slice(),l&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const R=(o.x+a.x)*.5,L=(a.y+o.y)*.5;i.unshift(R,L),i.push(R,L)}const c=t.points,u=i.length/2;let d=i.length;const f=c.length/2,p=s.width/2,m=p*p,g=s.miterLimit*s.miterLimit;let y=i[0],v=i[1],_=i[2],x=i[3],w=0,C=0,T=-(v-x),S=y-_,F=0,O=0,N=Math.sqrt(T*T+S*S);T/=N,S/=N,T*=p,S*=p;const B=s.alignment,A=(1-B)*2,b=B*2;h||(s.cap===ke.ROUND?d+=Ke(y-T*(A-b)*.5,v-S*(A-b)*.5,y-T*A,v-S*A,y+T*b,v+S*b,c,!0)+2:s.cap===ke.SQUARE&&(d+=zl(y,v,T,S,A,b,!0,c))),c.push(y-T*A,v-S*A,y+T*b,v+S*b);for(let R=1;R<u-1;++R){y=i[(R-1)*2],v=i[(R-1)*2+1],_=i[R*2],x=i[R*2+1],w=i[(R+1)*2],C=i[(R+1)*2+1],T=-(v-x),S=y-_,N=Math.sqrt(T*T+S*S),T/=N,S/=N,T*=p,S*=p,F=-(x-C),O=_-w,N=Math.sqrt(F*F+O*O),F/=N,O/=N,F*=p,O*=p;const L=_-y,z=v-x,P=_-w,M=C-x,W=L*P+z*M,Q=z*P-M*L,q=Q<0;if(Math.abs(Q)<.001*Math.abs(W)){c.push(_-T*A,x-S*A,_+T*b,x+S*b),W>=0&&(s.join===Lt.ROUND?d+=Ke(_,x,_-T*A,x-S*A,_-F*A,x-O*A,c,!1)+4:d+=2,c.push(_-F*b,x-O*b,_+F*A,x+O*A));continue}const et=(-T+y)*(-S+x)-(-T+_)*(-S+v),rt=(-F+w)*(-O+x)-(-F+_)*(-O+C),it=(L*rt-P*et)/Q,nt=(M*et-z*rt)/Q,_t=(it-_)*(it-_)+(nt-x)*(nt-x),vt=_+(it-_)*A,ht=x+(nt-x)*A,dt=_-(it-_)*b,pt=x-(nt-x)*b,Zt=Math.min(L*L+z*z,P*P+M*M),Kt=q?A:b,ri=Zt+Kt*Kt*m,hf=_t<=ri;let $i=s.join;if($i===Lt.MITER&&_t/m>g&&($i=Lt.BEVEL),hf)switch($i){case Lt.MITER:{c.push(vt,ht,dt,pt);break}case Lt.BEVEL:{q?c.push(vt,ht,_+T*b,x+S*b,vt,ht,_+F*b,x+O*b):c.push(_-T*A,x-S*A,dt,pt,_-F*A,x-O*A,dt,pt),d+=2;break}case Lt.ROUND:{q?(c.push(vt,ht,_+T*b,x+S*b),d+=Ke(_,x,_+T*b,x+S*b,_+F*b,x+O*b,c,!0)+4,c.push(vt,ht,_+F*b,x+O*b)):(c.push(_-T*A,x-S*A,dt,pt),d+=Ke(_,x,_-T*A,x-S*A,_-F*A,x-O*A,c,!1)+4,c.push(_-F*A,x-O*A,dt,pt));break}}else{switch(c.push(_-T*A,x-S*A,_+T*b,x+S*b),$i){case Lt.MITER:{q?c.push(dt,pt,dt,pt):c.push(vt,ht,vt,ht),d+=2;break}case Lt.ROUND:{q?d+=Ke(_,x,_+T*b,x+S*b,_+F*b,x+O*b,c,!0)+2:d+=Ke(_,x,_-T*A,x-S*A,_-F*A,x-O*A,c,!1)+2;break}}c.push(_-F*A,x-O*A,_+F*b,x+O*b),d+=2}}y=i[(u-2)*2],v=i[(u-2)*2+1],_=i[(u-1)*2],x=i[(u-1)*2+1],T=-(v-x),S=y-_,N=Math.sqrt(T*T+S*S),T/=N,S/=N,T*=p,S*=p,c.push(_-T*A,x-S*A,_+T*b,x+S*b),h||(s.cap===ke.ROUND?d+=Ke(_-T*(A-b)*.5,x-S*(A-b)*.5,_-T*A,x-S*A,_+T*b,x+S*b,c,!1)+2:s.cap===ke.SQUARE&&(d+=zl(_,x,T,S,A,b,!1,c)));const I=t.indices,E=Yr.epsilon*Yr.epsilon;for(let R=f;R<d+f-2;++R)y=c[R*2],v=c[R*2+1],_=c[(R+1)*2],x=c[(R+1)*2+1],w=c[(R+2)*2],C=c[(R+2)*2+1],!(Math.abs(y*(x-C)+_*(C-v)+w*(v-x))<E)&&I.push(R,R+1,R+2)}function av(r,t){let e=0;const i=r.shape,n=r.points||i.points,s=i.type!==xt.POLY||i.closeStroke;if(n.length===0)return;const o=t.points,a=t.indices,h=n.length/2,l=o.length/2;let c=l;for(o.push(n[0],n[1]),e=1;e<h;e++)o.push(n[e*2],n[e*2+1]),a.push(c,c+1),c++;s&&a.push(c,l)}function $l(r,t){r.lineStyle.native?av(r,t):ov(r,t)}class ih{static curveLength(t,e,i,n,s,o){const a=t-2*i+s,h=e-2*n+o,l=2*i-2*t,c=2*n-2*e,u=4*(a*a+h*h),d=4*(a*l+h*c),f=l*l+c*c,p=2*Math.sqrt(u+d+f),m=Math.sqrt(u),g=2*u*m,y=2*Math.sqrt(f),v=d/m;return(g*p+m*d*(p-y)+(4*f*u-d*d)*Math.log((2*m+v+p)/(v+y)))/(4*g)}static curveTo(t,e,i,n,s){const o=s[s.length-2],a=s[s.length-1],h=Yr._segmentsCount(ih.curveLength(o,a,t,e,i,n));let l=0,c=0;for(let u=1;u<=h;++u){const d=u/h;l=o+(t-o)*d,c=a+(e-a)*d,s.push(l+(t+(i-t)*d-l)*d,c+(e+(n-e)*d-c)*d)}}}const uo={[xt.POLY]:ud,[xt.CIRC]:ts,[xt.ELIP]:ts,[xt.RECT]:iv,[xt.RREC]:nv},Vl=[],dn=[];class es{constructor(t,e=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new es(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Tr=new K,dd=class fd extends vu{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Zn,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),dn.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Vl.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,n=null){const s=new es(t,e,i,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new es(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=n.lineStyle,n.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const n=e[i];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,Tr):Tr.copyFrom(t),n.shape.contains(Tr.x,Tr.y))){let s=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(Tr.x,Tr.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,n=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],n=i.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;const l=e[h],c=l.fillStyle,u=l.lineStyle;uo[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(c.visible||u.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=d===0?c:u;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=Mt.REPEAT,d===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-g;y!==0&&(i&&!this._compareStyles(n,f)&&(i.end(m,g),i=null),i||(i=Vl.pop()||new sv,i.begin(f,m,g),this.batches.push(i),n=f),this.addUvs(this.points,t,f.texture,g,y,f.matrix))}}const s=this.indices.length,o=this.points.length/2;if(i&&i.end(s,o),this.batches.length===0){this.batchable=!0;return}const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const i=this.graphicsData[t],n=i.fillStyle,s=i.lineStyle;if(n&&!n.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const n=t[e];for(let s=0;s<n.size;s++){const o=n.start+s;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<fd.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++Z._globalBatch;for(let u=0;u<this.drawCalls.length;u++)this.drawCalls[u].texArray.clear(),dn.push(this.drawCalls[u]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let n=dn.pop();n||(n=new Yo,n.texArray=new Qo),n.texArray.count=0,n.start=0,n.size=0,n.type=oe.TRIANGLES;let s=0,o=null,a=0,h=!1,l=oe.TRIANGLES,c=0;this.drawCalls.push(n);for(let u=0;u<this.batches.length;u++){const d=this.batches[u],f=8,p=d.style,m=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,l=h?oe.LINES:oe.TRIANGLES,o=null,s=f,t++),o!==m&&(o=m,m._batchEnabled!==t&&(s===f&&(t++,s=0,n.size>0&&(n=dn.pop(),n||(n=new Yo,n.texArray=new Qo),this.drawCalls.push(n)),n.start=c,n.size=0,n.texArray.count=0,n.type=l),m.touched=1,m._batchEnabled=t,m._batchLocation=s,m.wrapMode=Mt.REPEAT,n.texArray.elements[n.texArray.count++]=m,s++)),n.size+=d.size,c+=d.size,a=m._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart)}Z._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,n=this.textureIds,s=new ArrayBuffer(t.length*3*4),o=new Float32Array(s),a=new Uint32Array(s);let h=0;for(let l=0;l<t.length/2;l++)o[h++]=t[l*2],o[h++]=t[l*2+1],o[h++]=e[l*2],o[h++]=e[l*2+1],a[h++]=i[l],o[h++]=n[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?ud.triangulate(t,this):uo[t.type].triangulate(t,this)}processLine(t){$l(t,this);for(let e=0;e<t.holes.length;e++)$l(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];uo[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const n=t[i*2],s=t[i*2+1];t[i*2]=e.a*n+e.c*s+e.tx,t[i*2+1]=e.b*n+e.d*s+e.ty}}addColors(t,e,i,n,s=0){const o=at.shared.setValue(e).toLittleEndianNumber(),a=at.shared.setValue(o).toPremultiplied(i);t.length=Math.max(t.length,s+n);for(let h=0;h<n;h++)t[s+h]=a}addTextureIds(t,e,i,n=0){t.length=Math.max(t.length,n+i);for(let s=0;s<i;s++)t[n+s]=e}addUvs(t,e,i,n,s,o=null){let a=0;const h=e.length,l=i.frame;for(;a<s;){let u=t[(n+a)*2],d=t[(n+a)*2+1];if(o){const f=o.a*u+o.c*d+o.tx;d=o.b*u+o.d*d+o.ty,u=f}a++,e.push(u/l.width,d/l.height)}const c=i.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(e,i,h,s)}adjustUvs(t,e,i,n){const s=e.baseTexture,o=1e-6,a=i+n*2,h=e.frame,l=h.width/s.width,c=h.height/s.height;let u=h.x/h.width,d=h.y/h.height,f=Math.floor(t[i]+o),p=Math.floor(t[i+1]+o);for(let m=i+2;m<a;m+=2)f=Math.min(f,Math.floor(t[m]+o)),p=Math.min(p,Math.floor(t[m+1]+o));u-=f,d-=p;for(let m=i;m<a;m+=2)t[m]=(t[m]+u)*l,t[m+1]=(t[m+1]+d)*c}};dd.BATCHABLE_SIZE=100;let hv=dd;class Es{constructor(){this.color=16777215,this.alpha=1,this.texture=k.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Es;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=k.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class nh extends Es{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ke.BUTT,this.join=Lt.MITER,this.miterLimit=10}clone(){const t=new nh;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ke.BUTT,this.join=Lt.MITER,this.miterLimit=10}}const fo={},ga=class In extends Bt{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Es,this._lineStyle=new nh,this._matrix=null,this._holeMode=!1,this.state=fe.for2d(),this._geometry=t||new hv,this._geometry.refCount++,this._transformID=-1,this._tintColor=new at(16777215),this.blendMode=j.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new In(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,n=.5,s=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:n,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:k.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ke.BUTT,join:Lt.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new ur,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new ur,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,n=i[i.length-2],s=i[i.length-1];return(n!==t||s!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,n){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),ih.curveTo(t,e,i,n,s),this}bezierCurveTo(t,e,i,n,s,o){return this._initCurve(),rh.curveTo(t,e,i,n,s,o,this.currentPath.points),this}arcTo(t,e,i,n,s){this._initCurve(t,e);const o=this.currentPath.points,a=Hl.curveTo(t,e,i,n,s,o);if(a){const{cx:h,cy:l,radius:c,startAngle:u,endAngle:d,anticlockwise:f}=a;this.arc(h,l,c,u,d,f)}return this}arc(t,e,i,n,s,o=!1){if(n===s)return this;if(!o&&s<=n?s+=Xn:o&&n<=s&&(n+=Xn),s-n===0)return this;const a=t+Math.cos(n)*i,h=e+Math.sin(n)*i,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-h);u<l&&d<l||c.push(a,h)}else this.moveTo(a,h),c=this.currentPath.points;return Hl.arc(a,h,t,e,i,n,s,o,c),this}beginFill(t=0,e){return this.beginTextureFill({texture:k.WHITE,color:t,alpha:e})}normalizeColor(t){const e=at.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:k.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,n){return this.drawShape(new Y(t,e,i,n))}drawRoundedRect(t,e,i,n,s){return this.drawShape(new bs(t,e,i,n,s))}drawCircle(t,e,i){return this.drawShape(new vs(t,e,i))}drawEllipse(t,e,i,n){return this.drawShape(new xs(t,e,i,n))}drawPolygon(...t){let e,i=!0;const n=t[0];n.points?(i=n.closeStroke,e=n.points):Array.isArray(t[0])?e=t[0]:e=t;const s=new ur(e);return s.closeStroke=i,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===xt.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let n=0;n<i;n++){const s=t.batches[n],o=s.style.color,a=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,s.start*2,s.size),c={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:at.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[n]=c}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,n=this.worldAlpha,s=e.uniforms,o=i.drawCalls;s.translationMatrix=this.transform.worldTransform,at.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let a=0,h=o.length;a<h;a++)this._renderDrawCallDirect(t,i.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:i,type:n,size:s,start:o}=e,a=i.count;for(let h=0;h<a;h++)t.texture.bind(i.elements[h],h);t.geometry.draw(n,s,o)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!fo[i]){const{maxTextures:n}=t.plugins[i],s=new Int32Array(n);for(let h=0;h<n;h++)s[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new ot,default:jt.from({uSamplers:s},!0)},a=t.plugins[i]._shader.program;fo[i]=new le(a,o)}e=fo[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:n,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,i,n,s)}containsPoint(t){return this.worldTransform.applyInverse(t,In._TEMP_POINT),this._geometry.containsPoint(In._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=at.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this._geometry.points,c=this.vertexData;let u=0;for(let d=0;d<l.length;d+=2){const f=l[d],p=l[d+1];c[u++]=i*f+s*p+a,c[u++]=o*p+n*f+h}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};ga.curves=Yr,ga._TEMP_POINT=new K;let Ci=ga;class lv{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const po=new K,Xl=new ur,pd=class md extends Bt{constructor(t,e,i,n=oe.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||fe.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=H.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===oe.TRIANGLES&&e.length<md.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,h=n.d,l=n.tx,c=n.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=e[d*2],p=e[d*2+1];u[d*2]=s*f+a*p+l,u[d*2+1]=o*f+h*p+c}if(this._roundPixels){const d=H.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new lv(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,po);const e=this.geometry.getBuffer("aVertexPosition").data,i=Xl.points,n=this.geometry.getIndex().data,s=n.length,o=this.drawMode===4?3:1;for(let a=0;a+2<s;a+=o){const h=n[a]*2,l=n[a+1]*2,c=n[a+2]*2;if(i[0]=e[h],i[1]=e[h+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[c],i[5]=e[c+1],Xl.contains(po.x,po.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};pd.BATCHABLE_SIZE=100;let qr=pd;class Hi extends Ge{constructor(t,e,i){super();const n=new ut(t),s=new ut(e,!0),o=new ut(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,X.FLOAT).addAttribute("aTextureCoord",s,2,!1,X.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var cv=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,uv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Zr extends le{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:ot.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||Te.from(uv,cv),i),this._colorDirty=!1,this.uvMatrix=new Bu(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new at(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;at.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class dv extends Hi{constructor(t=200,e,i=0){super(new Float32Array(e.length*4),new Float32Array(e.length*4),new Uint16Array((e.length-1)*6)),this.points=e,this._width=t,this.textureScale=i,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),i.data=new Float32Array(t.length*4),n.data=new Uint16Array((t.length-1)*6));const s=i.data,o=n.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;let a=0,h=t[0];const l=this._width*this.textureScale,c=t.length;for(let d=0;d<c;d++){const f=d*4;if(this.textureScale>0){const p=h.x-t[d].x,m=h.y-t[d].y,g=Math.sqrt(p*p+m*m);h=t[d],a+=g/l}else a=d/(c-1);s[f]=a,s[f+1]=0,s[f+2]=a,s[f+3]=1}let u=0;for(let d=0;d<c-1;d++){const f=d*2;o[u++]=f,o[u++]=f+1,o[u++]=f+2,o[u++]=f+2,o[u++]=f+1,o[u++]=f+3}i.update(),n.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e=t[0],i,n=0,s=0;const o=this.buffers[0].data,a=t.length,h=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<a;l++){const c=t[l],u=l*4;l<t.length-1?i=t[l+1]:i=c,s=-(i.x-e.x),n=i.y-e.y;const d=Math.sqrt(n*n+s*s);d<1e-6?(n=0,s=0):(n/=d,s/=d,n*=h,s*=h),o[u]=c.x+n,o[u+1]=c.y+s,o[u+2]=c.x-n,o[u+3]=c.y-s,e=c}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class Wl extends qr{constructor(t,e,i=0){const n=new dv(t.height,e,i),s=new Zr(t);i>0&&(t.baseTexture.wrapMode=Mt.REPEAT),super(n,s),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}}class jl{constructor(t,e,i){this.geometry=new Ge,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||X.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new ut(Ng(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new ut(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=n,n+=a.size,this.staticStride+=a.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new ut(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===X.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===X.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,i){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,i,s.type===X.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,i,s.type===X.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var fv=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,pv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class gd extends ws{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new ot,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:X.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=le.from(pv,fv,{}),this.state=fe.for2d()}render(t){const e=t.children,i=t._maxSize,n=t._batchSize,s=this.renderer;let o=e.length;if(o===0)return;o>i&&!t.autoResize&&(o=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=gu(t.blendMode,l),s.state.set(this.state);const c=s.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=at.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=n,p+=1){let m=o-f;m>n&&(m=n),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const g=a[p];g.uploadDynamic(e,f,m);const y=t._bufferUpdateIDs[p]||0;d=d||g._updateID<y,d&&(g._updateID=t._updateID,g.uploadStatic(e,f,m)),s.geometry.bind(g.geometry),c.drawElements(c.TRIANGLES,m*6,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,n=t._batchSize,s=t._properties;for(let o=0;o<i;o+=n)e.push(new jl(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new jl(this.properties,i,e)}uploadVertices(t,e,i,n,s,o){let a=0,h=0,l=0,c=0;for(let u=0;u<i;++u){const d=t[e+u],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,y=f.orig;g?(h=g.x-d.anchor.x*y.width,a=h+g.width,c=g.y-d.anchor.y*y.height,l=c+g.height):(a=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),c=y.height*-d.anchor.y),n[o]=h*p,n[o+1]=c*m,n[o+s]=a*p,n[o+s+1]=c*m,n[o+s*2]=a*p,n[o+s*2+1]=l*m,n[o+s*3]=h*p,n[o+s*3+1]=l*m,o+=s*4}}uploadPosition(t,e,i,n,s,o){for(let a=0;a<i;a++){const h=t[e+a].position;n[o]=h.x,n[o+1]=h.y,n[o+s]=h.x,n[o+s+1]=h.y,n[o+s*2]=h.x,n[o+s*2+1]=h.y,n[o+s*3]=h.x,n[o+s*3+1]=h.y,o+=s*4}}uploadRotation(t,e,i,n,s,o){for(let a=0;a<i;a++){const h=t[e+a].rotation;n[o]=h,n[o+s]=h,n[o+s*2]=h,n[o+s*3]=h,o+=s*4}}uploadUvs(t,e,i,n,s,o){for(let a=0;a<i;++a){const h=t[e+a]._texture._uvs;h?(n[o]=h.x0,n[o+1]=h.y0,n[o+s]=h.x1,n[o+s+1]=h.y1,n[o+s*2]=h.x2,n[o+s*2+1]=h.y2,n[o+s*3]=h.x3,n[o+s*3+1]=h.y3,o+=s*4):(n[o]=0,n[o+1]=0,n[o+s]=0,n[o+s+1]=0,n[o+s*2]=0,n[o+s*2+1]=0,n[o+s*3]=0,n[o+s*3+1]=0,o+=s*4)}}uploadTint(t,e,i,n,s,o){for(let a=0;a<i;++a){const h=t[e+a],l=at.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);n[o]=l,n[o+s]=l,n[o+s*2]=l,n[o+s*3]=l,o+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}gd.extension={name:"particle",type:U.RendererPlugin};$.add(gd);var Ss=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(Ss||{});const fn={willReadFrequently:!0},ee=class V{static get experimentalLetterSpacingSupported(){let t=V._experimentalLetterSpacingSupported;if(t!==void 0){const e=H.ADAPTER.getCanvasRenderingContext2D().prototype;t=V._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,n,s,o,a,h,l){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=s,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,i,n=V._canvas){i=i??e.wordWrap;const s=e.toFontString(),o=V.measureFont(s);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const a=n.getContext("2d",fn);a.font=s;const h=(i?V.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let c=0;for(let p=0;p<h.length;p++){const m=V._measureText(h[p],e.letterSpacing,a);l[p]=m,c=Math.max(c,m)}let u=c+e.strokeThickness;e.dropShadow&&(u+=e.dropShadowDistance);const d=e.lineHeight||o.fontSize+e.strokeThickness;let f=Math.max(d,o.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new V(t,e,u,f,h,l,d+e.leading,c,o)}static _measureText(t,e,i){let n=!1;V.experimentalLetterSpacingSupported&&(V.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let s=i.measureText(t).width;return s>0&&(n?s-=e:s+=(V.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,i=V._canvas){const n=i.getContext("2d",fn);let s=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:c}=e,u=V.collapseSpaces(c),d=V.collapseNewlines(c);let f=!u;const p=e.wordWrapWidth+l,m=V.tokenize(t);for(let g=0;g<m.length;g++){let y=m[g];if(V.isNewline(y)){if(!d){a+=V.addLine(o),f=!u,o="",s=0;continue}y=" "}if(u){const _=V.isBreakingSpace(y),x=V.isBreakingSpace(o[o.length-1]);if(_&&x)continue}const v=V.getFromCache(y,l,h,n);if(v>p)if(o!==""&&(a+=V.addLine(o),o="",s=0),V.canBreakWords(y,e.breakWords)){const _=V.wordWrapSplit(y);for(let x=0;x<_.length;x++){let w=_[x],C=w,T=1;for(;_[x+T];){const F=_[x+T];if(!V.canBreakChars(C,F,y,x,e.breakWords))w+=F;else break;C=F,T++}x+=T-1;const S=V.getFromCache(w,l,h,n);S+s>p&&(a+=V.addLine(o),f=!1,o="",s=0),o+=w,s+=S}}else{o.length>0&&(a+=V.addLine(o),o="",s=0);const _=g===m.length-1;a+=V.addLine(y,!_),f=!1,o="",s=0}else v+s>p&&(f=!1,a+=V.addLine(o),o="",s=0),(o.length>0||!V.isBreakingSpace(y)||f)&&(o+=y,s+=v)}return a+=V.addLine(o,!1),a}static addLine(t,e=!0){return t=V.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,n){let s=i[t];return typeof s!="number"&&(s=V._measureText(t,e,n)+e,i[t]=s),s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!V.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:V._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:V._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],o=t[n+1];if(V.isBreakingSpace(s,o)||V.isNewline(s)){i!==""&&(e.push(i),i=""),e.push(s);continue}i+=s}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,s){return!0}static wordWrapSplit(t){return V.graphemeSegmenter(t)}static measureFont(t){if(V._fonts[t])return V._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=V._canvas,n=V._context;n.font=t;const s=V.METRICS_STRING+V.BASELINE_SYMBOL,o=Math.ceil(n.measureText(s).width);let a=Math.ceil(n.measureText(V.BASELINE_SYMBOL).width);const h=Math.ceil(V.HEIGHT_MULTIPLIER*a);if(a=a*V.BASELINE_MULTIPLIER|0,o===0||h===0)return V._fonts[t]=e,e;i.width=o,i.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,a);const l=n.getImageData(0,0,o,h).data,c=l.length,u=o*4;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let m=0;m<u;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f+=u;else break}for(e.ascent=a-d,f=c-u,p=!1,d=h;d>a;--d){for(let m=0;m<u;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f-=u;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,V._fonts[t]=e,e}static clearMetrics(t=""){t?delete V._fonts[t]:V._fonts={}}static get _canvas(){var t;if(!V.__canvas){let e;try{const i=new OffscreenCanvas(0,0);if((t=i.getContext("2d",fn))!=null&&t.measureText)return V.__canvas=i,i;e=H.ADAPTER.createCanvas()}catch{e=H.ADAPTER.createCanvas()}e.width=e.height=10,V.__canvas=e}return V.__canvas}static get _context(){return V.__context||(V.__context=V._canvas.getContext("2d",fn)),V.__context}};ee.METRICS_STRING="|q",ee.BASELINE_SYMBOL="M",ee.BASELINE_MULTIPLIER=1.4,ee.HEIGHT_MULTIPLIER=2,ee.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const r=new Intl.Segmenter;return t=>[...r.segment(t)].map(e=>e.segment)}return r=>[...r]})(),ee.experimentalLetterSpacing=!1,ee._fonts={},ee._newlines=[10,13],ee._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Be=ee;const mv=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],yd=class _i{constructor(t){this.styleID=0,this.reset(),go(this,t,t)}clone(){const t={};return go(t,this,_i.defaultStyle),new _i(t)}reset(){go(this,_i.defaultStyle,_i.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=mo(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=mo(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){gv(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=mo(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let n=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!mv.includes(n)&&(n=`"${n}"`),e[i]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};yd.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ss.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let ze=yd;function mo(r){const t=at.shared,e=i=>{const n=t.setValue(i);return n.alpha===1?n.toHex():n.toRgbaString()};return Array.isArray(r)?r.map(e):e(r)}function gv(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function go(r,t,e){for(const i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}const yv={texture:!0,children:!1,baseTexture:!0},_d=class ya extends ti{constructor(t,e,i){let n=!1;i||(i=H.ADAPTER.createCanvas(),n=!0),i.width=3,i.height=3;const s=k.from(i);s.orig=new Y,s.trim=new Y,super(s),this._ownCanvas=n,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=ya.defaultResolution??H.RESOLUTION,this._autoResolution=ya.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Be.experimentalLetterSpacing}static set experimentalLetterSpacing(t){J("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Be.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,n=Be.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,o=n.height,a=n.lines,h=n.lineHeight,l=n.lineWidths,c=n.maxLineWidth,u=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let d,f;const p=e.dropShadow?2:1;for(let m=0;m<p;++m){const g=e.dropShadow&&m===0,y=g?Math.ceil(Math.max(1,o)+e.padding*2):0,v=y*this._resolution;if(g){i.fillStyle="black",i.strokeStyle="black";const x=e.dropShadowColor,w=e.dropShadowBlur*this._resolution,C=e.dropShadowDistance*this._resolution;i.shadowColor=at.shared.setValue(x).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=w,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*C,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*C+v}else i.fillStyle=this._generateFillStyle(e,a,n),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let _=(h-u.fontSize)/2;h-u.fontSize<0&&(_=0);for(let x=0;x<a.length;x++)d=e.strokeThickness/2,f=e.strokeThickness/2+x*h+u.ascent+_,e.align==="right"?d+=c-l[x]:e.align==="center"&&(d+=(c-l[x])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[x],d+e.padding,f+e.padding-y,!0),e.fill&&this.drawLetterSpacing(a[x],d+e.padding,f+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,i,n=!1){const s=this._style.letterSpacing;let o=!1;if(Be.experimentalLetterSpacingSupported&&(Be.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||o){n?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let a=e;const h=Be.graphemeSegmenter(t);let l=this.context.measureText(t).width,c=0;for(let u=0;u<h.length;++u){const d=h[u];n?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);let f="";for(let p=u+1;p<h.length;++p)f+=h[p];c=this.context.measureText(f).width,a+=l-c+s,l=c}}updateTexture(){const t=this.canvas;if(this._style.trim){const o=Gg(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}const e=this._texture,i=this._style,n=i.trim?0:i.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const n=t.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let s;const o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-o-a*2,l=this.canvas.height/this._resolution-o-a*2,c=n.slice(),u=t.fillGradientStops.slice();if(!u.length){const d=c.length+1;for(let f=1;f<d;++f)u.push(f/d)}if(c.unshift(n[0]),u.unshift(0),c.push(n[n.length-1]),u.push(1),t.fillGradientType===Ss.LINEAR_VERTICAL){s=this.context.createLinearGradient(h/2,a,h/2,l+a);const d=i.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){const p=i.lineHeight*(f-1)+d,m=i.lineHeight*f;let g=m;f>0&&p>m&&(g=(m+p)/2);const y=m+d,v=i.lineHeight*(f+1);let _=y;f+1<e.length&&v<y&&(_=(y+v)/2);const x=(_-g)/l;for(let w=0;w<c.length;w++){let C=0;typeof u[w]=="number"?C=u[w]:C=w/c.length;let T=Math.min(1,Math.max(0,g/l+C*x));T=Number(T.toFixed(5)),s.addColorStop(T,c[w])}}}else{s=this.context.createLinearGradient(a,l/2,h+a,l/2);const d=c.length+1;let f=1;for(let p=0;p<c.length;p++){let m;typeof u[p]=="number"?m=u[p]:m=f/d,s.addColorStop(m,c[p]),f++}}return s}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},yv,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Oe(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Oe(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof ze?this._style=t:this._style=new ze(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};_d.defaultAutoResolution=!0;let vd=_d;class _v{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function vv(r,t){var i;let e=!1;if((i=r==null?void 0:r._textures)!=null&&i.length){for(let n=0;n<r._textures.length;n++)if(r._textures[n]instanceof k){const s=r._textures[n].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function xv(r,t){if(r.baseTexture instanceof Z){const e=r.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function bv(r,t){if(r._texture&&r._texture instanceof k){const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function wv(r,t){return t instanceof vd?(t.updateText(!0),!0):!1}function Tv(r,t){if(t instanceof ze){const e=t.toFontString();return Be.measureFont(e),!0}return!1}function Av(r,t){if(r instanceof vd){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Ev(r,t){return r instanceof ze?(t.includes(r)||t.push(r),!0):!1}const xd=class bd{constructor(t){this.limiter=new _v(bd.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Av),this.registerFindHook(Ev),this.registerFindHook(vv),this.registerFindHook(xv),this.registerFindHook(bv),this.registerUploadHook(wv),this.registerUploadHook(Tv)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Rt.system.addOnce(this.tick,this,gr.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Rt.system.addOnce(this.tick,this,gr.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Bt)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Rt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};xd.uploadsPerFrame=4;let _a=xd;Object.defineProperties(H,{UPLOADS_PER_FRAME:{get(){return _a.uploadsPerFrame},set(r){J("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),_a.uploadsPerFrame=r}}});function wd(r,t){return t instanceof Z?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1}function Sv(r,t){if(!(t instanceof Ci))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let n=0;n<i.length;n++){const{texture:s}=i[n].style;s&&wd(r,s.baseTexture)}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0}function Cv(r,t){return r instanceof Ci?(t.push(r),!0):!1}class Td extends _a{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Cv),this.registerUploadHook(wd),this.registerUploadHook(Sv)}}Td.extension={name:"prepare",type:U.RendererSystem};$.add(Td);var Iv=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Pv=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Rv=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Yl=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Mv=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const pn=new ot;class Ad extends ws{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Pu,this.state=fe.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=le.from(Yl,Mv,e),this.shader=t.context.webGLVersion>1?le.from(Pv,Iv,e):le.from(Yl,Rv,e)}render(t){const e=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-s,n[1]=n[3]=-o,n[2]=n[4]=1-s,n[5]=n[7]=1-o,i.invalidate();const a=t._texture,h=a.baseTexture,l=h.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==Mt.CLAMP:h.wrapMode===Mt.CLAMP&&(h.wrapMode=Mt.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,m=a.height,g=t._width,y=t._height;pn.set(c.a*p/g,c.b*p/y,c.c*m/g,c.d*m/y,c.tx/g,c.ty/y),pn.invert(),d?pn.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=pn.toArray(!0),f.uniforms.uColor=at.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(i),this.state.blendMode=gu(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Ad.extension={name:"tilingSprite",type:U.RendererPlugin};$.add(Ad);const Ed=class vi{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof k?t:null,this.baseTexture=t instanceof Z?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const n=this.baseTexture.resource;this.resolution=this._updateResolution(i||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=Se(t,null);return i===null&&(i=parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=vi.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=vi.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const n=this._frameKeys[e],s=this._frames[n],o=s.frame;if(o){let a=null,h=null;const l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,c=new Y(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?a=new Y(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new Y(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(h=new Y(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new k(this.baseTexture,a,c,h,s.rotated?2:0,s.anchor,s.borders),k.addToCache(this.textures[n],n.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const n=t[e][i];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*vi.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*vi.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Ed.BATCH_SIZE=1e3;let ql=Ed;const Fv=["jpg","png","jpeg","avif","webp"];function Sd(r,t,e){const i={};if(r.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[n]=t.textures[n]}),!e){const n=At.dirname(r[0]);t.linkedSheets.forEach((s,o)=>{const a=Sd([`${n}/${t.data.meta.related_multi_packs[o]}`],s,!0);Object.assign(i,a)})}return i}const Bv={extension:U.Asset,cache:{test:r=>r instanceof ql,getCacheableAssets:(r,t)=>Sd(r,t,!1)},resolver:{test:r=>{const t=r.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&Fv.includes(i)},parse:r=>{var e;const t=r.split(".");return{resolution:parseFloat(((e=H.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:t[t.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:U.LoadParser,priority:Yt.Normal},async testParse(r,t){return At.extname(t.src).toLowerCase()===".json"&&!!r.frames},async parse(r,t,e){var h,l;let i=At.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let n=i+r.meta.image;n=pa(n,t.src);const s=(await e.load([n]))[n],o=new ql(s.baseTexture,r,t.src);await o.parse();const a=(h=r==null?void 0:r.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(a)){const c=[];for(const d of a){if(typeof d!="string")continue;let f=i+d;(l=t.data)!=null&&l.ignoreMultiPack||(f=pa(f,t.src),c.push(e.load({src:f,data:{ignoreMultiPack:!0}})))}const u=await Promise.all(c);o.linkedSheets=u,u.forEach(d=>{d.linkedSheets=[o].concat(o.linkedSheets.filter(f=>f!==d))})}return o},unload(r){r.destroy(!0)}}};$.add(Bv);class rs{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Pn{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const o=e[s].match(/^[a-z]+/gm)[0],a=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in a){const c=a[l].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[u]=p}i[o].push(h)}const n=new rs;return i.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),i.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),i.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),i.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),i.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),i.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class va{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new rs,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<i.length;l++)e.info.push({face:i[l].getAttribute("face"),size:parseInt(i[l].getAttribute("size"),10)});for(let l=0;l<n.length;l++)e.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(let l=0;l<s.length;l++)e.page.push({id:parseInt(s[l].getAttribute("id"),10)||0,file:s[l].getAttribute("file")});for(let l=0;l<o.length;l++){const c=o[l];e.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return e}}class xa{static test(t){return typeof t=="string"&&t.includes("<font>")?va.test(H.ADAPTER.parseXML(t)):!1}static parse(t){return va.parse(H.ADAPTER.parseXML(t))}}const yo=[Pn,va,xa];function Dv(r){for(let t=0;t<yo.length;t++)if(yo[t].test(r))return yo[t];return null}function Lv(r,t,e,i,n,s){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,c=r.width/i-h-l*2,u=r.height/i-h-l*2,d=o.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),e.fillGradientType===Ss.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,l,c/2,u+l);let p=0;const m=(s.fontProperties.fontSize+e.strokeThickness)/u;for(let g=0;g<n.length;g++){const y=s.lineHeight*g;for(let v=0;v<d.length;v++){let _=0;typeof f[v]=="number"?_=f[v]:_=v/d.length;const x=y/u+_*m;let w=Math.max(p,x);w=Math.min(w,1),a.addColorStop(w,d[v]),p=w}}}else{a=t.createLinearGradient(l,u/2,c+l,u/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let y;typeof f[g]=="number"?y=f[g]:y=m/p,a.addColorStop(y,d[g]),m++}}return a}function Nv(r,t,e,i,n,s,o){const a=e.text,h=e.fontProperties;t.translate(i,n),t.scale(s,s);const l=o.strokeThickness/2,c=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=Lv(r,t,o,s,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const u=o.dropShadowColor,d=o.dropShadowBlur*s,f=o.dropShadowDistance*s;t.shadowColor=at.shared.setValue(u).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,c+e.lineHeight-h.descent),o.fill&&t.fillText(a,l,c+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Rn(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function Cd(r){return Array.from?Array.from(r):r.split("")}function Ov(r){typeof r=="string"&&(r=[r]);const t=[];for(let e=0,i=r.length;e<i;e++){const n=r[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...Cd(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Pe=class re{constructor(t,e,i){var c;const[n]=t.info,[s]=t.common,[o]=t.page,[a]=t.distanceField,h=Se(o.file),l={};this._ownsTextures=i,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/h,this.chars={},this.pageTextures=l;for(let u=0;u<t.page.length;u++){const{id:d,file:f}=t.page[u];l[d]=e instanceof Array?e[u]:e[f],a!=null&&a.fieldType&&a.fieldType!=="none"&&(l[d].baseTexture.alphaMode=Et.NO_PREMULTIPLIED_ALPHA,l[d].baseTexture.mipmap=ue.OFF)}for(let u=0;u<t.char.length;u++){const{id:d,page:f}=t.char[u];let{x:p,y:m,width:g,height:y,xoffset:v,yoffset:_,xadvance:x}=t.char[u];p/=h,m/=h,g/=h,y/=h,v/=h,_/=h,x/=h;const w=new Y(p+l[f].frame.x/h,m+l[f].frame.y/h,g,y);this.chars[d]={xOffset:v,yOffset:_,xAdvance:x,kerning:{},texture:new k(l[f].baseTexture,w),page:f}}for(let u=0;u<t.kerning.length;u++){let{first:d,second:f,amount:p}=t.kerning[u];d/=h,f/=h,p/=h,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=((c=a==null?void 0:a.fieldType)==null?void 0:c.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let n;if(t instanceof rs)n=t;else{const o=Dv(t);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(t)}e instanceof k&&(e=[e]);const s=new re(n,e,i);return re.available[s.font]=s,s}static uninstall(t){const e=re.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete re.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:s,resolution:o,textureWidth:a,textureHeight:h,...l}=Object.assign({},re.defaultOptions,i),c=Ov(n),u=e instanceof ze?e:new ze(e),d=a,f=new rs;f.info[0]={face:u.fontFamily,size:u.fontSize},f.common[0]={lineHeight:u.fontSize};let p=0,m=0,g,y,v,_=0;const x=[];for(let C=0;C<c.length;C++){g||(g=H.ADAPTER.createCanvas(),g.width=a,g.height=h,y=g.getContext("2d"),v=new Z(g,{resolution:o,...l}),x.push(new k(v)),f.page.push({id:x.length-1,file:""}));const T=c[C],S=Be.measureText(T,u,!1,g),F=S.width,O=Math.ceil(S.height),N=Math.ceil((u.fontStyle==="italic"?2:1)*F);if(m>=h-O*o){if(m===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${T}')`);--C,g=null,y=null,v=null,m=0,p=0,_=0;continue}if(_=Math.max(O+S.fontProperties.descent,_),N*o+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${T}')`);--C,m+=_*o,m=Math.ceil(m),p=0,_=0;continue}Nv(g,y,S,p,m,o,u);const B=Rn(S.text);f.char.push({id:B,page:x.length-1,x:p/o,y:m/o,width:N,height:O,xoffset:0,yoffset:0,xadvance:F-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),p+=(N+2*s)*o,p=Math.ceil(p)}if(!(i!=null&&i.skipKerning))for(let C=0,T=c.length;C<T;C++){const S=c[C];for(let F=0;F<T;F++){const O=c[F],N=y.measureText(S).width,B=y.measureText(O).width,A=y.measureText(S+O).width-(N+B);A&&f.kerning.push({first:Rn(S),second:Rn(O),amount:A})}}const w=new re(f,x,!0);return re.available[t]!==void 0&&re.uninstall(t),re.available[t]=w,w}};Pe.ALPHA=[["a","z"],["A","Z"]," "],Pe.NUMERIC=[["0","9"]],Pe.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Pe.ASCII=[[" ","~"]],Pe.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Pe.ALPHANUMERIC},Pe.available={};let Re=Pe;var kv=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,Uv=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Zl=[],Kl=[],Ql=[],Gv=class Id extends Bt{constructor(t,e={}){super();const{align:i,tint:n,maxWidth:s,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},Id.styleDefaults,e);if(!Re.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new at(n),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new we(()=>{this.dirty=!0},this,0,0),this._roundPixels=H.ROUND_PIXELS,this.dirty=!0,this._resolution=H.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var N;const t=Re.available[this._fontName],e=this.fontSize,i=e/t.size,n=new K,s=[],o=[],a=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=Cd(h),c=this._maxWidth*t.size/e,u=t.distanceFieldType==="none"?Zl:Kl;let d=null,f=0,p=0,m=0,g=-1,y=0,v=0,_=0,x=0;for(let B=0;B<l.length;B++){const A=l[B],b=Rn(A);if(/(?:\s)/.test(A)&&(g=B,y=f,x++),A==="\r"||A===`
`){o.push(f),a.push(-1),p=Math.max(p,f),++m,++v,n.x=0,n.y+=t.lineHeight,d=null,x=0;continue}const I=t.chars[b];if(!I)continue;d&&I.kerning[d]&&(n.x+=I.kerning[d]);const E=Ql.pop()||{texture:k.EMPTY,line:0,charCode:0,prevSpaces:0,position:new K};E.texture=I.texture,E.line=m,E.charCode=b,E.position.x=Math.round(n.x+I.xOffset+this._letterSpacing/2),E.position.y=Math.round(n.y+I.yOffset),E.prevSpaces=x,s.push(E),f=E.position.x+Math.max(I.xAdvance-I.xOffset,I.texture.orig.width),n.x+=I.xAdvance+this._letterSpacing,_=Math.max(_,I.yOffset+I.texture.height),d=b,g!==-1&&c>0&&n.x>c&&(++v,Gr(s,1+g-v,1+B-g),B=g,g=-1,o.push(y),a.push(s.length>0?s[s.length-1].prevSpaces:0),p=Math.max(p,y),m++,n.x=0,n.y+=t.lineHeight,d=null,x=0)}const w=l[l.length-1];w!=="\r"&&w!==`
`&&(/(?:\s)/.test(w)&&(f=y),o.push(f),p=Math.max(p,f),a.push(-1));const C=[];for(let B=0;B<=m;B++){let A=0;this._align==="right"?A=p-o[B]:this._align==="center"?A=(p-o[B])/2:this._align==="justify"&&(A=a[B]<0?0:(p-o[B])/a[B]),C.push(A)}const T=s.length,S={},F=[],O=this._activePagesMeshData;u.push(...O);for(let B=0;B<T;B++){const A=s[B].texture,b=A.baseTexture.uid;if(!S[b]){let I=u.pop();if(!I){const R=new Hi;let L,z;t.distanceFieldType==="none"?(L=new Zr(k.EMPTY),z=j.NORMAL):(L=new Zr(k.EMPTY,{program:Te.from(Uv,kv),uniforms:{uFWidth:0}}),z=j.NORMAL_NPM);const P=new qr(R,L);P.blendMode=z,I={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:P,vertices:null,uvs:null,indices:null}}I.index=0,I.indexCount=0,I.vertexCount=0,I.uvsCount=0,I.total=0;const{_textureCache:E}=this;E[b]=E[b]||new k(A.baseTexture),I.mesh.texture=E[b],I.mesh.tint=this._tintColor.value,F.push(I),S[b]=I}S[b].total++}for(let B=0;B<O.length;B++)F.includes(O[B])||this.removeChild(O[B].mesh);for(let B=0;B<F.length;B++)F[B].mesh.parent!==this&&this.addChild(F[B].mesh);this._activePagesMeshData=F;for(const B in S){const A=S[B],b=A.total;if(!(((N=A.indices)==null?void 0:N.length)>6*b)||A.vertices.length<qr.BATCHABLE_SIZE*2)A.vertices=new Float32Array(4*2*b),A.uvs=new Float32Array(4*2*b),A.indices=new Uint16Array(6*b);else{const I=A.total,E=A.vertices;for(let R=I*4*2;R<E.length;R++)E[R]=0}A.mesh.size=6*b}for(let B=0;B<T;B++){const A=s[B];let b=A.position.x+C[A.line]*(this._align==="justify"?A.prevSpaces:1);this._roundPixels&&(b=Math.round(b));const I=b*i,E=A.position.y*i,R=A.texture,L=S[R.baseTexture.uid],z=R.frame,P=R._uvs,M=L.index++;L.indices[M*6+0]=0+M*4,L.indices[M*6+1]=1+M*4,L.indices[M*6+2]=2+M*4,L.indices[M*6+3]=0+M*4,L.indices[M*6+4]=2+M*4,L.indices[M*6+5]=3+M*4,L.vertices[M*8+0]=I,L.vertices[M*8+1]=E,L.vertices[M*8+2]=I+z.width*i,L.vertices[M*8+3]=E,L.vertices[M*8+4]=I+z.width*i,L.vertices[M*8+5]=E+z.height*i,L.vertices[M*8+6]=I,L.vertices[M*8+7]=E+z.height*i,L.uvs[M*8+0]=P.x0,L.uvs[M*8+1]=P.y0,L.uvs[M*8+2]=P.x1,L.uvs[M*8+3]=P.y1,L.uvs[M*8+4]=P.x2,L.uvs[M*8+5]=P.y2,L.uvs[M*8+6]=P.x3,L.uvs[M*8+7]=P.y3}this._textWidth=p*i,this._textHeight=(n.y+t.lineHeight)*i;for(const B in S){const A=S[B];if(this.anchor.x!==0||this.anchor.y!==0){let R=0;const L=this._textWidth*this.anchor.x,z=this._textHeight*this.anchor.y;for(let P=0;P<A.total;P++)A.vertices[R++]-=L,A.vertices[R++]-=z,A.vertices[R++]-=L,A.vertices[R++]-=z,A.vertices[R++]-=L,A.vertices[R++]-=z,A.vertices[R++]-=L,A.vertices[R++]-=z}this._maxLineHeight=_*i;const b=A.mesh.geometry.getBuffer("aVertexPosition"),I=A.mesh.geometry.getBuffer("aTextureCoord"),E=A.mesh.geometry.getIndex();b.data=A.vertices,I.data=A.uvs,E.data=A.indices,b.update(),I.update(),E.update()}for(let B=0;B<s.length;B++)Ql.push(s[B]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:n}=Re.available[this._fontName];if(i!=="none"){const{a:s,b:o,c:a,d:h}=this.worldTransform,l=Math.sqrt(s*s+o*o),c=Math.sqrt(a*a+h*h),u=(Math.abs(l)+Math.abs(c))/2,d=this.fontSize/n,f=t._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=u*e*d*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Re.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Re.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Re.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i=Re.available[this._fontName].distanceFieldType==="none"?Zl:Kl;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>e[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=k.EMPTY});for(const n in e)e[n].destroy(),delete e[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Gv.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Hv=[".xml",".fnt"],zv={extension:{type:U.LoadParser,priority:Yt.Normal},name:"loadBitmapFont",test(r){return Hv.includes(At.extname(r).toLowerCase())},async testParse(r){return Pn.test(r)||xa.test(r)},async parse(r,t,e){const i=Pn.test(r)?Pn.parse(r):xa.parse(r),{src:n}=t,{page:s}=i,o=[];for(let l=0;l<s.length;++l){const c=s[l].file;let u=At.join(At.dirname(n),c);u=pa(u,n),o.push(u)}const a=await e.load(o),h=o.map(l=>a[l]);return Re.install(i,h,!0)},async load(r,t){return(await H.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};$.add(zv);const ba=class Pr extends ze{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Pr(Object.keys(Pr.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Pr.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=Pr;if(i[t]){const n=i[t];return this._fonts.push(n),n.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return H.ADAPTER.fetch(t).then(n=>n.blob()).then(async n=>new Promise((s,o)=>{const a=URL.createObjectURL(n),h=new FileReader;h.onload=()=>s([a,h.result]),h.onerror=o,h.readAsDataURL(n)})).then(async([n,s])=>{const o=Object.assign({family:At.basename(t,At.extname(t)),weight:"normal",style:"normal",display:"auto",src:n,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);i[t]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Dg(t)),typeof t=="number"?Bg(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const s=`${i}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,Pr.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=H.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};ba.availableFonts={},ba.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let _o=ba;const mn=class Rr extends ti{constructor(t="",e={}){super(k.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,n=k.from(i,{scaleMode:H.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new Y,n.trim=new Y,this.texture=n;const s="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(s,"svg"),h=document.createElementNS(s,"foreignObject"),l=document.createElementNS(o,"div"),c=document.createElementNS(o,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=Rr.defaultMaxWidth,this.maxHeight=Rr.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=Rr.defaultAutoResolution,this._resolution=Rr.defaultResolution??H.RESOLUTION,this.text=t,this.style=e}measureText(t){var c,u;const{text:e,style:i,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(n)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:a}=s;(o>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const h=Math.min(this.maxWidth,Math.ceil(o)),l=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",h.toString()),this._svgRoot.setAttribute("height",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:(c=this._style)==null?void 0:c.toCSS(n)}),this._styleElement.textContent=(u=this._style)==null?void 0:u.toGlobalCSS()),{width:h+i.padding*2,height:l+i.padding*2}}async updateText(t=!0){const{style:e,_image:i,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:o}=this.measureText();i.width=n.width=Math.ceil(Math.max(1,s)),i.height=n.height=Math.ceil(Math.max(1,o)),this._updateID++;const a=this._updateID;await new Promise(h=>{n.onload=async()=>{if(a<this._updateID){h();return}await e.onBeforeDraw(),i.src=n.src,n.onload=null,n.src="",this.updateTexture(),h()};const l=new XMLSerializer().serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:n}=this,{padding:s}=t,{baseTexture:o}=e;e.trim.width=e._frame.width=i.width/n,e.trim.height=e._frame.height=i.height/n,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(i.width,i.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var i,n,s,o,a;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Rr.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((i=this._style)==null||i.cleanFonts()),this._style=e,(n=this._svgRoot)==null||n.remove(),this._svgRoot=e,(s=this._domElement)==null||s.remove(),this._domElement=e,(o=this._foreignObject)==null||o.remove(),this._foreignObject=e,(a=this._styleElement)==null||a.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Oe(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Oe(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof _o?(this.ownsStyle=!1,this._style=t):t instanceof ze?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=_o.from(t)):(this.ownsStyle=!0,this._style=new _o(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};mn.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},mn.defaultMaxWidth=2024,mn.defaultMaxHeight=2024,mn.defaultAutoResolution=!0;class yT{constructor(t){const e={width:Bc,height:Dc,antialias:!0,backgroundAlpha:0,clearBeforeRender:!0,preserveDrawingBuffer:!0,...t};this.renderer=Zu(e),this.stage=new Bt}destroy(){var i,n,s,o,a;(i=this.stage)==null||i.destroy({children:!0,texture:!0,baseTexture:!0}),this.stage=void 0;const t=(n=this.renderer)==null?void 0:n.type,e=this.renderer instanceof Ts?(s=this.renderer)==null?void 0:s.gl:void 0;t===za.WEBGL&&e&&((o=e==null?void 0:e.getExtension("WEBGL_lose_context"))==null||o.loseContext()),(a=this.renderer)==null||a.destroy(!0),this.renderer=void 0}get view(){var t;return(t=this.renderer)==null?void 0:t.view}render(){var t;this.stage!=null&&((t=this.renderer)==null||t.render(this.stage))}}class $v extends Fc{constructor(t,e,i){var n;super(e,i),this.ctx=t,this.container=new Bt,(n=this.ctx.stage)==null||n.addChild(this.container)}render(){this.ctx.render()}addChild(t){this.container.addChild(t)}clearLayer(){this.container.removeChildren().forEach(e=>{e.destroy()})}onMount(t){var e,i;super.onMount(t),this.pixiViewContainer=((e=this.element)==null?void 0:e.querySelector("#webgl-layer"))??void 0,this.pixiViewContainer||(this.pixiViewContainer=document.createElement("div"),this.pixiViewContainer.setAttribute("id",`${this.id}`),this.pixiViewContainer.setAttribute("class","webgl-layer"),this.ctx.view!=null&&this.pixiViewContainer.appendChild(this.ctx.view),(i=this.element)==null||i.appendChild(this.pixiViewContainer),this.updateStyle())}onUnmount(t){var e,i;super.onUnmount(t),this.clearLayer(),(e=this.ctx.stage)==null||e.removeChild(this.container),this.container.destroy(),(i=this.pixiViewContainer)==null||i.remove(),this.pixiViewContainer=void 0}onResize(t){var e;super.onResize(t),(e=this.ctx.renderer)==null||e.resize(t.width,t.height)}onRescale(t){super.onRescale(t);const e=t.xBounds[0]>t.xBounds[1],i=t.yBounds[0]>t.yBounds[1];this.setContainerPosition(t.xScale(0),t.yScale(0)),this.setContainerScale(t.xRatio*(e?-1:1),t.yRatio*(i?-1:1))}setContainerPosition(t,e){this.container.position.set(t,e)}setContainerScale(t,e){this.container.scale.set(t,e)}updateStyle(t){var s;const e=t||this.isVisible,i=this.interactive?"auto":"none";this.container.visible=e;const n=[["position","absolute"],["pointer-events",`${i}`],["z-index",`${this.order}`],["opacity",`${this.opacity}`]].map(o=>o.join(":")).join(";");(s=this.pixiViewContainer)==null||s.setAttribute("style",n)}setVisibility(t,e){super.setVisibility(t,e),this.pixiViewContainer&&this.updateStyle(t)}onOpacityChanged(t){this.pixiViewContainer&&this.updateStyle()}onOrderChanged(t){this.pixiViewContainer&&this.updateStyle()}onInteractivityChanged(t){this.pixiViewContainer&&this.updateStyle()}renderType(){var t;return(t=this.ctx.renderer)==null?void 0:t.type}}function sh(r){throw new Error(`Unexpected object: ${JSON.stringify(r)}`)}const Vv=r=>r.kind==="pAndASymbol",Xv=r=>r.kind==="cementSqueeze",Wv=r=>r.kind==="cementPlug",jv=(r,t,e)=>i=>{switch(i.kind){case"screen":return r(i);case"tubing":return t(i);case"completionSymbol":return e(i);default:return sh(i)}},Ye=(r,t)=>{switch(t){case"Perforation":return r.Perforation(t);case"Open hole gravel pack":return r.OpenHoleGravelPack(t);case"Open hole frac pack":return r.OpenHoleFracPack(t);case"Cased hole fracturation":return r.CasedHoleFracturation(t);case"Cased hole frac pack":return r.CasedHoleFracPack(t);case"Cased hole gravel pack":return r.CasedHoleGravelPack(t);default:return sh(t)}},Yv=r=>Ye({Perforation:()=>!1,OpenHoleGravelPack:()=>!0,OpenHoleFracPack:()=>!0,CasedHoleFracturation:()=>!1,CasedHoleGravelPack:()=>!0,CasedHoleFracPack:()=>!0},r.subKind);function qv(r){return Ye({Perforation:()=>!1,OpenHoleGravelPack:()=>!1,OpenHoleFracPack:()=>!0,CasedHoleFracturation:()=>!0,CasedHoleGravelPack:()=>!1,CasedHoleFracPack:()=>!0},r.subKind)}function Zv(r){return Ye({Perforation:()=>!0,OpenHoleGravelPack:()=>!1,OpenHoleFracPack:()=>!1,CasedHoleFracturation:()=>!1,CasedHoleGravelPack:()=>!1,CasedHoleFracPack:()=>!1},r.subKind)}function Kv(r){return Ye({Perforation:()=>!1,OpenHoleGravelPack:()=>!1,OpenHoleFracPack:()=>!1,CasedHoleFracturation:()=>!1,CasedHoleGravelPack:()=>!0,CasedHoleFracPack:()=>!1},r.subKind)}function Qv(r){return Ye({Perforation:()=>!1,OpenHoleGravelPack:()=>!1,OpenHoleFracPack:()=>!1,CasedHoleFracturation:()=>!1,CasedHoleGravelPack:()=>!1,CasedHoleFracPack:()=>!0},r.subKind)}const Jv=r=>r.subKind==="Cased hole fracturation",tx=(r,t)=>r.start<t.end&&r.end>t.start,ex=r=>({holeLayerId:`${r}-hole`,casingLayerId:`${r}-casing`,completionLayerId:`${r}-completion`,cementLayerId:`${r}-cement`,pAndALayerId:`${r}-pAndA`,perforationLayerId:`${r}-perforation`}),rx={firstColor:"#8c541d",secondColor:"#eee3d8",lineColor:"#8b4513"},ix={solidColor:"#dcdcdc",lineColor:"#575757",shoeSize:{width:pf,length:mf},windowOptions:{dashColor:"#dc0000",dashLength:5,spaceLength:3}},nx={stroke:"rgba(0, 0, 0, 0.25)",yellow:"#FFFC00",grey:"gray",red:"#FF5050",outline:"black",transparent:"rgba(255, 255, 255, 0)",spikeWidth:50,spikeLength:50,packingOpacity:.7,fracLineCurve:10,fracLineLength:25,scalingFactor:25},sx={firstColor:"#c7b9ab",secondColor:"#5b5b5b",scalingFactor:4},ox={firstColor:"#8b6713",secondColor:"#000000",scalingFactor:4},ax={scalingFactor:4,lineColor:"#63666a"},hx={scalingFactor:1,innerColor:"#eeeeff",outerColor:"#777788"},lx={firstColor:"#c7b9ab",secondColor:"#000000",scalingFactor:4};var cx=Math.PI/180;function ux(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r<t?t:r>e?e:r}function _T(r){return r*cx}function vT(r){var t=new Array(r),e=1/(r-1);t[0]=0;for(var i=1;i<r-1;i++)t[i]=i*e;return t[r-1]=1,t}function oh(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function Pd(r,t){var e=Object.create(r.prototype);for(var i in t)e[i]=t[i];return e}function zi(){}var Fi=.7,is=1/Fi,$r="\\s*([+-]?\\d+)\\s*",Bi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ce="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dx=/^#([0-9a-f]{3,8})$/,fx=new RegExp(`^rgb\\(${$r},${$r},${$r}\\)$`),px=new RegExp(`^rgb\\(${ce},${ce},${ce}\\)$`),mx=new RegExp(`^rgba\\(${$r},${$r},${$r},${Bi}\\)$`),gx=new RegExp(`^rgba\\(${ce},${ce},${ce},${Bi}\\)$`),yx=new RegExp(`^hsl\\(${Bi},${ce},${ce}\\)$`),_x=new RegExp(`^hsla\\(${Bi},${ce},${ce},${Bi}\\)$`),Jl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};oh(zi,$e,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:tc,formatHex:tc,formatHex8:vx,formatHsl:xx,formatRgb:ec,toString:ec});function tc(){return this.rgb().formatHex()}function vx(){return this.rgb().formatHex8()}function xx(){return Rd(this).formatHsl()}function ec(){return this.rgb().formatRgb()}function $e(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=dx.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?rc(t):e===3?new St(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?gn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?gn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=fx.exec(r))?new St(t[1],t[2],t[3],1):(t=px.exec(r))?new St(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=mx.exec(r))?gn(t[1],t[2],t[3],t[4]):(t=gx.exec(r))?gn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=yx.exec(r))?sc(t[1],t[2]/100,t[3]/100,1):(t=_x.exec(r))?sc(t[1],t[2]/100,t[3]/100,t[4]):Jl.hasOwnProperty(r)?rc(Jl[r]):r==="transparent"?new St(NaN,NaN,NaN,0):null}function rc(r){return new St(r>>16&255,r>>8&255,r&255,1)}function gn(r,t,e,i){return i<=0&&(r=t=e=NaN),new St(r,t,e,i)}function bx(r){return r instanceof zi||(r=$e(r)),r?(r=r.rgb(),new St(r.r,r.g,r.b,r.opacity)):new St}function wa(r,t,e,i){return arguments.length===1?bx(r):new St(r,t,e,i??1)}function St(r,t,e,i){this.r=+r,this.g=+t,this.b=+e,this.opacity=+i}oh(St,wa,Pd(zi,{brighter(r){return r=r==null?is:Math.pow(is,r),new St(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Fi:Math.pow(Fi,r),new St(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new St(fr(this.r),fr(this.g),fr(this.b),ns(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ic,formatHex:ic,formatHex8:wx,formatRgb:nc,toString:nc}));function ic(){return`#${hr(this.r)}${hr(this.g)}${hr(this.b)}`}function wx(){return`#${hr(this.r)}${hr(this.g)}${hr(this.b)}${hr((isNaN(this.opacity)?1:this.opacity)*255)}`}function nc(){const r=ns(this.opacity);return`${r===1?"rgb(":"rgba("}${fr(this.r)}, ${fr(this.g)}, ${fr(this.b)}${r===1?")":`, ${r})`}`}function ns(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function fr(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function hr(r){return r=fr(r),(r<16?"0":"")+r.toString(16)}function sc(r,t,e,i){return i<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new Vt(r,t,e,i)}function Rd(r){if(r instanceof Vt)return new Vt(r.h,r.s,r.l,r.opacity);if(r instanceof zi||(r=$e(r)),!r)return new Vt;if(r instanceof Vt)return r;r=r.rgb();var t=r.r/255,e=r.g/255,i=r.b/255,n=Math.min(t,e,i),s=Math.max(t,e,i),o=NaN,a=s-n,h=(s+n)/2;return a?(t===s?o=(e-i)/a+(e<i)*6:e===s?o=(i-t)/a+2:o=(t-e)/a+4,a/=h<.5?s+n:2-s-n,o*=60):a=h>0&&h<1?0:o,new Vt(o,a,h,r.opacity)}function Tx(r,t,e,i){return arguments.length===1?Rd(r):new Vt(r,t,e,i??1)}function Vt(r,t,e,i){this.h=+r,this.s=+t,this.l=+e,this.opacity=+i}oh(Vt,Tx,Pd(zi,{brighter(r){return r=r==null?is:Math.pow(is,r),new Vt(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Fi:Math.pow(Fi,r),new Vt(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*t,n=2*e-i;return new St(vo(r>=240?r-240:r+120,n,i),vo(r,n,i),vo(r<120?r+240:r-120,n,i),this.opacity)},clamp(){return new Vt(oc(this.h),yn(this.s),yn(this.l),ns(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=ns(this.opacity);return`${r===1?"hsl(":"hsla("}${oc(this.h)}, ${yn(this.s)*100}%, ${yn(this.l)*100}%${r===1?")":`, ${r})`}`}}));function oc(r){return r=(r||0)%360,r<0?r+360:r}function yn(r){return Math.max(0,Math.min(1,r||0))}function vo(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}const Ax=16,Ex=6;function ve(r){const t=$e(r);if(t!=null){const e=t==null?void 0:t.formatHex();return parseInt(e.replace("#","0x"))}else throw Error(`Could not format string ${r} to hex code.`)}function xT(r){return typeof r=="string"?r:`#${r.toString(Ax).padStart(Ex,"0")}`}function hi(r,t,e){e===void 0&&(e=r);for(var i=0;i<r.length;i++)e[i]=r[i]+t[i];return e}function li(r,t,e){e===void 0&&(e=r);for(var i=0;i<r.length;i++)e[i]=r[i]-t[i];return e}function nr(r,t,e){e===void 0&&(e=r);for(var i=0;i<r.length;i++)e[i]=r[i]*t;return e}function Sx(r){for(var t=0,e=0;e<r.length;e++)t+=Math.pow(r[e],2);return t}function xi(r){var t=Sx(r);return t===0?t:Math.sqrt(t)}function ac(r,t){t===void 0&&(t=r);var e=xi(r);return e===0?Cx(0,t):nr(r,1/e,t)}function Cx(r,t){for(var e=0;e<t.length;e++)t[e]=r;return t}function Ix(r,t){for(var e=0,i=0;i<r.length;i++)e+=Math.pow(t[i]-r[i],2);return e===0?e:Math.sqrt(e)}function Px(r,t){for(var e=0,i=0;i<r.length;i++)e+=r[i]*t[i];return e}function Rx(r,t,e,i){i===void 0&&(i=r);for(var n=ux(e,0,1),s=1-n,o=0;o<r.length;o++)i[o]=r[o]*s+t[o]*n;return i}function Mx(r,t,e){e===void 0&&(e=r);for(var i=0;i<r.length;i++)e[i]=t(r[i],i);return e}function hc(r,t){t===void 0&&(t=0),t===void 0&&(t=0);for(var e=0;e<r.length;e++)if(Math.abs(r[e])>t)return!1;return!0}var xo=180/Math.PI,Fx=Math.PI/180;function bo(r,t,e){var i=Math.cos(t),n=Math.sin(t),s=r[0];return e[0]=i*s-n*r[1],e[1]=n*s+i*r[1],e}function lc(r){return Math.atan2(r[1],r[0])}function ci(r,t){var e=Math.atan2(t[1],t[0])-Math.atan2(r[1],r[0]);return e>Math.PI?e-=2*Math.PI:e<=-Math.PI&&(e+=2*Math.PI),e}var Md=function(){function r(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.isMutating=!1,this.length=2,typeof t=="number"?typeof e[0]=="number"?(this[0]=t,this[1]=e[0]):(this[0]=t,this[1]=t):"x"in t&&"y"in t?(this[0]=t.x,this[1]=t.y):(this[0]=t[0],this[1]=t[1])}return Object.defineProperty(r.prototype,"x",{get:function(){return this[0]},set:function(t){this[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this[1]},set:function(t){this[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"magnitude",{get:function(){return xi(this)},set:function(t){var e=xi(this);nr(this,t/e,this)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mutable",{get:function(){return this.isMutating=!0,this},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"immutable",{get:function(){return this.isMutating=!1,this},enumerable:!0,configurable:!0}),r.prototype.set=function(t,e){return typeof t=="number"?typeof e=="number"?(this[0]=t,this[1]=e):(this[0]=t,this[1]=t):(this[0]=t[0],this[1]=t[1]),this},r.prototype.add=function(t,e){return e===void 0&&(e=0),typeof t=="number"?this.isMutating?hi(this,[t,e]):hi(this.clone(),[t,e]):this.isMutating?hi(this,t):hi(this.clone(),t)},r.add=function(t,e){var i=new r(t);return hi(i,e)},r.prototype.sub=function(t,e){return e===void 0&&(e=0),typeof t=="number"?this.isMutating?li(this,[t,e]):li(this.clone(),[t,e]):this.isMutating?li(this,t):li(this.clone(),t)},r.sub=function(t,e){var i=new r(t);return li(i,e)},r.prototype.subFrom=function(t,e){return e===void 0&&(e=0),typeof t=="number"?this.isMutating?(this[0]=t-this[0],this[1]=e-this[1],this):new r(t-this[0],e-this[1]):this.isMutating?(this[0]=t[0]-this[0],this[1]=t[1]-this[1],this):new r(t[0]-this[0],t[1]-this[1])},r.divide=function(t,e){var i=new r(t);return nr(i,1/e)},r.multiply=function(t,e){var i=new r(t);return nr(i,e)},r.prototype.scale=function(t){return nr(this,t,this.isMutating?this:r.zero)},r.prototype.rescale=function(t){var e=xi(this);return e<=0?this.isMutating?this:r.zero:nr(this,t/e,this.isMutating?this:r.zero)},r.prototype.clampMagnitude=function(t){var e=xi(this);return e>t?nr(this,t/e,this.isMutating?this:r.zero):this.isMutating?this:this.clone()},r.prototype.rotate=function(t){return bo(this,t,this.isMutating?this:r.zero)},r.prototype.rotateDeg=function(t){return bo(this,t*Fx,this.isMutating?this:r.zero)},r.prototype.rotate90=function(){return t=this,e=this.isMutating?this:r.zero,i=t[0],e[0]=-t[1],e[1]=i,e;var t,e,i},r.prototype.rotate180=function(){return t=this,(e=this.isMutating?this:r.zero)[0]=-t[0],e[1]=-t[1],e;var t,e},r.prototype.rotate270=function(){return t=this,e=this.isMutating?this:r.zero,i=t[0],e[0]=t[1],e[1]=-i,e;var t,e,i},r.prototype.normalize=function(){return ac(this)},r.prototype.normalized=function(){return ac(this,r.zero)},r.distance=function(t,e){return Ix(t,e)},r.dot=function(t,e){return Px(t,e)},r.cross=function(t,e){return function(i,n){return i[0]*n[1]-i[1]*n[0]}(t,e)},r.angleRight=function(t){return lc(t)},r.angleRightDeg=function(t){return lc(t)*xo},r.angle=function(t,e){return Math.abs(ci(t,e))},r.angleDeg=function(t,e){return Math.abs(ci(t,e))*xo},r.signedAngle=function(t,e){return ci(t,e)},r.signedAngleDeg=function(t,e){return ci(t,e)*xo},r.lerp=function(t,e,i){var n=new r(t);return Rx(n,e,i)},r.lerpRot=function(t,e,i){return function(n,s,o,a){return a===void 0&&(a=n),bo(n,o*ci(n,s),a)}(t,e,i,r.zero)},r.prototype.clone=function(){return new r(this[0],this[1])},r.equals=function(t,e,i){return i===void 0&&(i=0),!(Math.abs(t[0]-e[0])>i)&&!(Math.abs(t[1]-e[1])>i)},r.prototype.equals=function(t,e){return e===void 0&&(e=0),r.equals(this,t,e)},r.isZeroVector=function(t,e){return e===void 0&&(e=0),hc(t,e)},r.prototype.isZeroVector=function(t){return t===void 0&&(t=0),hc(this,t)},r.prototype.toArray=function(){return[this[0],this[1]]},r.prototype.modify=function(t){return Mx(this,t)},r.prototype[Symbol.iterator]=function(){var t=this,e=0;return{next:function(){switch(e++){case 0:return{value:t[0],done:!1};case 1:return{value:t[1],done:!1};default:return{value:-1,done:!0}}}}},Object.defineProperty(r,"zero",{get:function(){return new r(0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"one",{get:function(){return new r(1,1)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"positiveInfinity",{get:function(){return new r(1/0,1/0)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"negativeInfinity",{get:function(){return new r(-1/0,-1/0)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"up",{get:function(){return new r(0,1)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"right",{get:function(){return new r(1,0)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"down",{get:function(){return new r(0,-1)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"left",{get:function(){return new r(-1,0)},enumerable:!0,configurable:!0}),r}();function Mn(r,t){return r==null||t==null?NaN:r<t?-1:r>t?1:r>=t?0:NaN}function Bx(r,t){return r==null||t==null?NaN:t<r?-1:t>r?1:t>=r?0:NaN}function Fd(r){let t,e,i;r.length!==2?(t=Mn,e=(a,h)=>Mn(r(a),h),i=(a,h)=>r(a)-h):(t=r===Mn||r===Bx?r:Dx,e=r,i=r);function n(a,h,l=0,c=a.length){if(l<c){if(t(h,h)!==0)return c;do{const u=l+c>>>1;e(a[u],h)<0?l=u+1:c=u}while(l<c)}return l}function s(a,h,l=0,c=a.length){if(l<c){if(t(h,h)!==0)return c;do{const u=l+c>>>1;e(a[u],h)<=0?l=u+1:c=u}while(l<c)}return l}function o(a,h,l=0,c=a.length){const u=n(a,h,l,c-1);return u>l&&i(a[u-1],h)>-i(a[u],h)?u-1:u}return{left:n,center:o,right:s}}function Dx(){return 0}function Lx(r){return r===null?NaN:+r}const Nx=Fd(Mn),Ox=Nx.right;Fd(Lx).center;const kx=Ox;class cc extends Map{constructor(t,e=Hx){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[i,n]of t)this.set(i,n)}get(t){return super.get(uc(this,t))}has(t){return super.has(uc(this,t))}set(t,e){return super.set(Ux(this,t),e)}delete(t){return super.delete(Gx(this,t))}}function uc({_intern:r,_key:t},e){const i=t(e);return r.has(i)?r.get(i):e}function Ux({_intern:r,_key:t},e){const i=t(e);return r.has(i)?r.get(i):(r.set(i,e),e)}function Gx({_intern:r,_key:t},e){const i=t(e);return r.has(i)&&(e=r.get(e),r.delete(i)),e}function Hx(r){return r!==null&&typeof r=="object"?r.valueOf():r}const zx=Math.sqrt(50),$x=Math.sqrt(10),Vx=Math.sqrt(2);function ss(r,t,e){const i=(t-r)/Math.max(0,e),n=Math.floor(Math.log10(i)),s=i/Math.pow(10,n),o=s>=zx?10:s>=$x?5:s>=Vx?2:1;let a,h,l;return n<0?(l=Math.pow(10,-n)/o,a=Math.round(r*l),h=Math.round(t*l),a/l<r&&++a,h/l>t&&--h,l=-l):(l=Math.pow(10,n)*o,a=Math.round(r/l),h=Math.round(t/l),a*l<r&&++a,h*l>t&&--h),h<a&&.5<=e&&e<2?ss(r,t,e*2):[a,h,l]}function Xx(r,t,e){if(t=+t,r=+r,e=+e,!(e>0))return[];if(r===t)return[r];const i=t<r,[n,s,o]=i?ss(t,r,e):ss(r,t,e);if(!(s>=n))return[];const a=s-n+1,h=new Array(a);if(i)if(o<0)for(let l=0;l<a;++l)h[l]=(s-l)/-o;else for(let l=0;l<a;++l)h[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)h[l]=(n+l)/-o;else for(let l=0;l<a;++l)h[l]=(n+l)*o;return h}function Ta(r,t,e){return t=+t,r=+r,e=+e,ss(r,t,e)[2]}function Wx(r,t,e){t=+t,r=+r,e=+e;const i=t<r,n=i?Ta(t,r,e):Ta(r,t,e);return(i?-1:1)*(n<0?1/-n:n)}function Aa(r,t){let e;if(t===void 0)for(const i of r)i!=null&&(e<i||e===void 0&&i>=i)&&(e=i);else{let i=-1;for(let n of r)(n=t(n,++i,r))!=null&&(e<n||e===void 0&&n>=n)&&(e=n)}return e}function wo(r,t){let e=0;if(t===void 0)for(let i of r)(i=+i)&&(e+=i);else{let i=-1;for(let n of r)(n=+t(n,++i,r))&&(e+=n)}return e}function Bd(r,t){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(t).domain(r);break}return this}const dc=Symbol("implicit");function Dd(){var r=new cc,t=[],e=[],i=dc;function n(s){let o=r.get(s);if(o===void 0){if(i!==dc)return i;r.set(s,o=t.push(s)-1)}return e[o%e.length]}return n.domain=function(s){if(!arguments.length)return t.slice();t=[],r=new cc;for(const o of s)r.has(o)||r.set(o,t.push(o)-1);return n},n.range=function(s){return arguments.length?(e=Array.from(s),n):e.slice()},n.unknown=function(s){return arguments.length?(i=s,n):i},n.copy=function(){return Dd(t,e).unknown(i)},Bd.apply(n,arguments),n}const ah=r=>()=>r;function jx(r,t){return function(e){return r+e*t}}function Yx(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function qx(r){return(r=+r)==1?Ld:function(t,e){return e-t?Yx(t,e,r):ah(isNaN(t)?e:t)}}function Ld(r,t){var e=t-r;return e?jx(r,e):ah(isNaN(r)?t:r)}const Di=function r(t){var e=qx(t);function i(n,s){var o=e((n=wa(n)).r,(s=wa(s)).r),a=e(n.g,s.g),h=e(n.b,s.b),l=Ld(n.opacity,s.opacity);return function(c){return n.r=o(c),n.g=a(c),n.b=h(c),n.opacity=l(c),n+""}}return i.gamma=r,i}(1);function Zx(r,t){t||(t=[]);var e=r?Math.min(t.length,r.length):0,i=t.slice(),n;return function(s){for(n=0;n<e;++n)i[n]=r[n]*(1-s)+t[n]*s;return i}}function Kx(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Qx(r,t){var e=t?t.length:0,i=r?Math.min(e,r.length):0,n=new Array(i),s=new Array(e),o;for(o=0;o<i;++o)n[o]=hh(r[o],t[o]);for(;o<e;++o)s[o]=t[o];return function(a){for(o=0;o<i;++o)s[o]=n[o](a);return s}}function Jx(r,t){var e=new Date;return r=+r,t=+t,function(i){return e.setTime(r*(1-i)+t*i),e}}function zt(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}function tb(r,t){var e={},i={},n;(r===null||typeof r!="object")&&(r={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in r?e[n]=hh(r[n],t[n]):i[n]=t[n];return function(s){for(n in e)i[n]=e[n](s);return i}}var Ea=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,To=new RegExp(Ea.source,"g");function eb(r){return function(){return r}}function rb(r){return function(t){return r(t)+""}}function Nd(r,t){var e=Ea.lastIndex=To.lastIndex=0,i,n,s,o=-1,a=[],h=[];for(r=r+"",t=t+"";(i=Ea.exec(r))&&(n=To.exec(t));)(s=n.index)>e&&(s=t.slice(e,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,h.push({i:o,x:zt(i,n)})),e=To.lastIndex;return e<t.length&&(s=t.slice(e),a[o]?a[o]+=s:a[++o]=s),a.length<2?h[0]?rb(h[0].x):eb(t):(t=h.length,function(l){for(var c=0,u;c<t;++c)a[(u=h[c]).i]=u.x(l);return a.join("")})}function hh(r,t){var e=typeof t,i;return t==null||e==="boolean"?ah(t):(e==="number"?zt:e==="string"?(i=$e(t))?(t=i,Di):Nd:t instanceof $e?Di:t instanceof Date?Jx:Kx(t)?Zx:Array.isArray(t)?Qx:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?tb:zt)(r,t)}function ib(r,t){return r=+r,t=+t,function(e){return Math.round(r*(1-e)+t*e)}}var fc=180/Math.PI,Sa={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Od(r,t,e,i,n,s){var o,a,h;return(o=Math.sqrt(r*r+t*t))&&(r/=o,t/=o),(h=r*e+t*i)&&(e-=r*h,i-=t*h),(a=Math.sqrt(e*e+i*i))&&(e/=a,i/=a,h/=a),r*i<t*e&&(r=-r,t=-t,h=-h,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(t,r)*fc,skewX:Math.atan(h)*fc,scaleX:o,scaleY:a}}var _n;function nb(r){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return t.isIdentity?Sa:Od(t.a,t.b,t.c,t.d,t.e,t.f)}function sb(r){return r==null||(_n||(_n=document.createElementNS("http://www.w3.org/2000/svg","g")),_n.setAttribute("transform",r),!(r=_n.transform.baseVal.consolidate()))?Sa:(r=r.matrix,Od(r.a,r.b,r.c,r.d,r.e,r.f))}function kd(r,t,e,i){function n(l){return l.length?l.pop()+" ":""}function s(l,c,u,d,f,p){if(l!==u||c!==d){var m=f.push("translate(",null,t,null,e);p.push({i:m-4,x:zt(l,u)},{i:m-2,x:zt(c,d)})}else(u||d)&&f.push("translate("+u+t+d+e)}function o(l,c,u,d){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),d.push({i:u.push(n(u)+"rotate(",null,i)-2,x:zt(l,c)})):c&&u.push(n(u)+"rotate("+c+i)}function a(l,c,u,d){l!==c?d.push({i:u.push(n(u)+"skewX(",null,i)-2,x:zt(l,c)}):c&&u.push(n(u)+"skewX("+c+i)}function h(l,c,u,d,f,p){if(l!==u||c!==d){var m=f.push(n(f)+"scale(",null,",",null,")");p.push({i:m-4,x:zt(l,u)},{i:m-2,x:zt(c,d)})}else(u!==1||d!==1)&&f.push(n(f)+"scale("+u+","+d+")")}return function(l,c){var u=[],d=[];return l=r(l),c=r(c),s(l.translateX,l.translateY,c.translateX,c.translateY,u,d),o(l.rotate,c.rotate,u,d),a(l.skewX,c.skewX,u,d),h(l.scaleX,l.scaleY,c.scaleX,c.scaleY,u,d),l=c=null,function(f){for(var p=-1,m=d.length,g;++p<m;)u[(g=d[p]).i]=g.x(f);return u.join("")}}}var ob=kd(nb,"px, ","px)","deg)"),ab=kd(sb,", ",")",")"),hb=1e-12;function pc(r){return((r=Math.exp(r))+1/r)/2}function lb(r){return((r=Math.exp(r))-1/r)/2}function cb(r){return((r=Math.exp(2*r))-1)/(r+1)}const ub=function r(t,e,i){function n(s,o){var a=s[0],h=s[1],l=s[2],c=o[0],u=o[1],d=o[2],f=c-a,p=u-h,m=f*f+p*p,g,y;if(m<hb)y=Math.log(d/l)/t,g=function(T){return[a+T*f,h+T*p,l*Math.exp(t*T*y)]};else{var v=Math.sqrt(m),_=(d*d-l*l+i*m)/(2*l*e*v),x=(d*d-l*l-i*m)/(2*d*e*v),w=Math.log(Math.sqrt(_*_+1)-_),C=Math.log(Math.sqrt(x*x+1)-x);y=(C-w)/t,g=function(T){var S=T*y,F=pc(w),O=l/(e*v)*(F*cb(t*S+w)-lb(w));return[a+O*f,h+O*p,l*F/pc(t*S+w)]}}return g.duration=y*1e3*t/Math.SQRT2,g}return n.rho=function(s){var o=Math.max(.001,+s),a=o*o,h=a*a;return r(o,a,h)},n}(Math.SQRT2,2,4);function db(r,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=r(i/(t-1));return e}function fb(r){return function(){return r}}function pb(r){return+r}var mc=[0,1];function Br(r){return r}function Ca(r,t){return(t-=r=+r)?function(e){return(e-r)/t}:fb(isNaN(t)?NaN:.5)}function mb(r,t){var e;return r>t&&(e=r,r=t,t=e),function(i){return Math.max(r,Math.min(t,i))}}function gb(r,t,e){var i=r[0],n=r[1],s=t[0],o=t[1];return n<i?(i=Ca(n,i),s=e(o,s)):(i=Ca(i,n),s=e(s,o)),function(a){return s(i(a))}}function yb(r,t,e){var i=Math.min(r.length,t.length)-1,n=new Array(i),s=new Array(i),o=-1;for(r[i]<r[0]&&(r=r.slice().reverse(),t=t.slice().reverse());++o<i;)n[o]=Ca(r[o],r[o+1]),s[o]=e(t[o],t[o+1]);return function(a){var h=kx(r,a,1,i)-1;return s[h](n[h](a))}}function _b(r,t){return t.domain(r.domain()).range(r.range()).interpolate(r.interpolate()).clamp(r.clamp()).unknown(r.unknown())}function vb(){var r=mc,t=mc,e=hh,i,n,s,o=Br,a,h,l;function c(){var d=Math.min(r.length,t.length);return o!==Br&&(o=mb(r[0],r[d-1])),a=d>2?yb:gb,h=l=null,u}function u(d){return d==null||isNaN(d=+d)?s:(h||(h=a(r.map(i),t,e)))(i(o(d)))}return u.invert=function(d){return o(n((l||(l=a(t,r.map(i),zt)))(d)))},u.domain=function(d){return arguments.length?(r=Array.from(d,pb),c()):r.slice()},u.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},u.rangeRound=function(d){return t=Array.from(d),e=ib,c()},u.clamp=function(d){return arguments.length?(o=d?!0:Br,c()):o!==Br},u.interpolate=function(d){return arguments.length?(e=d,c()):e},u.unknown=function(d){return arguments.length?(s=d,u):s},function(d,f){return i=d,n=f,c()}}function xb(){return vb()(Br,Br)}function bb(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function os(r,t){if((e=(r=t?r.toExponential(t-1):r.toExponential()).indexOf("e"))<0)return null;var e,i=r.slice(0,e);return[i.length>1?i[0]+i.slice(2):i,+r.slice(e+1)]}function Kr(r){return r=os(Math.abs(r)),r?r[1]:NaN}function wb(r,t){return function(e,i){for(var n=e.length,s=[],o=0,a=r[0],h=0;n>0&&a>0&&(h+a+1>i&&(a=Math.max(1,i-h)),s.push(e.substring(n-=a,n+a)),!((h+=a+1)>i));)a=r[o=(o+1)%r.length];return s.reverse().join(t)}}function Tb(r){return function(t){return t.replace(/[0-9]/g,function(e){return r[+e]})}}var Ab=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function as(r){if(!(t=Ab.exec(r)))throw new Error("invalid format: "+r);var t;return new lh({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}as.prototype=lh.prototype;function lh(r){this.fill=r.fill===void 0?" ":r.fill+"",this.align=r.align===void 0?">":r.align+"",this.sign=r.sign===void 0?"-":r.sign+"",this.symbol=r.symbol===void 0?"":r.symbol+"",this.zero=!!r.zero,this.width=r.width===void 0?void 0:+r.width,this.comma=!!r.comma,this.precision=r.precision===void 0?void 0:+r.precision,this.trim=!!r.trim,this.type=r.type===void 0?"":r.type+""}lh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Eb(r){t:for(var t=r.length,e=1,i=-1,n;e<t;++e)switch(r[e]){case".":i=n=e;break;case"0":i===0&&(i=e),n=e;break;default:if(!+r[e])break t;i>0&&(i=0);break}return i>0?r.slice(0,i)+r.slice(n+1):r}var Ud;function Sb(r,t){var e=os(r,t);if(!e)return r+"";var i=e[0],n=e[1],s=n-(Ud=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+os(r,Math.max(0,t+s-1))[0]}function gc(r,t){var e=os(r,t);if(!e)return r+"";var i=e[0],n=e[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}const yc={"%":(r,t)=>(r*100).toFixed(t),b:r=>Math.round(r).toString(2),c:r=>r+"",d:bb,e:(r,t)=>r.toExponential(t),f:(r,t)=>r.toFixed(t),g:(r,t)=>r.toPrecision(t),o:r=>Math.round(r).toString(8),p:(r,t)=>gc(r*100,t),r:gc,s:Sb,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16)};function _c(r){return r}var vc=Array.prototype.map,xc=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Cb(r){var t=r.grouping===void 0||r.thousands===void 0?_c:wb(vc.call(r.grouping,Number),r.thousands+""),e=r.currency===void 0?"":r.currency[0]+"",i=r.currency===void 0?"":r.currency[1]+"",n=r.decimal===void 0?".":r.decimal+"",s=r.numerals===void 0?_c:Tb(vc.call(r.numerals,String)),o=r.percent===void 0?"%":r.percent+"",a=r.minus===void 0?"":r.minus+"",h=r.nan===void 0?"NaN":r.nan+"";function l(u){u=as(u);var d=u.fill,f=u.align,p=u.sign,m=u.symbol,g=u.zero,y=u.width,v=u.comma,_=u.precision,x=u.trim,w=u.type;w==="n"?(v=!0,w="g"):yc[w]||(_===void 0&&(_=12),x=!0,w="g"),(g||d==="0"&&f==="=")&&(g=!0,d="0",f="=");var C=m==="$"?e:m==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",T=m==="$"?i:/[%p]/.test(w)?o:"",S=yc[w],F=/[defgprs%]/.test(w);_=_===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_));function O(N){var B=C,A=T,b,I,E;if(w==="c")A=S(N)+A,N="";else{N=+N;var R=N<0||1/N<0;if(N=isNaN(N)?h:S(Math.abs(N),_),x&&(N=Eb(N)),R&&+N==0&&p!=="+"&&(R=!1),B=(R?p==="("?p:a:p==="-"||p==="("?"":p)+B,A=(w==="s"?xc[8+Ud/3]:"")+A+(R&&p==="("?")":""),F){for(b=-1,I=N.length;++b<I;)if(E=N.charCodeAt(b),48>E||E>57){A=(E===46?n+N.slice(b+1):N.slice(b))+A,N=N.slice(0,b);break}}}v&&!g&&(N=t(N,1/0));var L=B.length+N.length+A.length,z=L<y?new Array(y-L+1).join(d):"";switch(v&&g&&(N=t(z+N,z.length?y-A.length:1/0),z=""),f){case"<":N=B+N+A+z;break;case"=":N=B+z+N+A;break;case"^":N=z.slice(0,L=z.length>>1)+B+N+A+z.slice(L);break;default:N=z+B+N+A;break}return s(N)}return O.toString=function(){return u+""},O}function c(u,d){var f=l((u=as(u),u.type="f",u)),p=Math.max(-8,Math.min(8,Math.floor(Kr(d)/3)))*3,m=Math.pow(10,-p),g=xc[8+p/3];return function(y){return f(m*y)+g}}return{format:l,formatPrefix:c}}var vn,Gd,Hd;Ib({thousands:",",grouping:[3],currency:["$",""]});function Ib(r){return vn=Cb(r),Gd=vn.format,Hd=vn.formatPrefix,vn}function Pb(r){return Math.max(0,-Kr(Math.abs(r)))}function Rb(r,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Kr(t)/3)))*3-Kr(Math.abs(r)))}function Mb(r,t){return r=Math.abs(r),t=Math.abs(t)-r,Math.max(0,Kr(t)-Kr(r))+1}function Fb(r,t,e,i){var n=Wx(r,t,e),s;switch(i=as(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(r),Math.abs(t));return i.precision==null&&!isNaN(s=Rb(n,o))&&(i.precision=s),Hd(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=Mb(n,Math.max(Math.abs(r),Math.abs(t))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Pb(n))&&(i.precision=s-(i.type==="%")*2);break}}return Gd(i)}function Bb(r){var t=r.domain;return r.ticks=function(e){var i=t();return Xx(i[0],i[i.length-1],e??10)},r.tickFormat=function(e,i){var n=t();return Fb(n[0],n[n.length-1],e??10,i)},r.nice=function(e){e==null&&(e=10);var i=t(),n=0,s=i.length-1,o=i[n],a=i[s],h,l,c=10;for(a<o&&(l=o,o=a,a=l,l=n,n=s,s=l);c-- >0;){if(l=Ta(o,a,e),l===h)return i[n]=o,i[s]=a,t(i);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;h=l}return r},r}function hs(){var r=xb();return r.copy=function(){return _b(r,hs())},Bd.apply(r,arguments),Bb(r)}const Db=2147483648,Lb=4294967295;function bT(r,t,e){const i=e.filter(f=>f.data.values),n=Hb(i),s=new Map,o=Ub(n,t,s);Gb(o);const a=Nb(n,r),h=Wb(r,o,t),l=kb(s,h),u=[...Ob(l,r),...Object.values(h).flat().filter(f=>!f.exclude)];return{lines:a,areas:u}}function Nb(r,t){return r.filter(i=>i.visualization==="line").map(i=>({id:i.name,label:i.name,width:2,color:ve(i.color||"black"),data:t.map((n,s)=>[n[0],i.values[s]])}))}function Ob(r,t){return r.map((i,n)=>{const s=n+1<r.length?r[n+1]:null;return{id:i.id,color:ve(i.color),data:t.map((o,a)=>[o[0],i.top[a],...s?[s.top[a]]:[]])}})}function kb(r,t){return Array.from(r.values()).sort((i,n)=>i.age-n.age).filter(i=>{const n=t[i.name],s=n&&n.length>0;return s||console.warn(`Intersection surface group '${i.name}' has no valid entries and will be discarded.`),s}).map((i,n)=>{const o=t[i.name][0];return{id:i.name,label:i.name,color:$b(n),top:o.data.map(a=>a[1])}})}function Ub(r,t,e){const i=t&&t.find(o=>o.stratUnitLevel===1),n=i?i.identifier:"SEABED";return r.filter(o=>o.visualization==="interval"||o.visualization==="none").map(o=>{const a=[],h=zd(t,o.name,a);h||console.warn(`No match for ${o.name} in strat column`);const l=a[0]||h,c=l&&l.identifier||n;return l&&!e.has(c)&&e.set(c,{age:l.topAge,name:l.identifier}),{...o,unit:h,group:c}})}function Gb(r){r.sort((t,e)=>{if(!t.unit&&!e.unit)return 0;if(!t.unit)return-1;if(!e.unit)return 1;const i=t.isBase?t.unit.baseAge:t.unit.topAge,n=e.isBase?e.unit.baseAge:e.unit.topAge;return i!==n?i-n:t.isBase&&!e.isBase?1:!t.isBase&&e.isBase?-1:t.unit.stratUnitLevel-e.unit.stratUnitLevel})}function zd(r,t,e=[]){const i=r.find(n=>n.identifier.toLowerCase()===t.toLowerCase());if(i){let n=i;do e.unshift(n),n=r.find(s=>s.identifier===n.stratUnitParent);while(n);return i}return null}function Hb(r){return r.map(t=>{const e=t.visualSettings.displayName,i=e.replace(/\s(Base|Top)/gi,""),n=e.toLowerCase().endsWith("base");return{name:i,isBase:n,values:t.data.values,color:t.visualSettings.colors.crossSection,visualization:t.visualSettings.crossSection.toLowerCase()}})}function zb(r){return r.colorR===null||r.colorG===null||r.colorB===null?Db:r.colorR<<16|r.colorG<<8|r.colorB}const $b=Dd().domain([0,100]).range(db(Di("#e6f1cf","#85906d"),10));function Vb(r,t,e,i){const n=t+1;if(!e||n>=e.length)return;const s=e.findIndex(o=>o.isBase&&o.name===r.name);if(s!==-1)return s;for(let o=n;o<e.length;o++){const a=e[o];if(!(a!=null&&a.isBase)||Xb(r,a,i))return o}}function Xb(r,t,e){const i=[];return zd(e,r.name,i),i.some(n=>t.name===n.identifier)}function Wb(r,t,e){return t.reduce((n,s,o)=>{var a;if(!s.isBase){n[s.group]||(n[s.group]=[]);const h=Vb(s,o,t,e);(a=n[s.group])==null||a.push({id:s.name,label:s.name,color:s.unit&&zb(s.unit)||Lb,exclude:s.visualization==="none"||!s.unit,data:r.map((l,c)=>{const u=s.values[c]!=null?jb(h,t,c):void 0;return[l[0],s.values[c],u]})})}return n},{})}function jb(r,t,e){var i,n;if(!(!t||!r||r>=t.length)){for(let s=r;s<t.length;s++)if(((i=t[s])==null?void 0:i.values[e])!=null)return(n=t[s])==null?void 0:n.values[e]}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Ia=function(r,t){return Ia=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},Ia(r,t)};function ch(r,t){function e(){this.constructor=r}Ia(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Pa=function(){return Pa=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++)for(var n in t=arguments[e])Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r},Pa.apply(this,arguments)};function bc(r,t){for(var e=new Array(r.length),i=0;i<r.length;i++)e[i]=2*r[i]-t[i];return e}function Ra(r,t,e){var i,n,s,o,a=t.length-1;if(e)i=t[r-1<0?a:r-1],n=t[r%t.length],s=t[(r+1)%t.length],o=t[(r+2)%t.length];else{if(r===a)throw Error("There is no spline segment at this index for a closed curve!");n=t[r],s=t[r+1],i=r>0?t[r-1]:bc(n,s),o=r<a-1?t[r+2]:bc(s,n)}return[i,n,s,o]}function Yb(r,t,e){e===void 0&&(e=!1);var i=e?t.length:t.length-1;if(r===1)return{index:i-1,weight:1};var n=i*r,s=Math.floor(n);return{index:s,weight:n-s}}function qb(r,t){for(var e=0;e<r.length;e++)r[e]=t;return r}function Zb(r,t){for(var e=0;e<r.length;e++)r[e]=t(r[e],e);return r}function Kb(r,t,e){e===void 0&&(e=0);for(var i=0;i<r.length;i++)e=t(e,r[i],i);return e}function ls(r,t){t=t||new Array(r.length);for(var e=0;e<r.length;e++)t[e]=r[e];return t}function Dt(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r<t?t:r>e?e:r}function Ma(r,t){var e=t[0];if(r>=t[t.length-1])return t.length-1;if(r<=e)return 0;for(var i=0,n=t.length-1;i<=n;){var s=Math.floor((i+n)/2),o=t[s];if(o<r)i=s+1;else{if(!(o>r))return s;n=s-1}}return Math.max(0,n)}var Xt=Math.pow(2,-42);function wc(r){var t=Math.pow(Math.abs(r),.3333333333333333);return r<0?-t:t}function $d(r,t,e){if(Math.abs(r)<Xt)return Math.abs(t)<Xt?[]:[-e/t];var i=t*t-4*r*e;return Math.abs(i)<Xt?[-t/(2*r)]:i>0?[(-t+Math.sqrt(i))/(2*r),(-t-Math.sqrt(i))/(2*r)]:[]}function Qb(r,t,e,i){if(Math.abs(r)<Xt)return $d(t,e,i);var n,s=(3*r*e-t*t)/(3*r*r),o=(2*t*t*t-9*r*t*e+27*r*r*i)/(27*r*r*r);if(Math.abs(s)<Xt)n=[wc(-o)];else if(Math.abs(o)<Xt)n=[0].concat(s<0?[Math.sqrt(-s),-Math.sqrt(-s)]:[]);else{var a=o*o/4+s*s*s/27;if(Math.abs(a)<Xt)n=[-1.5*o/s,3*o/s];else if(a>0)n=[(h=wc(-o/2-Math.sqrt(a)))-s/(3*h)];else{var h=2*Math.sqrt(-s/3),l=Math.acos(3*o/s/h)/3,c=2*Math.PI/3;n=[h*Math.cos(l),h*Math.cos(l-c),h*Math.cos(l-2*c)]}}for(var u=0;u<n.length;u++)n[u]-=t/(3*r);return n}function Jb(r,t){if(r.length!==t.length)throw Error("Vectors must be of equal length!");for(var e=0,i=0;i<r.length;i++)e+=r[i]*t[i];return e}function xn(r,t,e){if(!(r.length>3)){e=e||new Array(3);var i=r[0],n=r[1],s=r[2]||0,o=t[0],a=t[1],h=t[2]||0;return e[0]=n*h-s*a,e[1]=s*o-i*h,e[2]=i*a-n*o,e}}function Vd(r,t){for(var e=0,i=0;i<r.length;i++)e+=(r[i]-t[i])*(r[i]-t[i]);return e}function Dr(r){for(var t=0,e=0;e<r.length;e++)t+=r[e]*r[e];return Math.sqrt(t)}function cs(r,t){var e=Vd(r,t);return e===0?0:Math.sqrt(e)}function sr(r,t){var e=t?ls(r,t):r,i=Kb(e,function(s,o){return s+Math.pow(o,2)}),n=Math.sqrt(i);return n===0?qb(e,0):Zb(e,function(s){return s/n})}function tw(r,t){if(r.length>2)throw Error("Only supported for 2d vectors");var e=t?ls(r,t):r,i=-e[1];return e[1]=e[0],e[0]=i,e}function ew(r,t,e,i,n){if(n===void 0&&(n=0),n===0)return[0,1,2,3];var s=function(h,l){return Math.pow(Vd(h,l),.5*n)},o=s(t,r),a=s(e,t)+o;return[0,o,a,s(i,e)+a]}function rw(r,t,e,i,n){for(var s=Number.isFinite(n.tension)?n.tension:.5,o=Number.isFinite(n.alpha)?n.alpha:null,a=o>0?ew(r,t,e,i,o):null,h=new Array(r.length),l=0;l<r.length;l++){var c=0,u=0,d=r[l],f=t[l],p=e[l],m=i[l];if(a){var g=a[0],y=a[1],v=a[2],_=a[3];y-v!=0&&(g-y!=0&&g-v!=0&&(c=(1-s)*(v-y)*((d-f)/(g-y)-(d-p)/(g-v)+(f-p)/(y-v))),y-_!=0&&v-_!=0&&(u=(1-s)*(v-y)*((f-p)/(y-v)-(f-m)/(y-_)+(p-m)/(v-_))))}else c=(1-s)*(p-d)*.5,u=(1-s)*(m-f)*.5;var x=2*f-2*p+c+u,w=-3*f+3*p-2*c-u,C=c,T=f;h[l]=[x,w,C,T]}return h}function Lr(r,t){var e=r*r,i=r*e;return t[0]*i+t[1]*e+t[2]*r+t[3]}function Nr(r,t){var e=r*r;return 3*t[0]*e+2*t[1]*r+t[2]}function Ao(r,t){return 6*t[0]*r+2*t[1]}function iw(r,t){var e=t[0],i=t[1],n=t[2],s=t[3]-r;return e===0&&i===0&&n===0&&s===0?[0]:Qb(e,i,n,s).filter(function(o){return o>-Xt&&o<=1+Xt}).map(function(o){return Dt(o,0,1)})}function Fa(r,t,e,i){i===void 0&&(i=null),i=i||new Array(e.length);for(var n=0;n<e.length;n++)i[n]=r(t,e[n]);return i}var Xd=function(){function r(t){t===void 0&&(t=null),this._alpha=0,this._tension=.5,this._closed=!1,this._onInvalidateCache=null,this._onInvalidateCache=t,this._cache={arcLengths:null,coefficients:null}}return r.prototype._invalidateCache=function(){this.points&&(this._cache={arcLengths:null,coefficients:null},this._onInvalidateCache&&this._onInvalidateCache())},Object.defineProperty(r.prototype,"alpha",{get:function(){return this._alpha},set:function(t){Number.isFinite(t)&&t!==this._alpha&&(this._invalidateCache(),this._alpha=t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tension",{get:function(){return this._tension},set:function(t){Number.isFinite(t)&&t!==this._tension&&(this._invalidateCache(),this._tension=t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"points",{get:function(){return this._points},set:function(t){if(!t||t.length<2)throw Error("At least 2 control points are required!");this._points=t,this._invalidateCache()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this._closed},set:function(t){t=!!t,this._closed!==t&&(this._invalidateCache(),this._closed=t)},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this._invalidateCache()},r.prototype.evaluateForT=function(t,e,i){var n=Yb(e,this.points,this.closed),s=n.index;return Fa(t,n.weight,this.getCoefficients(s),i)},r.prototype.getCoefficients=function(t){if(this.points){if(this._cache.coefficients||(this._cache.coefficients=new Map),!this._cache.coefficients.has(t)){var e=Ra(t,this.points,this.closed),i=rw(e[0],e[1],e[2],e[3],{tension:this.tension,alpha:this.alpha});this._cache.coefficients.set(t,i)}return this._cache.coefficients.get(t)}},r}(),nw=function(r){function t(e,i){e===void 0&&(e=300),i===void 0&&(i=null);var n=r.call(this,i)||this;return n._subDivisions=e,n}return ch(t,r),Object.defineProperty(t.prototype,"arcLengths",{get:function(){return this._cache.arcLengths||(this._cache.arcLengths=this.computeArcLengths()),this._cache.arcLengths},enumerable:!1,configurable:!0}),t.prototype._invalidateCache=function(){r.prototype._invalidateCache.call(this),this._cache.arcLengths=null},t.prototype.computeArcLengths=function(){var e,i=[],n=this.evaluateForT(Lr,0),s=0;i.push(0);for(var o=1;o<=this._subDivisions;o++)s+=cs(e=this.evaluateForT(Lr,o/this._subDivisions),n),i.push(s),n=e;return i},t.prototype.lengthAt=function(e){var i=this.arcLengths;return e*i[i.length-1]},t.prototype.getT=function(e){var i=this.arcLengths,n=i.length,s=e*i[n-1],o=Ma(s,i);if(i[o]===s)return o/(n-1);var a=i[o];return(o+(s-a)/(i[o+1]-a))/(n-1)},t.prototype.getU=function(e){if(e===0)return 0;if(e===1)return 1;var i=this.arcLengths,n=i.length-1,s=i[n],o=e*n,a=Math.floor(o),h=i[a];if(o===a)return h/s;var l=a/n;return(h+cs(this.evaluateForT(Lr,l),this.evaluateForT(Lr,e)))/s},t}(Xd),Wd=[[[-.906179845938664,.23692688505618908],[-.5384693101056831,.47862867049936647],[0,.5688888888888889],[.5384693101056831,.47862867049936647],[.906179845938664,.23692688505618908]],[[-.932469514203152,.17132449237917036],[-.6612093864662645,.3607615730481386],[-.2386191860831969,.46791393457269104],[.2386191860831969,.46791393457269104],[.6612093864662645,.3607615730481386],[.932469514203152,.17132449237917036]],[[-.9491079123427585,.1294849661688697],[-.7415311855993945,.27970539148927664],[-.4058451513773972,.3818300505051189],[0,.4179591836734694],[.4058451513773972,.3818300505051189],[.7415311855993945,.27970539148927664],[.9491079123427585,.1294849661688697]],[[-.9602898564975363,.10122853629037626],[-.7966664774136267,.22238103445337448],[-.525532409916329,.31370664587788727],[-.1834346424956498,.362683783378362],[.1834346424956498,.362683783378362],[.525532409916329,.31370664587788727],[.7966664774136267,.22238103445337448],[.9602898564975363,.10122853629037626]],[[-.9681602395076261,.08127438836157441],[-.8360311073266358,.1806481606948574],[-.6133714327005904,.26061069640293544],[-.3242534234038089,.31234707704000286],[0,.3302393550012598],[.3242534234038089,.31234707704000286],[.6133714327005904,.26061069640293544],[.8360311073266358,.1806481606948574],[.9681602395076261,.08127438836157441]],[[-.9739065285171717,.06667134430868814],[-.8650633666889845,.1494513491505806],[-.6794095682990244,.21908636251598204],[-.4333953941292472,.26926671930999635],[-.14887433898163122,.29552422471475287],[.14887433898163122,.29552422471475287],[.4333953941292472,.26926671930999635],[.6794095682990244,.21908636251598204],[.8650633666889845,.1494513491505806],[.9739065285171717,.06667134430868814]],[[-.978228658146056,.0556685671161736],[-.887062599768095,.125580369464904],[-.730152005574049,.186290210927734],[-.519096129206811,.23319376459199],[-.269543155952344,.262804544510246],[0,.2729250867779],[.269543155952344,.262804544510246],[.519096129206811,.23319376459199],[.730152005574049,.186290210927734],[.887062599768095,.125580369464904],[.978228658146056,.0556685671161736]],[[-.981560634246719,.0471753363865118],[-.904117256370474,.106939325995318],[-.769902674194304,.160078328543346],[-.587317954286617,.203167426723065],[-.36783149899818,.233492536538354],[-.125233408511468,.249147045813402],[.125233408511468,.249147045813402],[.36783149899818,.233492536538354],[.587317954286617,.203167426723065],[.769902674194304,.160078328543346],[.904117256370474,.106939325995318],[.981560634246719,.0471753363865118]],[[-.984183054718588,.0404840047653158],[-.917598399222977,.0921214998377284],[-.801578090733309,.138873510219787],[-.64234933944034,.178145980761945],[-.448492751036446,.207816047536888],[-.230458315955134,.226283180262897],[0,.232551553230873],[.230458315955134,.226283180262897],[.448492751036446,.207816047536888],[.64234933944034,.178145980761945],[.801578090733309,.138873510219787],[.917598399222977,.0921214998377284],[.984183054718588,.0404840047653158]],[[-.986283808696812,.0351194603317518],[-.928434883663573,.0801580871597602],[-.827201315069764,.121518570687903],[-.687292904811685,.157203167158193],[-.515248636358154,.185538397477937],[-.319112368927889,.205198463721295],[-.108054948707343,.215263853463157],[.108054948707343,.215263853463157],[.319112368927889,.205198463721295],[.515248636358154,.185538397477937],[.687292904811685,.157203167158193],[.827201315069764,.121518570687903],[.928434883663573,.0801580871597602],[.986283808696812,.0351194603317518]],[[-.987992518020485,.0307532419961172],[-.937273392400705,.0703660474881081],[-.848206583410427,.107159220467171],[-.72441773136017,.139570677926154],[-.570972172608538,.166269205816993],[-.394151347077563,.186161000015562],[-.201194093997434,.198431485327111],[0,.202578241925561],[.201194093997434,.198431485327111],[.394151347077563,.186161000015562],[.570972172608538,.166269205816993],[.72441773136017,.139570677926154],[.848206583410427,.107159220467171],[.937273392400705,.0703660474881081],[.987992518020485,.0307532419961172]],[[-.989400934991649,.027152459411754],[-.944575023073232,.0622535239386478],[-.865631202387831,.0951585116824927],[-.755404408355003,.124628971255533],[-.617876244402643,.149595988816576],[-.458016777657227,.169156519395002],[-.281603550779258,.182603415044923],[-.0950125098376374,.189450610455068],[.0950125098376374,.189450610455068],[.281603550779258,.182603415044923],[.458016777657227,.169156519395002],[.617876244402643,.149595988816576],[.755404408355003,.124628971255533],[.865631202387831,.0951585116824927],[.944575023073232,.0622535239386478],[.989400934991649,.027152459411754]],[[-.990575475314417,.0241483028685479],[-.950675521768767,.0554595293739872],[-.880239153726985,.0850361483171791],[-.781514003896801,.111883847193403],[-.65767115921669,.135136368468525],[-.512690537086476,.15404576107681],[-.351231763453876,.16800410215645],[-.178484181495847,.176562705366992],[0,.179446470356206],[.178484181495847,.176562705366992],[.351231763453876,.16800410215645],[.512690537086476,.15404576107681],[.65767115921669,.135136368468525],[.781514003896801,.111883847193403],[.880239153726985,.0850361483171791],[.950675521768767,.0554595293739872],[.990575475314417,.0241483028685479]],[[-.99156516842093,.0216160135264833],[-.955823949571397,.0497145488949698],[-.892602466497555,.076425730254889],[-.803704958972523,.100942044106287],[-.691687043060353,.122555206711478],[-.559770831073947,.14064291467065],[-.411751161462842,.154684675126265],[-.251886225691505,.164276483745832],[-.0847750130417353,.169142382963143],[.0847750130417353,.169142382963143],[.251886225691505,.164276483745832],[.411751161462842,.154684675126265],[.559770831073947,.14064291467065],[.691687043060353,.122555206711478],[.803704958972523,.100942044106287],[.892602466497555,.076425730254889],[.955823949571397,.0497145488949697],[.99156516842093,.0216160135264833]],[[-.992406843843584,.0194617882297264],[-.96020815213483,.0448142267656996],[-.903155903614817,.0690445427376412],[-.822714656537142,.0914900216224499],[-.720966177335229,.111566645547333],[-.600545304661681,.128753962539336],[-.46457074137596,.142606702173606],[-.316564099963629,.152766042065859],[-.160358645640225,.158968843393954],[0,.161054449848783],[.160358645640225,.158968843393954],[.316564099963629,.152766042065859],[.46457074137596,.142606702173606],[.600545304661681,.128753962539336],[.720966177335229,.111566645547333],[.822714656537142,.0914900216224499],[.903155903614817,.0690445427376412],[.96020815213483,.0448142267656996],[.992406843843584,.0194617882297264]],[[-.993128599185094,.0176140071391521],[-.963971927277913,.0406014298003869],[-.912234428251325,.062672048334109],[-.839116971822218,.0832767415767047],[-.74633190646015,.10193011981724],[-.636053680726515,.118194531961518],[-.510867001950827,.131688638449176],[-.373706088715419,.142096109318382],[-.227785851141645,.149172986472603],[-.0765265211334973,.152753387130725],[.0765265211334973,.152753387130725],[.227785851141645,.149172986472603],[.373706088715419,.142096109318382],[.510867001950827,.131688638449176],[.636053680726515,.118194531961518],[.74633190646015,.10193011981724],[.839116971822218,.0832767415767047],[.912234428251325,.062672048334109],[.963971927277913,.0406014298003869],[.993128599185094,.0176140071391521]],[[-.993752170620389,.0160172282577743],[-.967226838566306,.0369537897708524],[-.9200993341504,.0571344254268572],[-.853363364583317,.0761001136283793],[-.768439963475677,.0934444234560338],[-.667138804197412,.108797299167148],[-.551618835887219,.121831416053728],[-.424342120207438,.132268938633337],[-.288021316802401,.139887394791073],[-.145561854160895,.14452440398997],[0,.14608113364969],[.145561854160895,.14452440398997],[.288021316802401,.139887394791073],[.424342120207438,.132268938633337],[.551618835887219,.121831416053728],[.667138804197412,.108797299167148],[.768439963475677,.0934444234560338],[.853363364583317,.0761001136283793],[.9200993341504,.0571344254268572],[.967226838566306,.0369537897708524],[.993752170620389,.0160172282577743]],[[-.994294585482399,.0146279952982722],[-.970060497835428,.0337749015848141],[-.926956772187174,.0522933351526832],[-.8658125777203,.0697964684245204],[-.787816805979208,.0859416062170677],[-.694487263186682,.10041414444288],[-.587640403506911,.112932296080539],[-.469355837986757,.123252376810512],[-.341935820892084,.131173504787062],[-.207860426688221,.136541498346015],[-.0697392733197222,.139251872855631],[.0697392733197222,.139251872855631],[.207860426688221,.136541498346015],[.341935820892084,.131173504787062],[.469355837986757,.123252376810512],[.587640403506911,.112932296080539],[.694487263186682,.10041414444288],[.787816805979208,.0859416062170677],[.8658125777203,.0697964684245204],[.926956772187174,.0522933351526832],[.970060497835428,.0337749015848141],[.994294585482399,.0146279952982722]],[[-.994769334997552,.0134118594871417],[-.972542471218115,.0309880058569794],[-.932971086826016,.0480376717310846],[-.876752358270441,.0642324214085258],[-.804888401618839,.0792814117767189],[-.71866136313195,.0929157660600351],[-.619609875763646,.104892091464541],[-.509501477846007,.114996640222411],[-.39030103803029,.123049084306729],[-.264135680970344,.128905722188082],[-.133256824298466,.132462039404696],[0,.133654572186106],[.133256824298466,.132462039404696],[.264135680970344,.128905722188082],[.39030103803029,.123049084306729],[.509501477846007,.114996640222411],[.619609875763646,.104892091464541],[.71866136313195,.0929157660600351],[.804888401618839,.0792814117767189],[.876752358270441,.0642324214085258],[.932971086826016,.0480376717310846],[.972542471218115,.0309880058569794],[.994769334997552,.0134118594871417]],[[-.995187219997021,.0123412297999872],[-.974728555971309,.0285313886289336],[-.938274552002732,.0442774388174198],[-.886415527004401,.0592985849154367],[-.820001985973902,.0733464814110803],[-.740124191578554,.0861901615319532],[-.648093651936975,.0976186521041138],[-.545421471388839,.107444270115965],[-.433793507626045,.115505668053725],[-.315042679696163,.121670472927803],[-.191118867473616,.125837456346828],[-.0640568928626056,.127938195346752],[.0640568928626056,.127938195346752],[.191118867473616,.125837456346828],[.315042679696163,.121670472927803],[.433793507626045,.115505668053725],[.545421471388839,.107444270115965],[.648093651936975,.0976186521041138],[.740124191578554,.0861901615319532],[.820001985973902,.0733464814110803],[.886415527004401,.0592985849154367],[.938274552002732,.0442774388174198],[.974728555971309,.0285313886289336],[.995187219997021,.0123412297999872]],[[-.995556969790498,.0113937985010262],[-.976663921459517,.0263549866150321],[-.942974571228974,.0409391567013063],[-.894991997878275,.0549046959758351],[-.833442628760834,.0680383338123569],[-.759259263037357,.080140700335001],[-.673566368473468,.0910282619829636],[-.577662930241222,.10053594906705],[-.473002731445714,.108519624474263],[-.361172305809387,.114858259145711],[-.243866883720988,.119455763535784],[-.12286469261071,.12224244299031],[0,.123176053726715],[.12286469261071,.12224244299031],[.243866883720988,.119455763535784],[.361172305809387,.114858259145711],[.473002731445714,.108519624474263],[.577662930241222,.10053594906705],[.673566368473468,.0910282619829636],[.759259263037357,.080140700335001],[.833442628760834,.0680383338123569],[.894991997878275,.0549046959758351],[.942974571228974,.0409391567013063],[.976663921459517,.0263549866150321],[.995556969790498,.0113937985010262]],[[-.995885701145616,.010551372617343],[-.97838544595647,.0244178510926319],[-.947159066661714,.0379623832943627],[-.902637861984307,.0509758252971478],[-.845445942788498,.0632740463295748],[-.776385948820678,.0746841497656597],[-.696427260419957,.0850458943134852],[-.606692293017618,.0942138003559141],[-.508440714824505,.102059161094425],[-.403051755123486,.108471840528576],[-.292004839485956,.113361816546319],[-.17685882035689,.116660443485296],[-.0592300934293132,.118321415279262],[.0592300934293132,.118321415279262],[.17685882035689,.116660443485296],[.292004839485956,.113361816546319],[.403051755123486,.108471840528576],[.508440714824505,.102059161094425],[.606692293017618,.0942138003559141],[.696427260419957,.0850458943134852],[.776385948820678,.0746841497656597],[.845445942788498,.0632740463295748],[.902637861984307,.0509758252971478],[.947159066661714,.0379623832943627],[.97838544595647,.0244178510926319],[.995885701145616,.010551372617343]],[[-.996179262888988,.00979899605129436],[-.979923475961501,.0226862315961806],[-.950900557814705,.0352970537574197],[-.909482320677491,.047449412520615],[-.856207908018294,.0589835368598335],[-.791771639070508,.0697488237662455],[-.717013473739423,.0796048677730577],[-.632907971946495,.0884231585437569],[-.540551564579456,.0960887273700285],[-.441148251750026,.102501637817745],[-.335993903638508,.107578285788533],[-.226459365439536,.111252488356845],[-.113972585609529,.113476346108965],[0,.114220867378956],[.113972585609529,.113476346108965],[.226459365439536,.111252488356845],[.335993903638508,.107578285788533],[.441148251750026,.102501637817745],[.540551564579456,.0960887273700285],[.632907971946495,.0884231585437569],[.717013473739423,.0796048677730577],[.791771639070508,.0697488237662455],[.856207908018294,.0589835368598336],[.909482320677491,.047449412520615],[.950900557814705,.0352970537574197],[.979923475961501,.0226862315961806],[.996179262888988,.00979899605129436]],[[-.996442497573954,.00912428259309452],[-.981303165370872,.0211321125927712],[-.954259280628938,.0329014277823043],[-.915633026392132,.0442729347590042],[-.865892522574395,.0551073456757167],[-.805641370917179,.0652729239669995],[-.735610878013631,.0746462142345687],[-.656651094038864,.0831134172289012],[-.569720471811401,.0905717443930328],[-.475874224955118,.0969306579979299],[-.376251516089078,.10211296757806],[-.272061627635178,.106055765922846],[-.16456928213338,.108711192258294],[-.0550792898840342,.110047013016475],[.0550792898840342,.110047013016475],[.16456928213338,.108711192258294],[.272061627635178,.106055765922846],[.376251516089078,.10211296757806],[.475874224955118,.0969306579979299],[.569720471811401,.0905717443930328],[.656651094038864,.0831134172289012],[.735610878013631,.0746462142345687],[.805641370917179,.0652729239669995],[.865892522574395,.0551073456757167],[.915633026392132,.0442729347590042],[.954259280628938,.0329014277823043],[.981303165370872,.0211321125927712],[.996442497573954,.00912428259309452]],[[-.996679442260596,.00851690387874641],[-.982545505261413,.0197320850561227],[-.957285595778087,.0307404922020936],[-.921180232953058,.0414020625186828],[-.874637804920102,.0515948269024979],[-.818185487615252,.0612030906570791],[-.752462851734477,.0701179332550512],[-.678214537602686,.0782383271357637],[-.596281797138227,.0854722573661725],[-.507592955124227,.0917377571392587],[-.413152888174008,.0969638340944086],[-.314031637867639,.101091273759914],[-.211352286166001,.104073310077729],[-.106278230132679,.10587615509732],[0,.106479381718314],[.106278230132679,.10587615509732],[.211352286166001,.104073310077729],[.314031637867639,.101091273759914],[.413152888174008,.0969638340944086],[.507592955124227,.0917377571392587],[.596281797138227,.0854722573661725],[.678214537602686,.0782383271357637],[.752462851734477,.0701179332550512],[.818185487615252,.0612030906570791],[.874637804920102,.0515948269024979],[.921180232953058,.0414020625186828],[.957285595778087,.0307404922020936],[.982545505261413,.0197320850561227],[.996679442260596,.00851690387874641]],[[-.996893484074649,.0079681924961666],[-.983668123279747,.0184664683110909],[-.960021864968307,.0287847078833233],[-.926200047429274,.038799192569627],[-.882560535792052,.048402672830594],[-.829565762382768,.057493156217619],[-.767777432104826,.0659742298821805],[-.697850494793315,.0737559747377052],[-.620526182989242,.0807558952294202],[-.536624148142019,.0868997872010829],[-.447033769538089,.0921225222377861],[-.352704725530878,.0963687371746442],[-.254636926167889,.0995934205867952],[-.153869913608583,.101762389748405],[-.0514718425553176,.102852652893558],[.0514718425553176,.102852652893558],[.153869913608583,.101762389748405],[.254636926167889,.0995934205867952],[.352704725530878,.0963687371746442],[.447033769538089,.0921225222377861],[.536624148142019,.0868997872010829],[.620526182989242,.0807558952294202],[.697850494793315,.0737559747377052],[.767777432104826,.0659742298821805],[.829565762382768,.057493156217619],[.882560535792052,.048402672830594],[.926200047429274,.038799192569627],[.960021864968307,.0287847078833233],[.983668123279747,.0184664683110909],[.996893484074649,.0079681924961666]]],Tc=Wd.length+5,sw=function(r){function t(e,i,n){e===void 0&&(e=24),i===void 0&&(i=21);var s=r.call(this,n)||this;return s._nSamples=21,s._gauss=function(o){if(o<5||o>Tc)throw Error("Order for Gaussian Quadrature must be in the range of ".concat(5," and ").concat(Tc,"."));return Wd[o-5]}(e),s._nSamples=i,s}return ch(t,r),t.prototype._invalidateCache=function(){r.prototype._invalidateCache.call(this),this._cache.arcLengths=null,this._cache.samples=null},Object.defineProperty(t.prototype,"arcLengths",{get:function(){return this._cache.arcLengths||(this._cache.arcLengths=this.computeArcLengths()),this._cache.arcLengths},enumerable:!1,configurable:!0}),t.prototype.getSamples=function(e){if(this.points){if(this._cache.samples||(this._cache.samples=new Map),!this._cache.samples.has(e)){for(var i=this._nSamples,n=[],s=[],o=this.getCoefficients(e),a=0;a<i;++a){var h=a/(i-1);n.push(this.computeArcLength(e,0,h));var l=Dr(Fa(Nr,h,o)),c=l===0?0:1/l;this.tension>.95&&(c=Dt(c,-1,1)),s.push(c)}var u=i-1,d=[],f=[],p=n[0],m=s[0],g=1/u;for(a=0;a<u;++a){var y=p,v=(p=n[a+1])-y,_=m,x=s[a+1];m=x;var w=g/v,C=(_+x-2*w)/(v*v),T=(3*w-2*_-x)/v;d.push(C),f.push(T)}this._cache.samples.set(e,[n,s,f,d])}return this._cache.samples.get(e)}},t.prototype.computeArcLength=function(e,i,n){if(i===void 0&&(i=0),n===void 0&&(n=1),i===n)return 0;for(var s=this.getCoefficients(e),o=.5*(n-i),a=0,h=0;h<this._gauss.length;h++){var l=this._gauss[h],c=l[0];a+=l[1]*Dr(Fa(Nr,o*c+o+i,s))}return o*a},t.prototype.computeArcLengths=function(){if(this.points){var e=[];e.push(0);for(var i=this.closed?this.points.length:this.points.length-1,n=0,s=0;s<i;s++)n+=this.computeArcLength(s),e.push(n);return e}},t.prototype.inverse=function(e,i){var n=1/(this._nSamples-1),s=this.getSamples(e),o=s[0],a=s[1],h=s[2],l=s[3];if(i>=o[o.length-1])return 1;if(i<=0)return 0;var c=Math.max(0,Ma(i,o)),u=c*n;if(o[c]===i)return u;var d=a[c],f=l[c],p=h[c],m=i-o[c];return((f*m+p)*m+d)*m+u},t.prototype.lengthAt=function(e){return e*this.arcLengths[this.arcLengths.length-1]},t.prototype.getT=function(e){var i=this.arcLengths,n=i.length,s=e*i[n-1],o=Ma(s,i),a=o/(n-1);if(i[o]===s)return a;var h=s-i[o];return(o+this.inverse(o,h))/(n-1)},t.prototype.getU=function(e){if(e===0)return 0;if(e===1)return 1;var i=this.arcLengths,n=i.length-1,s=i[n],o=e*n,a=Math.floor(o),h=i[a];if(o===a)return h/s;var l=o-a;return(h+this.computeArcLength(a,0,l))/s},t}(Xd),ow=function(){function r(t,e){e===void 0&&(e={});var i=this;this._cache=new Map;var n=(e=Pa({tension:.5,alpha:0,closed:!1},e)).arcDivisions?new nw(e.arcDivisions,function(){return i._invalidateCache()}):new sw(e.numericalApproximationOrder,e.numericalInverseSamples,function(){return i._invalidateCache()});n.alpha=e.alpha,n.tension=e.tension,n.closed=e.closed,n.points=t,this._lmargin=e.lmargin||1-n.tension,this._curveMapper=n}return r.prototype.getTimeFromPosition=function(t,e){return e===void 0&&(e=!1),this._curveMapper.getT(e?Dt(t,0,1):t)},r.prototype.getPositionFromTime=function(t,e){return e===void 0&&(e=!1),this._curveMapper.getU(e?Dt(t,0,1):t)},r.prototype.getPositionFromLength=function(t,e){e===void 0&&(e=!1);var i=e?Dt(t,0,this.length):t;return this._curveMapper.getU(i/this.length)},r.prototype.getLengthAt=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!1),this._curveMapper.lengthAt(e?Dt(t,0,1):t)},r.prototype.getTimeAtKnot=function(t){if(t<0||t>this.points.length-1)throw Error("Invalid index!");return t===0?0:this.closed||t!==this.points.length-1?t/(this.closed?this.points.length:this.points.length-1):1},r.prototype.getPositionAtKnot=function(t){return this.getPositionFromTime(this.getTimeAtKnot(t))},r.prototype.getPointAtTime=function(t,e){return(t=Dt(t,0,1))===0?ls(this.points[0],e):t===1?ls(this.closed?this.points[0]:this.points[this.points.length-1],e):this._curveMapper.evaluateForT(Lr,t,e)},r.prototype.getPointAt=function(t,e){return this.getPointAtTime(this.getTimeFromPosition(t),e)},r.prototype.getTangentAt=function(t,e){var i=Dt(this.getTimeFromPosition(t),0,1);return this.getTangentAtTime(i,e)},r.prototype.getTangentAtTime=function(t,e){return sr(this._curveMapper.evaluateForT(Nr,t,e))},r.prototype.getNormalAt=function(t,e){var i=Dt(this.getTimeFromPosition(t),0,1);return this.getNormalAtTime(i,e)},r.prototype.getNormalAtTime=function(t,e){var i=sr(this._curveMapper.evaluateForT(Nr,t));if(!(i.length<2||i.length>3)){var n=e||new Array(i.length);if(i.length===2)return n[0]=-i[1],n[1]=i[0],n;var s=sr(this._curveMapper.evaluateForT(Ao,t));return sr(xn(xn(i,s),i),n)}},r.prototype.getCurvatureAt=function(t){var e=Dt(this.getTimeFromPosition(t),0,1);return this.getCurvatureAtTime(e)},r.prototype.getCurvatureAtTime=function(t){var e=this._curveMapper.evaluateForT(Nr,t),i=this._curveMapper.evaluateForT(Ao,t),n=sr(e,[]),s=0,o=void 0;if(e.length===2){if((u=Math.pow(e[0]*e[0]+e[1]*e[1],1.5))!==0){var a=(e[0]*i[1]-e[1]*i[0])/u;o=a<0?[n[1],-n[0]]:[-n[1],n[0]],s=Math.abs(a)}}else if(e.length===3){var h=Dr(e),l=xn(e,i);o=sr(xn(l,e)),h!==0&&(s=Dr(l)/Math.pow(h,3))}else{h=Dr(e);var c=Dr(i),u=Math.pow(h,3),d=Jb(e,i);u!==0&&(s=Math.sqrt(Math.pow(h,2)*Math.pow(c,2)-Math.pow(d,2))/u)}return{curvature:s,radius:s!==0?1/s:0,tangent:n,direction:o}},r.prototype.getDerivativeAt=function(t,e){var i=Dt(this.getTimeFromPosition(t),0,1);return this._curveMapper.evaluateForT(Nr,i,e)},r.prototype.getSecondDerivativeAt=function(t,e){var i=Dt(this.getTimeFromPosition(t),0,1);return this._curveMapper.evaluateForT(Ao,i,e)},r.prototype.getBoundingBox=function(t,e){if(t===void 0&&(t=0),e===void 0&&(e=1),t===0&&e===1&&this._cache.has("bbox"))return this._cache.get("bbox");for(var i=[],n=[],s=this.getTimeFromPosition(t),o=this.getTimeFromPosition(e),a=this.getPointAtTime(s),h=this.getPointAtTime(o),l=this.closed?this.points.length:this.points.length-1,c=Math.floor(l*s),u=Math.ceil(l*o),d=0;d<a.length;d++)i[d]=Math.min(a[d],h[d]),n[d]=Math.max(a[d],h[d]);for(var f=function(y){var v=Ra(y-1,p.points,p.closed)[2];if(y<u)for(var _=0;_<v.length;_++)v[_]<i[_]&&(i[_]=v[_]),v[_]>n[_]&&(n[_]=v[_]);if(p.tension<1){var x=l*s-(y-1),w=l*o-(y-1),C=function(F){return F>-Xt&&F<=1+Xt&&(y-1!==c||F>x)&&(y!==u||F<w)},T=p._curveMapper.getCoefficients(y-1),S=function(F){var O=T[F];$d(3*O[0],2*O[1],O[2]).filter(C).forEach(function(N){var B=Lr(N,T[F]);B<i[F]&&(i[F]=B),B>n[F]&&(n[F]=B)})};for(_=0;_<T.length;_++)S(_)}},p=this,m=c+1;m<=u;m++)f(m);var g={min:i,max:n};return t===0&&e===1&&this._cache.set("bbox",g),g},r.prototype.getPoints=function(t,e,i,n){if(t===void 0&&(t=100),i===void 0&&(i=0),n===void 0&&(n=1),!t||t<=0)throw Error("Invalid arguments passed to getPoints(). You must specify at least 1 sample/segment.");if(!(i<0||n>1||n<i)){for(var s=[],o=0;o<=t;o++){var a=i===0&&n===1?o/t:i+o/t*(n-i);s.push(this.getPointAt(a,e&&new e))}return s}},r.prototype.getNearestPosition=function(t,e){var i=this;if(e===void 0&&(e=1e-5),e<=0||!Number.isFinite(e))throw Error("Invalid threshold. Must be a number greater than zero!");var n=10*this.points.length-1,s=new Array(t.length),o=1/0,a=0,h=this.createLookupTable(n);Array.from(h.keys()).forEach(function(d){var f=h.get(d),p=cs(t,f);if(p<o)return o=p,a=d,!0});for(var l=this.getTimeFromPosition(a),c=function(d){if(d>=0&&d<=1){i.getPointAtTime(d,s);var f=cs(t,s);if(f<o)return o=f,l=d,!0}},u=.005;u>e;)c(l-u)||c(l+u)||(u/=2);return{u:a=this._curveMapper.getU(l),distance:o,point:s}},r.prototype.getIntersects=function(t,e,i,n){var s=this;e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=this._lmargin);var o=this.getIntersectsAsTime(t,e,i,n).map(function(a){return s.getPointAtTime(a)});return Math.abs(i)===1?o.length===1?o[0]:null:o},r.prototype.getIntersectsAsPositions=function(t,e,i,n){var s=this;return e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=this._lmargin),this.getIntersectsAsTime(t,e,i,n).map(function(o){return s.getPositionFromTime(o)})},r.prototype.getIntersectsAsTime=function(t,e,i,n){e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=this._lmargin);for(var s=e,o=new Set,a=this.closed?this.points.length:this.points.length-1,h=0;h<a&&(i===0||o.size<Math.abs(i));h+=1){var l=i<0?a-(h+1):h,c=Ra(l,this.points,this.closed),u=c[1],d=c[2],f=this._curveMapper.getCoefficients(l),p=void 0,m=void 0;if(u[s]<d[s]?(p=u[s],m=d[s]):(p=d[s],m=u[s]),t-n<=m&&t+n>=p){var g=iw(t,f[s]);i<0?g.sort(function(_,x){return x-_}):i>=0&&g.sort(function(_,x){return _-x});for(var y=0;y<g.length;y++){var v=(g[y]+l)/a;if(o.add(v),i!==0&&o.size===Math.abs(i))break}}}return Array.from(o)},r.prototype.createLookupTable=function(t,e,i){if(e===void 0&&(e=0),i===void 0&&(i=1),!t||t<=1)throw Error("Invalid arguments passed to createLookupTable(). You must specify at least 2 samples.");if(!(e<0||i>1||i<e)){var n="lut_".concat(t,"_").concat(e,"_").concat(i);if(!this._cache.has(n)){for(var s=new Map,o=0;o<t;o++){var a=e===0&&i===1?o/(t-1):e+o/(t-1)*(i-e),h=this.getPointAt(a);s.set(a,h)}this._cache.set(n,s)}return this._cache.get(n)}},r.prototype.forEach=function(t,e,i,n){var s=this;i===void 0&&(i=0),n===void 0&&(n=1);var o=[];if(Number.isFinite(e)){if(e<=1)throw Error("Invalid arguments passed to forEach(). You must specify at least 2 samples.");for(var a=e,h=0;h<e;h++){var l=i===0&&n===1?h/(a-1):i+h/(a-1)*(n-i);o.push(l)}}else Array.isArray(e)&&(o=e);var c=null;o.forEach(function(u,d){if(!Number.isFinite(u)||u<0||u>1)throw Error("Invalid position (u) for sample in forEach!");var f=s.getTimeFromPosition(u),p=t({u,t:f,i:d,prev:c});c={u,t:f,i:d,value:p}})},r.prototype.map=function(t,e,i,n){var s=this;i===void 0&&(i=0),n===void 0&&(n=1);var o=[];if(Number.isFinite(e)){if(e<=1)throw Error("Invalid arguments passed to map(). You must specify at least 2 samples.");for(var a=e,h=0;h<e;h++){var l=i===0&&n===1?h/(a-1):i+h/(a-1)*(n-i);o.push(l)}}else Array.isArray(e)&&(o=e);var c=null;return o.map(function(u,d){if(!Number.isFinite(u)||u<0||u>1)throw Error("Invalid position (u) for sample in map()!");var f=s.getTimeFromPosition(u),p=t({u,t:f,i:d,prev:c});return c={u,t:f,i:d,value:p},p})},r.prototype.reduce=function(t,e,i,n,s){var o=this;n===void 0&&(n=0),s===void 0&&(s=1);var a=[];if(Number.isFinite(i)){if(i<=1)throw Error("Invalid arguments passed to map(). You must specify at least 2 samples.");for(var h=i,l=0;l<i;l++){var c=n===0&&s===1?l/(h-1):n+l/(h-1)*(s-n);a.push(c)}}else Array.isArray(i)&&(a=i);return a.reduce(function(u,d,f){if(!Number.isFinite(d)||d<0||d>1)throw Error("Invalid position (u) for sample in map()!");var p=o.getTimeFromPosition(d);return t({acc:u,u:d,t:p,i:f})},e)},r.prototype._invalidateCache=function(){return this._cache=new Map,this},r.prototype.reset=function(){this._curveMapper.reset()},Object.defineProperty(r.prototype,"points",{get:function(){return this._curveMapper.points},set:function(t){this._curveMapper.points=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tension",{get:function(){return this._curveMapper.tension},set:function(t){this._curveMapper.tension=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alpha",{get:function(){return this._curveMapper.alpha},set:function(t){this._curveMapper.alpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this._curveMapper.closed},set:function(t){this._curveMapper.closed=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this._curveMapper.lengthAt(1)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minX",{get:function(){return this.getBoundingBox().min[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxX",{get:function(){return this.getBoundingBox().max[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minY",{get:function(){return this.getBoundingBox().min[1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxY",{get:function(){return this.getBoundingBox().max[1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minZ",{get:function(){return this.getBoundingBox().min[2]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxZ",{get:function(){return this.getBoundingBox().max[2]},enumerable:!1,configurable:!0}),r}();(function(r){function t(e,i,n,s,o){return i===void 0&&(i=.5),n===void 0&&(n=300),s===void 0&&(s=!1),o===void 0&&(o=0),r.call(this,e.map(function(a){return[a[0],a[1]]}),{tension:i,alpha:o,arcDivisions:n,closed:s})||this}return ch(t,r),t.prototype.x=function(e,i,n){i===void 0&&(i=0),n===void 0&&(n=this._lmargin);var s=this.getIntersects(e,1,i,n);return Math.abs(i)===1?s[0]:s.map(function(o){return o[0]})},t.prototype.y=function(e,i,n){i===void 0&&(i=0),n===void 0&&(n=this._lmargin);var s=this.getIntersects(e,0,i,n);return Math.abs(i)===1?s[1]:s.map(function(o){return o[1]})},t.prototype.getNormalAt=function(e,i){return sr(tw(this.getTangentAt(e,i)))},t.prototype.getAngleAt=function(e){var i=this.getTangentAt(e);return Math.atan2(i[1],i[0])},t.prototype.getBoundingBox=function(e,i){e===void 0&&(e=0),i===void 0&&(i=1);var n=r.prototype.getBoundingBox.call(this,e,i);return{x1:n.min[0],x2:n.max[0],y1:n.min[1],y2:n.max[1],min:n.min,max:n.max}},t})(ow);const aw={dash:[10,5],width:1,color:16777215,alpha:1,scale:1,useTexture:!1,alignment:.5},jd=class Me{constructor(t,e={}){this.cursor=new K,this.scale=1,this.graphics=t,e={...aw,...e},this.dash=e.dash,this.dashSize=this.dash.reduce((i,n)=>i+n),this.useTexture=e.useTexture,this.options=e,this.setLineStyle()}setLineStyle(){const t=this.options;if(this.useTexture){const e=Me.getTexture(t,this.dashSize);this.graphics.lineTextureStyle({width:t.width*t.scale,color:t.color,alpha:t.alpha,texture:e,alignment:t.alignment})}else this.graphics.lineStyle({width:t.width*t.scale,color:t.color,alpha:t.alpha,cap:t.cap,join:t.join,alignment:t.alignment});this.scale=t.scale}static distance(t,e,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))}moveTo(t,e){return this.lineLength=0,this.cursor.set(t,e),this.start=new K(t,e),this.graphics.moveTo(this.cursor.x,this.cursor.y),this}lineTo(t,e,i){typeof this.lineLength===void 0&&this.moveTo(0,0);const n=Me.distance(this.cursor.x,this.cursor.y,t,e),s=Math.atan2(e-this.cursor.y,t-this.cursor.x),o=i&&t===this.start.x&&e===this.start.y;if(this.useTexture)if(this.graphics.moveTo(this.cursor.x,this.cursor.y),this.adjustLineStyle(s),o&&this.dash.length%2===0){const a=Math.min(this.dash[this.dash.length-1],n);this.graphics.lineTo(t-Math.cos(s)*a,e-Math.sin(s)*a),this.graphics.closePath()}else this.graphics.lineTo(t,e);else{const a=Math.cos(s),h=Math.sin(s);let l=this.cursor.x,c=this.cursor.y;const u=this.lineLength%(this.dashSize*this.scale);let d=0,f=0,p=0;for(let g=0;g<this.dash.length;g++){const y=this.dash[g]*this.scale;if(u<p+y){d=g,f=u-p;break}else p+=y}let m=n;for(;m>0;){const g=this.dash[d]*this.scale-f,y=m>g?g:m;if(o&&Me.distance(l+a*y,c+h*y,this.start.x,this.start.y)<=y){if(d%2===0){const _=Me.distance(l,c,this.start.x,this.start.y)-this.dash[this.dash.length-1]*this.scale;l+=a*_,c+=h*_,this.graphics.lineTo(l,c)}break}l+=a*y,c+=h*y,d%2?this.graphics.moveTo(l,c):this.graphics.lineTo(l,c),m-=y,d++,d=d===this.dash.length?0:d,f=0}}return this.lineLength+=n,this.cursor.set(t,e),this}closePath(){this.lineTo(this.start.x,this.start.y,!0)}drawCircle(t,e,i,n=80,s){const o=Math.PI*2/n;let a=0,h;s?(h=new K(t+Math.cos(a)*i,e+Math.sin(a)*i),s.apply(h,h),this.moveTo(h[0],h[1])):(h=new K(t+Math.cos(a)*i,e+Math.sin(a)*i),this.moveTo(h.x,h.y)),a+=o;for(let l=1;l<n+1;l++){const c=l===n?h:[t+Math.cos(a)*i,e+Math.sin(a)*i];this.lineTo(c[0],c[1]),a+=o}return this}drawEllipse(t,e,i,n,s=80,o){const a=Math.PI*2/s;let h;const l=new K;for(let c=0;c<Math.PI*2;c+=a){let u=t-i*Math.sin(c),d=e-n*Math.cos(c);o&&(l.set(u,d),o.apply(l,l),u=l.x,d=l.y),c===0?(this.moveTo(u,d),h={x:u,y:d}):this.lineTo(u,d)}return this.lineTo(h.x,h.y,!0),this}drawPolygon(t,e){const i=new K;if(typeof t[0]=="number")if(e){i.set(t[0],t[1]),e.apply(i,i),this.moveTo(i.x,i.y);for(let n=2;n<t.length;n+=2)i.set(t[n],t[n+1]),e.apply(i,i),this.lineTo(i.x,i.y,n===t.length-2)}else{this.moveTo(t[0],t[1]);for(let n=2;n<t.length;n+=2)this.lineTo(t[n],t[n+1],n===t.length-2)}else if(e){const n=t[0];i.copyFrom(n),e.apply(i,i),this.moveTo(i.x,i.y);for(let s=1;s<t.length;s++){const o=t[s];i.copyFrom(o),e.apply(i,i),this.lineTo(i.x,i.y,s===t.length-1)}}else{const n=t[0];this.moveTo(n.x,n.y);for(let s=1;s<t.length;s++){const o=t[s];this.lineTo(o.x,o.y,s===t.length-1)}}return this}drawRect(t,e,i,n,s){if(s){const o=new K;o.set(t,e),s.apply(o,o),this.moveTo(o.x,o.y),o.set(t+i,e),s.apply(o,o),this.lineTo(o.x,o.y),o.set(t+i,e+n),s.apply(o,o),this.lineTo(o.x,o.y),o.set(t,e+n),s.apply(o,o),this.lineTo(o.x,o.y),o.set(t,e),s.apply(o,o),this.lineTo(o.x,o.y,!0)}else this.moveTo(t,e).lineTo(t+i,e).lineTo(t+i,e+n).lineTo(t,e+n).lineTo(t,e,!0);return this}adjustLineStyle(t){const e=this.graphics.line;e.matrix=new ot,t&&e.matrix.rotate(t),this.scale!==1&&e.matrix.scale(this.scale,this.scale);const i=-this.lineLength;e.matrix.translate(this.cursor.x+i*Math.cos(t),this.cursor.y+i*Math.sin(t)),this.graphics.lineStyle(e)}static getTexture(t,e){const i=t.dash.toString();if(Me.dashTextureCache[i])return Me.dashTextureCache[i];const n=document.createElement("canvas");n.width=e,n.height=Math.ceil(t.width);const s=n.getContext("2d");if(!s){console.warn("Did not get context from canvas");return}s.strokeStyle="white",s.globalAlpha=t.alpha,s.lineWidth=t.width;let o=0;const a=t.width/2;s.moveTo(o,a);for(let l=0;l<t.dash.length;l+=2)o+=t.dash[l],s.lineTo(o,a),t.dash.length!==l+1&&(o+=t.dash[l+1],s.moveTo(o,a));s.stroke();const h=Me.dashTextureCache[i]=k.from(n);return h.baseTexture.scaleMode=ae.NEAREST,h}};jd.dashTextureCache={};let hw=jd;const Ba=r=>new Md(r.x,r.y),lw=r=>new K(r[0],r[1]),Yd=r=>{if(r.length<2)return[new Md(0)];let t;return r.map((e,i,n)=>{const s=n[i],o=n[i+1];if(i<n.length-1&&s!=null&&o!=null){const a=Ba(s);return t=Ba(o).sub(a).rotate90().normalized(),t}return t})},qd=(r,t,e)=>{const i=Ba(r);return lw(i.add(t.scale(e)))},Da=(r,t,e)=>{if(r.length!==t.length)throw new Error("Number of vectors does not match number of points");return r.map((i,n)=>{const s=t[n];if(s!=null)return qd(i,s,e);throw new Error(`Trying to read index ${n} of point ${i}, but no such vector was found!`)})},Ac=(r,t,e,i)=>r<=i&&e<=t,cw=(r,t,e,i)=>r<i&&e<t,uw=r=>Array.from(new Set(r)),Cs=(r,t,e,i)=>{const n=i.filter(o=>Ac(r,t,o.start,o.end)),s=e.filter(o=>Ac(r,t,o.start,o.end));return{overlappingHoles:n,overlappingOuterStrings:s}},Is=([r,t],e)=>{const s=e.flatMap(a=>[a.start-1e-4,a.start,a.end,a.end+1e-4]).filter(a=>a>=r&&a<=t);return s.push(r),s.push(t),uw(s).sort((a,h)=>a-h)},Pt=r=>r.kind==="casing"?r.innerDiameter:r.diameter,Zd=(r,t,e,i)=>{const s=r.find(l=>l.start<=i&&l.end>=i),o=s?s.diameter:0,a=t.filter(l=>Pt(l)>o).sort((l,c)=>Pt(l)-Pt(c)).find(l=>l.start<=i&&l.end>=i),h=e.find(l=>l.start<=i&&l.end>=i&&l.diameter>o);return a?Pt(a):h?h.diameter:100},dw=(r,t,e,i)=>{const s=r.sort((a,h)=>h.diameter-a.diameter).find(a=>a.start<=e&&a.end>=e),o=t.find(a=>a.start<=e&&a.end>=e);return s&&i!=="Open hole frac pack"&&i!=="Open hole gravel pack"?Pt(s):o?o.diameter:100},fw=(r,t,e,i)=>{const s=r.sort((l,c)=>Pt(l)-Pt(c)).find(l=>l.start<=i&&l.end>=i);if(s)return Pt(s);const o=r.length?Math.min(...r.map(l=>Pt(l))):0,a=t.sort((l,c)=>Pt(l)-Pt(c)).find(l=>l.start<=i&&l.end>=i&&o<=Pt(l));if(a)return Pt(a);const h=e.find(l=>l.start<=i&&l.end>=i&&l.diameter);return h?h.diameter:100},pw=(r,t,e,i,n,s)=>{const{attachedStrings:o,nonAttachedStrings:a}=uh(r.referenceIds,t,e);if(o.length===0)throw new Error(`Invalid cement data, can't find referenced casing/completion string for cement with id '${r.id}'`);o.sort((m,g)=>m.end-g.end);const h=o[o.length-1].end,{overlappingOuterStrings:l,overlappingHoles:c}=Cs(r.toc,h,a,i),u=[...l,...c].map(m=>({start:m.start,end:m.end}));return Is([r.toc,h],u).flatMap((m,g,y)=>{if(g===y.length-1)return[];const v=y[g+1],_=Zd(o,l,c,m);return[{top:m,bottom:v,diameter:_*n}]}).map(m=>({diameter:m.diameter,points:s(m.top,m.bottom)}))},uh=(r,t,e)=>[...t,...e].reduce((i,n)=>r.includes(n.id)?{...i,attachedStrings:[...i.attachedStrings,n]}:{...i,nonAttachedStrings:[...i.nonAttachedStrings,n]},{attachedStrings:[],nonAttachedStrings:[]}),mw=(r,t,e,i,n,s)=>{const{attachedStrings:o,nonAttachedStrings:a}=uh(r.referenceIds,t,e);if(o.length===0)throw new Error(`Invalid cement squeeze data, can't find referenced casing/completion for squeeze with id '${r.id}'`);const{overlappingOuterStrings:h,overlappingHoles:l}=Cs(r.start,r.end,a,i),c=[...h,...l].map(p=>({start:p.start,end:p.end}));return Is([r.start,r.end],c).flatMap((p,m,g)=>{if(m===g.length-1)return[];const y=g[m+1],v=Zd(o,h,l,p);return[{top:p,bottom:y,diameter:v*n}]}).map(p=>({diameter:p.diameter,points:s(p.top,p.bottom)}))},gw=(r,t,e,i,n,s)=>{const{attachedStrings:o,nonAttachedStrings:a}=uh(r.referenceIds,t,e),{overlappingHoles:h,overlappingOuterStrings:l}=Cs(r.start,r.end,a,i),c=[...o,...h,...l].map(p=>({start:p.start,end:p.end}));return Is([r.start,r.end],c).flatMap((p,m,g)=>{if(m===g.length-1)return[];const y=g[m+1],v=fw(o,l,h,p);return[{top:p,bottom:y,diameter:v*n}]}).map(p=>({diameter:p.diameter,points:s(p.top,p.bottom)}))},yw=(r,t,e,i,n)=>{const o=t.createLinearGradient(0,0,0,r.height);return o.addColorStop(0,e),o.addColorStop(.5-n,i),o.addColorStop(.5+n,i),o.addColorStop(1,e),o},_w=({firstColor:r,secondColor:t},e,i)=>{const n=document.createElement("canvas");n.width=e,n.height=i;const s=n.getContext("2d");if(s==null)throw Error("Could not get canvas context!");return s.fillStyle=yw(n,s,r,t,0),s.fillRect(0,0,n.width,n.height),k.from(n)},vw=({scalingFactor:r})=>{const t=document.createElement("canvas"),e=Ue*r;t.width=e,t.height=e;const i=t.getContext("2d");if(i==null)throw Error("Could not get canvas context!");i.fillStyle="white",i.fillRect(0,0,t.width,t.height);const n=e/10;i.strokeStyle="#AAAAAA",i.lineWidth=n,i.beginPath();const s=e/3;for(let o=-t.width;o<t.width;o++)i.moveTo(-t.width+s*o,-t.height),i.lineTo(t.width+s*o,t.height*2);return i.stroke(),k.from(t)},xw=({innerColor:r,outerColor:t,scalingFactor:e})=>{const i=Ue*e,n=document.createElement("canvas");n.width=i,n.height=i;const s=n.getContext("2d");if(s==null)throw Error("Could not get canvas context!");const o=s.createLinearGradient(0,0,0,i),a=.3,h=.7;return o.addColorStop(0,t),o.addColorStop(a,r),o.addColorStop(h,r),o.addColorStop(1,t),s.fillStyle=o,s.fillRect(0,0,n.width,n.height),k.from(n)},bw=({firstColor:r,secondColor:t,scalingFactor:e})=>{const i=document.createElement("canvas"),n=Ue*e,s=e;i.width=n,i.height=n;const o=i.getContext("2d");if(o==null)throw Error("Could not get canvas context!");o.fillStyle=r,o.fillRect(0,0,i.width,i.height),o.lineWidth=s,o.fillStyle=t,o.beginPath();const a=n/12;for(let h=-i.width;h<i.width;h++)o.moveTo(-i.width+a*h,-i.height),o.lineTo(i.width+a*h,i.height);return o.stroke(),k.from(i)},ww=({firstColor:r,secondColor:t,scalingFactor:e})=>{const i=document.createElement("canvas"),n=Ue*e;i.width=n,i.height=n;const s=i.getContext("2d");if(s==null)throw Error("Could not get canvas context!");s.fillStyle=r,s.fillRect(0,0,i.width,i.height),s.lineWidth=e,s.strokeStyle=t,s.beginPath(),s.setLineDash([20,10]);const o=n/12;for(let a=-i.width;a<i.width;a++)s.moveTo(-i.width+o*a,-i.height),s.lineTo(i.width+o*a,i.height*2);return s.stroke(),k.from(i)},Tw=({firstColor:r,secondColor:t,scalingFactor:e})=>{const i=document.createElement("canvas"),n=Ue*e,s=e;i.width=n,i.height=n;const o=i.getContext("2d");if(o==null)throw Error("Could not get canvas context!");o.lineWidth=s,o.fillStyle=r,o.strokeStyle=t,o.fillRect(0,0,i.width,i.height),o.beginPath(),o.setLineDash([20,10]);const a=n/12;for(let h=-i.width;h<i.width;h++)o.moveTo(-i.width+a*h,-i.height),o.lineTo(i.width+a*h,i.height*2);return o.stroke(),k.from(i)},Fn=(r,t)=>{const e=Yd(t),i=Da(t,e,r);return{leftPath:Da(t,e,-r),rightPath:i}},Eo=(r,t)=>({kind:"casing",start:r,end:t}),Aw=(r,t)=>({kind:"casing-window",start:r,end:t}),Ew=r=>{const t=(r.windows||[]).filter(e=>cw(r.start,r.end,e.start,e.end)).reduce(({intervals:e,lastBottom:i},n,s,o)=>{const a=i<n.start?Eo(i,n.start):null,h=a?a.end:i,l=Math.max(h,n.start),c=Math.min(r.end,n.end),u=Aw(l,c),d=c,p=s===o.length-1&&d<r.end?Eo(d,r.end):null,m=[a,u,p].filter(g=>g!=null);return{intervals:[...e,...m],lastBottom:d}},{intervals:[],lastBottom:r.start});return t.intervals.length?t.intervals:[Eo(r.start,r.end)]},Sw=(r,t,e)=>{const i=t.diameter*r,n=i/2,o=t.innerDiameter*r/2,a=n-o,h=Ew(t).map(l=>{const c=e(l.start,l.end),{leftPath:u,rightPath:d}=Fn(n,c);return{kind:l.kind,leftPath:u,rightPath:d,pathPoints:c}});return{kind:"casing",id:t.id,referenceDiameter:i,referenceRadius:n,sections:h,casingWallWidth:a,hasShoe:t.hasShoe,bottom:t.end}},Cw=(r,t,e,i,n)=>{const{overlappingOuterStrings:s,overlappingHoles:o}=Cs(r.start,r.end,t,e),a=[...s,...o].map(u=>({start:u.start,end:u.end}));return Is([r.start,r.end],a).flatMap((u,d,f)=>{if(d===f.length-1)return[];const p=f[d+1],m=dw(s,o,u,r.subKind);return[{top:u,bottom:p,diameter:m*i}]}).map(u=>{const d=n(u.top,u.bottom);return{diameter:u.diameter,points:d}})},Ps=(r,t,e)=>{const{packingOpacity:i,yellow:n}=e;t.fillStyle=n,t.strokeStyle=n;const s=[0,0],o=[r.width,r.height];t.save(),t.globalAlpha=i,t.fillRect(...s,...o),t.restore()},dh=(r,t,e,i,n)=>{const{fracLineCurve:s}=i,o=10,a=r.width/o,h=e/3*i.scalingFactor,l=h/4,c=h/2,u=0,d=n==="diameter"?0:c;t.globalAlpha=i.packingOpacity;const f=()=>{for(let p=-1;p<o;p++){const m=[p*a+u+a/2,r.height/2-l-d-l];t.beginPath();const g=[...m],y=[m[0]-s*2,m[1]-l/4],v=[m[0],m[1]-l/2],_=[m[0]+s*2,m[1]-l/2-l/4],x=[m[0],m[1]-l];t.bezierCurveTo(...g,...y,...v),t.bezierCurveTo(...v,..._,...x),t.stroke()}for(let p=-1;p<o;p++){const m=[p*a+a+u+a/2,r.height/2+h/2+d];t.beginPath();const g=[...m],y=[m[0]-s*2,m[1]+l/4],v=[m[0],m[1]+l/2],_=[m[0]+s*2,m[1]+l/2+l/4],x=[m[0],m[1]+l];t.bezierCurveTo(...g,...y,...v),t.bezierCurveTo(...v,..._,...x),t.stroke()}};t.strokeStyle=i.yellow,t.lineWidth=6,t.save(),f(),t.restore(),t.lineWidth=1,t.strokeStyle=i.outline,f(),t.closePath()},Iw=(r,t,e,i)=>{const s=r.width/4;t.strokeStyle=i.outline;const o=e/3*i.scalingFactor;t.lineWidth=1;const a=o/2;for(let h=0;h<=4;h++){const l=[h*s,r.height/2-o/2],c=[l[0]-s/2,l[1]-a],u=[l[0]-s,l[1]];t.beginPath(),t.moveTo(...l),t.lineTo(...c),t.lineTo(...u),t.fill(),t.lineWidth=1,t.stroke()}for(let h=0;h<=4;h++){const l=[h*s,r.height/2+o/2],c=[l[0]-s/2,l[1]+a],u=[l[0]-s,l[1]];t.beginPath(),t.moveTo(...l),t.lineTo(...c),t.lineTo(...u),t.fill(),t.lineWidth=1,t.stroke()}t.closePath()},de=(r="Error!",t)=>{console.error(`${r}`);const e=(t==null?void 0:t.canvas)||document.createElement("canvas"),i=Ue;e.width=i/2,e.height=i;const n=(t==null?void 0:t.canvasCtx)||e.getContext("2d"),s=[0,0],o=[e.width,e.height];if(n==null)throw Error("Could not get canvas context!");return n.fillStyle="#ff00ff",n.fillRect(...s,...o),new k(k.from(e,{wrapMode:Mt.CLAMP}).baseTexture,void 0,new Y(0,0,e.width,e.height),void 0,st.MIRROR_HORIZONTAL)},Ve=(r,t)=>{const e=document.createElement("canvas"),n=r.diameter*t.scalingFactor;e.width=n/2,e.height=n;const s=e.getContext("2d");if(s==null)throw Error("Could not get canvas context!");return{canvas:e,ctx:s}},Xe=r=>new k(k.from(r,{wrapMode:Mt.CLAMP}).baseTexture,void 0,new Y(0,0,r.width,r.height),void 0,st.MIRROR_HORIZONTAL),Pw=(r,t)=>e=>t.some(i=>e(i)&&tx(r,i)),fh={packing:()=>de(),fracLines:()=>de(),spikes:(r,t,e,i)=>{const{canvas:n,ctx:s}=Ve(t,i),o=Pw(r,e),a=o(Kv),h=o(Jv),l=o(Qv),u=a||h||l?i.yellow:i.red;return s.globalAlpha=i.packingOpacity,r.isOpen?(s.fillStyle=u,s.strokeStyle=u):(s.fillStyle=i.grey,s.strokeStyle=i.grey),Iw(n,s,t.diameter,i),l&&dh(n,s,t.diameter,i,"spike"),Xe(n)}},Kd={packing:()=>de(),fracLines:(r,t)=>{const{canvas:e,ctx:i}=Ve(r,t);return dh(e,i,r.diameter,t,"diameter"),Xe(e)},spikes:()=>de()},us={packing:(r,t)=>{const{canvas:e,ctx:i}=Ve(r,t);return Ps(e,i,t),Xe(e)},fracLines:(r,t)=>{const{canvas:e}=Ve(r,t);return Xe(e)},spikes:()=>de()},ph={packing:(r,t)=>{const{canvas:e,ctx:i}=Ve(r,t);return Ps(e,i,t),Xe(e)},fracLines:()=>de(),spikes:()=>de()},mh={packing:(r,t)=>{const{canvas:e,ctx:i}=Ve(r,t);return Ps(e,i,t),Xe(e)},fracLines:()=>de(),spikes:()=>de()},gh={packing:(r,t,e)=>{const{canvas:i,ctx:n}=Ve(t,e);return Ps(i,n,e),Xe(i)},fracLines:(r,t)=>{const{canvas:e,ctx:i}=Ve(r,t);return dh(e,i,r.diameter,t,"diameter"),Xe(e)},spikes:()=>de()},Rw=(r,t,e)=>Ye({Perforation:()=>fh.packing(),CasedHoleFracturation:()=>us.packing(t,e),CasedHoleFracPack:()=>us.packing(t,e),OpenHoleGravelPack:()=>mh.packing(t,e),OpenHoleFracPack:()=>gh.packing(r,t,e),CasedHoleGravelPack:()=>ph.packing(t,e)},r.subKind),Mw=(r,t,e)=>Ye({Perforation:()=>fh.fracLines(),OpenHoleGravelPack:()=>mh.fracLines(),OpenHoleFracPack:()=>gh.fracLines(t,e),CasedHoleFracturation:()=>Kd.fracLines(t,e),CasedHoleGravelPack:()=>ph.fracLines(),CasedHoleFracPack:()=>us.fracLines(t,e)},r.subKind),Fw=(r,t,e,i)=>Ye({Perforation:()=>fh.spikes(r,e,t,i),OpenHoleGravelPack:()=>mh.spikes(),OpenHoleFracPack:()=>gh.spikes(),CasedHoleFracturation:()=>Kd.spikes(),CasedHoleGravelPack:()=>ph.spikes(),CasedHoleFracPack:()=>us.spikes()},r.subKind);class Bw extends Hi{constructor(t){const e=wo(t,i=>i.points.length);super(new Float32Array(e*4),new Float32Array(e*4),new Uint16Array((e-1)*6)),this.segments=t,this.build()}get width(){return Aa(this.segments,t=>t.diameter)}build(){var p,m,g,y,v,_,x,w;const t=this.segments;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex(),s=wo(t,C=>C.points.length);if(s<1)return;e.data.length/4!==s&&(e.data=new Float32Array(s*4),i.data=new Float32Array(s*4),n.data=new Uint16Array((s-1)*6));const o=i.data,a=n.data;o[0]=0,o[1]=0,o[2]=0,o[3]=1;const h=t.length,l=Aa(t,C=>C.diameter);let c=0,u=0,d=0,f=0;for(let C=0;C<h;C++){let T=(p=t[C])==null?void 0:p.points[0];const S=l,F=((m=t[C])==null?void 0:m.diameter)/l/2,O=(g=t[C])==null?void 0:g.points.length;for(let N=0;N<O;N++){const B=T.x-((v=(y=t[C])==null?void 0:y.points[N])==null?void 0:v.x),A=T.y-((x=(_=t[C])==null?void 0:_.points[N])==null?void 0:x.y),b=Math.sqrt(B*B+A*A);T=(w=t[C])==null?void 0:w.points[N],c+=b/S,o[u]=c,o[u+1]=.5-F,o[u+2]=c,o[u+3]=.5+F,u+=4}for(let N=0;N<O-1;N++)a[f++]=d,a[f++]=d+1,a[f++]=d+2,a[f++]=d+2,a[f++]=d+1,a[f++]=d+3,d+=2;d+=2}i.update(),n.update(),this.updateVertices()}updateVertices(){var s,o,a,h,l,c,u,d;const t=this.segments;if(wo(t,f=>f.points.length)<1)return;const i=t.length;let n=0;for(let f=0;f<i;f++){let p=(s=t[f])==null?void 0:s.points[0],m,g=0,y=0;const v=(o=this.buffers[0])==null?void 0:o.data,_=(a=t[f])==null?void 0:a.points.length;let x=0;for(let w=0;w<_;w++){const C=(h=t[f])==null?void 0:h.points[w];x=n+w*4,w<((l=t[f])==null?void 0:l.points.length)-1?m=(c=t[f])==null?void 0:c.points[w+1]:m=C,y=-(m.x-p.x),g=m.y-p.y;const T=Math.sqrt(g*g+y*y),S=((u=t[f])==null?void 0:u.diameter)/2;g/=T,y/=T,g*=S,y*=S,v!=null&&(v[x]=C.x+g,v[x+1]=C.y+y,v[x+2]=C.x-g,v[x+3]=C.y-y),p=C}n=x+4}(d=this.buffers[0])==null||d.update()}update(){this.build()}}class Dw extends qr{constructor(t,e){const i=new Bw(e),n=new Zr(t);t.baseTexture.wrapMode=Mt.REPEAT,super(i,n),this.autoUpdate=!0}_render(t){const e=this.geometry;this.autoUpdate&&e.update(),super._render(t)}}class Lw extends Hi{constructor(t,e=200){super(new Float32Array(t.length*4),new Float32Array(t.length*4),new Uint16Array((t.length-1)*6)),this.points=t,this._width=e,this.build()}get width(){return this._width}build(){var u,d;const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),i.data=new Float32Array(t.length*4),n.data=new Uint16Array((t.length-1)*6));const s=i.data,o=n.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;let a=0,h=t[0];const l=t.length;for(let f=0;f<l;f++){const p=f*4,m=h.x-((u=t[f])==null?void 0:u.x),g=h.y-((d=t[f])==null?void 0:d.y),y=Math.sqrt(m*m+g*g);h=t[f],a+=y/this._width,s[p]=a,s[p+1]=0,s[p+2]=a,s[p+3]=1}let c=0;for(let f=0;f<l-1;f++){const p=f*2;o[c++]=p,o[c++]=p+1,o[c++]=p+2,o[c++]=p+2,o[c++]=p+1,o[c++]=p+3}i.update(),n.update(),this.updateVertices()}updateVertices(){var h,l;const t=this.points;if(t.length<1)return;let e=t[0],i,n=0,s=0;const o=(h=this.buffers[0])==null?void 0:h.data,a=t.length;for(let c=0;c<a;c++){const u=t[c],d=c*4;c<t.length-1?i=t[c+1]:i=u,s=-(i.x-e.x),n=i.y-e.y;const f=Math.sqrt(n*n+s*s),p=this._width/2;n/=f,s/=f,n*=p,s*=p,o[d]=u.x+n,o[d+1]=u.y+s,o[d+2]=u.x-n,o[d+3]=u.y-s,e=u}(l=this.buffers[0])==null||l.update()}update(){this.build()}}class Nw extends qr{constructor(t,e,i){const n=new Lw(e,i),s=new Zr(t);t.baseTexture.wrapMode=Mt.REPEAT,super(n,s),this.autoUpdate=!0}_render(t){const e=this.geometry;this.autoUpdate&&e.update(),super._render(t)}}class Ow extends Hi{constructor(t,e=200){super(new Float32Array(t.length*4),new Float32Array(t.length*4),new Uint16Array((t.length-1)*6)),this.points=t,this._width=e,this.build()}build(){var f,p,m,g;const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),i.data=new Float32Array(t.length*4),n.data=new Uint16Array((t.length-1)*6));const s=t.length;let o=0,a=t[0];for(let y=0;y<s;y++){const v=a.x-((f=t[y])==null?void 0:f.x),_=a.y-((p=t[y])==null?void 0:p.y),x=Math.sqrt(v*v+_*_);a=t[y],o+=x}const h=i.data,l=n.data;h[0]=0,h[1]=0,h[2]=0,h[3]=1;let c=0,u=t[0];for(let y=0;y<s;y++){const v=y*4,_=u.x-((m=t[y])==null?void 0:m.x),x=u.y-((g=t[y])==null?void 0:g.y),w=Math.sqrt(_*_+x*x);u=t[y],c+=w/o,h[v]=c,h[v+1]=0,h[v+2]=c,h[v+3]=1}let d=0;for(let y=0;y<s-1;y++){const v=y*2;l[d++]=v,l[d++]=v+1,l[d++]=v+2,l[d++]=v+2,l[d++]=v+1,l[d++]=v+3}i.update(),n.update(),this.updateVertices()}updateVertices(){var h,l;const t=this.points;if(t.length<1)return;let e=t[0],i,n=0,s=0;const o=(h=this.buffers[0])==null?void 0:h.data,a=t.length;for(let c=0;c<a;c++){const u=t[c],d=c*4;c<t.length-1?i=t[c+1]:i=u,s=-(i.x-e.x),n=i.y-e.y;const f=Math.sqrt(n*n+s*s),p=this._width/2;n/=f,s/=f,n*=p,s*=p,o[d]=u.x+n,o[d+1]=u.y+s,o[d+2]=u.x-n,o[d+3]=u.y-s,e=u}(l=this.buffers[0])==null||l.update()}update(){this.updateVertices()}}class kw extends qr{constructor(t,e){const i=new Ow(e,t.height),n=new Zr(t);super(i,n),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}}const Uw=(r,t,e)=>i=>{switch(i.kind){case"casing":return r(i);case"cement":return t(i);case"cementSqueeze":return e(i);default:return sh(i)}},Gw=r=>({exaggerationFactor:2,internalLayerOptions:ex(r),holeOptions:rx,casingOptions:ix,cementOptions:sx,cementSqueezeOptions:ox,screenOptions:ax,tubingOptions:hx,cementPlugOptions:lx,perforationOptions:nx}),Qd=class Jd extends $v{constructor(t,e,i){super(t,e,i),this.internalLayerVisibility={holeLayerId:!0,casingLayerId:!0,completionLayerId:!0,cementLayerId:!0,pAndALayerId:!0,perforationLayerId:!0},this.cementTextureCache=null,this.cementSqueezeTextureCache=null,this.cementPlugTextureCache=null,this.holeTextureCache=null,this.screenTextureCache=null,this.tubingTextureCache=null,this.textureSymbolCacheArray=null,this.scalingFactors={height:600,zFactor:1,yScale:hs()},this.getZFactorScaledPathForPoints=(n,s)=>{var h;const o=l=>l*this.scalingFactors.zFactor;return(((h=this.referenceSystem)==null?void 0:h.getCurtainPath(n,s,!0))??[]).map(l=>new K(l.point[0],o(l.point[1])))},this.drawBigPolygon=(n,s=0)=>{const o=new Ci;o.beginFill(s),o.drawPolygon(n),o.endFill(),this.addChild(o)},this.perforationRopeAndTextureReferences=[],this.prepareSymbolRenderObject=n=>{const{exaggerationFactor:s=1}=this.options,o=n.diameter*s;return{pathPoints:this.getZFactorScaledPathForPoints(n.start,n.end),referenceDiameter:o,symbolKey:n.symbolKey}},this.drawSymbolComponent=({pathPoints:n,referenceDiameter:s,symbolKey:o})=>{const a=this.getSymbolTexture(o,s);this.drawSVGRope(n,a)},this.drawHoleSize=(n,s)=>{if(s==null)return;const o=this.getZFactorScaledPathForPoints(s.start,s.end);if(o.length===0)return;const{exaggerationFactor:a=1,holeOptions:h}=this.options,l=s.diameter*a,{rightPath:c,leftPath:u}=Fn(l/2,o),d=this.getHoleTexture(h,l,n);this.drawHoleRope(o,d,n),this.drawOutline(u,c,ve(h.lineColor),df*a,"TopAndBottom",0)},this.drawCasing=n=>{const{casingOptions:s}=this.options,o=ve(s.solidColor),a=ve(s.lineColor);n.sections.forEach((h,l,c)=>{const u=Jd.getOutlineClosureType(l,c.length-1),d=this.createCasingTexture(n.referenceDiameter);this.drawRope(h.pathPoints,d,o),h.kind==="casing-window"?this.drawCasingWindowOutline(h.leftPath,h.rightPath,s,n.casingWallWidth):this.drawOutline(h.leftPath,h.rightPath,a,n.casingWallWidth,u)})},this.generateShoe=(n,s,o,a)=>{const h=n-o,l=n,c=this.getZFactorScaledPathForPoints(h,l),u=Yd(c),d=Da(c,u,s*(a<0?-1:1)),f=c[c.length-1],p=u[u.length-1],m=qd(f,p,a+s*(a<0?-1:1));return[...d,m]},this.createCementSqueezeShape=(n,s,o,a)=>{const{exaggerationFactor:h=1}=this.options;return mw(n,s,o,a,h,this.getZFactorScaledPathForPoints)},this.createPerforationShape=(n,s,o)=>{const{exaggerationFactor:a=1}=this.options;return Cw(n,s,o,a,this.getZFactorScaledPathForPoints)},this.options={...this.options,...Gw(this.id),...i}}onUnmount(t){super.onUnmount(t),this.cementTextureCache=null,this.cementSqueezeTextureCache=null,this.holeTextureCache=null,this.screenTextureCache=null,this.tubingTextureCache=null,this.textureSymbolCacheArray=null}onUpdate(t){super.onUpdate(t),this.clearLayer(),this.preRender(),this.render()}onRescale(t){const e=this.scalingFactors.zFactor!==t.zFactor;this.scalingFactors={height:t.height,zFactor:t.zFactor,yScale:t.yScale},super.optionsRescale(t);const i=this.yRatio(),n=t.xBounds[0]>t.xBounds[1],s=t.yBounds[0]>t.yBounds[1];this.setContainerPosition(t.xScale(0),t.yScale(0)),this.setContainerScale(t.xRatio*(n?-1:1),i*(s?-1:1)),e&&(this.clearLayer(),this.preRender()),this.render()}setVisibility(t,e){if(e===this.id){super.setVisibility(t,e);return}const{internalLayerOptions:i}=this.options,s=(i?Object.entries(i):[]).find(([a,h])=>h===e),o=s==null?void 0:s[0];o&&(this.internalLayerVisibility[o]=t,this.clearLayer(),this.preRender(),this.render())}getInternalLayerIds(){const{internalLayerOptions:t}=this.options;return t?Object.values(t):[]}yRatio(){const t=this.scalingFactors.yScale.domain(),i=(t[1]-t[0])*this.scalingFactors.zFactor,n=[t[0],t[0]+i];return Math.abs(this.scalingFactors.height/(n[1]-n[0]))}drawRope(t,e,i){if(t.length===0)return;const n=new Wl(e,t,1);n.tint=i||n.tint,this.addChild(n)}drawOutline(t,e,i,n=1,s="None",o=1){const a=t.map(u=>u.clone()).reverse(),h=e[0],l=a[0],c=new Ci;c.lineStyle(n,i,void 0,o),c.moveTo(h.x,h.y),e.forEach(u=>c.lineTo(u.x,u.y)),(s==="None"||s==="Top")&&c.moveTo(l.x,l.y),a.forEach(u=>c.lineTo(u.x,u.y)),(s==="TopAndBottom"||s==="Top")&&c.lineTo(h.x,h.y),this.addChild(c)}drawCasingWindowOutline(t,e,{lineColor:i,windowOptions:n},s=1){var m,g;const o=!!((g=(m=this.referenceSystem)==null?void 0:m.options)!=null&&g.calculateDisplacementFromBottom),[a,h]=o?[t,e]:[e,t],[l,c]=o?[1,0]:[0,1],u=new Ci;u.lineStyle(s,ve(i),void 0,c);const d=a[0];u.moveTo(d.x,d.y),a.forEach(y=>u.lineTo(y.x,y.y));const f=new hw(u,{dash:[n.dashLength,n.spaceLength],color:ve(n.dashColor),width:s,alignment:l}),p=h[0];f.moveTo(p.x,p.y),h.forEach(y=>{f.lineTo(y.x,y.y)}),this.addChild(u)}preRender(){if(!this.data||!this.referenceSystem)return;const{exaggerationFactor:t=1}=this.options,{holeSizes:e,casings:i,cements:n,completion:s,symbols:o,pAndA:a,perforations:h}=this.data;this.updateSymbolCache(o),e.sort((m,g)=>g.diameter-m.diameter);const l=e.length>0?(Aa(e,m=>m.diameter)??0)*t:uf*t;this.internalLayerVisibility.holeLayerId&&e.forEach(m=>this.drawHoleSize(l,m)),i.sort((m,g)=>g.diameter-m.diameter);const c=i.map(m=>this.createCasingRenderObject(m)),u=n.map(m=>({kind:"cement",segments:pw(m,i,s,e,t,this.getZFactorScaledPathForPoints),casingIds:(m.referenceIds||[]).filter(g=>g)})),[d,f]=a.reduce(([m,g],y)=>Xv(y)?[[y,...m],g]:[m,[y,...g]],[[],[]]),p=d.map(m=>({kind:"cementSqueeze",segments:this.createCementSqueezeShape(m,i,s,e),casingIds:m.referenceIds}));if(this.sortCementAndCasingRenderObjects(c,u,p).forEach(Uw(m=>{this.internalLayerVisibility.casingLayerId&&(this.drawCasing(m),m.hasShoe&&this.drawShoe(m.bottom,m.referenceRadius))},m=>{if(this.internalLayerVisibility.cementLayerId){const g=this.getCementTexture();g&&this.drawComplexRope(m.segments,g)}},m=>{if(this.internalLayerVisibility.pAndALayerId){const g=this.getCementSqueezeTexture();g&&this.drawComplexRope(m.segments,g)}})),this.perforationRopeAndTextureReferences.forEach(({rope:m,texture:g})=>{m.destroy({children:!0,texture:!0,baseTexture:!0}),g.destroy(!0)}),this.perforationRopeAndTextureReferences=[],this.internalLayerVisibility.perforationLayerId){const{perforationOptions:m}=this.options,g=h.filter(Yv),y=h.filter(qv),v=h.filter(Zv);g.forEach(_=>{const w=this.createPerforationShape(_,i,e).reduce((C,T)=>(C[T.diameter]||(C[T.diameter]=[]),C[T.diameter]=[...C[T.diameter]??[],T],C),{});Object.values(w).forEach(C=>{const T=Rw(_,C[0],m),S=this.drawComplexRope(C,T);S&&this.perforationRopeAndTextureReferences.push({rope:S,texture:T})})}),v.forEach(_=>{const C=this.createPerforationShape(_,i,e).map(T=>({...T,diameter:T.diameter*3})).reduce((T,S)=>(T[S.diameter]||(T[S.diameter]=[]),T[S.diameter]=[...T[S.diameter]??[],S],T),{});Object.values(C).forEach(T=>{T.forEach(S=>{const F=Fw(_,h,S,m),O=this.drawComplexRope([S],F);O&&this.perforationRopeAndTextureReferences.push({rope:O,texture:F})})})}),y.forEach(_=>{const C=this.createPerforationShape(_,i,e).map(T=>({...T,diameter:T.diameter*3})).reduce((T,S)=>(T[S.diameter]||(T[S.diameter]=[]),T[S.diameter]=[...T[S.diameter]??[],S],T),{});Object.values(C).forEach(T=>{T.forEach(S=>{const F=Mw(_,S,m),O=this.drawComplexRope([S],F);O&&this.perforationRopeAndTextureReferences.push({rope:O,texture:F})})})})}this.internalLayerVisibility.completionLayerId&&s.forEach(jv(m=>this.drawScreen(m),m=>this.drawTubing(m),m=>{const g=this.prepareSymbolRenderObject(m);this.drawSymbolComponent(g)})),this.internalLayerVisibility.pAndALayerId&&f.forEach(m=>{if(Vv(m)){const g=this.prepareSymbolRenderObject(m);this.drawSymbolComponent(g)}Wv(m)&&this.drawCementPlug(m,i,s,e)})}updateSymbolCache(t){if(this.textureSymbolCacheArray||(this.textureSymbolCacheArray={}),!t)return;const e=Object.keys(this.textureSymbolCacheArray);Object.entries(t).forEach(([i,n])=>{!e.includes(i)&&this.textureSymbolCacheArray&&(this.textureSymbolCacheArray[i]=k.from(n))})}drawCementPlug(t,e,i,n){const{exaggerationFactor:s=1,cementPlugOptions:o}=this.options,a=gw(t,e,i,n,s,this.getZFactorScaledPathForPoints);o&&this.drawComplexRope(a,this.getCementPlugTexture(o));const{rightPath:h,leftPath:l}=a.reduce((c,u)=>{const{leftPath:d,rightPath:f}=Fn(u.diameter/2,u.points);return{rightPath:[...c.rightPath,...f],leftPath:[...c.leftPath,...d]}},{rightPath:[],leftPath:[]});this.drawOutline(l,h,ve("black"),.25,"TopAndBottom")}createCasingRenderObject(t){const{exaggerationFactor:e=1}=this.options;return Sw(e,t,this.getZFactorScaledPathForPoints)}getCementPlugTexture(t){return this.cementPlugTextureCache||(this.cementPlugTextureCache=ww(t)),this.cementPlugTextureCache}drawSVGRope(t,e){if(t.length===0)return;const i=new kw(e,t);this.addChild(i)}getSymbolTexture(t,e){var n,s;const i=(s=(n=this.textureSymbolCacheArray)==null?void 0:n[t])==null?void 0:s.baseTexture;return i?new k(i,void 0,new Y(0,0,0,e),void 0,st.MAIN_DIAGONAL):void 0}drawHoleRope(t,e,i){if(t.length===0)return;const n=new Wl(e,t,i/Ue);this.addChild(n)}getHoleTexture(t,e,i){const n=Ue,s=n,o=n,a=e/i*n;this.holeTextureCache||(this.holeTextureCache=_w(t,o,s));const h=this.holeTextureCache.baseTexture,l=(s-a)/2,c=new Y(0,l,o,a);return new k(h,c)}sortCementAndCasingRenderObjects(t,e,i){let n=0;const{result:s}=t.reduce((o,a)=>{const h=o.remainingCement.find(c=>c.casingIds.includes(a.id)),l=o.remainingCementSqueezes.filter(c=>c.casingIds.includes(a.id));return h&&(h.zIndex=n++),l.forEach(c=>c.zIndex=n++),a.zIndex=n++,{result:[...o.result,h,a,...l],remainingCement:o.remainingCement.filter(c=>c!==h),remainingCementSqueezes:o.remainingCementSqueezes.filter(c=>!l.includes(c))}},{result:[],remainingCement:e,remainingCementSqueezes:i});return s.filter(o=>o!=null).sort((o,a)=>o.zIndex-a.zIndex)}drawComplexRope(t,e){if(t.length===0)return;const i=new Dw(e,t);return this.addChild(i),i}createCasingTexture(t){return new k(k.WHITE.baseTexture,void 0,new Y(0,0,16,t))}drawShoe(t,e){const{exaggerationFactor:i=1,casingOptions:n}=this.options,s=n.shoeSize.width*i,o=n.shoeSize.length*i,a=this.generateShoe(t,e,o,s),h=this.generateShoe(t,e,o,-s);this.drawBigPolygon(h),this.drawBigPolygon(a)}getCementTexture(){if(!this.cementTextureCache){const{cementOptions:t}=this.options;t&&(this.cementTextureCache=bw(t))}return this.cementTextureCache}getCementSqueezeTexture(){if(!this.cementSqueezeTextureCache){const{cementSqueezeOptions:t}=this.options;t&&(this.cementSqueezeTextureCache=Tw(t))}return this.cementSqueezeTextureCache}drawScreen({start:t,end:e,diameter:i}){const{exaggerationFactor:n=1,screenOptions:s}=this.options,o=n*i,a=this.getZFactorScaledPathForPoints(t,e),{leftPath:h,rightPath:l}=Fn(o/2,a),c=this.getScreenTexture();c&&(this.drawCompletionRope(a,c,o),this.drawOutline(h,l,ve(s.lineColor),ff*n,"TopAndBottom"))}drawTubing({diameter:t,start:e,end:i}){const{exaggerationFactor:n=1,tubingOptions:s}=this.options,o=n*t,a=this.getZFactorScaledPathForPoints(e,i),h=this.getTubingTexture(s);this.drawCompletionRope(a,h,o)}getTubingTexture(t){return this.tubingTextureCache||(this.tubingTextureCache=xw(t)),this.tubingTextureCache}getScreenTexture(){if(!this.screenTextureCache){const{screenOptions:t}=this.options;t&&(this.screenTextureCache=vw(t))}return this.screenTextureCache}drawCompletionRope(t,e,i){if(t.length===0)return;const n=new Nw(e,t,i);this.addChild(n)}};Qd.getOutlineClosureType=(r,t)=>r===0?r===t?"TopAndBottom":"Top":r===t?"Bottom":"None";let wT=Qd;var Hw={value:()=>{}};function yh(){for(var r=0,t=arguments.length,e={},i;r<t;++r){if(!(i=arguments[r]+"")||i in e||/[\s.]/.test(i))throw new Error("illegal type: "+i);e[i]=[]}return new Bn(e)}function Bn(r){this._=r}function zw(r,t){return r.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");if(n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:i}})}Bn.prototype=yh.prototype={constructor:Bn,on:function(r,t){var e=this._,i=zw(r+"",e),n,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((n=(r=i[s]).type)&&(n=$w(e[n],r.name)))return n;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(n=(r=i[s]).type)e[n]=Ec(e[n],r.name,t);else if(t==null)for(n in e)e[n]=Ec(e[n],r.name,null);return this},copy:function(){var r={},t=this._;for(var e in t)r[e]=t[e].slice();return new Bn(r)},call:function(r,t){if((n=arguments.length-2)>0)for(var e=new Array(n),i=0,n,s;i<n;++i)e[i]=arguments[i+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(s=this._[r],i=0,n=s.length;i<n;++i)s[i].value.apply(t,e)},apply:function(r,t,e){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var i=this._[r],n=0,s=i.length;n<s;++n)i[n].value.apply(t,e)}};function $w(r,t){for(var e=0,i=r.length,n;e<i;++e)if((n=r[e]).name===t)return n.value}function Ec(r,t,e){for(var i=0,n=r.length;i<n;++i)if(r[i].name===t){r[i]=Hw,r=r.slice(0,i).concat(r.slice(i+1));break}return e!=null&&r.push({name:t,value:e}),r}const La={capture:!0,passive:!1};function Na(r){r.preventDefault(),r.stopImmediatePropagation()}function Vw(r){var t=r.document.documentElement,e=De(r).on("dragstart.drag",Na,La);"onselectstart"in t?e.on("selectstart.drag",Na,La):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Xw(r,t){var e=r.document.documentElement,i=De(r).on("dragstart.drag",null);t&&(i.on("click.drag",Na,La),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}var Qr=0,bi=0,ui=0,tf=1e3,ds,wi,fs=0,yr=0,Rs=0,Li=typeof performance=="object"&&performance.now?performance:Date,ef=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function _h(){return yr||(ef(Ww),yr=Li.now()+Rs)}function Ww(){yr=0}function ps(){this._call=this._time=this._next=null}ps.prototype=rf.prototype={constructor:ps,restart:function(r,t,e){if(typeof r!="function")throw new TypeError("callback is not a function");e=(e==null?_h():+e)+(t==null?0:+t),!this._next&&wi!==this&&(wi?wi._next=this:ds=this,wi=this),this._call=r,this._time=e,Oa()},stop:function(){this._call&&(this._call=null,this._time=1/0,Oa())}};function rf(r,t,e){var i=new ps;return i.restart(r,t,e),i}function jw(){_h(),++Qr;for(var r=ds,t;r;)(t=yr-r._time)>=0&&r._call.call(void 0,t),r=r._next;--Qr}function Sc(){yr=(fs=Li.now())+Rs,Qr=bi=0;try{jw()}finally{Qr=0,qw(),yr=0}}function Yw(){var r=Li.now(),t=r-fs;t>tf&&(Rs-=t,fs=r)}function qw(){for(var r,t=ds,e,i=1/0;t;)t._call?(i>t._time&&(i=t._time),r=t,t=t._next):(e=t._next,t._next=null,t=r?r._next=e:ds=e);wi=r,Oa(i)}function Oa(r){if(!Qr){bi&&(bi=clearTimeout(bi));var t=r-yr;t>24?(r<1/0&&(bi=setTimeout(Sc,r-Li.now()-Rs)),ui&&(ui=clearInterval(ui))):(ui||(fs=Li.now(),ui=setInterval(Yw,tf)),Qr=1,ef(Sc))}}function Cc(r,t,e){var i=new ps;return t=t==null?0:+t,i.restart(n=>{i.stop(),r(n+t)},t,e),i}var Zw=yh("start","end","cancel","interrupt"),Kw=[],nf=0,Ic=1,ka=2,Dn=3,Pc=4,Ua=5,Ln=6;function Ms(r,t,e,i,n,s){var o=r.__transition;if(!o)r.__transition={};else if(e in o)return;Qw(r,e,{name:t,index:i,group:n,on:Zw,tween:Kw,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:nf})}function vh(r,t){var e=qt(r,t);if(e.state>nf)throw new Error("too late; already scheduled");return e}function pe(r,t){var e=qt(r,t);if(e.state>Dn)throw new Error("too late; already running");return e}function qt(r,t){var e=r.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function Qw(r,t,e){var i=r.__transition,n;i[t]=e,e.timer=rf(s,0,e.time);function s(l){e.state=Ic,e.timer.restart(o,e.delay,e.time),e.delay<=l&&o(l-e.delay)}function o(l){var c,u,d,f;if(e.state!==Ic)return h();for(c in i)if(f=i[c],f.name===e.name){if(f.state===Dn)return Cc(o);f.state===Pc?(f.state=Ln,f.timer.stop(),f.on.call("interrupt",r,r.__data__,f.index,f.group),delete i[c]):+c<t&&(f.state=Ln,f.timer.stop(),f.on.call("cancel",r,r.__data__,f.index,f.group),delete i[c])}if(Cc(function(){e.state===Dn&&(e.state=Pc,e.timer.restart(a,e.delay,e.time),a(l))}),e.state=ka,e.on.call("start",r,r.__data__,e.index,e.group),e.state===ka){for(e.state=Dn,n=new Array(d=e.tween.length),c=0,u=-1;c<d;++c)(f=e.tween[c].value.call(r,r.__data__,e.index,e.group))&&(n[++u]=f);n.length=u+1}}function a(l){for(var c=l<e.duration?e.ease.call(null,l/e.duration):(e.timer.restart(h),e.state=Ua,1),u=-1,d=n.length;++u<d;)n[u].call(r,c);e.state===Ua&&(e.on.call("end",r,r.__data__,e.index,e.group),h())}function h(){e.state=Ln,e.timer.stop(),delete i[t];for(var l in i)return;delete r.__transition}}function Nn(r,t){var e=r.__transition,i,n,s=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((i=e[o]).name!==t){s=!1;continue}n=i.state>ka&&i.state<Ua,i.state=Ln,i.timer.stop(),i.on.call(n?"interrupt":"cancel",r,r.__data__,i.index,i.group),delete e[o]}s&&delete r.__transition}}function Jw(r){return this.each(function(){Nn(this,r)})}function t2(r,t){var e,i;return function(){var n=pe(this,r),s=n.tween;if(s!==e){i=e=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}n.tween=i}}function e2(r,t,e){var i,n;if(typeof e!="function")throw new Error;return function(){var s=pe(this,r),o=s.tween;if(o!==i){n=(i=o).slice();for(var a={name:t,value:e},h=0,l=n.length;h<l;++h)if(n[h].name===t){n[h]=a;break}h===l&&n.push(a)}s.tween=n}}function r2(r,t){var e=this._id;if(r+="",arguments.length<2){for(var i=qt(this.node(),e).tween,n=0,s=i.length,o;n<s;++n)if((o=i[n]).name===r)return o.value;return null}return this.each((t==null?t2:e2)(e,r,t))}function xh(r,t,e){var i=r._id;return r.each(function(){var n=pe(this,i);(n.value||(n.value={}))[t]=e.apply(this,arguments)}),function(n){return qt(n,i).value[t]}}function sf(r,t){var e;return(typeof t=="number"?zt:t instanceof $e?Di:(e=$e(t))?(t=e,Di):Nd)(r,t)}function i2(r){return function(){this.removeAttribute(r)}}function n2(r){return function(){this.removeAttributeNS(r.space,r.local)}}function s2(r,t,e){var i,n=e+"",s;return function(){var o=this.getAttribute(r);return o===n?null:o===i?s:s=t(i=o,e)}}function o2(r,t,e){var i,n=e+"",s;return function(){var o=this.getAttributeNS(r.space,r.local);return o===n?null:o===i?s:s=t(i=o,e)}}function a2(r,t,e){var i,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttribute(r):(o=this.getAttribute(r),h=a+"",o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a)))}}function h2(r,t,e){var i,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttributeNS(r.space,r.local):(o=this.getAttributeNS(r.space,r.local),h=a+"",o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a)))}}function l2(r,t){var e=ms(r),i=e==="transform"?ab:sf;return this.attrTween(r,typeof t=="function"?(e.local?h2:a2)(e,i,xh(this,"attr."+r,t)):t==null?(e.local?n2:i2)(e):(e.local?o2:s2)(e,i,t))}function c2(r,t){return function(e){this.setAttribute(r,t.call(this,e))}}function u2(r,t){return function(e){this.setAttributeNS(r.space,r.local,t.call(this,e))}}function d2(r,t){var e,i;function n(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&u2(r,s)),e}return n._value=t,n}function f2(r,t){var e,i;function n(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&c2(r,s)),e}return n._value=t,n}function p2(r,t){var e="attr."+r;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var i=ms(r);return this.tween(e,(i.local?d2:f2)(i,t))}function m2(r,t){return function(){vh(this,r).delay=+t.apply(this,arguments)}}function g2(r,t){return t=+t,function(){vh(this,r).delay=t}}function y2(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?m2:g2)(t,r)):qt(this.node(),t).delay}function _2(r,t){return function(){pe(this,r).duration=+t.apply(this,arguments)}}function v2(r,t){return t=+t,function(){pe(this,r).duration=t}}function x2(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?_2:v2)(t,r)):qt(this.node(),t).duration}function b2(r,t){if(typeof t!="function")throw new Error;return function(){pe(this,r).ease=t}}function w2(r){var t=this._id;return arguments.length?this.each(b2(t,r)):qt(this.node(),t).ease}function T2(r,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;pe(this,r).ease=e}}function A2(r){if(typeof r!="function")throw new Error;return this.each(T2(this._id,r))}function E2(r){typeof r!="function"&&(r=Oc(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=[],h,l=0;l<o;++l)(h=s[l])&&r.call(h,h.__data__,l,s)&&a.push(h);return new Ce(i,this._parents,this._name,this._id)}function S2(r){if(r._id!==this._id)throw new Error;for(var t=this._groups,e=r._groups,i=t.length,n=e.length,s=Math.min(i,n),o=new Array(i),a=0;a<s;++a)for(var h=t[a],l=e[a],c=h.length,u=o[a]=new Array(c),d,f=0;f<c;++f)(d=h[f]||l[f])&&(u[f]=d);for(;a<i;++a)o[a]=t[a];return new Ce(o,this._parents,this._name,this._id)}function C2(r){return(r+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function I2(r,t,e){var i,n,s=C2(t)?vh:pe;return function(){var o=s(this,r),a=o.on;a!==i&&(n=(i=a).copy()).on(t,e),o.on=n}}function P2(r,t){var e=this._id;return arguments.length<2?qt(this.node(),e).on.on(r):this.each(I2(e,r,t))}function R2(r){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==r)return;t&&t.removeChild(this)}}function M2(){return this.on("end.remove",R2(this._id))}function F2(r){var t=this._name,e=this._id;typeof r!="function"&&(r=Ga(r));for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o)for(var a=i[o],h=a.length,l=s[o]=new Array(h),c,u,d=0;d<h;++d)(c=a[d])&&(u=r.call(c,c.__data__,d,a))&&("__data__"in c&&(u.__data__=c.__data__),l[d]=u,Ms(l[d],t,e,d,l,qt(c,e)));return new Ce(s,this._parents,t,e)}function B2(r){var t=this._name,e=this._id;typeof r!="function"&&(r=Nc(r));for(var i=this._groups,n=i.length,s=[],o=[],a=0;a<n;++a)for(var h=i[a],l=h.length,c,u=0;u<l;++u)if(c=h[u]){for(var d=r.call(c,c.__data__,u,h),f,p=qt(c,e),m=0,g=d.length;m<g;++m)(f=d[m])&&Ms(f,t,e,m,d,p);s.push(d),o.push(c)}return new Ce(s,o,t,e)}var D2=Ni.prototype.constructor;function L2(){return new D2(this._groups,this._parents)}function N2(r,t){var e,i,n;return function(){var s=Vr(this,r),o=(this.style.removeProperty(r),Vr(this,r));return s===o?null:s===e&&o===i?n:n=t(e=s,i=o)}}function of(r){return function(){this.style.removeProperty(r)}}function O2(r,t,e){var i,n=e+"",s;return function(){var o=Vr(this,r);return o===n?null:o===i?s:s=t(i=o,e)}}function k2(r,t,e){var i,n,s;return function(){var o=Vr(this,r),a=e(this),h=a+"";return a==null&&(h=a=(this.style.removeProperty(r),Vr(this,r))),o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a))}}function U2(r,t){var e,i,n,s="style."+t,o="end."+s,a;return function(){var h=pe(this,r),l=h.on,c=h.value[s]==null?a||(a=of(t)):void 0;(l!==e||n!==c)&&(i=(e=l).copy()).on(o,n=c),h.on=i}}function G2(r,t,e){var i=(r+="")=="transform"?ob:sf;return t==null?this.styleTween(r,N2(r,i)).on("end.style."+r,of(r)):typeof t=="function"?this.styleTween(r,k2(r,i,xh(this,"style."+r,t))).each(U2(this._id,r)):this.styleTween(r,O2(r,i,t),e).on("end.style."+r,null)}function H2(r,t,e){return function(i){this.style.setProperty(r,t.call(this,i),e)}}function z2(r,t,e){var i,n;function s(){var o=t.apply(this,arguments);return o!==n&&(i=(n=o)&&H2(r,o,e)),i}return s._value=t,s}function $2(r,t,e){var i="style."+(r+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,z2(r,t,e??""))}function V2(r){return function(){this.textContent=r}}function X2(r){return function(){var t=r(this);this.textContent=t??""}}function W2(r){return this.tween("text",typeof r=="function"?X2(xh(this,"text",r)):V2(r==null?"":r+""))}function j2(r){return function(t){this.textContent=r.call(this,t)}}function Y2(r){var t,e;function i(){var n=r.apply(this,arguments);return n!==e&&(t=(e=n)&&j2(n)),t}return i._value=r,i}function q2(r){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(r==null)return this.tween(t,null);if(typeof r!="function")throw new Error;return this.tween(t,Y2(r))}function Z2(){for(var r=this._name,t=this._id,e=af(),i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,h,l=0;l<a;++l)if(h=o[l]){var c=qt(h,t);Ms(h,r,e,l,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Ce(i,this._parents,r,e)}function K2(){var r,t,e=this,i=e._id,n=e.size();return new Promise(function(s,o){var a={value:o},h={value:function(){--n===0&&s()}};e.each(function(){var l=pe(this,i),c=l.on;c!==r&&(t=(r=c).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(h)),l.on=t}),n===0&&s()})}var Q2=0;function Ce(r,t,e,i){this._groups=r,this._parents=t,this._name=e,this._id=i}function af(){return++Q2}var ye=Ni.prototype;Ce.prototype={constructor:Ce,select:F2,selectAll:B2,selectChild:ye.selectChild,selectChildren:ye.selectChildren,filter:E2,merge:S2,selection:L2,transition:Z2,call:ye.call,nodes:ye.nodes,node:ye.node,size:ye.size,empty:ye.empty,each:ye.each,on:P2,attr:l2,attrTween:p2,style:G2,styleTween:$2,text:W2,textTween:q2,remove:M2,tween:r2,delay:y2,duration:x2,ease:w2,easeVarying:A2,end:K2,[Symbol.iterator]:ye[Symbol.iterator]};function J2(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var tT={time:null,delay:0,duration:250,ease:J2};function eT(r,t){for(var e;!(e=r.__transition)||!(e=e[t]);)if(!(r=r.parentNode))throw new Error(`transition ${t} not found`);return e}function rT(r){var t,e;r instanceof Ce?(t=r._id,r=r._name):(t=af(),(e=tT).time=_h(),r=r==null?null:r+"");for(var i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&Ms(h,r,t,l,o,e||eT(h,t));return new Ce(i,this._parents,r,t)}Ni.prototype.interrupt=Jw;Ni.prototype.transition=rT;const bn=r=>()=>r;function iT(r,{sourceEvent:t,target:e,transform:i,dispatch:n}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:n}})}function Ae(r,t,e){this.k=r,this.x=t,this.y=e}Ae.prototype={constructor:Ae,scale:function(r){return r===1?this:new Ae(this.k*r,this.x,this.y)},translate:function(r,t){return r===0&t===0?this:new Ae(this.k,this.x+this.k*r,this.y+this.k*t)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var bh=new Ae(1,0,0);Ae.prototype;function So(r){r.stopImmediatePropagation()}function di(r){r.preventDefault(),r.stopImmediatePropagation()}function nT(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function sT(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function Rc(){return this.__zoom||bh}function oT(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function aT(){return navigator.maxTouchPoints||"ontouchstart"in this}function hT(r,t,e){var i=r.invertX(t[0][0])-e[0][0],n=r.invertX(t[1][0])-e[1][0],s=r.invertY(t[0][1])-e[0][1],o=r.invertY(t[1][1])-e[1][1];return r.translate(n>i?(i+n)/2:Math.min(0,i)||Math.max(0,n),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function lT(){var r=nT,t=sT,e=hT,i=oT,n=aT,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,h=ub,l=yh("start","zoom","end"),c,u,d,f=500,p=150,m=0,g=10;function y(b){b.property("__zoom",Rc).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",F).on("dblclick.zoom",O).filter(n).on("touchstart.zoom",N).on("touchmove.zoom",B).on("touchend.zoom touchcancel.zoom",A).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(b,I,E,R){var L=b.selection?b.selection():b;L.property("__zoom",Rc),b!==L?w(b,I,E,R):L.interrupt().each(function(){C(this,arguments).event(R).start().zoom(null,typeof I=="function"?I.apply(this,arguments):I).end()})},y.scaleBy=function(b,I,E,R){y.scaleTo(b,function(){var L=this.__zoom.k,z=typeof I=="function"?I.apply(this,arguments):I;return L*z},E,R)},y.scaleTo=function(b,I,E,R){y.transform(b,function(){var L=t.apply(this,arguments),z=this.__zoom,P=E==null?x(L):typeof E=="function"?E.apply(this,arguments):E,M=z.invert(P),W=typeof I=="function"?I.apply(this,arguments):I;return e(_(v(z,W),P,M),L,o)},E,R)},y.translateBy=function(b,I,E,R){y.transform(b,function(){return e(this.__zoom.translate(typeof I=="function"?I.apply(this,arguments):I,typeof E=="function"?E.apply(this,arguments):E),t.apply(this,arguments),o)},null,R)},y.translateTo=function(b,I,E,R,L){y.transform(b,function(){var z=t.apply(this,arguments),P=this.__zoom,M=R==null?x(z):typeof R=="function"?R.apply(this,arguments):R;return e(bh.translate(M[0],M[1]).scale(P.k).translate(typeof I=="function"?-I.apply(this,arguments):-I,typeof E=="function"?-E.apply(this,arguments):-E),z,o)},R,L)};function v(b,I){return I=Math.max(s[0],Math.min(s[1],I)),I===b.k?b:new Ae(I,b.x,b.y)}function _(b,I,E){var R=I[0]-E[0]*b.k,L=I[1]-E[1]*b.k;return R===b.x&&L===b.y?b:new Ae(b.k,R,L)}function x(b){return[(+b[0][0]+ +b[1][0])/2,(+b[0][1]+ +b[1][1])/2]}function w(b,I,E,R){b.on("start.zoom",function(){C(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(R).end()}).tween("zoom",function(){var L=this,z=arguments,P=C(L,z).event(R),M=t.apply(L,z),W=E==null?x(M):typeof E=="function"?E.apply(L,z):E,Q=Math.max(M[1][0]-M[0][0],M[1][1]-M[0][1]),q=L.__zoom,et=typeof I=="function"?I.apply(L,z):I,rt=h(q.invert(W).concat(Q/q.k),et.invert(W).concat(Q/et.k));return function(it){if(it===1)it=et;else{var nt=rt(it),_t=Q/nt[2];it=new Ae(_t,W[0]-nt[0]*_t,W[1]-nt[1]*_t)}P.zoom(null,it)}})}function C(b,I,E){return!E&&b.__zooming||new T(b,I)}function T(b,I){this.that=b,this.args=I,this.active=0,this.sourceEvent=null,this.extent=t.apply(b,I),this.taps=0}T.prototype={event:function(b){return b&&(this.sourceEvent=b),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(b,I){return this.mouse&&b!=="mouse"&&(this.mouse[1]=I.invert(this.mouse[0])),this.touch0&&b!=="touch"&&(this.touch0[1]=I.invert(this.touch0[0])),this.touch1&&b!=="touch"&&(this.touch1[1]=I.invert(this.touch1[0])),this.that.__zoom=I,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(b){var I=De(this.that).datum();l.call(b,this.that,new iT(b,{sourceEvent:this.sourceEvent,target:y,type:b,transform:this.that.__zoom,dispatch:l}),I)}};function S(b,...I){if(!r.apply(this,arguments))return;var E=C(this,I).event(b),R=this.__zoom,L=Math.max(s[0],Math.min(s[1],R.k*Math.pow(2,i.apply(this,arguments)))),z=qe(b);if(E.wheel)(E.mouse[0][0]!==z[0]||E.mouse[0][1]!==z[1])&&(E.mouse[1]=R.invert(E.mouse[0]=z)),clearTimeout(E.wheel);else{if(R.k===L)return;E.mouse=[z,R.invert(z)],Nn(this),E.start()}di(b),E.wheel=setTimeout(P,p),E.zoom("mouse",e(_(v(R,L),E.mouse[0],E.mouse[1]),E.extent,o));function P(){E.wheel=null,E.end()}}function F(b,...I){if(d||!r.apply(this,arguments))return;var E=b.currentTarget,R=C(this,I,!0).event(b),L=De(b.view).on("mousemove.zoom",W,!0).on("mouseup.zoom",Q,!0),z=qe(b,E),P=b.clientX,M=b.clientY;Vw(b.view),So(b),R.mouse=[z,this.__zoom.invert(z)],Nn(this),R.start();function W(q){if(di(q),!R.moved){var et=q.clientX-P,rt=q.clientY-M;R.moved=et*et+rt*rt>m}R.event(q).zoom("mouse",e(_(R.that.__zoom,R.mouse[0]=qe(q,E),R.mouse[1]),R.extent,o))}function Q(q){L.on("mousemove.zoom mouseup.zoom",null),Xw(q.view,R.moved),di(q),R.event(q).end()}}function O(b,...I){if(r.apply(this,arguments)){var E=this.__zoom,R=qe(b.changedTouches?b.changedTouches[0]:b,this),L=E.invert(R),z=E.k*(b.shiftKey?.5:2),P=e(_(v(E,z),R,L),t.apply(this,I),o);di(b),a>0?De(this).transition().duration(a).call(w,P,R,b):De(this).call(y.transform,P,R,b)}}function N(b,...I){if(r.apply(this,arguments)){var E=b.touches,R=E.length,L=C(this,I,b.changedTouches.length===R).event(b),z,P,M,W;for(So(b),P=0;P<R;++P)M=E[P],W=qe(M,this),W=[W,this.__zoom.invert(W),M.identifier],L.touch0?!L.touch1&&L.touch0[2]!==W[2]&&(L.touch1=W,L.taps=0):(L.touch0=W,z=!0,L.taps=1+!!c);c&&(c=clearTimeout(c)),z&&(L.taps<2&&(u=W[0],c=setTimeout(function(){c=null},f)),Nn(this),L.start())}}function B(b,...I){if(this.__zooming){var E=C(this,I).event(b),R=b.changedTouches,L=R.length,z,P,M,W;for(di(b),z=0;z<L;++z)P=R[z],M=qe(P,this),E.touch0&&E.touch0[2]===P.identifier?E.touch0[0]=M:E.touch1&&E.touch1[2]===P.identifier&&(E.touch1[0]=M);if(P=E.that.__zoom,E.touch1){var Q=E.touch0[0],q=E.touch0[1],et=E.touch1[0],rt=E.touch1[1],it=(it=et[0]-Q[0])*it+(it=et[1]-Q[1])*it,nt=(nt=rt[0]-q[0])*nt+(nt=rt[1]-q[1])*nt;P=v(P,Math.sqrt(it/nt)),M=[(Q[0]+et[0])/2,(Q[1]+et[1])/2],W=[(q[0]+rt[0])/2,(q[1]+rt[1])/2]}else if(E.touch0)M=E.touch0[0],W=E.touch0[1];else return;E.zoom("touch",e(_(P,M,W),E.extent,o))}}function A(b,...I){if(this.__zooming){var E=C(this,I).event(b),R=b.changedTouches,L=R.length,z,P;for(So(b),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),z=0;z<L;++z)P=R[z],E.touch0&&E.touch0[2]===P.identifier?delete E.touch0:E.touch1&&E.touch1[2]===P.identifier&&delete E.touch1;if(E.touch1&&!E.touch0&&(E.touch0=E.touch1,delete E.touch1),E.touch0)E.touch0[1]=this.__zoom.invert(E.touch0[0]);else if(E.end(),E.taps===2&&(P=qe(P,this),Math.hypot(u[0]-P[0],u[1]-P[1])<g)){var M=De(this).on("dblclick.zoom");M&&M.apply(this,arguments)}}}return y.wheelDelta=function(b){return arguments.length?(i=typeof b=="function"?b:bn(+b),y):i},y.filter=function(b){return arguments.length?(r=typeof b=="function"?b:bn(!!b),y):r},y.touchable=function(b){return arguments.length?(n=typeof b=="function"?b:bn(!!b),y):n},y.extent=function(b){return arguments.length?(t=typeof b=="function"?b:bn([[+b[0][0],+b[0][1]],[+b[1][0],+b[1][1]]]),y):t},y.scaleExtent=function(b){return arguments.length?(s[0]=+b[0],s[1]=+b[1],y):[s[0],s[1]]},y.translateExtent=function(b){return arguments.length?(o[0][0]=+b[0][0],o[1][0]=+b[1][0],o[0][1]=+b[0][1],o[1][1]=+b[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(b){return arguments.length?(e=b,y):e},y.duration=function(b){return arguments.length?(a=+b,y):a},y.interpolate=function(b){return arguments.length?(h=b,y):h},y.on=function(){var b=l.on.apply(l,arguments);return b===l?y:b},y.clickDistance=function(b){return arguments.length?(m=(b=+b)*b,y):Math.sqrt(m)},y.tapDistance=function(b){return arguments.length?(g=+b,y):g},y}const cT=.1,uT=256;class TT{constructor(t,e,i={maxZoomLevel:uT,minZoomLevel:cT}){this.xBounds=[0,1],this.yBounds=[0,1],this.translateBoundsX=[0,1],this.translateBoundsY=[0,1],this._zFactor=1,this._enableTranslateExtent=!1,this.container=De(t),this.options=i,this.onRescale=e,this.onZoom=this.onZoom.bind(this),this.calculateTransform=this.calculateTransform.bind(this),this.applyTransform=this.applyTransform.bind(this),this.recalculateZoomTransform=this.recalculateZoomTransform.bind(this),this.rescale=this.rescale.bind(this),this.adjustToSize=this.adjustToSize.bind(this),this.setViewport=this.setViewport.bind(this),this.currentStateAsEvent=this.currentStateAsEvent.bind(this),this.updateTranslateExtent=this.updateTranslateExtent.bind(this),this.scaleX=hs().domain(this.xBounds).range([0,1]),this.scaleY=hs().domain(this.yBounds).range([0,1]),this.init()}get width(){return this.scaleX.range()[1]??0}get height(){return this.scaleY.range()[1]??0}get xSpan(){const{xBounds:t}=this;return Math.abs(t[1]-t[0])}get ySpan(){const{yBounds:t}=this;return Math.abs(t[1]-t[0])}get viewportRatio(){return this.width/(this.height||1)}get xRatio(){const t=this.scaleX.domain();return Math.abs(this.width/(t[1]-t[0]))}get yRatio(){const t=this.scaleY.domain();return Math.abs(this.height/(t[1]-t[0]))}get zFactor(){return this._zFactor}set zFactor(t){this._zFactor=t,this.recalculateZoomTransform()}get isXInverted(){return this.xBounds[1]<this.xBounds[0]}get isYInverted(){return this.yBounds[1]<this.yBounds[0]}get enableTranslateExtent(){return this._enableTranslateExtent}set enableTranslateExtent(t){this._enableTranslateExtent=t,this.updateTranslateExtent()}updateTranslateExtent(){const{width:t,xSpan:e,zFactor:i,enableTranslateExtent:n,translateBoundsX:s,translateBoundsY:o}=this;let a=-1/0,h=-1/0,l=1/0,c=1/0;if(n){const u=t/e;a=s[0]*u,l=s[1]*u,h=o[0]*u*i,c=o[1]*u*i}this.zoom.translateExtent([[a,h],[l,c]])}currentStateAsEvent(){const{scaleX:t,scaleY:e,xBounds:i,yBounds:n,zFactor:s,viewportRatio:o,currentTransform:a,xRatio:h,yRatio:l,width:c,height:u}=this;return{xScale:t.copy(),yScale:e.copy(),xBounds:i,yBounds:n,zFactor:s,viewportRatio:o,xRatio:h,yRatio:l,width:c,height:u,transform:Object.assign({},a)}}rescale(){const{currentStateAsEvent:t}=this;this.onRescale(t())}init(){this.zoom=lT().scaleExtent([this.options.minZoomLevel,this.options.maxZoomLevel]).on("zoom",this.onZoom),this.container.call(this.zoom)}onZoom(t){const{transform:e}=t;e&&(this.applyTransform(e),this.rescale())}applyTransform(t){const{width:e,scaleX:i,scaleY:n,xSpan:s,xBounds:o,yBounds:a,zFactor:h}=this,{viewportRatio:l,isXInverted:c,isYInverted:u}=this,d=e*t.k,f=s/d,p=s/t.k,m=p/h/l,g=f*t.x,y=f/h*t.y,v=o[0]-(c?-g:g),_=a[0]-(u?-y:y);i.domain([v,v+(c?-p:p)]),n.domain([_,_+(u?-m:m)]),this.currentTransform=t}setViewport(t,e,i,n){const{zoom:s,container:o,calculateTransform:a,scaleX:h,scaleY:l,isXInverted:c}=this;if(t==null||i==null||isNaN(t)||isNaN(i)){const m=h.domain(),g=m[1]-m[0];(t==null||isNaN(t))&&(t=m[0]+g/2||0),(i==null||isNaN(i))&&(i=Math.abs(g)||1)}if(e==null||isNaN(e)){const m=l.domain();e=m[0]+(m[1]-m[0])/2||0}const u=c?-i:i,d=t-u/2,f=d+u,p=a(d,f,e);n!=null&&Number.isFinite(n)&&n>0?s.transform(o.transition().duration(n),p):s.transform(o,p)}setBounds(t,e){this.xBounds=t,this.yBounds=e,this.recalculateZoomTransform()}setTranslateBounds(t,e){this.translateBoundsX=t,this.translateBoundsY=e,this.updateTranslateExtent()}adjustToSize(t,e,i=!1){const{width:n,height:s,scaleX:o,scaleY:a,recalculateZoomTransform:h}=this;let l=0,c=0;if(typeof t=="number"&&typeof e=="number")c=e,l=t;else{const f=this.container.node();if(f){const{width:p,height:m}=f.getBoundingClientRect();l=p,c=m}}const u=Math.max(1,l),d=Math.max(1,c);!i&&n===u&&s===d||(o.range([0,u]),a.range([0,d]),h(),this.onRescale(this.currentStateAsEvent()))}calculateTransform(t,e,i){const{scaleX:n,xSpan:s,xBounds:o,yBounds:a,zFactor:h,viewportRatio:l,isXInverted:c,isYInverted:u}=this,[d,f]=n.range(),p=Math.abs(e-t),m=s/p,g=p/(f-d),y=i-(u?-p:p)/h/l/2,v=(o[0]-t)/(c?-g:g),_=(a[0]-y)/((u?-g:g)/h);return bh.translate(v,_).scale(m)}recalculateZoomTransform(){const{scaleX:t,scaleY:e,container:i,calculateTransform:n,updateTranslateExtent:s}=this,[o,a]=t.domain(),[h,l]=e.domain(),c=h+(l-h)/2,u=n(o,a,c);s(),this.zoom.transform(i,u)}setZoomLevelBoundary(t){return this.zoom.scaleExtent(t),this}setMaxZoomLevel(t){const e=this.zoom.scaleExtent();return this.zoom.scaleExtent([e[0],t]),this}setMinZoomLevel(t){const e=this.zoom.scaleExtent();return this.zoom.scaleExtent([t,e[1]]),this}}const AT=r=>{const t=document.createElement("div");return t.setAttribute("style",`display: flex;flex:1;flex-direction:column; width: ${r}px;height:100%; background-color: white; padding: 12px;`),t},ET=(r,t)=>{const e=document.createElement("div");return e.className="story-layer-container",e.setAttribute("style",`height: ${t}px; width: ${r}px;background-color: #eee;`),e.setAttribute("height",`${t}`),e.setAttribute("width",`${r}`),e},ST=r=>{const t=document.createElement("div");return t.className="button-container",t.setAttribute("style",`width: ${r}px;background-color: white;`),t},CT=()=>{const r=document.createElement("p"),t=[];let e;function i(){window.requestAnimationFrame(()=>{const n=performance.now();for(;t.length>0&&t[0]<=n-1e3;)t.shift();t.push(n),e=t.length,r.innerHTML=`FPS: ${e}`,i()})}return i(),r},IT=r=>{const t=document.createElement("p");return t.innerHTML=r,t};export{gT as C,Bc as D,Ci as G,fT as H,Fc as L,yT as P,wT as S,Md as V,TT as Z,ET as a,IT as b,AT as c,CT as d,ow as e,vT as f,ST as g,Dc as h,xT as i,bT as j,pT as k,sh as l,hs as m,$e as n,ux as o,mT as p,$v as q,sr as r,De as s,_T as t,qe as u};
//# sourceMappingURL=elements-861b6ce3.js.map
