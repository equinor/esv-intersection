{"version":3,"file":"findsample-968c1705.js","sources":["../../../../src/datautils/findsample.ts"],"sourcesContent":["export function findIndexOfSample(data: number[][], pos: number): number {\n  if (data.length < 2) {\n    return -1;\n  }\n\n  const linearSearchLimit = 20;\n  let a = 0;\n  let b = data.length - 1;\n  let aPos = data[a]?.[0];\n  let bPos = data[b]?.[0];\n\n  while (b - a > linearSearchLimit) {\n    const splitAt = Math.floor((b + a) / 2);\n    const splitPos = data[splitAt]?.[0];\n\n    if (aPos == null || bPos == null || splitPos == null) {\n      return -1;\n    }\n\n    if (pos >= aPos && pos < splitPos) {\n      b = splitAt;\n      bPos = data[b]?.[0];\n    } else if (pos >= splitPos && pos <= bPos) {\n      a = splitAt;\n      aPos = data[a]?.[0];\n    } else if (pos <= aPos && pos > splitPos) {\n      b = splitAt;\n      bPos = data[b]?.[0];\n    } else if (pos <= splitPos && pos >= bPos) {\n      a = splitAt;\n      aPos = data[a]?.[0];\n    } else {\n      return -1;\n    }\n  }\n\n  let index = -1;\n  for (let i = a; i < b; i++) {\n    const v1 = data[i]?.[0];\n    const v2 = data[i + 1]?.[0];\n    if (v1 != null && v2 != null && Math.min(v1, v2) <= pos && pos <= Math.max(v1, v2)) {\n      index = i;\n      break;\n    }\n  }\n\n  return index;\n}\n\nexport function findSampleAtPos(data: number[][], pos: number, topLimit = 0, bottomLimit = 0): number {\n  let y = 0;\n  const index = findIndexOfSample(data, pos);\n  if (index !== -1) {\n    const v1 = data[index]?.[1];\n    const v2 = data[index + 1]?.[1];\n\n    if (v1 && v2) {\n      const x1 = data[index]?.[0] ?? 0;\n      const x2 = data[index + 1]?.[0] ?? 0;\n      const span = x2 - x1;\n      const d = pos - x1;\n      const f = d / span;\n      y = v1 * (1 - f) + v2 * f;\n      if (topLimit && topLimit > y) {\n        y = topLimit;\n      }\n      if (bottomLimit && bottomLimit < y) {\n        y = bottomLimit;\n      }\n    }\n  }\n  return y;\n}\n"],"names":["findIndexOfSample","data","pos","_a","_b","_c","_d","_e","_f","_g","_h","_i","linearSearchLimit","a","b","aPos","bPos","splitAt","splitPos","index","i","v1","v2","findSampleAtPos","topLimit","bottomLimit","y","x1","span","f"],"mappings":"AAAgB,SAAAA,EAAkBC,EAAkBC,EAAqB,CAAzD,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACV,GAAAV,EAAK,OAAS,EACT,MAAA,GAGT,MAAMW,EAAoB,GAC1B,IAAIC,EAAI,EACJC,EAAIb,EAAK,OAAS,EAClBc,GAAOZ,EAAAF,EAAKY,CAAC,IAAN,YAAAV,EAAU,GACjBa,GAAOZ,EAAAH,EAAKa,CAAC,IAAN,YAAAV,EAAU,GAEd,KAAAU,EAAID,EAAID,GAAmB,CAChC,MAAMK,EAAU,KAAK,OAAOH,EAAID,GAAK,CAAC,EAChCK,GAAWb,EAAAJ,EAAKgB,CAAO,IAAZ,YAAAZ,EAAgB,GAEjC,GAAIU,GAAQ,MAAQC,GAAQ,MAAQE,GAAY,KACvC,MAAA,GAGL,GAAAhB,GAAOa,GAAQb,EAAMgB,EACnBJ,EAAAG,EACGD,GAAAV,EAAAL,EAAKa,CAAC,IAAN,YAAAR,EAAU,WACRJ,GAAOgB,GAAYhB,GAAOc,EAC/BH,EAAAI,EACGF,GAAAR,EAAAN,EAAKY,CAAC,IAAN,YAAAN,EAAU,WACRL,GAAOa,GAAQb,EAAMgB,EAC1BJ,EAAAG,EACGD,GAAAR,EAAAP,EAAKa,CAAC,IAAN,YAAAN,EAAU,WACRN,GAAOgB,GAAYhB,GAAOc,EAC/BH,EAAAI,EACGF,GAAAN,EAAAR,EAAKY,CAAC,IAAN,YAAAJ,EAAU,OAEV,OAAA,EAEX,CAEA,IAAIU,EAAQ,GACZ,QAASC,EAAIP,EAAGO,EAAIN,EAAGM,IAAK,CAC1B,MAAMC,GAAKX,EAAAT,EAAKmB,CAAC,IAAN,YAAAV,EAAU,GACfY,GAAKX,EAAAV,EAAKmB,EAAI,CAAC,IAAV,YAAAT,EAAc,GACzB,GAAIU,GAAM,MAAQC,GAAM,MAAQ,KAAK,IAAID,EAAIC,CAAE,GAAKpB,GAAOA,GAAO,KAAK,IAAImB,EAAIC,CAAE,EAAG,CAC1EH,EAAAC,EACR,KACF,CACF,CAEO,OAAAD,CACT,CAEO,SAASI,EAAgBtB,EAAkBC,EAAasB,EAAW,EAAGC,EAAc,EAAW,CAjDtF,IAAAtB,EAAAC,EAAAC,EAAAC,EAkDd,IAAIoB,EAAI,EACF,MAAAP,EAAQnB,EAAkBC,EAAMC,CAAG,EACzC,GAAIiB,IAAU,GAAI,CAChB,MAAME,GAAKlB,EAAAF,EAAKkB,CAAK,IAAV,YAAAhB,EAAc,GACnBmB,GAAKlB,EAAAH,EAAKkB,EAAQ,CAAC,IAAd,YAAAf,EAAkB,GAE7B,GAAIiB,GAAMC,EAAI,CACZ,MAAMK,IAAKtB,EAAAJ,EAAKkB,CAAK,IAAV,YAAAd,EAAc,KAAM,EAEzBuB,KADKtB,EAAAL,EAAKkB,EAAQ,CAAC,IAAd,YAAAb,EAAkB,KAAM,GACjBqB,EAEZE,GADI3B,EAAMyB,GACFC,EACVF,EAAAL,GAAM,EAAIQ,GAAKP,EAAKO,EACpBL,GAAYA,EAAWE,IACrBA,EAAAF,GAEFC,GAAeA,EAAcC,IAC3BA,EAAAD,EAER,CACF,CACO,OAAAC,CACT"}